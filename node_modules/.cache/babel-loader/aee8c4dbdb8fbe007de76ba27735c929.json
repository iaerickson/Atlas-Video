{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\irlan\\\\OneDrive\\\\Desktop\\\\Atlas-Video\\\\src\\\\components\\\\AgoraVideoCall\\\\index.jsx\";\nimport React from 'react';\nimport { merge } from 'lodash';\nimport AgoraRTC from 'agora-rtc-sdk';\nimport './canvas.css';\nimport '../../assets/fonts/css/icons.css';\nconst tile_canvas = {\n  '1': ['span 12/span 24'],\n  '2': ['span 12/span 12/13/25', 'span 12/span 12/13/13'],\n  '3': ['span 6/span 12', 'span 6/span 12', 'span 6/span 12/7/19'],\n  '4': ['span 6/span 12', 'span 6/span 12', 'span 6/span 12', 'span 6/span 12/7/13'],\n  '5': ['span 3/span 4/13/9', 'span 3/span 4/13/13', 'span 3/span 4/13/17', 'span 3/span 4/13/21', 'span 9/span 16/10/21'],\n  '6': ['span 3/span 4/13/7', 'span 3/span 4/13/11', 'span 3/span 4/13/15', 'span 3/span 4/13/19', 'span 3/span 4/13/23', 'span 9/span 16/10/21'],\n  '7': ['span 3/span 4/13/5', 'span 3/span 4/13/9', 'span 3/span 4/13/13', 'span 3/span 4/13/17', 'span 3/span 4/13/21', 'span 3/span 4/13/25', 'span 9/span 16/10/21']\n};\n/**\n * @prop appId uid\n * @prop transcode attendeeMode videoProfile channel baseMode\n */\n\nclass AgoraCanvas extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.streamInit = (uid, attendeeMode, videoProfile, config) => {\n      let defaultConfig = {\n        streamID: uid,\n        audio: true,\n        video: true,\n        screen: false\n      };\n\n      switch (attendeeMode) {\n        case 'audio-only':\n          defaultConfig.video = false;\n          break;\n\n        case 'audience':\n          defaultConfig.video = false;\n          defaultConfig.audio = false;\n          break;\n\n        default:\n        case 'video':\n          break;\n      }\n\n      let stream = AgoraRTC.createStream(merge(defaultConfig, config));\n      stream.setVideoProfile(videoProfile);\n      return stream;\n    };\n\n    this.subscribeStreamEvents = () => {\n      let rt = this;\n      rt.client.on('stream-added', function (evt) {\n        let stream = evt.stream;\n        console.log(\"New stream added: \" + stream.getId());\n        console.log('At ' + new Date().toLocaleTimeString());\n        console.log(\"Subscribe \", stream);\n        rt.client.subscribe(stream, function (err) {\n          console.log(\"Subscribe stream failed\", err);\n        });\n      });\n      rt.client.on('peer-leave', function (evt) {\n        console.log(\"Peer has left: \" + evt.uid);\n        console.log(new Date().toLocaleTimeString());\n        console.log(evt);\n        rt.removeStream(evt.uid);\n      });\n      rt.client.on('stream-subscribed', function (evt) {\n        let stream = evt.stream;\n        console.log(\"Got stream-subscribed event\");\n        console.log(new Date().toLocaleTimeString());\n        console.log(\"Subscribe remote stream successfully: \" + stream.getId());\n        console.log(evt);\n        rt.addStream(stream);\n      });\n      rt.client.on(\"stream-removed\", function (evt) {\n        let stream = evt.stream;\n        console.log(\"Stream removed: \" + stream.getId());\n        console.log(new Date().toLocaleTimeString());\n        console.log(evt);\n        rt.removeStream(stream.getId());\n      });\n    };\n\n    this.removeStream = uid => {\n      this.state.streamList.map((item, index) => {\n        if (item.getId() === uid) {\n          item.close();\n          let element = document.querySelector('#ag-item-' + uid);\n\n          if (element) {\n            element.parentNode.removeChild(element);\n          }\n\n          let tempList = [...this.state.streamList];\n          tempList.splice(index, 1);\n          this.setState({\n            streamList: tempList\n          });\n        }\n      });\n    };\n\n    this.addStream = (stream, push = false) => {\n      let repeatition = this.state.streamList.some(item => {\n        return item.getId() === stream.getId();\n      });\n\n      if (repeatition) {\n        return;\n      }\n\n      if (push) {\n        this.setState({\n          streamList: this.state.streamList.concat([stream])\n        });\n      } else {\n        this.setState({\n          streamList: [stream].concat(this.state.streamList)\n        });\n      }\n    };\n\n    this.handleCamera = e => {\n      e.currentTarget.classList.toggle('off');\n      this.localStream.isVideoOn() ? this.localStream.disableVideo() : this.localStream.enableVideo();\n    };\n\n    this.handleMic = e => {\n      e.currentTarget.classList.toggle('off');\n      this.localStream.isAudioOn() ? this.localStream.disableAudio() : this.localStream.enableAudio();\n    };\n\n    this.switchDisplay = e => {\n      if (e.currentTarget.classList.contains('disabled') || this.state.streamList.length <= 1) {\n        return;\n      }\n\n      if (this.state.displayMode === 'pip') {\n        this.setState({\n          displayMode: 'tile'\n        });\n      } else if (this.state.displayMode === 'tile') {\n        this.setState({\n          displayMode: 'pip'\n        });\n      } else if (this.state.displayMode === 'share') {// do nothing or alert, tbd\n      } else {\n        console.error('Display Mode can only be tile/pip/share');\n      }\n    };\n\n    this.hideRemote = e => {\n      if (e.currentTarget.classList.contains('disabled') || this.state.streamList.length <= 1) {\n        return;\n      }\n\n      let list;\n      let id = this.state.streamList[this.state.streamList.length - 1].getId();\n      list = Array.from(document.querySelectorAll(`.ag-item:not(#ag-item-${id})`));\n      list.map(item => {\n        if (item.style.display !== 'none') {\n          item.style.display = 'none';\n        } else {\n          item.style.display = 'block';\n        }\n      });\n    };\n\n    this.handleExit = e => {\n      if (e.currentTarget.classList.contains('disabled')) {\n        return;\n      }\n\n      try {\n        this.client && this.client.unpublish(this.localStream);\n        this.localStream && this.localStream.close();\n        this.client && this.client.leave(() => {\n          console.log('Client succeed to leave.');\n        }, () => {\n          console.log('Client failed to leave.');\n        });\n      } finally {\n        this.setState({\n          readyState: false\n        });\n        this.client = null;\n        this.localStream = null; // redirect to index\n\n        window.location.hash = '';\n      }\n    };\n\n    this.client = {};\n    this.localStream = {};\n    this.shareClient = {};\n    this.shareStream = {};\n    this.state = {\n      displayMode: 'pip',\n      streamList: [],\n      readyState: false\n    };\n  }\n\n  componentWillMount() {\n    let $ = this.props; // init AgoraRTC local client\n\n    this.client = AgoraRTC.createClient({\n      mode: $.transcode\n    });\n    this.client.init($.appId, () => {\n      console.log(\"AgoraRTC client initialized\");\n      this.subscribeStreamEvents();\n      this.client.join($.appId, $.channel, $.uid, uid => {\n        console.log(\"User \" + uid + \" join channel successfully\");\n        console.log('At ' + new Date().toLocaleTimeString()); // create local stream\n        // It is not recommended to setState in function addStream\n\n        this.localStream = this.streamInit(uid, $.attendeeMode, $.videoProfile);\n        this.localStream.init(() => {\n          if ($.attendeeMode !== 'audience') {\n            this.addStream(this.localStream, true);\n            this.client.publish(this.localStream, err => {\n              console.log(\"Publish local stream error: \" + err);\n            });\n          }\n\n          this.setState({\n            readyState: true\n          });\n        }, err => {\n          console.log(\"getUserMedia failed\", err);\n          this.setState({\n            readyState: true\n          });\n        });\n      });\n    });\n  }\n\n  componentDidMount() {\n    // add listener to control btn group\n    let canvas = document.querySelector('#ag-canvas');\n    let btnGroup = document.querySelector('.ag-btn-group');\n    canvas.addEventListener('mousemove', () => {\n      if (global._toolbarToggle) {\n        clearTimeout(global._toolbarToggle);\n      }\n\n      btnGroup.classList.add('active');\n      global._toolbarToggle = setTimeout(function () {\n        btnGroup.classList.remove('active');\n      }, 2000);\n    });\n  } // componentWillUnmount () {\n  //     // remove listener\n  //     let canvas = document.querySelector('#ag-canvas')\n  //     canvas.removeEventListener('mousemove')\n  // }\n\n\n  componentDidUpdate() {\n    // rerendering\n    let canvas = document.querySelector('#ag-canvas'); // pip mode (can only use when less than 4 people in channel)\n\n    if (this.state.displayMode === 'pip') {\n      let no = this.state.streamList.length;\n\n      if (no > 4) {\n        this.setState({\n          displayMode: 'tile'\n        });\n        return;\n      }\n\n      this.state.streamList.map((item, index) => {\n        let id = item.getId();\n        let dom = document.querySelector('#ag-item-' + id);\n\n        if (!dom) {\n          dom = document.createElement('section');\n          dom.setAttribute('id', 'ag-item-' + id);\n          dom.setAttribute('class', 'ag-item');\n          canvas.appendChild(dom);\n          item.play('ag-item-' + id);\n        }\n\n        if (index === no - 1) {\n          dom.setAttribute('style', `grid-area: span 12/span 24/13/25`);\n        } else {\n          dom.setAttribute('style', `grid-area: span 3/span 4/${4 + 3 * index}/25;\n                    z-index:1;width:calc(100% - 20px);height:calc(100% - 20px)`);\n        }\n\n        item.player.resize && item.player.resize();\n      });\n    } // tile mode\n    else if (this.state.displayMode === 'tile') {\n        let no = this.state.streamList.length;\n        this.state.streamList.map((item, index) => {\n          let id = item.getId();\n          let dom = document.querySelector('#ag-item-' + id);\n\n          if (!dom) {\n            dom = document.createElement('section');\n            dom.setAttribute('id', 'ag-item-' + id);\n            dom.setAttribute('class', 'ag-item');\n            canvas.appendChild(dom);\n            item.play('ag-item-' + id);\n          }\n\n          dom.setAttribute('style', `grid-area: ${tile_canvas[no][index]}`);\n          item.player.resize && item.player.resize();\n        });\n      } // screen share mode (tbd)\n      else if (this.state.displayMode === 'share') {}\n  }\n\n  componentWillUnmount() {\n    this.client && this.client.unpublish(this.localStream);\n    this.localStream && this.localStream.close();\n    this.client && this.client.leave(() => {\n      console.log('Client succeed to leave.');\n    }, () => {\n      console.log('Client failed to leave.');\n    });\n  }\n\n  render() {\n    const style = {\n      display: 'grid',\n      gridGap: '10px',\n      alignItems: 'center',\n      justifyItems: 'center',\n      gridTemplateRows: 'repeat(12, auto)',\n      gridTemplateColumns: 'repeat(24, auto)'\n    };\n    const videoControlBtn = this.props.attendeeMode === 'video' ? /*#__PURE__*/React.createElement(\"span\", {\n      onClick: this.handleCamera,\n      className: \"ag-btn videoControlBtn\",\n      title: \"Enable/Disable Video\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ag-icon ag-icon-camera\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ag-icon ag-icon-camera-off\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 9\n      }\n    })) : '';\n    const audioControlBtn = this.props.attendeeMode !== 'audience' ? /*#__PURE__*/React.createElement(\"span\", {\n      onClick: this.handleMic,\n      className: \"ag-btn audioControlBtn\",\n      title: \"Enable/Disable Audio\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 346,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ag-icon ag-icon-mic\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 350,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ag-icon ag-icon-mic-off\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 9\n      }\n    })) : '';\n    const switchDisplayBtn = /*#__PURE__*/React.createElement(\"span\", {\n      onClick: this.switchDisplay,\n      className: this.state.streamList.length > 4 ? \"ag-btn displayModeBtn disabled\" : \"ag-btn displayModeBtn\",\n      title: \"Switch Display Mode\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ag-icon ag-icon-switch-display\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 359,\n        columnNumber: 9\n      }\n    }));\n    const hideRemoteBtn = /*#__PURE__*/React.createElement(\"span\", {\n      className: this.state.streamList.length > 4 || this.state.displayMode !== 'pip' ? \"ag-btn disableRemoteBtn disabled\" : \"ag-btn disableRemoteBtn\",\n      onClick: this.hideRemote,\n      title: \"Hide Remote Stream\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 363,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ag-icon ag-icon-remove-pip\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 9\n      }\n    }));\n    const exitBtn = /*#__PURE__*/React.createElement(\"span\", {\n      onClick: this.handleExit,\n      className: this.state.readyState ? 'ag-btn exitBtn' : 'ag-btn exitBtn disabled',\n      title: \"Exit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"ag-icon ag-icon-leave\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 375,\n        columnNumber: 9\n      }\n    }));\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"ag-canvas\",\n      style: style,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"ag-btn-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 9\n      }\n    }, exitBtn, videoControlBtn, audioControlBtn, switchDisplayBtn, hideRemoteBtn));\n  }\n\n}\n\nexport default AgoraCanvas;","map":{"version":3,"sources":["C:/Users/irlan/OneDrive/Desktop/Atlas-Video/src/components/AgoraVideoCall/index.jsx"],"names":["React","merge","AgoraRTC","tile_canvas","AgoraCanvas","Component","constructor","props","streamInit","uid","attendeeMode","videoProfile","config","defaultConfig","streamID","audio","video","screen","stream","createStream","setVideoProfile","subscribeStreamEvents","rt","client","on","evt","console","log","getId","Date","toLocaleTimeString","subscribe","err","removeStream","addStream","state","streamList","map","item","index","close","element","document","querySelector","parentNode","removeChild","tempList","splice","setState","push","repeatition","some","concat","handleCamera","e","currentTarget","classList","toggle","localStream","isVideoOn","disableVideo","enableVideo","handleMic","isAudioOn","disableAudio","enableAudio","switchDisplay","contains","length","displayMode","error","hideRemote","list","id","Array","from","querySelectorAll","style","display","handleExit","unpublish","leave","readyState","window","location","hash","shareClient","shareStream","componentWillMount","$","createClient","mode","transcode","init","appId","join","channel","publish","componentDidMount","canvas","btnGroup","addEventListener","global","_toolbarToggle","clearTimeout","add","setTimeout","remove","componentDidUpdate","no","dom","createElement","setAttribute","appendChild","play","player","resize","componentWillUnmount","render","gridGap","alignItems","justifyItems","gridTemplateRows","gridTemplateColumns","videoControlBtn","audioControlBtn","switchDisplayBtn","hideRemoteBtn","exitBtn"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { merge } from 'lodash'\nimport AgoraRTC from 'agora-rtc-sdk'\n\nimport './canvas.css'\nimport '../../assets/fonts/css/icons.css'\n\nconst tile_canvas = {\n  '1': ['span 12/span 24'],\n  '2': ['span 12/span 12/13/25', 'span 12/span 12/13/13'],\n  '3': ['span 6/span 12', 'span 6/span 12', 'span 6/span 12/7/19'],\n  '4': ['span 6/span 12', 'span 6/span 12', 'span 6/span 12', 'span 6/span 12/7/13'],\n  '5': ['span 3/span 4/13/9', 'span 3/span 4/13/13', 'span 3/span 4/13/17', 'span 3/span 4/13/21', 'span 9/span 16/10/21'],\n  '6': ['span 3/span 4/13/7', 'span 3/span 4/13/11', 'span 3/span 4/13/15', 'span 3/span 4/13/19', 'span 3/span 4/13/23', 'span 9/span 16/10/21'],\n  '7': ['span 3/span 4/13/5', 'span 3/span 4/13/9', 'span 3/span 4/13/13', 'span 3/span 4/13/17', 'span 3/span 4/13/21', 'span 3/span 4/13/25', 'span 9/span 16/10/21'],\n}\n\n\n/**\n * @prop appId uid\n * @prop transcode attendeeMode videoProfile channel baseMode\n */\nclass AgoraCanvas extends React.Component {\n  constructor(props) {\n    super(props)\n    this.client = {}\n    this.localStream = {}\n    this.shareClient = {}\n    this.shareStream = {}\n    this.state = {\n      displayMode: 'pip',\n      streamList: [],\n      readyState: false\n    }\n  }\n\n  componentWillMount() {\n    let $ = this.props\n    // init AgoraRTC local client\n    this.client = AgoraRTC.createClient({ mode: $.transcode })\n    this.client.init($.appId, () => {\n      console.log(\"AgoraRTC client initialized\")\n      this.subscribeStreamEvents()\n      this.client.join($.appId, $.channel, $.uid, (uid) => {\n        console.log(\"User \" + uid + \" join channel successfully\")\n        console.log('At ' + new Date().toLocaleTimeString())\n        // create local stream\n        // It is not recommended to setState in function addStream\n        this.localStream = this.streamInit(uid, $.attendeeMode, $.videoProfile)\n        this.localStream.init(() => {\n          if ($.attendeeMode !== 'audience') {\n            this.addStream(this.localStream, true)\n            this.client.publish(this.localStream, err => {\n              console.log(\"Publish local stream error: \" + err);\n            })\n          }\n          this.setState({ readyState: true })\n        },\n          err => {\n            console.log(\"getUserMedia failed\", err)\n            this.setState({ readyState: true })\n          })\n      })\n    })\n  }\n\n  componentDidMount() {\n    // add listener to control btn group\n    let canvas = document.querySelector('#ag-canvas')\n    let btnGroup = document.querySelector('.ag-btn-group')\n    canvas.addEventListener('mousemove', () => {\n      if (global._toolbarToggle) {\n        clearTimeout(global._toolbarToggle)\n      }\n      btnGroup.classList.add('active')\n      global._toolbarToggle = setTimeout(function () {\n        btnGroup.classList.remove('active')\n      }, 2000)\n    })\n  }\n\n  // componentWillUnmount () {\n  //     // remove listener\n  //     let canvas = document.querySelector('#ag-canvas')\n  //     canvas.removeEventListener('mousemove')\n  // }\n\n  componentDidUpdate() {\n    // rerendering\n    let canvas = document.querySelector('#ag-canvas')\n    // pip mode (can only use when less than 4 people in channel)\n    if (this.state.displayMode === 'pip') {\n      let no = this.state.streamList.length\n      if (no > 4) {\n        this.setState({ displayMode: 'tile' })\n        return\n      }\n      this.state.streamList.map((item, index) => {\n        let id = item.getId()\n        let dom = document.querySelector('#ag-item-' + id)\n        if (!dom) {\n          dom = document.createElement('section')\n          dom.setAttribute('id', 'ag-item-' + id)\n          dom.setAttribute('class', 'ag-item')\n          canvas.appendChild(dom)\n          item.play('ag-item-' + id)\n        }\n        if (index === no - 1) {\n          dom.setAttribute('style', `grid-area: span 12/span 24/13/25`)\n        }\n        else {\n          dom.setAttribute('style', `grid-area: span 3/span 4/${4 + 3 * index}/25;\n                    z-index:1;width:calc(100% - 20px);height:calc(100% - 20px)`)\n        }\n\n        item.player.resize && item.player.resize()\n\n\n      })\n    }\n    // tile mode\n    else if (this.state.displayMode === 'tile') {\n      let no = this.state.streamList.length\n      this.state.streamList.map((item, index) => {\n        let id = item.getId()\n        let dom = document.querySelector('#ag-item-' + id)\n        if (!dom) {\n          dom = document.createElement('section')\n          dom.setAttribute('id', 'ag-item-' + id)\n          dom.setAttribute('class', 'ag-item')\n          canvas.appendChild(dom)\n          item.play('ag-item-' + id)\n        }\n        dom.setAttribute('style', `grid-area: ${tile_canvas[no][index]}`)\n        item.player.resize && item.player.resize()\n\n\n      })\n    }\n    // screen share mode (tbd)\n    else if (this.state.displayMode === 'share') {\n\n    }\n  }\n\n  componentWillUnmount () {\n    this.client && this.client.unpublish(this.localStream)\n    this.localStream && this.localStream.close()\n    this.client && this.client.leave(() => {\n      console.log('Client succeed to leave.')\n    }, () => {\n      console.log('Client failed to leave.')\n    })\n  }\n\n  streamInit = (uid, attendeeMode, videoProfile, config) => {\n    let defaultConfig = {\n      streamID: uid,\n      audio: true,\n      video: true,\n      screen: false\n    }\n\n    switch (attendeeMode) {\n      case 'audio-only':\n        defaultConfig.video = false\n        break;\n      case 'audience':\n        defaultConfig.video = false\n        defaultConfig.audio = false\n        break;\n      default:\n      case 'video':\n        break;\n    }\n\n    let stream = AgoraRTC.createStream(merge(defaultConfig, config))\n    stream.setVideoProfile(videoProfile)\n    return stream\n  }\n\n  subscribeStreamEvents = () => {\n    let rt = this\n    rt.client.on('stream-added', function (evt) {\n      let stream = evt.stream\n      console.log(\"New stream added: \" + stream.getId())\n      console.log('At ' + new Date().toLocaleTimeString())\n      console.log(\"Subscribe \", stream)\n      rt.client.subscribe(stream, function (err) {\n        console.log(\"Subscribe stream failed\", err)\n      })\n    })\n\n    rt.client.on('peer-leave', function (evt) {\n      console.log(\"Peer has left: \" + evt.uid)\n      console.log(new Date().toLocaleTimeString())\n      console.log(evt)\n      rt.removeStream(evt.uid)\n    })\n\n    rt.client.on('stream-subscribed', function (evt) {\n      let stream = evt.stream\n      console.log(\"Got stream-subscribed event\")\n      console.log(new Date().toLocaleTimeString())\n      console.log(\"Subscribe remote stream successfully: \" + stream.getId())\n      console.log(evt)\n      rt.addStream(stream)\n    })\n\n    rt.client.on(\"stream-removed\", function (evt) {\n      let stream = evt.stream\n      console.log(\"Stream removed: \" + stream.getId())\n      console.log(new Date().toLocaleTimeString())\n      console.log(evt)\n      rt.removeStream(stream.getId())\n    })\n  }\n\n  removeStream = (uid) => {\n    this.state.streamList.map((item, index) => {\n      if (item.getId() === uid) {\n        item.close()\n        let element = document.querySelector('#ag-item-' + uid)\n        if (element) {\n          element.parentNode.removeChild(element)\n        }\n        let tempList = [...this.state.streamList]\n        tempList.splice(index, 1)\n        this.setState({\n          streamList: tempList\n        })\n      }\n\n    })\n  }\n\n  addStream = (stream, push = false) => {\n    let repeatition = this.state.streamList.some(item => {\n      return item.getId() === stream.getId()\n    })\n    if (repeatition) {\n      return\n    }\n    if (push) {\n      this.setState({\n        streamList: this.state.streamList.concat([stream])\n      })\n    }\n    else {\n      this.setState({\n        streamList: [stream].concat(this.state.streamList)\n      })\n    }\n\n  }\n\n  handleCamera = (e) => {\n    e.currentTarget.classList.toggle('off')\n    this.localStream.isVideoOn() ?\n      this.localStream.disableVideo() : this.localStream.enableVideo()\n  }\n\n  handleMic = (e) => {\n    e.currentTarget.classList.toggle('off')\n    this.localStream.isAudioOn() ?\n      this.localStream.disableAudio() : this.localStream.enableAudio()\n  }\n\n  switchDisplay = (e) => {\n    if (e.currentTarget.classList.contains('disabled') || this.state.streamList.length <= 1) {\n      return\n    }\n    if (this.state.displayMode === 'pip') {\n      this.setState({ displayMode: 'tile' })\n    }\n    else if (this.state.displayMode === 'tile') {\n      this.setState({ displayMode: 'pip' })\n    }\n    else if (this.state.displayMode === 'share') {\n      // do nothing or alert, tbd\n    }\n    else {\n      console.error('Display Mode can only be tile/pip/share')\n    }\n  }\n\n  hideRemote = (e) => {\n    if (e.currentTarget.classList.contains('disabled') || this.state.streamList.length <= 1) {\n      return\n    }\n    let list\n    let id = this.state.streamList[this.state.streamList.length - 1].getId()\n    list = Array.from(document.querySelectorAll(`.ag-item:not(#ag-item-${id})`))\n    list.map(item => {\n      if (item.style.display !== 'none') {\n        item.style.display = 'none'\n      }\n      else {\n        item.style.display = 'block'\n      }\n    })\n\n  }\n\n  handleExit = (e) => {\n    if (e.currentTarget.classList.contains('disabled')) {\n      return\n    }\n    try {\n      this.client && this.client.unpublish(this.localStream)\n      this.localStream && this.localStream.close()\n      this.client && this.client.leave(() => {\n        console.log('Client succeed to leave.')\n      }, () => {\n        console.log('Client failed to leave.')\n      })\n    }\n    finally {\n      this.setState({ readyState: false })\n      this.client = null\n      this.localStream = null\n      // redirect to index\n      window.location.hash = ''\n    }\n  }\n\n  render() {\n    const style = {\n      display: 'grid',\n      gridGap: '10px',\n      alignItems: 'center',\n      justifyItems: 'center',\n      gridTemplateRows: 'repeat(12, auto)',\n      gridTemplateColumns: 'repeat(24, auto)'\n    }\n    const videoControlBtn = this.props.attendeeMode === 'video' ?\n      (<span\n        onClick={this.handleCamera}\n        className=\"ag-btn videoControlBtn\"\n        title=\"Enable/Disable Video\">\n        <i className=\"ag-icon ag-icon-camera\"></i>\n        <i className=\"ag-icon ag-icon-camera-off\"></i>\n      </span>) : ''\n\n    const audioControlBtn = this.props.attendeeMode !== 'audience' ?\n      (<span\n        onClick={this.handleMic}\n        className=\"ag-btn audioControlBtn\"\n        title=\"Enable/Disable Audio\">\n        <i className=\"ag-icon ag-icon-mic\"></i>\n        <i className=\"ag-icon ag-icon-mic-off\"></i>\n      </span>) : ''\n\n    const switchDisplayBtn = (\n      <span\n        onClick={this.switchDisplay}\n        className={this.state.streamList.length > 4 ? \"ag-btn displayModeBtn disabled\" : \"ag-btn displayModeBtn\"}\n        title=\"Switch Display Mode\">\n        <i className=\"ag-icon ag-icon-switch-display\"></i>\n      </span>\n    )\n    const hideRemoteBtn = (\n      <span\n        className={this.state.streamList.length > 4 || this.state.displayMode !== 'pip' ? \"ag-btn disableRemoteBtn disabled\" : \"ag-btn disableRemoteBtn\"}\n        onClick={this.hideRemote}\n        title=\"Hide Remote Stream\">\n        <i className=\"ag-icon ag-icon-remove-pip\"></i>\n      </span>\n    )\n    const exitBtn = (\n      <span\n        onClick={this.handleExit}\n        className={this.state.readyState ? 'ag-btn exitBtn' : 'ag-btn exitBtn disabled'}\n        title=\"Exit\">\n        <i className=\"ag-icon ag-icon-leave\"></i>\n      </span>\n    )\n\n    return (\n      <div id=\"ag-canvas\" style={style}>\n        <div className=\"ag-btn-group\">\n          {exitBtn}\n          {videoControlBtn}\n          {audioControlBtn}\n          {/* <span className=\"ag-btn shareScreenBtn\" title=\"Share Screen\">\n                        <i className=\"ag-icon ag-icon-screen-share\"></i>\n                    </span> */}\n          {switchDisplayBtn}\n          {hideRemoteBtn}\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default AgoraCanvas"]},"metadata":{},"sourceType":"module"}