{"ast":null,"code":"/*! AgoraRTC|BUILD v2.9.0-0-gd55f286 */\n!function (e, t) {\n  \"object\" == typeof exports && \"object\" == typeof module ? module.exports = t() : \"function\" == typeof define && define.amd ? define(\"AgoraRTC\", [], t) : \"object\" == typeof exports ? exports.AgoraRTC = t() : e.AgoraRTC = t();\n}(window, function () {\n  return function (e) {\n    var t = {};\n\n    function n(i) {\n      if (t[i]) return t[i].exports;\n      var a = t[i] = {\n        i: i,\n        l: !1,\n        exports: {}\n      };\n      return e[i].call(a.exports, a, a.exports, n), a.l = !0, a.exports;\n    }\n\n    return n.m = e, n.c = t, n.d = function (e, t, i) {\n      n.o(e, t) || Object.defineProperty(e, t, {\n        enumerable: !0,\n        get: i\n      });\n    }, n.r = function (e) {\n      \"undefined\" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, {\n        value: \"Module\"\n      }), Object.defineProperty(e, \"__esModule\", {\n        value: !0\n      });\n    }, n.t = function (e, t) {\n      if (1 & t && (e = n(e)), 8 & t) return e;\n      if (4 & t && \"object\" == typeof e && e && e.__esModule) return e;\n      var i = Object.create(null);\n      if (n.r(i), Object.defineProperty(i, \"default\", {\n        enumerable: !0,\n        value: e\n      }), 2 & t && \"string\" != typeof e) for (var a in e) n.d(i, a, function (t) {\n        return e[t];\n      }.bind(null, a));\n      return i;\n    }, n.n = function (e) {\n      var t = e && e.__esModule ? function () {\n        return e.default;\n      } : function () {\n        return e;\n      };\n      return n.d(t, \"a\", t), t;\n    }, n.o = function (e, t) {\n      return Object.prototype.hasOwnProperty.call(e, t);\n    }, n.p = \"\", n(n.s = 26);\n  }([function (e, t, n) {\n    \"use strict\";\n\n    n.r(t);\n    var i = n(6),\n        a = n.n(i),\n        r = n(7),\n        o = n(2),\n        s = n(1),\n        c = 0,\n        d = \"free\",\n        u = [],\n        l = [],\n        p = 0;\n    setInterval(function () {\n      Object(o.getParameter)(\"UPLOAD_LOG\") && f.info(\"console log upload\");\n    }, 9e5);\n\n    var f = function () {\n      var e,\n          t,\n          n,\n          i,\n          f,\n          m,\n          g = \"https://\".concat(Object(o.getParameter)(\"LOG_UPLOAD_SERVER\"), \"/upload/v1\"),\n          v = [\"DEBUG\", \"INFO\", \"WARNING\", \"ERROR\", \"NONE\"],\n          S = 0,\n          I = function e(t) {\n        d = \"uploading\", setTimeout(function () {\n          !function (e, t, n) {\n            var i;\n            Array.isArray(e) || (e = [e]), e = e.map(function (e) {\n              return {\n                log_item_id: c++,\n                log_level: e.log_level,\n                payload_str: e.payload\n              };\n            }), i = {\n              sdk_version: o.VERSION,\n              process_id: Object(s.a)(),\n              payload: JSON.stringify(e)\n            };\n\n            try {\n              Object(r.c)(g, i, function (e) {\n                \"OK\" === e ? t && t(e) : n && n(e);\n              }, function (e) {\n                n && n(e);\n              }, {\n                withCredentials: !0\n              });\n            } catch (e) {\n              n && n(e);\n            }\n          }(t, function () {\n            p = 0, 0 !== u.length ? (l = u.length < 10 ? u.splice(0, u.length) : u.splice(0, 10), e(l)) : d = \"free\";\n          }, function () {\n            setTimeout(function () {\n              e(l);\n            }, p++ < 2 ? 200 : 1e4);\n          });\n        }, 3e3);\n      };\n\n      t = function () {\n        for (var t = [0], n = 0; n < arguments.length; n++) t.push(arguments[n]);\n\n        e.apply(this, t);\n      }, n = function () {\n        for (var t = [1], n = 0; n < arguments.length; n++) t.push(arguments[n]);\n\n        e.apply(this, t);\n      }, i = function () {\n        for (var t = [2], n = 0; n < arguments.length; n++) t.push(arguments[n]);\n\n        e.apply(this, t);\n      }, f = function () {\n        for (var t = [3], n = 0; n < arguments.length; n++) t.push(arguments[n]);\n\n        e.apply(this, t);\n      };\n      var h = {};\n      return m = function (e) {\n        h[e] || (i.apply(void 0, arguments), h[e] = !0);\n      }, {\n        DEBUG: 0,\n        INFO: 1,\n        WARNING: 2,\n        ERROR: 3,\n        NONE: 4,\n        enableLogUpload: function () {\n          Object(o.setParameter)(\"UPLOAD_LOG\", !0);\n        },\n        disableLogUpload: function () {\n          Object(o.setParameter)(\"UPLOAD_LOG\", !1);\n        },\n        setProxyServer: function (e) {\n          g = e ? \"https://\".concat(e, \"/ls/?h=\").concat(Object(o.getParameter)(\"LOG_UPLOAD_SERVER\"), \"&p=443&d=upload/v1\") : \"https://\".concat(Object(o.getParameter)(\"LOG_UPLOAD_SERVER\"), \"/upload/v1\");\n        },\n        setLogLevel: function (e) {\n          e > 4 ? e = 4 : e < 0 && (e = 0), S = e;\n        },\n        log: e = function () {\n          var e,\n              t = arguments[0],\n              n = arguments;\n          if (n[0] = (e = new Date()).toTimeString().split(\" \")[0] + \":\" + e.getMilliseconds() + \" Agora-SDK [\" + (v[t] || \"DEFAULT\") + \"]:\", function (e, t) {\n            if (Object(o.getParameter)(\"UPLOAD_LOG\")) try {\n              t = Array.prototype.slice.call(t);\n              var n = \"\";\n              t.forEach(function (e) {\n                \"object\" === a()(e) && (e = JSON.stringify(e)), n = n + e + \" \";\n              }), u.push({\n                payload: n,\n                log_level: e\n              }), \"free\" === d && (l = u.length < 10 ? u.splice(0, u.length) : u.splice(0, 10), I(l));\n            } catch (e) {}\n          }(t, n), !(t < S)) switch (t) {\n            case 0:\n            case 1:\n              console.log.apply(console, n);\n              break;\n\n            case 2:\n              console.warn.apply(console, n);\n              break;\n\n            case 3:\n              console.error.apply(console, n);\n              break;\n\n            default:\n              return void console.log.apply(console, n);\n          }\n        },\n        debug: t,\n        info: n,\n        warning: i,\n        deprecate: m,\n        error: f\n      };\n    }();\n\n    t.default = f;\n  }, function (e, t, n) {\n    \"use strict\";\n\n    var i = n(11),\n        a = n.n(i),\n        r = n(4),\n        o = n.n(r),\n        s = n(2),\n        c = n(0),\n        d = n(7),\n        u = n(12),\n        l = n.n(u);\n    n.d(t, \"b\", function () {\n      return g;\n    }), n.d(t, \"a\", function () {\n      return m;\n    });\n\n    var p = {\n      eventType: null,\n      sid: null,\n      lts: null,\n      success: null,\n      cname: null,\n      uid: null,\n      peer: null,\n      cid: null,\n      elapse: null,\n      extend: null,\n      vid: 0\n    },\n        f = null,\n        m = function () {\n      return f || (f = \"process-\" + l()(), c.default.info(\"processId: \" + f)), f;\n    },\n        g = function () {\n      var e = {\n        list: {}\n      };\n      e.url = Object(d.e)() ? \"https://\".concat(Object(s.getParameter)(\"EVENT_REPORT_DOMAIN\"), \":6443/events/message\") : \"http://\".concat(Object(s.getParameter)(\"EVENT_REPORT_DOMAIN\"), \":6080/events/message\"), e.urlBackup = Object(d.e)() ? \"https://\".concat(Object(s.getParameter)(\"EVENT_REPORT_BACKUP_DOMAIN\"), \":6443/events/message\") : \"http://\".concat(Object(s.getParameter)(\"EVENT_REPORT_BACKUP_DOMAIN\"), \":6080/events/message\"), e.setProxyServer = function (t) {\n        t ? (e.url = Object(d.e)() ? \"https://\".concat(t, \"/rs/?h=\").concat(Object(s.getParameter)(\"EVENT_REPORT_DOMAIN\"), \"&p=6443&d=events/message\") : \"http://\".concat(t, \"/rs/?h=\").concat(Object(s.getParameter)(\"EVENT_REPORT_DOMAIN\"), \"&p=6080&d=events/message\"), e.urlBackup = Object(d.e)() ? \"https://\".concat(t, \"/rs/?h=\").concat(Object(s.getParameter)(\"EVENT_REPORT_BACKUP_DOMAIN\"), \"&p=6443&d=events/message\") : \"http://\".concat(t, \"/rs/?h=\").concat(Object(s.getParameter)(\"EVENT_REPORT_BACKUP_DOMAIN\"), \"&p=6080&d=events/message\"), c.default.debug(\"reportProxyServerURL: \".concat(e.url)), c.default.debug(\"reportProxyServerBackupURL: \".concat(e.urlBackup))) : (e.url = Object(d.e)() ? \"https://\".concat(Object(s.getParameter)(\"EVENT_REPORT_DOMAIN\"), \":6443/events/message\") : \"http://\".concat(Object(s.getParameter)(\"EVENT_REPORT_DOMAIN\"), \":6080/events/message\"), e.urlBackup = Object(d.e)() ? \"https://\".concat(Object(s.getParameter)(\"EVENT_REPORT_BACKUP_DOMAIN\"), \":6443/events/message\") : \"http://\".concat(Object(s.getParameter)(\"EVENT_REPORT_BACKUP_DOMAIN\"), \":6080/events/message\"));\n      }, e.sessionInit = function (t, n) {\n        var i = o()({}, p);\n        i.startTime = +new Date(), i.sid = t, i.cname = n.cname, e.list[t] = i;\n        var a = o()({}, {\n          willUploadConsoleLog: Object(s.getParameter)(\"UPLOAD_LOG\")\n        }, n.extend),\n            r = o()({}, i);\n        r.eventType = \"session_init\", r.appid = n.appid, r.browser = navigator.userAgent, r.build = s.BUILD, r.lts = +new Date(), r.elapse = r.lts - r.startTime, r.extend = JSON.stringify(a), r.mode = n.mode, r.process = m(), r.success = n.succ, r.version = s.VERSION, delete r.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.Session\",\n          data: r\n        }), e._flushInvokeReport(t);\n      }, e.joinChooseServer = function (t, n, i) {\n        if (e.list[t]) {\n          n.uid && (e.list[t].uid = parseInt(n.uid)), n.cid && (e.list[t].cid = parseInt(n.cid));\n          var a = o()({}, e.list[t]);\n          a.eventType = \"join_choose_server\";\n          var r = n.lts;\n          a.lts = Date.now(), a.eventElapse = a.lts - r, a.chooseServerAddr = n.csAddr, a.errorCode = n.ec, a.elapse = a.lts - a.startTime, a.success = n.succ, a.chooseServerAddrList = JSON.stringify(n.serverList), delete a.startTime, e.send({\n            type: \"io.agora.pb.Wrtc.JoinChooseServer\",\n            data: a\n          });\n        }\n      }, e.reqUserAccount = function (t, n) {\n        n.vid && (e.list[t].vid = n.vid);\n        var i = o()({}, e.list[t]),\n            a = n.lts;\n        i.eventType = \"req_user_account\", i.lts = Date.now(), i.success = n.success, i.serverAddress = n.serverAddress, i.stringUid = n.stringUid, i.uid = n.uid, i.errorCode = n.errorCode, i.elapse = i.lts - i.startTime, i.eventElapse = i.lts - a, i.extend = \"string\" == typeof n.extend ? n.extend : JSON.stringify(n.extend), delete i.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.ReqUserAccount\",\n          data: i\n        });\n      }, e.joinGateway = function (t, n) {\n        n.vid && (e.list[t].vid = n.vid);\n        var i = o()({}, e.list[t]),\n            a = n.lts;\n        i.eventType = \"join_gateway\", i.lts = Date.now(), i.gatewayAddr = n.addr, i.success = n.succ, i.errorCode = n.ec, i.elapse = i.lts - i.startTime, i.eventElapse = i.lts - a, delete i.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.JoinGateway\",\n          data: i\n        });\n      }, e.publish = function (t, n) {\n        var i = o()({}, e.list[t]);\n        i.eventType = \"publish\";\n        var a = n.lts;\n        i.lts = Date.now(), i.eventElapse = i.lts - a, i.elapse = i.lts - i.startTime, i.success = n.succ, i.errorCode = n.ec, n.videoName && (i.videoName = n.videoName), n.audioName && (i.audioName = n.audioName), n.screenName && (i.screenName = n.screenName), delete i.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.Publish\",\n          data: i\n        }), e._flushInvokeReport(t);\n      }, e.subscribe = function (t, n) {\n        var i = o()({}, e.list[t]);\n        i.eventType = \"subscribe\";\n        var a = n.lts;\n        i.lts = Date.now(), i.eventElapse = i.lts - a, i.elapse = i.lts - i.startTime, i.errorCode = n.ec, i.success = n.succ, isFinite(n.peerid) ? i.peer = n.peerid : i.peerSuid = \"\" + n.peerid, \"boolean\" == typeof n.video && (i.video = n.video), \"boolean\" == typeof n.audio && (i.audio = n.audio), delete i.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.Subscribe\",\n          data: i\n        }), e._flushInvokeReport(t);\n      }, e.firstRemoteFrame = function (t, n) {\n        var i = o()({}, e.list[t]);\n        i.eventType = \"first_remote_frame\";\n        var a = n.lts;\n        i.lts = Date.now(), i.eventElapse = i.lts - a, i.elapse = i.lts - i.startTime, i.width = n.width, i.height = n.height, i.success = n.succ, i.errorCode = n.ec, isFinite(n.peerid) ? i.peer = n.peerid : i.peerSuid = \"\" + n.peerid, delete i.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.FirstFrame\",\n          data: i\n        });\n      }, e.streamSwitch = function (t, n) {\n        var i = o()({}, e.list[t]);\n        i.eventType = \"stream_switch\", i.lts = Date.now(), i.isDual = n.isdual, i.elapse = i.lts - i.startTime, i.success = i.succ, delete i.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.StreamSwitch\",\n          data: i\n        });\n      }, e.audioSendingStopped = function (t, n) {\n        var i = o()({}, e.list[t]);\n        i.eventType = \"audio_sending_stopped\", i.lts = Date.now(), i.elapse = i.lts - i.startTime, i.reason = n.reason, i.success = n.succ, delete i.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.AudioSendingStopped\",\n          data: i\n        });\n      }, e.videoSendingStopped = function (t, n) {\n        var i = o()({}, e.list[t]);\n        i.eventType = \"video_sending_stopped\", i.lts = Date.now(), i.elapse = i.lts - i.startTime, i.reson = n.reason, i.success = n.succ, delete i.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.VideoSendingStopped\",\n          data: i\n        });\n      }, e.requestProxyAppCenter = function (t, n) {\n        var i = o()({}, e.list[t]),\n            a = n.lts;\n        i.eventType = \"request_proxy_appcenter\", i.lts = Date.now(), i.eventElapse = i.lts - a, i.elapse = i.lts - i.startTime, i.extend = n.extend + \"\", i.APAddr = n.APAddr, i.workerManagerList = n.workerManagerList, i.response = n.response, i.errorCode = n.ec, i.success = n.succ, delete i.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.RequestProxyAppCenter\",\n          data: i\n        });\n      }, e.requestProxyWorkerManager = function (t, n) {\n        var i = o()({}, e.list[t]),\n            a = n.lts;\n        i.eventType = \"request_proxy_worker_manager\", i.lts = Date.now(), i.eventElapse = i.lts - a, i.elapse = i.lts - i.startTime, i.extend = n.extend, i.workerManagerAddr = n.workerManagerAddr, i.response = n.response, i.errorCode = n.ec, i.success = n.succ, delete i.startTime, e.send({\n          type: \"io.agora.pb.Wrtc.RequestProxyWorkerManager\",\n          data: i\n        });\n      };\n      var t = 0;\n      return e.reportApiInvoke = function (e, n) {\n        var i = n.tag,\n            r = n.name,\n            o = n.getStates,\n            d = n.options,\n            u = n.timeout,\n            l = void 0 === u ? 6e4 : u,\n            p = n.callback,\n            f = n.reportResult,\n            m = void 0 === f || f,\n            v = Date.now(),\n            S = 0,\n            I = t++,\n            h = function () {\n          return a()({\n            tag: i,\n            invokeId: I,\n            sid: e,\n            name: r,\n            apiInvokeTime: v,\n            options: d\n          }, o && {\n            states: (t = o(), Object.keys(t).reduce(function (e, n) {\n              var i = e;\n              return null != t[n] && (i[n] = t[n]), i;\n            }, {}))\n          });\n          var t;\n        },\n            _ = !!Object(s.getParameter)(\"SHOW_REPORT_INVOKER_LOG\");\n\n        _ && c.default.info(\"\".concat(r, \" start\"));\n        var y = setTimeout(function () {\n          g._sendApiInvoke(a()({}, h(), {\n            error: \"API_INVOKE_TIMEOUT\",\n            success: !1\n          }));\n        }, l);\n        return function (e, t) {\n          if (clearTimeout(y), ++S > 1 && (e = \"EXECUTOR_INVOKE_\".concat(S)), e) return g._sendApiInvoke(a()({}, h(), {\n            success: !1,\n            error: e\n          }, o && {\n            states: o()\n          })), _ && c.default.info(\"\".concat(r, \" onFailure\"), e), p && p(e);\n          g._sendApiInvoke(a()({}, h(), {\n            success: !0\n          }, m && {\n            result: t\n          }, o && {\n            states: o()\n          })), _ && c.default.info(\"\".concat(r, \" onSuccess\")), p && p(null, t);\n        };\n      }, e._cachedItems = [], e._cacheInvokeReport = function (t) {\n        t.lts || (t.lts = Date.now()), e._cachedItems.push(t), e._cachedItems.length > 50 && e._cachedItems.shift();\n      }, e._flushInvokeReport = function (t) {\n        if (e._cachedItems.length) {\n          var n = e._cachedItems;\n          e._cachedItems = [], c.default.debug(\"Flush cached event reporting:\", n.length), n.forEach(function (n, i) {\n            n.sid = t, setTimeout(function () {\n              e._sendApiInvoke(n);\n            }, 5e3 + 500 * i);\n          });\n        }\n      }, e._sendApiInvoke = function (t) {\n        var n = t.tag,\n            i = t.invokeId,\n            r = t.sid,\n            o = t.name,\n            c = t.result,\n            d = t.states,\n            u = t.options,\n            l = t.error,\n            p = t.success,\n            f = t.apiInvokeTime,\n            m = t.lts,\n            g = Object(s.getParameter)(\"NOT_REPORT_EVENT\");\n        if (!(n && g instanceof Array && -1 !== g.indexOf(n))) if (e.list[r]) {\n          var v = e.list[r],\n              S = v.startTime,\n              I = v.cname,\n              h = v.uid,\n              _ = v.cid,\n              y = (m = m || Date.now()) - S,\n              E = m - f,\n              b = \"\";\n          if (u) try {\n            b = JSON.stringify(u);\n          } catch (e) {\n            b = u.toString();\n          }\n          var T = a()({\n            invokeId: i,\n            sid: r,\n            cname: I,\n            cid: _,\n            lts: m,\n            uid: h,\n            success: p,\n            elapse: y,\n            apiName: o,\n            execElapse: E\n          }, void 0 !== u && {\n            options: b\n          }, void 0 !== d && {\n            execStates: JSON.stringify(d)\n          }, void 0 !== l && {\n            errorCode: JSON.stringify(l)\n          }, void 0 !== c && {\n            execResult: JSON.stringify(c)\n          });\n          e.send({\n            type: \"io.agora.pb.Wrtc.ApiInvoke\",\n            data: T\n          });\n        } else e._cacheInvokeReport(arguments[0]);\n      }, e._send = function (t) {\n        try {\n          var n = [];\n          t && t.data && t.data.apiName ? n.push([\"apiName\", \"\" + t.data.apiName]) : t && t.data && t.data.eventType && n.push([\"eventType\", t.data.eventType]);\n          var i = n.map(function (e) {\n            return \"\".concat(e[0], \"=\").concat(encodeURIComponent(e[1]));\n          }).join(\"&\"),\n              a = -1 === e.url.indexOf(\"?\") ? \"\".concat(e.url, \"?\").concat(i) : e.url;\n          Object(d.c)(a, t, null, function (n) {\n            var a = -1 === e.urlBackup.indexOf(\"?\") ? \"\".concat(e.urlBackup, \"?\").concat(i) : e.urlBackup;\n            Object(d.c)(a, t, null, function (e) {}, {\n              timeout: 1e4\n            });\n          }, {\n            timeout: 1e4\n          });\n        } catch (e) {}\n      }, e.sendCache = [], e.sendTimer = null, e.send = function (t) {\n        if (e.sendCache.push(t), null === e.sendTimer) {\n          return function t() {\n            e.sendTimer = setTimeout(function () {\n              if (0 !== e.sendCache.length) return e._send(e.sendCache.shift()), t();\n              e.sendTimer = null;\n            }, Object(s.getParameter)(\"EVENT_REPORT_SEND_INTERVAL\"));\n          }();\n        }\n      }, e;\n    }();\n  }, function (e, t, n) {\n    \"use strict\";\n\n    t.__esModule = !0;\n    t.BUILD = \"v2.9.0-0-gd55f286\";\n    t.VERSION = \"2.9.0\";\n    t.SUPPORT_RESOLUTION_LIST = {\n      \"90p_1\": [160, 90, null, null, null, null],\n      \"120p_1\": [160, 120, 15, 15, 30, 65],\n      \"120p_3\": [120, 120, 15, 15, 30, 50],\n      \"120p_4\": [212, 120, null, null, null, null],\n      \"180p_1\": [320, 180, 15, 15, 30, 140],\n      \"180p_3\": [180, 180, 15, 15, 30, 100],\n      \"180p_4\": [240, 180, 15, 15, 30, 120],\n      \"240p_1\": [320, 240, 15, 15, 40, 200],\n      \"240p_3\": [240, 240, 15, 15, 40, 140],\n      \"240p_4\": [424, 240, 15, 15, 40, 220],\n      \"360p_1\": [640, 360, 15, 15, 80, 400],\n      \"360p_3\": [360, 360, 15, 15, 80, 260],\n      \"360p_4\": [640, 360, 30, 30, 80, 600],\n      \"360p_6\": [360, 360, 30, 30, 80, 400],\n      \"360p_7\": [480, 360, 15, 15, 80, 320],\n      \"360p_8\": [480, 360, 30, 30, 80, 490],\n      \"360p_9\": [640, 360, 15, 15, 80, 800],\n      \"360p_10\": [640, 360, 24, 24, 80, 800],\n      \"360p_11\": [640, 360, 24, 24, 80, 1e3],\n      \"480p_1\": [640, 480, 15, 15, 20, 500, 1, 5],\n      \"480p_2\": [640, 480, 30, 30, 100, 1e3, 25, 30],\n      \"480p_3\": [480, 480, 15, 15, 100, 400],\n      \"480p_4\": [640, 480, 30, 30, 100, 750],\n      \"480p_6\": [480, 480, 30, 30, 100, 600],\n      \"480p_8\": [848, 480, 15, 15, 100, 610],\n      \"480p_9\": [848, 480, 30, 30, 100, 930],\n      \"480p_10\": [640, 480, 10, 10, 100, 400],\n      \"720p_1\": [1280, 720, 15, 15, 120, 1130, 1, 5],\n      \"720p_2\": [1280, 720, 30, 30, 120, 2e3, 25, 30],\n      \"720p_3\": [1280, 720, 30, 30, 120, 1710],\n      \"720p_5\": [960, 720, 15, 15, 120, 910],\n      \"720p_6\": [960, 720, 30, 30, 120, 1380],\n      \"1080p_1\": [1920, 1080, 15, 15, 120, 2080, 1, 5],\n      \"1080p_2\": [1920, 1080, 30, 30, 120, 3e3, 25, 30],\n      \"1080p_3\": [1920, 1080, 30, 30, 120, 3150],\n      \"1080p_5\": [1920, 1080, 60, 60, 120, 4780],\n      \"1440p_1\": [2560, 1440, 30, 30, 120, 4850],\n      \"1440p_2\": [2560, 1440, 60, 60, 120, 7350],\n      \"4k_1\": [3840, 2160, 30, 30, 120, 8910],\n      \"4k_3\": [3840, 2160, 60, 60, 120, 13500]\n    };\n    t.AUDIO_PROFILE_SETTINGS = {\n      speech_low_quality: [!1, !1, !0, !0],\n      speech_standard: [!1, !1, !0, !1],\n      music_standard: [!1, !1, !1, !1],\n      standard_stereo: [!1, !0, !1, !1],\n      high_quality: [!0, !1, !1, !1],\n      high_quality_stereo: [!0, !0, !1, !1],\n      default: [!1, !1, !1, !1]\n    };\n    var i = {\n      WEBCS_DOMAIN: [\"webrtc2-ap-web-1.agora.io\", \"webrtc2-ap-web-2.agoraio.cn\"],\n      WEBCS_DOMAIN_BACKUP_LIST: [\"webrtc2-ap-web-3.agora.io\", \"webrtc2-ap-web-4.agoraio.cn\"],\n      PROXY_CS: [\"ap-proxy-1.agora.io\", \"ap-proxy-2.agora.io\"],\n      CDS_AP: [\"cds-ap-web-1.agora.io\", \"cds-ap-web-2.agoraio.cn\", \"cds-ap-web-3.agora.io\", \"cds-ap-web-4.agoraio.cn\"],\n      ACCOUNT_REGISTER: [\"sua-ap-web-1.agora.io\", \"sua-ap-web-2.agoraio.cn\", \"sua-ap-web-3.agora.io\", \"sua-ap-web-4.agoraio.cn\"],\n      UAP_AP: [\"uap-ap-web-1.agora.io\", \"uap-ap-web-2.agoraio.cn\", \"uap-ap-web-3.agora.io\", \"uap-ap-web-4.agoraio.cn\"],\n      ACCOUNT_REGISTER_RETRY_TIMEOUT: 1,\n      ACCOUNT_REGISTER_RETRY_RATIO: 2,\n      ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX: 6e4,\n      ACCOUNT_REGISTER_RETRY_COUNT_MAX: 1e5,\n      AUDIO_CONTEXT: null,\n      LOG_UPLOAD_SERVER: \"logservice.agora.io\",\n      EVENT_REPORT_DOMAIN: \"webcollector-1.agora.io\",\n      EVENT_REPORT_BACKUP_DOMAIN: \"webcollector-2.agoraio.cn\",\n      WEBCS_BACKUP_CONNECT_TIMEOUT: 6e3,\n      LIVESTREAMING_ALIGN: !0,\n      HTTP_CONNECT_TIMEOUT: 5e3,\n      PLAYER_STATE_DEFER: 2e3,\n      SIGNAL_REQUEST_TIMEOUT: 1e4,\n      SIGNAL_REQUEST_WATCH_INTERVAL: 1e3,\n      REPORT_STATS: !0,\n      REPORT_STATS_TIMEOUT: 3e3,\n      UPLOAD_LOG: !1,\n      NOT_REPORT_EVENT: [],\n      FILEPATH_LENMAX: 255,\n      SUBSCRIBE_TCC: !1,\n      PING_PONG_TIME_OUT: 10,\n      DUALSTREAM_OPERATION_CHECK: !0,\n      WEBSOCKET_TIMEOUT_MIN: 1e4,\n      EVENT_REPORT_SEND_INTERVAL: 1e3,\n      MEDIA_ELEMENT_EXISTS_DEPTH: 3,\n      CANDIDATE_TIMEOUT: 2e3,\n      SHIM_CANDIDATE: !1,\n      LEAVE_MSG_TIMEOUT: 2e3,\n      TICKET_RENEW_TIMEOUT: 828e5,\n      SHOW_REPORT_INVOKER_LOG: !1,\n      STATS_FILTER: {\n        transportId: !0,\n        googTrackId: !0\n      },\n      FORCE_TURN: !1,\n      TURN_ENABLE_TCP: !0,\n      TURN_ENABLE_UDP: !0,\n      FORCE_CHANGED_GATEWAY_FLAG: !1,\n      JOIN_EXTEND: \"\",\n      PUB_EXTEND: \"\",\n      SUB_EXTEND: \"\"\n    };\n\n    t.setParameter = function (e, t) {\n      return void 0 !== i[e] && (i[e] = t, !0);\n    };\n\n    t.getParameter = function (e) {\n      return void 0 !== i[e] ? i[e] : null;\n    };\n  }, function (e, t, n) {\n    \"use strict\";\n\n    n.r(t), n.d(t, \"getBrowserInfo\", function () {\n      return I;\n    }), n.d(t, \"getBrowserVersion\", function () {\n      return p;\n    }), n.d(t, \"getBrowserOS\", function () {\n      return f;\n    }), n.d(t, \"isChrome\", function () {\n      return i;\n    }), n.d(t, \"isSafari\", function () {\n      return a;\n    }), n.d(t, \"isFireFox\", function () {\n      return o;\n    }), n.d(t, \"isOpera\", function () {\n      return s;\n    }), n.d(t, \"isEdge\", function () {\n      return r;\n    }), n.d(t, \"isQQBrowser\", function () {\n      return c;\n    }), n.d(t, \"isWeChatBrowser\", function () {\n      return d;\n    }), n.d(t, \"isLegacyChrome\", function () {\n      return g;\n    }), n.d(t, \"isSupportedPC\", function () {\n      return u;\n    }), n.d(t, \"isSupportedMobile\", function () {\n      return l;\n    }), n.d(t, \"getChromeKernelVersion\", function () {\n      return S;\n    }), n.d(t, \"isChromeKernel\", function () {\n      return m;\n    });\n\n    var i = function () {\n      var e = I();\n      return e.name && \"Chrome\" === e.name;\n    },\n        a = function () {\n      var e = I();\n      return e.name && \"Safari\" === e.name;\n    },\n        r = function () {\n      var e = I();\n      return e.name && \"Edge\" === e.name;\n    },\n        o = function () {\n      var e = I();\n      return e.name && \"Firefox\" === e.name;\n    },\n        s = function () {\n      var e = I();\n      return e.name && \"OPR\" === e.name;\n    },\n        c = function () {\n      var e = I();\n      return e.name && \"QQBrowser\" === e.name;\n    },\n        d = function () {\n      var e = I();\n      return e.name && \"MicroMessenger\" === e.name;\n    },\n        u = function () {\n      var e = f();\n      return \"Linux\" === e || \"Mac OS X\" === e || \"Mac OS\" === e || -1 !== e.indexOf(\"Windows\");\n    },\n        l = function () {\n      var e = f();\n      return \"Android\" === e || \"iOS\" === e;\n    },\n        p = function () {\n      return I().version;\n    },\n        f = function () {\n      return I().os;\n    },\n        m = function () {\n      return !!navigator.userAgent.match(/chrome\\/[\\d]./i);\n    };\n\n    function g() {\n      return window.navigator.appVersion && null !== window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./) && window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./)[1] <= 35;\n    }\n\n    var v,\n        S = function () {\n      var e = navigator.userAgent.match(/chrome\\/[\\d]./i);\n      return e && e[0] && e[0].split(\"/\")[1];\n    },\n        I = (v = function () {\n      var e,\n          t = navigator.userAgent,\n          n = t.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || [];\n      \"Chrome\" === n[1] && null != (e = t.match(/(OPR(?=\\/))\\/?(\\d+)/i)) && (n = e), \"Safari\" === n[1] && null != (e = t.match(/version\\/(\\d+)/i)) && (n[2] = e[1]), ~t.toLowerCase().indexOf(\"qqbrowser\") && null != (e = t.match(/(qqbrowser(?=\\/))\\/?(\\d+)/i)) && (n = e), ~t.toLowerCase().indexOf(\"micromessenger\") && null != (e = t.match(/(micromessenger(?=\\/))\\/?(\\d+)/i)) && (n = e), ~t.toLowerCase().indexOf(\"edge\") && null != (e = t.match(/(edge(?=\\/))\\/?(\\d+)/i)) && (n = e), ~t.toLowerCase().indexOf(\"trident\") && null != (e = /\\brv[ :]+(\\d+)/g.exec(t) || []) && (n = [null, \"IE\", e[1]]);\n      var i = void 0,\n          a = [{\n        s: \"Windows 10\",\n        r: /(Windows 10.0|Windows NT 10.0)/\n      }, {\n        s: \"Windows 8.1\",\n        r: /(Windows 8.1|Windows NT 6.3)/\n      }, {\n        s: \"Windows 8\",\n        r: /(Windows 8|Windows NT 6.2)/\n      }, {\n        s: \"Windows 7\",\n        r: /(Windows 7|Windows NT 6.1)/\n      }, {\n        s: \"Windows Vista\",\n        r: /Windows NT 6.0/\n      }, {\n        s: \"Windows Server 2003\",\n        r: /Windows NT 5.2/\n      }, {\n        s: \"Windows XP\",\n        r: /(Windows NT 5.1|Windows XP)/\n      }, {\n        s: \"Windows 2000\",\n        r: /(Windows NT 5.0|Windows 2000)/\n      }, {\n        s: \"Windows ME\",\n        r: /(Win 9x 4.90|Windows ME)/\n      }, {\n        s: \"Windows 98\",\n        r: /(Windows 98|Win98)/\n      }, {\n        s: \"Windows 95\",\n        r: /(Windows 95|Win95|Windows_95)/\n      }, {\n        s: \"Windows NT 4.0\",\n        r: /(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/\n      }, {\n        s: \"Windows CE\",\n        r: /Windows CE/\n      }, {\n        s: \"Windows 3.11\",\n        r: /Win16/\n      }, {\n        s: \"Android\",\n        r: /Android/\n      }, {\n        s: \"Open BSD\",\n        r: /OpenBSD/\n      }, {\n        s: \"Sun OS\",\n        r: /SunOS/\n      }, {\n        s: \"Linux\",\n        r: /(Linux|X11)/\n      }, {\n        s: \"iOS\",\n        r: /(iPhone|iPad|iPod)/\n      }, {\n        s: \"Mac OS X\",\n        r: /Mac OS X/\n      }, {\n        s: \"Mac OS\",\n        r: /(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/\n      }, {\n        s: \"QNX\",\n        r: /QNX/\n      }, {\n        s: \"UNIX\",\n        r: /UNIX/\n      }, {\n        s: \"BeOS\",\n        r: /BeOS/\n      }, {\n        s: \"OS/2\",\n        r: /OS\\/2/\n      }, {\n        s: \"Search Bot\",\n        r: /(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\\/Teoma|ia_archiver)/\n      }];\n\n      for (var r in a) {\n        var o = a[r];\n\n        if (o.r.test(navigator.userAgent)) {\n          i = o.s;\n          break;\n        }\n      }\n\n      return {\n        name: n[1],\n        version: n[2],\n        os: i\n      };\n    }(), function () {\n      return v;\n    });\n  }, function (e, t) {\n    function n() {\n      return e.exports = n = Object.assign || function (e) {\n        for (var t = 1; t < arguments.length; t++) {\n          var n = arguments[t];\n\n          for (var i in n) Object.prototype.hasOwnProperty.call(n, i) && (e[i] = n[i]);\n        }\n\n        return e;\n      }, n.apply(this, arguments);\n    }\n\n    e.exports = n;\n  }, function (e, t, n) {\n    e.exports = n(24);\n  }, function (e, t) {\n    function n(e) {\n      return (n = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (e) {\n        return typeof e;\n      } : function (e) {\n        return e && \"function\" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? \"symbol\" : typeof e;\n      })(e);\n    }\n\n    function i(t) {\n      return \"function\" == typeof Symbol && \"symbol\" === n(Symbol.iterator) ? e.exports = i = function (e) {\n        return n(e);\n      } : e.exports = i = function (e) {\n        return e && \"function\" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? \"symbol\" : n(e);\n      }, i(t);\n    }\n\n    e.exports = i;\n  }, function (e, t, n) {\n    \"use strict\";\n\n    n.d(t, \"c\", function () {\n      return u;\n    }), n.d(t, \"e\", function () {\n      return l;\n    }), n.d(t, \"b\", function () {\n      return s;\n    }), n.d(t, \"a\", function () {\n      return c;\n    }), n.d(t, \"d\", function () {\n      return d;\n    });\n\n    var i = n(2),\n        a = n(8),\n        r = 0,\n        o = 0,\n        s = function () {\n      return r;\n    },\n        c = function () {\n      return o;\n    },\n        d = function () {\n      r = 0, o = 0;\n    },\n        u = function (e, t, n, s, c) {\n      var d = new XMLHttpRequest();\n      if (d.timeout = t.timeout || Object(i.getParameter)(\"HTTP_CONNECT_TIMEOUT\"), d.open(\"POST\", e, !0), d.setRequestHeader(\"Content-type\", \"application/json; charset=utf-8\"), c) for (var u in c) \"withCredentials\" == u ? d.withCredentials = !0 : d.setRequestHeader(u, c[u]);\n      d.onload = function (e) {\n        o += Object(a.d)(d.responseText), n && n(d.responseText);\n      }, d.onerror = function (t) {\n        s && s(t, e);\n      }, d.ontimeout = function (t) {\n        s && s(t, e);\n      };\n      var l = JSON.stringify(t);\n      r += Object(a.d)(l), d.send(l);\n    },\n        l = function () {\n      return \"https:\" == document.location.protocol;\n    };\n  }, function (e, t, n) {\n    \"use strict\";\n\n    n.d(t, \"b\", function () {\n      return u;\n    }), n.d(t, \"a\", function () {\n      return d;\n    }), n.d(t, \"g\", function () {\n      return l;\n    }), n.d(t, \"c\", function () {\n      return p;\n    }), n.d(t, \"f\", function () {\n      return f;\n    }), n.d(t, \"e\", function () {\n      return g;\n    }), n.d(t, \"d\", function () {\n      return m;\n    });\n    n(6);\n\n    var i = n(3),\n        a = n(0),\n        r = n(12),\n        o = n.n(r),\n        s = n(13),\n        c = n(10),\n        d = function (e) {\n      return this.audioContext = Object(s.a)(), this.sourceNode = e.otWebkitAudioSource || this.audioContext.createMediaStreamSource(e), this.analyser = this.audioContext.createAnalyser(), this.timeDomainData = new Uint8Array(this.analyser.frequencyBinCount), this.sourceNode.connect(this.analyser), this.getAudioLevel = function () {\n        if (this.analyser) {\n          this.analyser.getByteTimeDomainData(this.timeDomainData);\n\n          for (var e = 0, t = 0; t < this.timeDomainData.length; t++) e = Math.max(e, Math.abs(this.timeDomainData[t] - 128));\n\n          return e / 128;\n        }\n\n        return a.default.warning(\"can't find analyser in audioLevelHelper\"), 0;\n      }, this;\n    };\n\n    function u() {\n      return o()().replace(/-/g, \"\").toUpperCase();\n    }\n\n    var l = function (e, t, n) {\n      try {\n        a.default.debug(\"start vsResHack\", e);\n        var r = document.createElement(\"video\");\n        r.setAttribute(\"autoplay\", \"\"), r.setAttribute(\"muted\", \"\"), r.muted = !0, r.setAttribute(\"playsinline\", \"\"), r.setAttribute(\"style\", \"position: absolute; top: 0; left: 0; width:1px; high:1px;\"), document.body.appendChild(r), r.addEventListener(\"playing\", function (n) {\n          i.isFireFox() ? r.videoWidth && (a.default.debug(\"[vsResHack] get stream resolution: \", \"\".concat(r.videoWidth, \" x \").concat(r.videoHeight), e), t(r.videoWidth, r.videoHeight), document.body.removeChild(r)) : (a.default.debug(\"[vsResHack] get stream resolution: \", \"\".concat(r.videoWidth, \" x \").concat(r.videoHeight), e), t(r.videoWidth, r.videoHeight), document.body.removeChild(r));\n        }), Object(c.setSrcObject)(r, e);\n      } catch (e) {\n        n(e);\n      }\n    },\n        p = function (e) {\n      return \"number\" == typeof e && 0 <= e && e <= 4294967295;\n    },\n        f = function (e) {\n      isNaN(e) && (e = 1e3);\n      var t = +new Date(),\n          n = (t = (9301 * t + 49297) % 233280) / 233280;\n      return Math.ceil(n * e);\n    },\n        m = function (e) {\n      var t = encodeURIComponent(e).match(/%[89ABab]/g);\n      return e.length + (t ? t.length : 0);\n    },\n        g = function () {\n      if (!document.getElementById(\"agora-ban-tip\")) {\n        var e = document.createElement(\"div\");\n        e.id = \"agora-ban-tip\", e.style = \"position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #fff;\", document.querySelector(\"body\").prepend(e);\n        var t = document.createElement(\"div\");\n        t.style = \"background: #000; width: 346px; height: 116px; z-index: 100000; opacity: 0.6; border-radius: 10px; box-shadow: 0 2px 4px #000;\", e.append(t);\n        var n = document.createElement(\"div\");\n        n.style = \"height: 76px; display: flex; justify-content: center; align-items: center;\";\n        var i = document.createElement(\"span\");\n        i.style = \"height: 28px; width: 28px; color: #000; text-align: center; line-height: 30px; background: #fff; border-radius: 50%; font-weight: 600; font-size: 20px;margin-right: 5px;\", i.innerText = \"!\";\n        var a = document.createElement(\"span\");\n        a.innerText = \"This browser does not support webRTC\", n.append(i), n.append(a);\n        var r = document.createElement(\"div\");\n        r.style = \"height: 38px; display: flex; border-top: #fff 1px solid; justify-content: center; align-items: center;\", r.innerText = \"OK\", t.append(n), t.append(r), r.onclick = function () {\n          var e = document.getElementById(\"agora-ban-tip\");\n          e.parentNode.removeChild(e);\n        };\n      }\n    };\n  }, function (e, t) {\n    function n(e, t, n, i, a, r, o) {\n      try {\n        var s = e[r](o),\n            c = s.value;\n      } catch (e) {\n        return void n(e);\n      }\n\n      s.done ? t(c) : Promise.resolve(c).then(i, a);\n    }\n\n    e.exports = function (e) {\n      return function () {\n        var t = this,\n            i = arguments;\n        return new Promise(function (a, r) {\n          var o = e.apply(t, i);\n\n          function s(e) {\n            n(o, a, r, s, c, \"next\", e);\n          }\n\n          function c(e) {\n            n(o, a, r, s, c, \"throw\", e);\n          }\n\n          s(void 0);\n        });\n      };\n    };\n  }, function (e, t, n) {\n    \"use strict\";\n\n    n.r(t), n.d(t, \"RTCPeerConnection\", function () {\n      return b;\n    }), n.d(t, \"getUserMedia\", function () {\n      return o;\n    }), n.d(t, \"attachMediaStream\", function () {\n      return s;\n    }), n.d(t, \"reattachMediaStream\", function () {\n      return c;\n    }), n.d(t, \"setSrcObject\", function () {\n      return f;\n    }), n.d(t, \"getSrcObject\", function () {\n      return m;\n    }), n.d(t, \"webrtcDetectedBrowser\", function () {\n      return d;\n    }), n.d(t, \"webrtcDetectedVersion\", function () {\n      return u;\n    }), n.d(t, \"webrtcMinimumVersion\", function () {\n      return l;\n    }), n.d(t, \"webrtcTesting\", function () {\n      return T;\n    }), n.d(t, \"webrtcUtils\", function () {\n      return S;\n    });\n    var i = n(6),\n        a = n.n(i),\n        r = n(3),\n        o = null,\n        s = null,\n        c = null,\n        d = null,\n        u = null,\n        l = null,\n        p = null,\n        f = null,\n        m = null,\n        g = null,\n        v = {\n      addStream: null\n    },\n        S = {\n      log: function () {},\n      extractVersion: function (e, t, n) {\n        var i = e.match(t);\n        return i && i.length >= n && parseInt(i[n]);\n      }\n    };\n    if (\"object\" == (\"undefined\" == typeof window ? \"undefined\" : a()(window)) ? (!window.HTMLMediaElement || \"srcObject\" in window.HTMLMediaElement.prototype ? (f = function (e, t) {\n      e.srcObject = t;\n    }, m = function (e) {\n      return e.srcObject;\n    }) : (f = function (e, t) {\n      \"mozSrcObject\" in e ? e.mozSrcObject = t : (e._srcObject = t, e.src = t ? URL.createObjectURL(t) : null);\n    }, m = function (e) {\n      return \"mozSrcObject\" in e ? e.mozSrcObject : e._srcObject;\n    }), o = window.navigator && window.navigator.getUserMedia) : (f = function (e, t) {\n      e.srcObject = t;\n    }, m = function (e) {\n      return e.srcObject;\n    }), s = function (e, t) {\n      f(e, t);\n    }, c = function (e, t) {\n      f(e, m(t));\n    }, \"undefined\" != typeof window && window.navigator) {\n      if (navigator.mozGetUserMedia && window.mozRTCPeerConnection) {\n        for (var I in S.log(\"This appears to be Firefox\"), d = \"firefox\", u = S.extractVersion(navigator.userAgent, /Firefox\\/([0-9]+)\\./, 1), l = 31, g = mozRTCPeerConnection, v) v[I] = g.prototype[I];\n\n        if (p = function (e, t) {\n          if (u < 38 && e && e.iceServers) {\n            for (var n = [], i = 0; i < e.iceServers.length; i++) {\n              var a = e.iceServers[i];\n              if (a.hasOwnProperty(\"urls\")) for (var r = 0; r < a.urls.length; r++) {\n                var o = {\n                  url: a.urls[r]\n                };\n                0 === a.urls[r].indexOf(\"turn\") && (o.username = a.username, o.credential = a.credential), n.push(o);\n              } else n.push(e.iceServers[i]);\n            }\n\n            e.iceServers = n;\n          }\n\n          var s = new g(e, t);\n\n          for (var c in v) s[c] = v[c];\n\n          return s;\n        }, window.RTCSessionDescription || (window.RTCSessionDescription = mozRTCSessionDescription), window.RTCIceCandidate || (window.RTCIceCandidate = mozRTCIceCandidate), o = function (e, t, n) {\n          var i = function (e) {\n            if (\"object\" !== a()(e) || e.require) return e;\n            var t = [];\n            return Object.keys(e).forEach(function (n) {\n              if (\"require\" !== n && \"advanced\" !== n && \"mediaSource\" !== n) {\n                var i = e[n] = \"object\" === a()(e[n]) ? e[n] : {\n                  ideal: e[n]\n                };\n\n                if (void 0 === i.min && void 0 === i.max && void 0 === i.exact || t.push(n), void 0 !== i.exact && (\"number\" == typeof i.exact ? i.min = i.max = i.exact : e[n] = i.exact, delete i.exact), void 0 !== i.ideal) {\n                  e.advanced = e.advanced || [];\n                  var r = {};\n                  \"number\" == typeof i.ideal ? r[n] = {\n                    min: i.ideal,\n                    max: i.ideal\n                  } : r[n] = i.ideal, e.advanced.push(r), delete i.ideal, Object.keys(i).length || delete e[n];\n                }\n              }\n            }), t.length && (e.require = t), e;\n          };\n\n          return u < 38 && (S.log(\"spec: \" + JSON.stringify(e)), e.audio && (e.audio = i(e.audio)), e.video && (e.video = i(e.video)), S.log(\"ff37: \" + JSON.stringify(e))), navigator.mozGetUserMedia(e, t, n);\n        }, navigator.getUserMedia = o, navigator.mediaDevices || (navigator.mediaDevices = {\n          getUserMedia: E,\n          addEventListener: function () {},\n          removeEventListener: function () {}\n        }), navigator.mediaDevices.enumerateDevices = navigator.mediaDevices.enumerateDevices || function () {\n          return new Promise(function (e) {\n            e([{\n              kind: \"audioinput\",\n              deviceId: \"default\",\n              label: \"\",\n              groupId: \"\"\n            }, {\n              kind: \"videoinput\",\n              deviceId: \"default\",\n              label: \"\",\n              groupId: \"\"\n            }]);\n          });\n        }, u < 41) {\n          var h = navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n\n          navigator.mediaDevices.enumerateDevices = function () {\n            return h().then(void 0, function (e) {\n              if (\"NotFoundError\" === e.name) return [];\n              throw e;\n            });\n          };\n        }\n      } else if (navigator.webkitGetUserMedia && window.webkitRTCPeerConnection) {\n        for (var I in S.log(\"This appears to be Chrome\"), d = \"chrome\", u = S.extractVersion(navigator.userAgent, /Chrom(e|ium)\\/([0-9]+)\\./, 2), l = 38, g = webkitRTCPeerConnection, v) v[I] = g.prototype[I];\n\n        p = function (e, t) {\n          e && e.iceTransportPolicy && (e.iceTransports = e.iceTransportPolicy);\n          var n = new g(e, t);\n\n          for (var i in v) n[i] = v[i];\n\n          var a = n.getStats.bind(n);\n          return n.getStats = function (e, t, n) {\n            var i = this,\n                r = arguments;\n            r.length > 0 && \"function\" == typeof e && (t ? (n = t, t = e, r = [e = null, t, n]) : (t = e, r = [e = null, t]));\n\n            var o = function (e) {\n              var t = {};\n              return e.result().forEach(function (e) {\n                var n = {\n                  id: e.id,\n                  timestamp: e.timestamp,\n                  type: e.type\n                };\n                e.names().forEach(function (t) {\n                  n[t] = e.stat(t);\n                }), t[n.id] = n;\n              }), t;\n            };\n\n            if (r.length >= 2) {\n              return a.apply(this, [function (e) {\n                r[1](o(e));\n              }, r[0]]);\n            }\n\n            return new Promise(function (t, n) {\n              1 === r.length && null === e ? a.apply(i, [function (e) {\n                t.apply(null, [o(e)]);\n              }, n]) : a.apply(i, [t, n]);\n            });\n          }, n;\n        }, [\"createOffer\", \"createAnswer\"].forEach(function (e) {\n          var t = webkitRTCPeerConnection.prototype[e];\n\n          webkitRTCPeerConnection.prototype[e] = function () {\n            var e = this;\n\n            if (arguments.length < 1 || 1 === arguments.length && \"object\" === a()(arguments[0])) {\n              var n = 1 === arguments.length ? arguments[0] : void 0;\n              return new Promise(function (i, a) {\n                t.apply(e, [i, a, n]);\n              });\n            }\n\n            return t.apply(this, arguments);\n          };\n        }), [\"setLocalDescription\", \"setRemoteDescription\", \"addIceCandidate\"].forEach(function (e) {\n          var t = webkitRTCPeerConnection.prototype[e];\n\n          webkitRTCPeerConnection.prototype[e] = function () {\n            var e = arguments,\n                n = this;\n            return new Promise(function (i, a) {\n              t.apply(n, [e[0], function () {\n                i(), e.length >= 2 && e[1].apply(null, []);\n              }, function (t) {\n                a(t), e.length >= 3 && e[2].apply(null, [t]);\n              }]);\n            });\n          };\n        });\n\n        var _ = function (e) {\n          if (\"object\" !== a()(e) || e.mandatory || e.optional) return e;\n          var t = {};\n          return Object.keys(e).forEach(function (n) {\n            if (\"require\" !== n && \"advanced\" !== n && \"mediaSource\" !== n) {\n              var i = \"object\" === a()(e[n]) ? e[n] : {\n                ideal: e[n]\n              };\n              void 0 !== i.exact && \"number\" == typeof i.exact && (i.min = i.max = i.exact);\n\n              var r = function (e, t) {\n                return e ? e + t.charAt(0).toUpperCase() + t.slice(1) : \"deviceId\" === t ? \"sourceId\" : t;\n              };\n\n              if (void 0 !== i.ideal) {\n                t.optional = t.optional || [];\n                var o = {};\n                \"number\" == typeof i.ideal ? (o[r(\"min\", n)] = i.ideal, t.optional.push(o), (o = {})[r(\"max\", n)] = i.ideal, t.optional.push(o)) : (o[r(\"\", n)] = i.ideal, t.optional.push(o));\n              }\n\n              void 0 !== i.exact && \"number\" != typeof i.exact ? (t.mandatory = t.mandatory || {}, t.mandatory[r(\"\", n)] = i.exact) : [\"min\", \"max\"].forEach(function (e) {\n                void 0 !== i[e] && (t.mandatory = t.mandatory || {}, t.mandatory[r(e, n)] = i[e]);\n              });\n            }\n          }), e.advanced && (t.optional = (t.optional || []).concat(e.advanced)), t;\n        };\n\n        if (o = function (e, t, n) {\n          return e.audio && (e.audio = _(e.audio)), e.video && (e.video = _(e.video)), S.log(\"chrome: \" + JSON.stringify(e)), navigator.webkitGetUserMedia(e, t, n);\n        }, navigator.getUserMedia = o, navigator.mediaDevices || (navigator.mediaDevices = {\n          getUserMedia: E,\n          enumerateDevices: function () {\n            return new Promise(function (e) {\n              var t = {\n                audio: \"audioinput\",\n                video: \"videoinput\"\n              };\n              return MediaStreamTrack.getSources(function (n) {\n                e(n.map(function (e) {\n                  return {\n                    label: e.label,\n                    kind: t[e.kind],\n                    deviceId: e.id,\n                    groupId: \"\"\n                  };\n                }));\n              });\n            });\n          }\n        }), navigator.mediaDevices.getUserMedia) {\n          if (Number(Object(r.getBrowserVersion)().split(\".\")[0]) < 46) {\n            var y = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\n\n            navigator.mediaDevices.getUserMedia = function (e) {\n              return S.log(\"spec:   \" + JSON.stringify(e)), e.audio = _(e.audio), e.video = _(e.video), S.log(\"chrome: \" + JSON.stringify(e)), y(e);\n            };\n          }\n        } else navigator.mediaDevices.getUserMedia = function (e) {\n          return E(e);\n        };\n\n        void 0 === navigator.mediaDevices.addEventListener && (navigator.mediaDevices.addEventListener = function () {\n          S.log(\"Dummy mediaDevices.addEventListener called.\");\n        }), void 0 === navigator.mediaDevices.removeEventListener && (navigator.mediaDevices.removeEventListener = function () {\n          S.log(\"Dummy mediaDevices.removeEventListener called.\");\n        }), s = function (e, t) {\n          u >= 43 ? f(e, t) : void 0 !== e.src ? e.src = t ? URL.createObjectURL(t) : null : S.log(\"Error attaching stream to element.\");\n        }, c = function (e, t) {\n          u >= 43 ? f(e, m(t)) : e.src = t.src;\n        };\n      } else navigator.mediaDevices && navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/) ? (S.log(\"This appears to be Edge\"), d = \"edge\", u = S.extractVersion(navigator.userAgent, /Edge\\/(\\d+).(\\d+)$/, 2), l = 12) : S.log(\"Browser does not appear to be WebRTC-capable\");\n    } else S.log(\"This does not appear to be a browser\"), d = \"not a browser\";\n\n    function E(e) {\n      return new Promise(function (t, n) {\n        o(e, t, n);\n      });\n    }\n\n    var b,\n        T = {};\n\n    try {\n      Object.defineProperty(T, \"version\", {\n        set: function (e) {\n          u = e;\n        }\n      });\n    } catch (e) {}\n\n    p ? b = p : \"undefined\" != typeof window && (b = window.RTCPeerConnection);\n  }, function (e, t, n) {\n    var i = n(19);\n\n    e.exports = function (e) {\n      for (var t = 1; t < arguments.length; t++) {\n        var n = null != arguments[t] ? arguments[t] : {},\n            a = Object.keys(n);\n        \"function\" == typeof Object.getOwnPropertySymbols && (a = a.concat(Object.getOwnPropertySymbols(n).filter(function (e) {\n          return Object.getOwnPropertyDescriptor(n, e).enumerable;\n        }))), a.forEach(function (t) {\n          i(e, t, n[t]);\n        });\n      }\n\n      return e;\n    };\n  }, function (e, t, n) {\n    var i = n(17),\n        a = n(18);\n\n    e.exports = function (e, t, n) {\n      var r = t && n || 0;\n      \"string\" == typeof e && (t = \"binary\" === e ? new Array(16) : null, e = null);\n      var o = (e = e || {}).random || (e.rng || i)();\n      if (o[6] = 15 & o[6] | 64, o[8] = 63 & o[8] | 128, t) for (var s = 0; s < 16; ++s) t[r + s] = o[s];\n      return t || a(o);\n    };\n  }, function (e, t, n) {\n    \"use strict\";\n\n    n.d(t, \"a\", function () {\n      return s;\n    });\n\n    var i = window.AudioContext || window.webkitAudioContext,\n        a = n(2),\n        r = a.getParameter,\n        o = a.setParameter,\n        s = function () {\n      return r(\"AUDIO_CONTEXT\") || (console.log(\"Creating Audio Context\"), o(\"AUDIO_CONTEXT\", function () {\n        if (i) return new i();\n        throw new Error(\"AUDIO_CONTEXT_NOT_SUPPORTED\");\n      }())), r(\"AUDIO_CONTEXT\");\n    };\n  }, function (e, t, n) {\n    \"use strict\";\n\n    t.__esModule = !0;\n    var i,\n        a = n(0),\n        r = n(10);\n    !function (e) {\n      e.NEW = \"new\", e.PREPARING_OFFER = \"preparing-offer\", e.OFFER_SENT = \"offer-sent\", e.ESTABLISHED = \"established\", e.CLOSED = \"closed\";\n    }(i || (i = {}));\n\n    var o = function () {\n      function e(e) {\n        this.candidate = null, this.state = i.NEW, this.config = e, this.isSubscriber = this.config.isSubscriber, this.peerConnection = this.initPeecConnection(e), this.peerConnection.onicecandidate = this._onicecandidate.bind(this), this.peerConnection.oniceconnectionstatechange = this._oniceconnectionstatechange.bind(this), this.peerConnection.onaddstream = this._onaddstream.bind(this), this.peerConnection.ontrack = this._ontrack.bind(this), this.processSignalingMessage = this.setAnswer.bind(this), this.peerConnection.createOffer({\n          offerToReceiveAudio: !0,\n          offerToReceiveVideo: !0\n        }).then(this.setLocalSDP.bind(this)), this.sendVideoStats = {\n          id: \"\",\n          type: \"\",\n          mediaType: \"\",\n          googCodecName: \"h264\" === this.config.codec ? \"H264\" : \"VP8\",\n          bytesSent: \"0\",\n          packetsLost: \"0\",\n          packetsSent: \"0\",\n          googAdaptationChanges: \"0\",\n          googAvgEncodeMs: \"0\",\n          googEncodeUsagePercent: \"0\",\n          googFirsReceived: \"0\",\n          googFrameHeightSent: \"0\",\n          googFrameHeightInput: \"0\",\n          googFrameRateInput: \"0\",\n          googFrameRateSent: \"0\",\n          googFrameWidthSent: \"0\",\n          googFrameWidthInput: \"0\",\n          googNacksReceived: \"0\",\n          googPlisReceived: \"0\",\n          googRtt: \"0\",\n          googFramesEncoded: \"0\"\n        }, this.sendAudioStats = {\n          id: \"\",\n          type: \"\",\n          mediaType: \"\",\n          googCodecName: \"opus\",\n          aecDivergentFilterFraction: \"0\",\n          audioInputLevel: \"0\",\n          bytesSent: \"0\",\n          packetsSent: \"0\",\n          googEchoCancellationReturnLoss: \"0\",\n          googEchoCancellationReturnLossEnhancement: \"0\"\n        }, this.receiveAudioStats = {\n          id: \"\",\n          type: \"\",\n          mediaType: \"\",\n          audioOutputLevel: \"0\",\n          bytesReceived: \"0\",\n          packetsLost: \"0\",\n          packetsReceived: \"0\",\n          googAccelerateRate: \"0\",\n          googCurrentDelayMs: \"0\",\n          googDecodingCNG: \"0\",\n          googDecodingCTN: \"0\",\n          googDecodingCTSG: \"0\",\n          googDecodingNormal: \"0\",\n          googDecodingPLC: \"0\",\n          googDecodingPLCCNG: \"0\",\n          googExpandRate: \"0\",\n          googJitterBufferMs: \"0\",\n          googJitterReceived: \"0\",\n          googPreemptiveExpandRate: \"0\",\n          googPreferredJitterBufferMs: \"0\",\n          googSecondaryDecodedRate: \"0\",\n          googSpeechExpandRate: \"0\"\n        }, this.receiveVideoStats = {\n          id: \"\",\n          type: \"\",\n          mediaType: \"\",\n          googTargetDelayMs: \"0\",\n          packetsLost: \"0\",\n          googDecodeMs: \"0\",\n          googMaxDecodeMs: \"0\",\n          googRenderDelayMs: \"0\",\n          googFrameWidthReceived: \"0\",\n          googFrameHeightReceived: \"0\",\n          googFrameRateReceived: \"0\",\n          googFrameRateDecoded: \"0\",\n          googFrameRateOutput: \"0\",\n          googFramesDecoded: \"0\",\n          googFrameReceived: \"0\",\n          googJitterBufferMs: \"0\",\n          googCurrentDelayMs: \"0\",\n          googMinPlayoutDelayMs: \"0\",\n          googNacksSent: \"0\",\n          googPlisSent: \"0\",\n          googFirsSent: \"0\",\n          bytesReceived: \"0\",\n          packetsReceived: \"0\"\n        };\n      }\n\n      return e.prototype.addStream = function (e) {\n        this.peerConnection.addStream(e);\n      }, e.prototype.setAnswer = function (e) {\n        var t = JSON.parse(e);\n        this.peerConnection.setRemoteDescription(new RTCSessionDescription({\n          sdp: t.sdp,\n          type: \"answer\"\n        })), this.onsignalingmessage && this.onsignalingmessage(\"\");\n      }, e.prototype.close = function () {\n        this.peerConnection.close();\n      }, e.prototype.getStats = function (e, t) {\n        if (void 0 === t && (t = 500), t = t > 500 ? 500 : t, Date.now() - this.lastTimeGetStats < t) {\n          var n = [];\n          this.config.isSubscriber ? (n.push(this.receiveVideoStats), n.push(this.receiveAudioStats)) : (n.push(this.sendAudioStats), n.push(this.sendVideoStats)), n.push({\n            id: \"time\",\n            startTime: this.connectedTime,\n            timestamp: Date.now()\n          }), e && e(n);\n        } else this._getStats(e);\n      }, e.prototype._getStats = function (e) {\n        var t = this,\n            n = [];\n        this.peerConnection.getStats(null).then(function (i) {\n          t.lastTimeGetStats = Date.now(), Object.keys(i).map(function (e) {\n            var n = i[e];\n            t.config.isSubscriber ? n.type && \"inboundrtp\" === n.type && n.mediaType && \"audio\" === n.mediaType ? (t.receiveAudioStats.id = n.id + \"recv\", t.receiveAudioStats.type = n.type + \"\", t.receiveAudioStats.mediaType = n.mediaType + \"\", t.receiveAudioStats.packetsReceived = n.packetsReceived + \"\", t.receiveAudioStats.bytesReceived = n.bytesReceived + \"\", t.receiveAudioStats.packetsLost = n.packetsLost + \"\", t.receiveAudioStats.googJitterReceived = n.jitter + \"\") : n.type && \"inboundrtp\" === n.type && n.mediaType && \"video\" === n.mediaType ? (t.receiveVideoStats.id = n.id + \"recv\", t.receiveVideoStats.type = n.type + \"\", t.receiveVideoStats.mediaType = n.mediaType + \"\", t.receiveVideoStats.packetsReceived = n.packetsReceived + \"\", t.receiveVideoStats.bytesReceived = n.bytesReceived + \"\", t.receiveVideoStats.packetsLost = n.packetsLost + \"\", t.receiveVideoStats.googJitterBufferMs = n.jitter + \"\", t.receiveVideoStats.googPlisSent = n.pliCount + \"\", t.receiveVideoStats.googFirsSent = n.firCount + \"\", t.receiveVideoStats.googNacksSent = n.nackCount + \"\") : n.remoteSource && n.type && \"track\" === n.type && n.trackIdentifier && -1 !== n.trackIdentifier.indexOf(\"v\") ? (t.receiveVideoStats.googFrameHeightReceived = n.frameHeight + \"\", t.receiveVideoStats.googFrameWidthReceived = n.frameWidth + \"\", t.receiveVideoStats.googFrameRateDecoded = n.framesPerSecond + \"\", t.receiveVideoStats.googFrameRateOutput = n.framesPerSecond + \"\", t.receiveVideoStats.googFrameRateReceived = n.framesPerSecond + \"\", t.receiveVideoStats.googFramesDecoded = n.framesDecoded + \"\", t.receiveVideoStats.googFrameReceived = n.framesReceived + \"\") : n.remoteSource && n.type && \"track\" === n.type && n.trackIdentifier && -1 !== n.trackIdentifier.indexOf(\"a\") && (t.receiveAudioStats.audioOutputLevel = n.audioLevel + \"\") : !n.isRemote && n.type && \"outboundrtp\" === n.type && n.mediaType && \"audio\" === n.mediaType ? (t.sendAudioStats.id = n.id + \"send\", t.sendAudioStats.type = n.type + \"\", t.sendAudioStats.mediaType = n.mediaType + \"\", t.sendAudioStats.packetsSent = n.packetsSent + \"\", t.sendAudioStats.bytesSent = n.bytesSent + \"\") : !n.isRemote && n.type && \"outboundrtp\" === n.type && n.mediaType && \"video\" === n.mediaType ? (t.sendVideoStats.id = n.id + \"send\", t.sendVideoStats.type = n.type + \"\", t.sendVideoStats.mediaType = n.mediaType + \"\", t.sendVideoStats.packetsSent = n.packetsSent + \"\", t.sendVideoStats.bytesSent = n.bytesSent + \"\", t.sendVideoStats.googRtt = n.roundTripTime + \"\", t.sendVideoStats.googPlisReceived = n.pliCount + \"\", t.sendVideoStats.googFirsReceived = n.firCount + \"\", t.sendVideoStats.googNacksReceived = n.nackCount + \"\") : !n.remoteSource && n.type && \"track\" === n.type && n.framesSent && 0 !== n.framesSent && (t.sendVideoStats.googFrameHeightSent = n.frameHeight + \"\", t.sendVideoStats.googFrameHeightInput = n.frameHeight + \"\", t.sendVideoStats.googFrameWidthSent = n.frameWidth + \"\", t.sendVideoStats.googFrameWidthInput = n.frameWidth + \"\", t.sendVideoStats.googFramesEncoded = n.framesSent + \"\", t.sendVideoStats.googFrameRateSent = n.framesPerSecond + \"\");\n          }), t.config.isSubscriber ? (n.push(t.receiveVideoStats), n.push(t.receiveAudioStats)) : (n.push(t.sendAudioStats), n.push(t.sendVideoStats)), n.push({\n            id: \"time\",\n            startTime: t.connectedTime,\n            timestamp: Date.now()\n          }), e && e(n);\n        });\n      }, e.prototype.getStatsRate = function (e) {\n        this.getStats(e);\n      }, e.prototype.initPeecConnection = function (e) {\n        var t = e.stunServerUrl,\n            n = e.turnServer,\n            i = e.iceServers;\n        return this.pcConfig = {\n          iceServers: [{\n            urls: \"stun:webcs.agora.io:3478\"\n          }]\n        }, i instanceof Array ? this.pcConfig.iceServers = e.iceServers : t && (t instanceof Array ? t.map(function (e) {\n          \"string\" == typeof e && \"\" !== e && this.pcConfig.iceServers.push({\n            urls: e\n          });\n        }) : \"string\" == typeof t && \"\" !== t && this.pcConfig.iceServers.push({\n          urls: t\n        })), n && (n instanceof Array ? n.map(function (e) {\n          \"string\" == typeof e.url && \"\" !== e.url && this.pcConfig.iceServers.push({\n            username: e.username,\n            credential: e.credential,\n            url: e.url\n          });\n        }) : \"auto\" !== n.mode && \"manual\" !== n.mode || (n.udpport && this.pcConfig.iceServers.push({\n          username: n.username,\n          credential: n.credential,\n          credentialType: \"password\",\n          urls: \"turn:\" + n.url + \":\" + n.udpport + \"?transport=udp\"\n        }), \"string\" == typeof n.tcpport && \"\" !== n.tcpport && this.pcConfig.iceServers.push({\n          username: n.username,\n          credential: n.credential,\n          credentialType: \"password\",\n          urls: \"turn:\" + n.url + \":\" + n.tcpport + \"?transport=tcp\"\n        }), !0 === n.forceturn && (this.pcConfig.iceTransportPolicy = \"relay\"))), new r.RTCPeerConnection(this.pcConfig);\n      }, e.prototype._ontrack = function (e) {\n        this.onaddstream && this.onaddstream(e, \"ontrack\");\n      }, e.prototype._onaddstream = function (e) {\n        this.onaddstream && this.onaddstream(e, \"onaddstream\");\n      }, e.prototype._oniceconnectionstatechange = function (e) {\n        \"connected\" === e.currentTarget.iceConnectionState && (this.state = i.ESTABLISHED, this.connectedTime = Date.now()), this.oniceconnectionstatechange && this.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n      }, e.prototype._onicecandidate = function (e) {\n        !this.candidate && e && (this.candidate = e.candidate, this.peerConnection.createOffer({\n          offerToReceiveAudio: !0,\n          offerToReceiveVideo: !0\n        }).then(this.editLocalSDP.bind(this)).then(this.setLocalSDP.bind(this)).then(this.sendOffer.bind(this)).catch());\n      }, e.prototype.setLocalSDP = function (e) {\n        return this.peerConnection.setLocalDescription(new RTCSessionDescription({\n          sdp: e.sdp,\n          type: \"offer\"\n        })), this.state = i.PREPARING_OFFER, e;\n      }, e.prototype.editLocalSDP = function (e) {\n        return e.sdp = this.setBandWidth(e.sdp), e.sdp = this.reviseOpus(e.sdp), e.sdp = this.addCandidate(e.sdp), e;\n      }, e.prototype.setSendRecv = function (e) {\n        return e = (e = (e = e.replace(/a=recvonly\\r\\n/g, \"a=sendrecv\\r\\n\")).replace(/a=sendonly\\r\\n/g, \"a=sendrecv\\r\\n\")).replace(/a=inactive\\r\\n/g, \"a=sendrecv\\r\\n\");\n      }, e.prototype.setBandWidth = function (e) {\n        var t,\n            n,\n            i = this.config,\n            r = i.codec,\n            o = i.minVideoBW,\n            s = i.maxVideoBW,\n            c = i.maxAudioBW,\n            d = i.clientId;\n\n        if ((t = e.match(/m=video.*\\r\\n/)) && o && s) {\n          n = t[0] + \"b=AS:\" + s + \"\\r\\n\";\n          var u = 0,\n              l = 0;\n          \"h264\" === r ? (u = e.search(/a=rtpmap:(\\d+) H264\\/90000\\r\\n/), l = e.search(/H264\\/90000\\r\\n/)) : \"vp8\" === r && (u = e.search(/a=rtpmap:(\\d+) VP8\\/90000\\r\\n/), l = e.search(/VP8\\/90000\\r\\n/)), -1 !== u && -1 !== l && l - u > 10 && (n = n + \"a=fmtp:\" + e.slice(u + 9, l - 1) + \" x-google-min-bitrate=\" + o + \"\\r\\n\"), e = e.replace(t[0], n), a.default.debug(\"[\" + d + \"]Set Video Bitrate - min:\" + o + \" max:\" + s);\n        }\n\n        return (t = e.match(/m=audio.*\\r\\n/)) && c && (n = t[0] + \"b=AS:\" + c + \"\\r\\n\", e = e.replace(t[0], n)), e;\n      }, e.prototype.reviseOpus = function (e) {\n        return e = (e = e.replace(/a=rtpmap:102 opus\\/48000\\/2/g, \"a=rtpmap:111 opus/48000/2\")).replace(/m=audio 9 UDP\\/TLS\\/RTP\\/SAVPF 102 0 8 97 13 118 101/g, \"m=audio 9 UDP/TLS/RTP/SAVPF 111 0 8 97 13 118 101\");\n      }, e.prototype.addCandidate = function (e) {\n        return e += \"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\\r\\n\";\n      }, e.prototype.sendOffer = function (e) {\n        this.config.callback(JSON.stringify({\n          sdp: e.sdp,\n          messageType: \"OFFER\",\n          tiebreaker: Math.floor(429496723 * Math.random() + 1)\n        })), this.state = i.OFFER_SENT;\n      }, e;\n    }();\n\n    t.default = o;\n  }, function (e, t, n) {\n    \"use strict\";\n\n    var i = this && this.__awaiter || function (e, t, n, i) {\n      return new (n || (n = Promise))(function (a, r) {\n        function o(e) {\n          try {\n            c(i.next(e));\n          } catch (e) {\n            r(e);\n          }\n        }\n\n        function s(e) {\n          try {\n            c(i.throw(e));\n          } catch (e) {\n            r(e);\n          }\n        }\n\n        function c(e) {\n          e.done ? a(e.value) : new n(function (t) {\n            t(e.value);\n          }).then(o, s);\n        }\n\n        c((i = i.apply(e, t || [])).next());\n      });\n    },\n        a = this && this.__generator || function (e, t) {\n      var n,\n          i,\n          a,\n          r,\n          o = {\n        label: 0,\n        sent: function () {\n          if (1 & a[0]) throw a[1];\n          return a[1];\n        },\n        trys: [],\n        ops: []\n      };\n      return r = {\n        next: s(0),\n        throw: s(1),\n        return: s(2)\n      }, \"function\" == typeof Symbol && (r[Symbol.iterator] = function () {\n        return this;\n      }), r;\n\n      function s(r) {\n        return function (s) {\n          return function (r) {\n            if (n) throw new TypeError(\"Generator is already executing.\");\n\n            for (; o;) try {\n              if (n = 1, i && (a = 2 & r[0] ? i.return : r[0] ? i.throw || ((a = i.return) && a.call(i), 0) : i.next) && !(a = a.call(i, r[1])).done) return a;\n\n              switch (i = 0, a && (r = [2 & r[0], a.value]), r[0]) {\n                case 0:\n                case 1:\n                  a = r;\n                  break;\n\n                case 4:\n                  return o.label++, {\n                    value: r[1],\n                    done: !1\n                  };\n\n                case 5:\n                  o.label++, i = r[1], r = [0];\n                  continue;\n\n                case 7:\n                  r = o.ops.pop(), o.trys.pop();\n                  continue;\n\n                default:\n                  if (!(a = (a = o.trys).length > 0 && a[a.length - 1]) && (6 === r[0] || 2 === r[0])) {\n                    o = 0;\n                    continue;\n                  }\n\n                  if (3 === r[0] && (!a || r[1] > a[0] && r[1] < a[3])) {\n                    o.label = r[1];\n                    break;\n                  }\n\n                  if (6 === r[0] && o.label < a[1]) {\n                    o.label = a[1], a = r;\n                    break;\n                  }\n\n                  if (a && o.label < a[2]) {\n                    o.label = a[2], o.ops.push(r);\n                    break;\n                  }\n\n                  a[2] && o.ops.pop(), o.trys.pop();\n                  continue;\n              }\n\n              r = t.call(e, o);\n            } catch (e) {\n              r = [6, e], i = 0;\n            } finally {\n              n = a = 0;\n            }\n\n            if (5 & r[0]) throw r[1];\n            return {\n              value: r[0] ? r[1] : void 0,\n              done: !0\n            };\n          }([r, s]);\n        };\n      }\n    },\n        r = this;\n\n    t.__esModule = !0;\n    var o = n(20),\n        s = n(3),\n        c = n(0);\n\n    t.getSupportedCodec = function (e) {\n      return i(r, void 0, void 0, function () {\n        var t, n, i, r, u;\n        return a(this, function (a) {\n          switch (a.label) {\n            case 0:\n              return t = {\n                video: [],\n                audio: []\n              }, \"undefined\" != typeof window ? [3, 1] : (c.default.error(\"getSupportedCodec: NOT_BROWSER_ENV\"), [2, Promise.reject(\"NOT_BROWSER_ENV\")]);\n\n            case 1:\n              try {\n                n = o.createRTCPeerConnection({\n                  iceServers: []\n                });\n              } catch (e) {\n                return c.default.error(\"Failed to init RTCPeerConnection\", e), [2, Promise.reject(e)];\n              }\n\n              return n ? [3, 2] : (c.default.warning(\"getSupportedCodec: no RTCPeerConnection constructor is detected\"), [2, Promise.resolve(t)]);\n\n            case 2:\n              return e && e.stream ? [3, 7] : (i = {\n                mandatory: {\n                  OfferToReceiveAudio: !0,\n                  OfferToReceiveVideo: !0\n                }\n              }, r = void 0, (s.isSafari() || s.isFireFox() || s.isWeChatBrowser()) && n.addTransceiver ? (n.addTransceiver(\"audio\"), n.addTransceiver(\"video\"), [4, n.createOffer()]) : [3, 4]);\n\n            case 3:\n              return r = a.sent(), [3, 6];\n\n            case 4:\n              return [4, new Promise(function (e, t) {\n                var a = setTimeout(function () {\n                  t(\"CREATEOFFER_TIMEOUT\");\n                }, 3e3);\n                n.createOffer(function (t) {\n                  clearTimeout(a), e(t);\n                }, function (e) {\n                  clearTimeout(a), t(e);\n                }, i);\n              })];\n\n            case 5:\n              r = a.sent(), a.label = 6;\n\n            case 6:\n              return n.close(), u = r.sdp, [2, d(u)];\n\n            case 7:\n              return e.stream.getTracks && n.addTrack ? e.stream.getTracks().forEach(function (t) {\n                n.addTrack(t, e.stream);\n              }) : n.addStream(e.stream), r = void 0, s.isSafari() || s.isFireFox() ? [4, n.createOffer()] : [3, 9];\n\n            case 8:\n              return r = a.sent(), [3, 11];\n\n            case 9:\n              return [4, new Promise(function (e, t) {\n                n.createOffer(e, t);\n              })];\n\n            case 10:\n              r = a.sent(), a.label = 11;\n\n            case 11:\n              return n.close(), u = r.sdp, [2, d(u)];\n          }\n        });\n      });\n    };\n\n    var d = function (e) {\n      var t = {\n        video: [],\n        audio: []\n      };\n      return e.match(/ VP8/i) && t.video.push(\"VP8\"), e.match(/ H264/i) && t.video.push(\"H264\"), e.match(/ opus/i) && t.audio.push(\"OPUS\"), Promise.resolve(t);\n    };\n  }, function (e, t, n) {\n    var i = n(21),\n        a = n(22),\n        r = n(23);\n\n    e.exports = function (e) {\n      return i(e) || a(e) || r();\n    };\n  }, function (e, t) {\n    var n = \"undefined\" != typeof crypto && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || \"undefined\" != typeof msCrypto && \"function\" == typeof window.msCrypto.getRandomValues && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (n) {\n      var i = new Uint8Array(16);\n\n      e.exports = function () {\n        return n(i), i;\n      };\n    } else {\n      var a = new Array(16);\n\n      e.exports = function () {\n        for (var e, t = 0; t < 16; t++) 0 == (3 & t) && (e = 4294967296 * Math.random()), a[t] = e >>> ((3 & t) << 3) & 255;\n\n        return a;\n      };\n    }\n  }, function (e, t) {\n    for (var n = [], i = 0; i < 256; ++i) n[i] = (i + 256).toString(16).substr(1);\n\n    e.exports = function (e, t) {\n      var i = t || 0,\n          a = n;\n      return [a[e[i++]], a[e[i++]], a[e[i++]], a[e[i++]], \"-\", a[e[i++]], a[e[i++]], \"-\", a[e[i++]], a[e[i++]], \"-\", a[e[i++]], a[e[i++]], \"-\", a[e[i++]], a[e[i++]], a[e[i++]], a[e[i++]], a[e[i++]], a[e[i++]]].join(\"\");\n    };\n  }, function (e, t) {\n    e.exports = function (e, t, n) {\n      return t in e ? Object.defineProperty(e, t, {\n        value: n,\n        enumerable: !0,\n        configurable: !0,\n        writable: !0\n      }) : e[t] = n, e;\n    };\n  }, function (e, t, n) {\n    \"use strict\";\n\n    t.__esModule = !0;\n    var i = \"object\" == typeof window && window.RTCPeerConnection,\n        a = \"object\" == typeof window && window.webkitRTCPeerConnection,\n        r = \"object\" == typeof window && window.mozRTCPeerConnection;\n\n    t.createRTCPeerConnection = function (e) {\n      var t = i || a || r;\n      return t ? new t(e) : null;\n    };\n  }, function (e, t) {\n    e.exports = function (e) {\n      if (Array.isArray(e)) {\n        for (var t = 0, n = new Array(e.length); t < e.length; t++) n[t] = e[t];\n\n        return n;\n      }\n    };\n  }, function (e, t) {\n    e.exports = function (e) {\n      if (Symbol.iterator in Object(e) || \"[object Arguments]\" === Object.prototype.toString.call(e)) return Array.from(e);\n    };\n  }, function (e, t) {\n    e.exports = function () {\n      throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n    };\n  }, function (e, t, n) {\n    var i = function () {\n      return this || \"object\" == typeof self && self;\n    }() || Function(\"return this\")(),\n        a = i.regeneratorRuntime && Object.getOwnPropertyNames(i).indexOf(\"regeneratorRuntime\") >= 0,\n        r = a && i.regeneratorRuntime;\n\n    if (i.regeneratorRuntime = void 0, e.exports = n(25), a) i.regeneratorRuntime = r;else try {\n      delete i.regeneratorRuntime;\n    } catch (e) {\n      i.regeneratorRuntime = void 0;\n    }\n  }, function (e, t) {\n    !function (t) {\n      \"use strict\";\n\n      var n,\n          i = Object.prototype,\n          a = i.hasOwnProperty,\n          r = \"function\" == typeof Symbol ? Symbol : {},\n          o = r.iterator || \"@@iterator\",\n          s = r.asyncIterator || \"@@asyncIterator\",\n          c = r.toStringTag || \"@@toStringTag\",\n          d = \"object\" == typeof e,\n          u = t.regeneratorRuntime;\n      if (u) d && (e.exports = u);else {\n        (u = t.regeneratorRuntime = d ? e.exports : {}).wrap = _;\n        var l = \"suspendedStart\",\n            p = \"suspendedYield\",\n            f = \"executing\",\n            m = \"completed\",\n            g = {},\n            v = {};\n\n        v[o] = function () {\n          return this;\n        };\n\n        var S = Object.getPrototypeOf,\n            I = S && S(S(D([])));\n        I && I !== i && a.call(I, o) && (v = I);\n        var h = T.prototype = E.prototype = Object.create(v);\n        b.prototype = h.constructor = T, T.constructor = b, T[c] = b.displayName = \"GeneratorFunction\", u.isGeneratorFunction = function (e) {\n          var t = \"function\" == typeof e && e.constructor;\n          return !!t && (t === b || \"GeneratorFunction\" === (t.displayName || t.name));\n        }, u.mark = function (e) {\n          return Object.setPrototypeOf ? Object.setPrototypeOf(e, T) : (e.__proto__ = T, c in e || (e[c] = \"GeneratorFunction\")), e.prototype = Object.create(h), e;\n        }, u.awrap = function (e) {\n          return {\n            __await: e\n          };\n        }, R(A.prototype), A.prototype[s] = function () {\n          return this;\n        }, u.AsyncIterator = A, u.async = function (e, t, n, i) {\n          var a = new A(_(e, t, n, i));\n          return u.isGeneratorFunction(t) ? a : a.next().then(function (e) {\n            return e.done ? e.value : a.next();\n          });\n        }, R(h), h[c] = \"Generator\", h[o] = function () {\n          return this;\n        }, h.toString = function () {\n          return \"[object Generator]\";\n        }, u.keys = function (e) {\n          var t = [];\n\n          for (var n in e) t.push(n);\n\n          return t.reverse(), function n() {\n            for (; t.length;) {\n              var i = t.pop();\n              if (i in e) return n.value = i, n.done = !1, n;\n            }\n\n            return n.done = !0, n;\n          };\n        }, u.values = D, w.prototype = {\n          constructor: w,\n          reset: function (e) {\n            if (this.prev = 0, this.next = 0, this.sent = this._sent = n, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = n, this.tryEntries.forEach(N), !e) for (var t in this) \"t\" === t.charAt(0) && a.call(this, t) && !isNaN(+t.slice(1)) && (this[t] = n);\n          },\n          stop: function () {\n            this.done = !0;\n            var e = this.tryEntries[0].completion;\n            if (\"throw\" === e.type) throw e.arg;\n            return this.rval;\n          },\n          dispatchException: function (e) {\n            if (this.done) throw e;\n            var t = this;\n\n            function i(i, a) {\n              return s.type = \"throw\", s.arg = e, t.next = i, a && (t.method = \"next\", t.arg = n), !!a;\n            }\n\n            for (var r = this.tryEntries.length - 1; r >= 0; --r) {\n              var o = this.tryEntries[r],\n                  s = o.completion;\n              if (\"root\" === o.tryLoc) return i(\"end\");\n\n              if (o.tryLoc <= this.prev) {\n                var c = a.call(o, \"catchLoc\"),\n                    d = a.call(o, \"finallyLoc\");\n\n                if (c && d) {\n                  if (this.prev < o.catchLoc) return i(o.catchLoc, !0);\n                  if (this.prev < o.finallyLoc) return i(o.finallyLoc);\n                } else if (c) {\n                  if (this.prev < o.catchLoc) return i(o.catchLoc, !0);\n                } else {\n                  if (!d) throw new Error(\"try statement without catch or finally\");\n                  if (this.prev < o.finallyLoc) return i(o.finallyLoc);\n                }\n              }\n            }\n          },\n          abrupt: function (e, t) {\n            for (var n = this.tryEntries.length - 1; n >= 0; --n) {\n              var i = this.tryEntries[n];\n\n              if (i.tryLoc <= this.prev && a.call(i, \"finallyLoc\") && this.prev < i.finallyLoc) {\n                var r = i;\n                break;\n              }\n            }\n\n            r && (\"break\" === e || \"continue\" === e) && r.tryLoc <= t && t <= r.finallyLoc && (r = null);\n            var o = r ? r.completion : {};\n            return o.type = e, o.arg = t, r ? (this.method = \"next\", this.next = r.finallyLoc, g) : this.complete(o);\n          },\n          complete: function (e, t) {\n            if (\"throw\" === e.type) throw e.arg;\n            return \"break\" === e.type || \"continue\" === e.type ? this.next = e.arg : \"return\" === e.type ? (this.rval = this.arg = e.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === e.type && t && (this.next = t), g;\n          },\n          finish: function (e) {\n            for (var t = this.tryEntries.length - 1; t >= 0; --t) {\n              var n = this.tryEntries[t];\n              if (n.finallyLoc === e) return this.complete(n.completion, n.afterLoc), N(n), g;\n            }\n          },\n          catch: function (e) {\n            for (var t = this.tryEntries.length - 1; t >= 0; --t) {\n              var n = this.tryEntries[t];\n\n              if (n.tryLoc === e) {\n                var i = n.completion;\n\n                if (\"throw\" === i.type) {\n                  var a = i.arg;\n                  N(n);\n                }\n\n                return a;\n              }\n            }\n\n            throw new Error(\"illegal catch attempt\");\n          },\n          delegateYield: function (e, t, i) {\n            return this.delegate = {\n              iterator: D(e),\n              resultName: t,\n              nextLoc: i\n            }, \"next\" === this.method && (this.arg = n), g;\n          }\n        };\n      }\n\n      function _(e, t, n, i) {\n        var a = t && t.prototype instanceof E ? t : E,\n            r = Object.create(a.prototype),\n            o = new w(i || []);\n        return r._invoke = function (e, t, n) {\n          var i = l;\n          return function (a, r) {\n            if (i === f) throw new Error(\"Generator is already running\");\n\n            if (i === m) {\n              if (\"throw\" === a) throw r;\n              return k();\n            }\n\n            for (n.method = a, n.arg = r;;) {\n              var o = n.delegate;\n\n              if (o) {\n                var s = C(o, n);\n\n                if (s) {\n                  if (s === g) continue;\n                  return s;\n                }\n              }\n\n              if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) {\n                if (i === l) throw i = m, n.arg;\n                n.dispatchException(n.arg);\n              } else \"return\" === n.method && n.abrupt(\"return\", n.arg);\n              i = f;\n              var c = y(e, t, n);\n\n              if (\"normal\" === c.type) {\n                if (i = n.done ? m : p, c.arg === g) continue;\n                return {\n                  value: c.arg,\n                  done: n.done\n                };\n              }\n\n              \"throw\" === c.type && (i = m, n.method = \"throw\", n.arg = c.arg);\n            }\n          };\n        }(e, n, o), r;\n      }\n\n      function y(e, t, n) {\n        try {\n          return {\n            type: \"normal\",\n            arg: e.call(t, n)\n          };\n        } catch (e) {\n          return {\n            type: \"throw\",\n            arg: e\n          };\n        }\n      }\n\n      function E() {}\n\n      function b() {}\n\n      function T() {}\n\n      function R(e) {\n        [\"next\", \"throw\", \"return\"].forEach(function (t) {\n          e[t] = function (e) {\n            return this._invoke(t, e);\n          };\n        });\n      }\n\n      function A(e) {\n        var t;\n\n        this._invoke = function (n, i) {\n          function r() {\n            return new Promise(function (t, r) {\n              !function t(n, i, r, o) {\n                var s = y(e[n], e, i);\n\n                if (\"throw\" !== s.type) {\n                  var c = s.arg,\n                      d = c.value;\n                  return d && \"object\" == typeof d && a.call(d, \"__await\") ? Promise.resolve(d.__await).then(function (e) {\n                    t(\"next\", e, r, o);\n                  }, function (e) {\n                    t(\"throw\", e, r, o);\n                  }) : Promise.resolve(d).then(function (e) {\n                    c.value = e, r(c);\n                  }, function (e) {\n                    return t(\"throw\", e, r, o);\n                  });\n                }\n\n                o(s.arg);\n              }(n, i, t, r);\n            });\n          }\n\n          return t = t ? t.then(r, r) : r();\n        };\n      }\n\n      function C(e, t) {\n        var i = e.iterator[t.method];\n\n        if (i === n) {\n          if (t.delegate = null, \"throw\" === t.method) {\n            if (e.iterator.return && (t.method = \"return\", t.arg = n, C(e, t), \"throw\" === t.method)) return g;\n            t.method = \"throw\", t.arg = new TypeError(\"The iterator does not provide a 'throw' method\");\n          }\n\n          return g;\n        }\n\n        var a = y(i, e.iterator, t.arg);\n        if (\"throw\" === a.type) return t.method = \"throw\", t.arg = a.arg, t.delegate = null, g;\n        var r = a.arg;\n        return r ? r.done ? (t[e.resultName] = r.value, t.next = e.nextLoc, \"return\" !== t.method && (t.method = \"next\", t.arg = n), t.delegate = null, g) : r : (t.method = \"throw\", t.arg = new TypeError(\"iterator result is not an object\"), t.delegate = null, g);\n      }\n\n      function O(e) {\n        var t = {\n          tryLoc: e[0]\n        };\n        1 in e && (t.catchLoc = e[1]), 2 in e && (t.finallyLoc = e[2], t.afterLoc = e[3]), this.tryEntries.push(t);\n      }\n\n      function N(e) {\n        var t = e.completion || {};\n        t.type = \"normal\", delete t.arg, e.completion = t;\n      }\n\n      function w(e) {\n        this.tryEntries = [{\n          tryLoc: \"root\"\n        }], e.forEach(O, this), this.reset(!0);\n      }\n\n      function D(e) {\n        if (e) {\n          var t = e[o];\n          if (t) return t.call(e);\n          if (\"function\" == typeof e.next) return e;\n\n          if (!isNaN(e.length)) {\n            var i = -1,\n                r = function t() {\n              for (; ++i < e.length;) if (a.call(e, i)) return t.value = e[i], t.done = !1, t;\n\n              return t.value = n, t.done = !0, t;\n            };\n\n            return r.next = r;\n          }\n        }\n\n        return {\n          next: k\n        };\n      }\n\n      function k() {\n        return {\n          value: n,\n          done: !0\n        };\n      }\n    }(function () {\n      return this || \"object\" == typeof self && self;\n    }() || Function(\"return this\")());\n  }, function (e, t, n) {\n    \"use strict\";\n\n    n.r(t);\n\n    var a = n(2),\n        r = n(0),\n        o = n(1),\n        s = function () {\n      var e = {\n        dispatcher: {}\n      };\n      return e.dispatcher.eventListeners = {}, e.addEventListener = function (t, n) {\n        void 0 === e.dispatcher.eventListeners[t] && (e.dispatcher.eventListeners[t] = []), e.dispatcher.eventListeners[t].push(n);\n      }, e.hasListeners = function (t) {\n        return !(!e.dispatcher.eventListeners[t] || !e.dispatcher.eventListeners[t].length);\n      }, e.on = e.addEventListener, e.removeEventListener = function (t, n) {\n        var i;\n        -1 !== (i = e.dispatcher.eventListeners[t].indexOf(n)) && e.dispatcher.eventListeners[t].splice(i, 1);\n      }, e.dispatchEvent = function (t) {\n        var n;\n\n        for (n in e.dispatcher.eventListeners[t.type]) e.dispatcher.eventListeners[t.type] && e.dispatcher.eventListeners[t.type].hasOwnProperty(n) && \"function\" == typeof e.dispatcher.eventListeners[t.type][n] && e.dispatcher.eventListeners[t.type][n](t);\n      }, e.dispatchSocketEvent = function (t) {\n        var n;\n\n        for (n in e.dispatcher.eventListeners[t.type]) e.dispatcher.eventListeners[t.type] && e.dispatcher.eventListeners[t.type].hasOwnProperty(n) && \"function\" == typeof e.dispatcher.eventListeners[t.type][n] && e.dispatcher.eventListeners[t.type][n](t.msg);\n      }, e;\n    },\n        c = function (e) {\n      var t = {};\n      return t.type = e.type, t;\n    },\n        d = function (e) {\n      var t = c(e);\n      return t.stream = e.stream, t.reason = e.reason, t.msg = e.msg, t;\n    },\n        u = function (e) {\n      var t = c(e);\n      return t.uid = e.uid, t.attr = e.attr, t.stream = e.stream, t;\n    },\n        l = function (e) {\n      var t = c(e);\n      return t.msg = e.msg, t;\n    },\n        p = function (e) {\n      var t = c(e);\n      return t.url = e.url, t.uid = e.uid, t.status = e.status, t.reason = e.reason, t;\n    },\n        f = n(3),\n        m = function () {};\n\n    m.prototype.set = function (e, t) {\n      [\"BatteryLevel\"].indexOf(e) > -1 && (this[e] = t);\n    };\n\n    var g = new function () {\n      var e = s();\n      return e.states = {\n        UNINIT: \"UNINIT\",\n        INITING: \"INITING\",\n        INITED: \"INITED\"\n      }, e.state = e.states.UNINIT, e.batteryManager = null, e._init = function (t, n) {\n        e.state = e.states.INITING, navigator.getBattery ? navigator.getBattery().then(function (n) {\n          e.batteryManager = n, t && setTimeout(function () {\n            t();\n          }, 0);\n        }).catch(function (e) {\n          r.default.debug(\"navigator.getBattery is disabled\", e), t && t();\n        }) : (e.state = e.states.INITED, t && t());\n      }, e._getBatteryStats = function () {\n        var t = {};\n        return e.batteryManager && e.batteryManager.level ? t.BatteryLevel = Math.floor(100 * e.batteryManager.level) : t.BatteryLevel = \"UNSUPPORTED\", t;\n      }, e.getStats = function (t, n) {\n        var i = new m(),\n            a = e._getBatteryStats();\n\n        a && a.BatteryLevel && i.set(\"BatteryLevel\", a.BatteryLevel), t && t(i);\n      }, e._init(), e;\n    }(),\n        v = n(4),\n        S = n.n(v),\n        I = function (e) {\n      var t = s(e);\n      return t.url = \".\", t;\n    },\n        h = n(10),\n        _ = {\n      101100: \"NO_FLAG_SET\",\n      101101: \"FLAG_SET_BUT_EMPTY\",\n      101102: \"INVALID_FALG_SET\",\n      101203: \"NO_SERVICE_AVIABLE\",\n      0: \"OK_CODE\",\n      5: \"INVALID_VENDOR_KEY\",\n      7: \"INVALID_CHANNEL_NAME\",\n      8: \"INTERNAL_ERROR\",\n      9: \"NO_AUTHORIZED\",\n      10: \"DYNAMIC_KEY_TIMEOUT\",\n      11: \"NO_ACTIVE_STATUS\",\n      13: \"DYNAMIC_KEY_EXPIRED\",\n      14: \"STATIC_USE_DYANMIC_KEY\",\n      15: \"DYNAMIC_USE_STATIC_KEY\",\n      1010100: \"NO_FLAG_SET\",\n      1010101: \"FLAG_SET_BUT_EMPTY\",\n      1010102: \"INVALID_FALG_SET\",\n      1010200: \"NO_SERVICE_AVAILABLE\",\n      1010203: \"NO_SERVICE_AVAILABLE_WEBRTC\",\n      1010205: \"NO_SERVICE_AVAILABLE_DISPATCHER\",\n      1010208: \"NO_SERVICE_AVAILABLE_APPCENTER\",\n      1010211: \"NO_SERVICE_AVAILABLE_SUA\",\n      2010005: \"INVALID_VENDOR_KEY\",\n      2010007: \"INVALID_CHANNEL_NAME\",\n      2010008: \"INTERNAL_ERROR\",\n      2010009: \"NO_AUTHORIZED\",\n      2010010: \"DYNAMIC_KEY_TIMEOUT\",\n      2010011: \"NO_ACTIVE_STATUS\",\n      2010013: \"DYNAMIC_KEY_EXPIRED\",\n      2010014: \"STATIC_USE_DYANMIC_KEY\",\n      2010015: \"DYNAMIC_USE_STATIC_KEY\"\n    },\n        y = {\n      2000: \"ERR_NO_VOCS_AVAILABLE\",\n      2001: \"ERR_NO_VOS_AVAILABLE\",\n      2002: \"ERR_JOIN_CHANNEL_TIMEOUT\",\n      2003: \"WARN_REPEAT_JOIN\",\n      2004: \"ERR_JOIN_BY_MULTI_IP\",\n      2011: \"ERR_NOT_JOINED\",\n      2012: \"WARN_REPEAT_JOIN\",\n      2013: \"ERR_INVALID_VENDOR_KEY\",\n      2014: \"ERR_INVALID_CHANNEL_NAME\",\n      2015: \"ERR_INVALID_STRINGUID\",\n      2016: \"ERR_TOO_MANY_USERS\",\n      2017: \"ERR_SET_CLIENT_ROLE_TIMEOUT\",\n      2018: \"ERR_SET_CLIENT_ROLE_NO_PERMISSION\",\n      2019: \"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE\",\n      2020: \"ERR_PUBLISH_REQUEST_INVALID\",\n      2021: \"ERR_SUBSCRIBE_REQUEST_INVALID\",\n      2022: \"ERR_NOT_SUPPORTED_MESSAGE\",\n      2023: \"ERR_ILLEAGAL_PLUGIN\",\n      101: \"ERR_INVALID_VENDOR_KEY\",\n      102: \"ERR_INVALID_CHANNEL_NAME\",\n      103: \"WARN_NO_AVAILABLE_CHANNEL\",\n      104: \"WARN_LOOKUP_CHANNEL_TIMEOUT\",\n      105: \"WARN_LOOKUP_CHANNEL_REJECTED\",\n      106: \"WARN_OPEN_CHANNEL_TIMEOUT\",\n      107: \"WARN_OPEN_CHANNEL_REJECTED\",\n      108: \"WARN_REQUEST_DEFERRED\",\n      109: \"ERR_DYNAMIC_KEY_TIMEOUT\",\n      110: \"ERR_NO_AUTHORIZED\",\n      111: \"ERR_VOM_SERVICE_UNAVAILABLE\",\n      112: \"ERR_NO_CHANNEL_AVAILABLE_CODE\",\n      113: \"ERR_TOO_MANY_USERS\",\n      114: \"ERR_MASTER_VOCS_UNAVAILABLE\",\n      115: \"ERR_INTERNAL_ERROR\",\n      116: \"ERR_NO_ACTIVE_STATUS\",\n      117: \"ERR_INVALID_UID\",\n      118: \"ERR_DYNAMIC_KEY_EXPIRED\",\n      119: \"ERR_STATIC_USE_DYANMIC_KE\",\n      120: \"ERR_DYNAMIC_USE_STATIC_KE\",\n      2: \"K_TIMESTAMP_EXPIRED\",\n      3: \"K_CHANNEL_PERMISSION_INVALID\",\n      4: \"K_CERTIFICATE_INVALID\",\n      5: \"K_CHANNEL_NAME_EMPTY\",\n      6: \"K_CHANNEL_NOT_FOUND\",\n      7: \"K_TICKET_INVALID\",\n      8: \"K_CHANNEL_CONFLICTED\",\n      9: \"K_SERVICE_NOT_READY\",\n      10: \"K_SERVICE_TOO_HEAVY\",\n      14: \"K_UID_BANNED\",\n      15: \"K_IP_BANNED\",\n      16: \"K_CHANNEL_BANNED\"\n    },\n        E = {\n      1: \"ERROR_ILLEAGAL_APPID\",\n      2: \"ERROR_ILLEAGAL_UID\",\n      3: \"INTERNAL_SERVER_ERROR\"\n    },\n        b = [\"NO_FLAG_SET\", \"NO_SERVICE_AVIABLE\", \"FLAG_SET_BUT_EMPTY\", \"EMPTY_ADDRESS_RESPONSE\"],\n        T = 0,\n        R = 1,\n        A = 2,\n        C = 3,\n        O = 4,\n        N = 5,\n        w = 6,\n        D = 7,\n        k = 8,\n        L = 9,\n        M = 10,\n        P = {\n      19: \"ERR_ALREADY_IN_USE\",\n      10: \"ERR_TIMEDOUT\",\n      3: \"ERR_NOT_READY\",\n      9: \"ERR_NO_PERMISSION\",\n      0: \"UNKNOW_ERROR\"\n    },\n        x = {\n      FAILED: \"FAILED\",\n      INVALID_KEY: \"INVALID_KEY\",\n      INVALID_CLIENT_MODE: \"INVALID_CLIENT_MODE\",\n      INVALID_CLIENT_CODEC: \"INVALID_CLIENT_CODEC\",\n      CLIENT_MODE_CODEC_MISMATCH: \"CLIENT_MODE_CODEC_MISMATCH\",\n      WEB_API_NOT_SUPPORTED: \"WEB_API_NOT_SUPPORTED\",\n      INVALID_PARAMETER: \"INVALID_PARAMETER\",\n      INVALID_OPERATION: \"INVALID_OPERATION\",\n      INVALID_LOCAL_STREAM: \"INVALID_LOCAL_STREAM\",\n      INVALID_REMOTE_STREAM: \"INVALID_REMOTE_STREAM\",\n      INVALID_DYNAMIC_KEY: \"INVALID_DYNAMIC_KEY\",\n      DYNAMIC_KEY_TIMEOUT: \"DYNAMIC_KEY_TIMEOUT\",\n      NO_VOCS_AVAILABLE: \"NO_VOCS_AVAILABLE\",\n      NO_VOS_AVAILABLE: \"ERR_NO_VOS_AVAILABLE\",\n      JOIN_CHANNEL_TIMEOUT: \"ERR_JOIN_CHANNEL_TIMEOUT\",\n      NO_AVAILABLE_CHANNEL: \"NO_AVAILABLE_CHANNEL\",\n      LOOKUP_CHANNEL_TIMEOUT: \"LOOKUP_CHANNEL_TIMEOUT\",\n      LOOKUP_CHANNEL_REJECTED: \"LOOKUP_CHANNEL_REJECTED\",\n      OPEN_CHANNEL_TIMEOUT: \"OPEN_CHANNEL_TIMEOUT\",\n      OPEN_CHANNEL_REJECTED: \"OPEN_CHANNEL_REJECTED\",\n      REQUEST_DEFERRED: \"REQUEST_DEFERRED\",\n      STREAM_ALREADY_PUBLISHED: \"STREAM_ALREADY_PUBLISHED\",\n      STREAM_NOT_YET_PUBLISHED: \"STREAM_NOT_YET_PUBLISHED\",\n      JOIN_TOO_FREQUENT: \"JOIN_TOO_FREQUENT\",\n      SOCKET_ERROR: \"SOCKET_ERROR\",\n      SOCKET_DISCONNECTED: \"SOCKET_DISCONNECTED\",\n      PEERCONNECTION_FAILED: \"PEERCONNECTION_FAILED\",\n      CONNECT_GATEWAY_ERROR: \"CONNECT_GATEWAY_ERROR\",\n      SERVICE_NOT_AVAILABLE: \"SERVICE_NOT_AVAILABLE\",\n      JOIN_CHANNEL_FAILED: \"JOIN_CHANNEL_FAILED\",\n      PUBLISH_STREAM_FAILED: \"PUBLISH_STREAM_FAILED\",\n      UNPUBLISH_STREAM_FAILED: \"UNPUBLISH_STREAM_FAILED\",\n      SUBSCRIBE_STREAM_FAILED: \"SUBSCRIBE_STREAM_FAILED\",\n      UNSUBSCRIBE_STREAM_FAILED: \"UNSUBSCRIBE_STREAM_FAILED\",\n      NO_SUCH_REMOTE_STREAM: \"NO_SUCH_REMOTE_STREAM\",\n      ERR_FAILED: \"1\",\n      ERR_INVALID_VENDOR_KEY: \"101\",\n      ERR_INVALID_CHANNEL_NAME: \"102\",\n      WARN_NO_AVAILABLE_CHANNEL: \"103\",\n      WARN_LOOKUP_CHANNEL_TIMEOUT: \"104\",\n      WARN_LOOKUP_CHANNEL_REJECTED: \"105\",\n      WARN_OPEN_CHANNEL_TIMEOUT: \"106\",\n      WARN_OPEN_CHANNEL_REJECTED: \"107\",\n      WARN_REQUEST_DEFERRED: \"108\",\n      ERR_DYNAMIC_KEY_TIMEOUT: \"109\",\n      ERR_INVALID_DYNAMIC_KEY: \"110\",\n      ERR_NO_VOCS_AVAILABLE: \"2000\",\n      ERR_NO_VOS_AVAILABLE: \"2001\",\n      ERR_JOIN_CHANNEL_TIMEOUT: \"2002\",\n      IOS_NOT_SUPPORT: \"IOS_NOT_SUPPORT\",\n      WECHAT_NOT_SUPPORT: \"WECHAT_NOT_SUPPORT\",\n      SHARING_SCREEN_NOT_SUPPORT: \"SHARING_SCREEN_NOT_SUPPORT\",\n      STILL_ON_PUBLISHING: \"STILL_ON_PUBLISHING\",\n      LOW_STREAM_ALREADY_PUBLISHED: \"LOW_STREAM_ALREADY_PUBLISHED\",\n      LOW_STREAM_NOT_YET_PUBLISHED: \"LOW_STREAM_ALREADY_PUBLISHED\",\n      HIGH_STREAM_NOT_VIDEO_TRACE: \"HIGH_STREAM_NOT_VIDEO_TRACE\",\n      NOT_FIND_DEVICE_BY_LABEL: \"NOT_FIND_DEVICE_BY_LABEL\",\n      ENABLE_DUALSTREAM_FAILED: \"ENABLE_DUALSTREAM_FAILED\",\n      DISABLE_DUALSTREAM_FAILED: \"DISABLE_DUALSTREAM_FAILED\",\n      PLAYER_NOT_FOUND: \"PLAYER_NOT_FOUND\",\n      ELECTRON_NOT_SUPPORT_SHARING_SCREEN: \"ELECTRON_NOT_SUPPORT_SHARING_SCREEN\",\n      BAD_ENVIRONMENT: \"BAD_ENVIRONMENT\",\n      LOAD_AUDIO_FAILED: \"LOAD_AUDIO_FAILED\"\n    },\n        U = 0,\n        V = function (e) {\n      var t = I({});\n      t.id = e.id, t.playerId = U++, t.fit = e.options && e.options.fit, \"contain\" !== t.fit && \"cover\" !== t.fit && (t.fit = null), t.url = e.url, t.stream = e.stream.stream, t.elementID = e.elementID, t.setAudioOutput = function (e, n, i) {\n        var a = t.video || t.audio;\n        return a ? a.setSinkId ? void a.setSinkId(e).then(function () {\n          return r.default.debug(\"[\" + t.id + \"] \" + \"video \".concat(t.id, \" setAudioOutput \").concat(e, \" SUCCESS\")), a == t.video && t.audio ? t.audio.setSinkId(e) : Promise.resolve();\n        }).then(function () {\n          return r.default.debug(\"[\" + t.id + \"] \" + \"audio \".concat(t.id, \" setAudioOutput \").concat(e, \" SUCCESS\")), n && n();\n        }).catch(function (e) {\n          return r.default.error(\"[\" + t.id + \"] VideoPlayer.setAudioOutput\", e), i && i(e);\n        }) : (r.default.error(\"[\" + t.id + \"] \", x.WEB_API_NOT_SUPPORTED), i && i(x.WEB_API_NOT_SUPPORTED)) : (r.default.error(\"[\" + t.id + \"] \", x.PLAYER_NOT_FOUND), i && i(x.PLAYER_NOT_FOUND));\n      }, t.destroy = function () {\n        r.default.debug(\"destroy \".concat(e.stream.local ? \"local\" : \"remote\", \" Player \").concat(t.id)), Object(h.setSrcObject)(t.video, null), Object(h.setSrcObject)(t.audio, null), t.video.pause(), delete t.resizer, clearInterval(t.mediaPlayerTimer), t.mediaPlayerTimer = null, document.getElementById(t.div.id) && t.parentNode.contains(t.div) && t.parentNode.removeChild(t.div), [\"video\", \"audio\"].forEach(function (n) {\n          t[n];\n          var i = s[n];\n          clearTimeout(i.playDeferTimeout), i.formerMediaState = null;\n          var a = {\n            playerId: t.playerId,\n            stateId: i.stateId + 1,\n            playDeferTimeout: null,\n            error: !1,\n            status: \"aborted\",\n            reason: \"stop\",\n            updatedAt: Date.now()\n          };\n          s[n] = a;\n          var c = {\n            type: \"player-status-change\",\n            playerId: t.playerId,\n            mediaType: n,\n            status: a.status,\n            reason: a.reason,\n            isErrorState: !1\n          };\n          r.default.debug(\"Media Player Status Change Triggered by destroy()\", c), e.stream.dispatchEvent(c), o.b.reportApiInvoke(e.stream.sid, {\n            name: \"Stream.playerStatusChange\",\n            options: c,\n            tag: \"tracer\"\n          })();\n        });\n      }, t.div = document.createElement(\"div\"), t.div.setAttribute(\"id\", \"player_\" + t.id), e.stream.video ? t.div.setAttribute(\"style\", \"width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;\") : t.div.setAttribute(\"style\", \"width: 100%; height: 100%; position: relative; overflow: hidden;\"), t.video = document.createElement(\"video\"), t.video.setAttribute(\"id\", \"video\" + t.id), e.stream.local && !e.stream.screen ? e.stream.mirror ? t.video.setAttribute(\"style\", \"width: 100%; height: 100%; position: absolute; transform: rotateY(180deg); object-fit: \".concat(t.fit || \"cover\", \";\")) : t.video.setAttribute(\"style\", \"width: 100%; height: 100%; position: absolute; object-fit: \".concat(t.fit || \"cover\", \";\")) : e.stream.video ? t.video.setAttribute(\"style\", \"width: 100%; height: 100%; position: absolute; object-fit: \".concat(t.fit || \"cover\", \";\")) : e.stream.screen ? t.video.setAttribute(\"style\", \"width: 100%; height: 100%; position: absolute; object-fit: \".concat(t.fit || \"contain\")) : t.video.setAttribute(\"style\", \"width: 100%; height: 100%; position: absolute; display: none; object-fit: \".concat(t.fit || \"cover\"));\n      var n = {\n        autoplay: !0,\n        muted: !!e.stream.local || !(!f.isSafari() && \"iOS\" !== f.getBrowserOS()) && \"video_element_muted\",\n        playsinline: !0,\n        controls: !(!f.isSafari() && \"iOS\" !== f.getBrowserOS() || e.stream.local),\n        volume: null\n      },\n          i = S()({}, n, e.options);\n      !0 !== i.muted || i.volume || (i.volume = 0), i.autoplay && t.video.setAttribute(\"autoplay\", \"\"), !0 !== i.muted && \"video_element_muted\" !== i.muted || (t.video.setAttribute(\"muted\", \"\"), t.video.muted = !0), i.playsinline && t.video.setAttribute(\"playsinline\", \"\"), i.controls && t.video.setAttribute(\"controls\", \"\"), Number.isFinite(i.volume) && (t.video.volume = i.volume), t.audio = document.createElement(\"audio\"), t.audio.setAttribute(\"id\", \"audio\" + t.id), i.autoplay && t.audio.setAttribute(\"autoplay\", \"\"), !0 === i.muted && t.audio.setAttribute(\"muted\", \"\"), !0 === i.muted && (t.audio.muted = !0), i.playsinline && t.audio.setAttribute(\"playsinline\", \"\"), Number.isFinite(i.volume) && (t.audio.volume = i.volume), void 0 !== t.elementID ? (document.getElementById(t.elementID).appendChild(t.div), t.container = document.getElementById(t.elementID)) : (document.body.appendChild(t.div), t.container = document.body), t.parentNode = t.div.parentNode;\n      var s = {\n        video: {\n          playerId: t.playerId,\n          stateId: 0,\n          playDeferTimeout: null,\n          error: !1,\n          status: \"init\",\n          reason: null,\n          updatedAt: Date.now()\n        },\n        audio: {\n          playerId: t.playerId,\n          stateId: 0,\n          playDeferTimeout: null,\n          error: !1,\n          status: \"init\",\n          reason: null,\n          updatedAt: Date.now()\n        }\n      };\n\n      t.mediaElemExists = function (e) {\n        for (var t = e, n = 0; n < Object(a.getParameter)(\"MEDIA_ELEMENT_EXISTS_DEPTH\") && t; n++) t = t.parentNode;\n\n        return !!t;\n      };\n\n      var c = function (e) {\n        return t.mediaElemExists(e) ? e.paused ? \"paused\" : \"play\" : \"aborted\";\n      },\n          d = function (e, t, n) {\n        var i = c(e),\n            a = !0;\n        return \"paused\" === i ? (\"audio\" === t && !0 === n.muted && (a = !1), n.autoplay || (a = !1)) : \"play\" === i ? \"video\" === t ? a = !1 : !0 === n.muted ? e.muted && (a = !1) : e.muted || (a = !1) : \"aborted\" === i && (a = !1), a;\n      },\n          u = function (n) {\n        var u,\n            l = this;\n\n        if (l === t.video ? u = \"video\" : l === t.audio && (u = \"audio\"), u) {\n          n.type || r.default.error(\"Unexpected evt\", n);\n          var p = c(l);\n          clearTimeout(s[u].playDeferTimeout), s[u].playDeferTimeout = setTimeout(function () {\n            s[u].playDeferTimeout = null;\n            var a = s[u],\n                f = c(l);\n\n            if (p === f) {\n              var m = {\n                playerId: t.playerId,\n                stateId: a.stateId + 1,\n                playDeferTimeout: null,\n                error: d(l, u, i),\n                status: c(l),\n                reason: n.type,\n                updatedAt: Date.now()\n              };\n\n              if (a.status !== m.status) {\n                s[u] = m;\n                var g = {\n                  type: \"player-status-change\",\n                  playerId: t.playerId,\n                  mediaType: u,\n                  status: m.status,\n                  reason: m.reason,\n                  isErrorState: m.error\n                };\n                r.default.debug(\"Media Player Status Change\", g), e.stream.dispatchEvent(g), o.b.reportApiInvoke(e.stream.sid, {\n                  name: \"Stream.playerStatusChange\",\n                  options: g,\n                  tag: \"tracer\"\n                })();\n              }\n            } else r.default.debug(\"Status Change after event Triggered.\" + \"Stream \".concat(t.id, \" PlayerId \").concat(t.playerId, \" mediaType \").concat(u, \" Status \").concat(p, \"=>\").concat(f));\n          }, Object(a.getParameter)(\"PLAYER_STATE_DEFER\"));\n        } else r.default.error(\"Unknown media element\", l);\n      };\n\n      if (t.mediaPlayerTimer = setInterval(function () {\n        [\"video\", \"audio\"].forEach(function (n) {\n          var a = t[n],\n              u = s[n];\n\n          if (!u.playDeferTimeout) {\n            var l = {\n              playerId: t.playerId,\n              stateId: u.stateId + 1,\n              playDeferTimeout: null,\n              error: d(a, n, i),\n              status: c(a),\n              reason: \"timer\",\n              updatedAt: Date.now()\n            };\n\n            if (u.status !== l.status) {\n              r.default.debug(\"Player \".concat(t.playerId, \" \").concat(n, \" Status Changed Detected by Timer: \").concat(u.status, \"=>\").concat(l.status)), s[n] = l;\n              var p = {\n                type: \"player-status-change\",\n                playerId: t.playerId,\n                mediaType: n,\n                status: l.status,\n                reason: l.reason,\n                isErrorState: l.error\n              };\n              r.default.debug(\"Media Player Status Change\", p), e.stream.dispatchEvent(p), o.b.reportApiInvoke(e.stream.sid, {\n                name: \"Stream.playerStatusChange\",\n                options: p,\n                tag: \"tracer\"\n              })();\n            }\n          }\n        });\n      }, Object(a.getParameter)(\"PLAYER_STATE_DEFER\")), t.video.addEventListener(\"playing\", function (e) {\n        !function e() {\n          t.video.videoWidth * t.video.videoHeight > 4 ? r.default.debug(\"[\" + t.id + \"] video dimensions:\", t.video.videoWidth, t.video.videoHeight) : setTimeout(e, 50);\n        }();\n      }), t.video.addEventListener(\"playing\", u), t.video.addEventListener(\"canplay\", u), t.video.addEventListener(\"abort\", u), t.video.addEventListener(\"onerror\", u), t.video.addEventListener(\"suspend\", u), t.video.addEventListener(\"stalled\", u), t.video.addEventListener(\"pause\", u), t.audio.addEventListener(\"playing\", u), t.audio.addEventListener(\"canplay\", u), t.audio.addEventListener(\"abort\", u), t.audio.addEventListener(\"onerror\", u), t.audio.addEventListener(\"suspend\", u), t.audio.addEventListener(\"stalled\", u), t.audio.addEventListener(\"pause\", u), e.stream.hasVideo() || e.stream.hasScreen()) t.div.appendChild(t.video), t.div.appendChild(t.audio), f.isEdge() ? t.video.srcObject = e.stream.stream : (Object(h.attachMediaStream)(t.video, e.stream.stream), Object(h.attachMediaStream)(t.audio, e.stream.stream));else if (!1 !== i.muted && \"video_element_muted\" !== i.muted || (t.video.removeAttribute(\"muted\"), t.video.muted = !1), t.div.appendChild(t.video), window.MediaStream && (f.isSafari() || \"iOS\" === f.getBrowserOS())) {\n        var l = new MediaStream(e.stream.stream.getAudioTracks());\n        Object(h.setSrcObject)(t.video, l);\n      } else Object(h.setSrcObject)(t.video, e.stream.stream);\n      return t.setAudioVolume = function (e) {\n        var n = parseInt(e) / 100;\n        isFinite(n) && (n < 0 ? n = 0 : n > 1 && (n = 1), t.video && (t.video.volume = n), t.audio && (t.audio.volume = n));\n      }, t;\n    },\n        F = function (e) {\n      var t = {},\n          n = h.RTCPeerConnection;\n      t.uid = e.uid, t.isVideoMute = e.isVideoMute, t.isAudioMute = e.isAudioMute, t.isSubscriber = e.isSubscriber, t.clientId = e.clientId, t.filterStatsCache = [], t.originStatsCache = [], t.lastTimeGetStats = null, t.pc_config = {\n        iceServers: [{\n          url: \"stun:webcs.agora.io:3478\"\n        }]\n      }, t.con = {\n        optional: [{\n          DtlsSrtpKeyAgreement: !0\n        }]\n      }, e.iceServers instanceof Array ? t.pc_config.iceServers = e.iceServers : (e.stunServerUrl && (e.stunServerUrl instanceof Array ? e.stunServerUrl.map(function (e) {\n        \"string\" == typeof e && \"\" !== e && t.pc_config.iceServers.push({\n          url: e\n        });\n      }) : \"string\" == typeof e.stunServerUrl && \"\" !== e.stunServerUrl && t.pc_config.iceServers.push({\n        url: e.stunServerUrl\n      })), e.turnServer && (e.turnServer instanceof Array ? e.turnServer.map(function (e) {\n        \"string\" == typeof e.url && \"\" !== e.url && t.pc_config.iceServers.push({\n          username: e.username,\n          credential: e.credential,\n          url: e.url\n        });\n      }) : \"auto\" !== e.turnServer.mode && \"manual\" !== e.turnServer.mode || (e.turnServer.udpport && t.pc_config.iceServers.push({\n        username: e.turnServer.username,\n        credential: e.turnServer.credential,\n        credentialType: \"password\",\n        urls: \"turn:\" + e.turnServer.url + \":\" + e.turnServer.udpport + \"?transport=udp\"\n      }), \"string\" == typeof e.turnServer.tcpport && \"\" !== e.turnServer.tcpport && t.pc_config.iceServers.push({\n        username: e.turnServer.username,\n        credential: e.turnServer.credential,\n        credentialType: \"password\",\n        urls: \"turn:\" + e.turnServer.url + \":\" + e.turnServer.tcpport + \"?transport=tcp\"\n      }), !0 === e.turnServer.forceturn && (t.pc_config.iceTransportPolicy = \"relay\")))), void 0 === e.audio && (e.audio = !0), void 0 === e.video && (e.video = !0), t.mediaConstraints = {\n        mandatory: {\n          OfferToReceiveVideo: e.video,\n          OfferToReceiveAudio: e.audio\n        }\n      }, t.roapSessionId = 103;\n\n      try {\n        t.pc_config.sdpSemantics = \"plan-b\", t.peerConnection = new n(t.pc_config, t.con);\n      } catch (e) {\n        delete t.pc_config.sdpSemantics, t.peerConnection = new n(t.pc_config, t.con);\n      }\n\n      t.iceCandidateTimer = setTimeout(function () {\n        t.iceCandidateTimer = null, r.default.debug(\"[\".concat(t.clientId, \"]Candidates collected: \").concat(t.iceCandidateCount)), t.moreIceComing && (t.moreIceComing = !1, t.markActionNeeded());\n      }, Object(a.getParameter)(\"CANDIDATE_TIMEOUT\")), t.peerConnection.onicecandidate = function (e) {\n        var n, i, a, o;\n        i = (n = t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\\ssrflx.+\\r\\n/), a = n.match(/a=candidate:.+typ\\shost.+\\r\\n/), o = n.match(/a=candidate:.+typ\\srelay.+\\r\\n/), null === i && null === a && null === o || void 0 !== t.ice || !t.iceCandidateTimer || (r.default.debug(\"[\" + t.clientId + \"]srflx candidate : \" + i + \" relay candidate: \" + o + \" host candidate : \" + a), clearTimeout(t.iceCandidateTimer), t.iceCandidateTimer = null, t.ice = 0, t.moreIceComing = !1, t.markActionNeeded()), t.iceCandidateCount = t.iceCandidateCount + 1;\n      }, r.default.debug(\"[\" + t.clientId + ']Created webkitRTCPeerConnnection with config \"' + JSON.stringify(t.pc_config) + '\".');\n\n      var i = function (t) {\n        return e.screen && (t = t.replace(\"a=x-google-flag:conference\\r\\n\", \"\")), t;\n      },\n          o = function (n) {\n        var i, a;\n\n        if ((i = n.match(/m=video.*\\r\\n/)) && e.minVideoBW && e.maxVideoBW) {\n          a = i[0] + \"b=AS:\" + e.maxVideoBW + \"\\r\\n\";\n          var o = 0,\n              s = 0;\n          \"h264\" === e.codec ? (o = n.search(/a=rtpmap:(\\d+) H264\\/90000\\r\\n/), s = n.search(/H264\\/90000\\r\\n/)) : \"vp8\" === e.codec && (o = n.search(/a=rtpmap:(\\d+) VP8\\/90000\\r\\n/), s = n.search(/VP8\\/90000\\r\\n/)), -1 !== o && -1 !== s && s - o > 10 && (a = a + \"a=fmtp:\" + n.slice(o + 9, s - 1) + \" x-google-min-bitrate=\" + e.minVideoBW + \"\\r\\n\"), n = n.replace(i[0], a), r.default.debug(\"[\" + t.clientId + \"]Set Video Bitrate - min:\" + e.minVideoBW + \" max:\" + e.maxVideoBW);\n        }\n\n        return (i = n.match(/m=audio.*\\r\\n/)) && e.maxAudioBW && (a = i[0] + \"b=AS:\" + e.maxAudioBW + \"\\r\\n\", n = n.replace(i[0], a)), n;\n      };\n\n      return t.processSignalingMessage = function (e) {\n        var n,\n            a = JSON.parse(e);\n        t.incomingMessage = a, \"new\" === t.state ? \"OFFER\" === a.messageType ? (n = {\n          sdp: a.sdp,\n          type: \"offer\"\n        }, t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)).catch(function (e) {}), t.state = \"offer-received\", t.markActionNeeded()) : t.error(\"Illegal message for this state: \" + a.messageType + \" in state \" + t.state) : \"offer-sent\" === t.state ? \"ANSWER\" === a.messageType ? ((n = {\n          sdp: a.sdp,\n          type: \"answer\"\n        }).sdp = i(n.sdp), n.sdp = o(n.sdp), t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)).catch(function (e) {}), t.state = \"established\") : \"pr-answer\" === a.messageType ? (n = {\n          sdp: a.sdp,\n          type: \"pr-answer\"\n        }, t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)).catch(function (e) {})) : \"offer\" === a.messageType ? t.error(\"Not written yet\") : t.error(\"Illegal message for this state: \" + a.messageType + \" in state \" + t.state) : \"established\" === t.state && (\"OFFER\" === a.messageType ? (n = {\n          sdp: a.sdp,\n          type: \"offer\"\n        }, t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)).catch(function (e) {}), t.state = \"offer-received\", t.markActionNeeded()) : \"ANSWER\" === a.messageType ? ((n = {\n          sdp: a.sdp,\n          type: \"answer\"\n        }).sdp = i(n.sdp), n.sdp = o(n.sdp), t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)).catch(function (e) {})) : t.error(\"Illegal message for this state: \" + a.messageType + \" in state \" + t.state));\n      }, t.getVideoRelatedStats = function (e) {\n        t.peerConnection.getStats(function (n) {\n          Object.keys(n).forEach(function (i) {\n            var a = n[i];\n            t.isSubscriber ? \"video\" === a.mediaType && a.id && ~a.id.indexOf(\"recv\") && e && e({\n              mediaType: \"video\",\n              peerId: t.uid,\n              isVideoMute: t.isVideoMute,\n              frameRateReceived: a.googFrameRateReceived,\n              frameRateDecoded: a.googFrameRateDecoded,\n              bytesReceived: a.bytesReceived,\n              packetsReceived: a.packetsReceived,\n              packetsLost: a.packetsLost\n            }) : \"video\" === a.mediaType && a.id && ~a.id.indexOf(\"send\") && e && e({\n              mediaType: \"video\",\n              isVideoMute: t.isVideoMute,\n              frameRateInput: a.googFrameRateInput,\n              frameRateSent: a.googFrameRateSent,\n              googRtt: a.googRtt\n            });\n          });\n        });\n      }, t.getAudioRelatedStats = function (e) {\n        t.peerConnection.getStats(function (n) {\n          Object.keys(n).forEach(function (i) {\n            var a = n[i];\n            t.isSubscriber && \"audio\" === a.mediaType && a.id && ~a.id.indexOf(\"recv\") && e && e({\n              mediaType: \"audio\",\n              peerId: t.uid,\n              isAudioMute: t.isAudioMute,\n              frameDropped: parseInt(a.googDecodingPLC) + parseInt(a.googDecodingPLCCNG) + \"\",\n              frameReceived: a.googDecodingCTN,\n              googJitterReceived: a.googJitterReceived,\n              bytesReceived: a.bytesReceived,\n              packetsReceived: a.packetsReceived,\n              packetsLost: a.packetsLost\n            });\n          });\n        });\n      }, t.getStatsRate = function (e) {\n        t.getStats(function (t) {\n          e(t);\n        });\n      }, t.getStats = function (e, n) {\n        n = (n = n || 500) > 500 ? 500 : n, t.lastTimeGetStats && Date.now() - t.lastTimeGetStats < n ? e && e(t.filterStatsCache, t.originStatsCache) : this._getStats(function (n, i) {\n          t.filterStatsCache = n, t.originStatsCache = i, t.lastTimeGetStats = Date.now(), e && e(n, i);\n        });\n      }, t._getStats = function (e) {\n        t.peerConnection.getStats(function (n) {\n          var i = [],\n              a = [],\n              r = null;\n          Object.keys(n).forEach(function (e) {\n            var t = n[e];\n            a.push(t), \"ssrc\" !== t.type && \"VideoBwe\" !== t.type || (r = t.timestamp, i.push(t));\n          }), i.push({\n            id: \"time\",\n            startTime: t.connectedTime,\n            timestamp: r || new Date()\n          }), e(i, a);\n        });\n      }, t.addTrack = function (e, n) {\n        t.peerConnection.addTrack(e, n);\n      }, t.removeTrack = function (e, n) {\n        t.peerConnection.removeTrack(t.peerConnection.getSenders().find(function (t) {\n          return t.track == e;\n        }));\n      }, t.addStream = function (e) {\n        t.peerConnection.addStream(e), t.markActionNeeded();\n      }, t.removeStream = function () {\n        t.markActionNeeded();\n      }, t.close = function () {\n        t.state = \"closed\", t.peerConnection.close();\n      }, t.markActionNeeded = function () {\n        t.actionNeeded = !0, t.doLater(function () {\n          t.onstablestate();\n        });\n      }, t.doLater = function (e) {\n        window.setTimeout(e, 1);\n      }, t.onstablestate = function () {\n        var e;\n\n        if (t.actionNeeded) {\n          if (\"new\" === t.state || \"established\" === t.state) t.peerConnection.createOffer(function (e) {\n            if (e.sdp !== t.prevOffer) return t.peerConnection.setLocalDescription(e), t.state = \"preparing-offer\", void t.markActionNeeded();\n            r.default.debug(\"[\" + t.clientId + \"]Not sending a new offer\");\n          }, function (e) {\n            r.default.debug(\"[\" + t.clientId + \"]peer connection create offer failed \", e);\n          }, t.mediaConstraints);else if (\"preparing-offer\" === t.state) {\n            if (t.moreIceComing) return;\n            t.prevOffer = t.peerConnection.localDescription.sdp, t.offerCandidates = t.prevOffer.match(/a=candidate.+\\r\\n/g) || [], t.offerCandidates.length || (r.default.warning(\"[\".concat(t.clientId, \"]No Ice Candidate generated\")), Object(a.getParameter)(\"SHIM_CANDIDATE\") ? (r.default.debug(\"Shimming fake candidate\"), t.prevOffer += \"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\\r\\n\") : r.default.error(\"[\".concat(t.clientId, \"]None Ice Candidate not allowed\"))), t.prevOffer = t.prevOffer.replace(/a=candidate:.+typ\\shost.+\\r\\n/g, \"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\\r\\n\"), t.sendMessage(\"OFFER\", t.prevOffer), t.state = \"offer-sent\";\n          } else if (\"offer-received\" === t.state) t.peerConnection.createAnswer(function (e) {\n            if (t.peerConnection.setLocalDescription(e), t.state = \"offer-received-preparing-answer\", t.iceStarted) t.markActionNeeded();else {\n              var n = new Date();\n              r.default.debug(\"[\" + t.clientId + \"]\" + n.getTime() + \": Starting ICE in responder\"), t.iceStarted = !0;\n            }\n          }, function (e) {\n            r.default.debug(\"[\" + t.clientId + \"]peer connection create answer failed \", e);\n          }, t.mediaConstraints);else if (\"offer-received-preparing-answer\" === t.state) {\n            if (t.moreIceComing) return;\n            e = t.peerConnection.localDescription.sdp, t.sendMessage(\"ANSWER\", e), t.state = \"established\";\n          } else t.error(\"Dazed and confused in state \" + t.state + \", stopping here\");\n          t.actionNeeded = !1;\n        }\n      }, t.sendMessage = function (e, n) {\n        var i = {};\n        i.messageType = e, i.sdp = n, \"OFFER\" === e ? (i.offererSessionId = t.sessionId, i.answererSessionId = t.otherSessionId, i.seq = t.sequenceNumber += 1, i.tiebreaker = Math.floor(429496723 * Math.random() + 1)) : (i.offererSessionId = t.incomingMessage.offererSessionId, i.answererSessionId = t.sessionId, i.seq = t.incomingMessage.seq), t.onsignalingmessage(JSON.stringify(i));\n      }, t._getSender = function (e) {\n        if (t.peerConnection && t.peerConnection.getSenders) {\n          var n = t.peerConnection.getSenders().find(function (t) {\n            return t.track.kind == e;\n          });\n          if (n) return n;\n        }\n\n        return null;\n      }, t.hasSender = function (e) {\n        return !!t._getSender(e);\n      }, t.replaceTrack = function (e, n, i) {\n        var a = t._getSender(e.kind);\n\n        if (!a) return i(\"NO_SENDER_FOUND\");\n\n        try {\n          a.replaceTrack(e);\n        } catch (e) {\n          return i && i(e);\n        }\n\n        setTimeout(function () {\n          return n && n();\n        }, 50);\n      }, t.error = function (e) {\n        throw \"Error in RoapOnJsep: \" + e;\n      }, t.sessionId = t.roapSessionId += 1, t.sequenceNumber = 0, t.actionNeeded = !1, t.iceStarted = !1, t.moreIceComing = !0, t.iceCandidateCount = 0, t.onsignalingmessage = e.callback, t.peerConnection.ontrack = function (e) {\n        t.onaddstream && (t.onaddstream(e, \"ontrack\"), t.peerConnection.onaddstream = null);\n      }, t.peerConnection.onaddstream = function (e) {\n        t.onaddstream && (t.onaddstream(e, \"onaddstream\"), t.peerConnection.ontrack = null);\n      }, t.peerConnection.onremovestream = function (e) {\n        t.onremovestream && t.onremovestream(e);\n      }, t.peerConnection.oniceconnectionstatechange = function (e) {\n        \"connected\" === e.currentTarget.iceConnectionState && (t.connectedTime = new Date()), t.oniceconnectionstatechange && t.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n      }, t.renegotiate = function () {\n        void 0 !== t.prevOffer && t.peerConnection.createOffer().then(function (e) {\n          return e.sdp = e.sdp.replace(/a=recvonly\\r\\n/g, \"a=inactive\\r\\n\"), e.sdp = i(e.sdp), e.sdp = o(e.sdp), t.peerConnection.setLocalDescription(e);\n        }).then(function () {\n          t.onnegotiationneeded && t.onnegotiationneeded(t.peerConnection.localDescription.sdp);\n        }).catch(function (e) {\n          console.log(\"createOffer error: \", e);\n        });\n      }, t.peerConnection.onnegotiationneeded = t.renegotiate, t.onaddstream = null, t.onremovestream = null, t.onnegotiationneeded = null, t.state = \"new\", t.markActionNeeded(), t;\n    },\n        j = function (e) {\n      var t = {},\n          n = h.RTCPeerConnection;\n      t.uid = e.uid, t.isVideoMute = e.isVideoMute, t.isAudioMute = e.isAudioMute, t.isSubscriber = e.isSubscriber, t.clientId = e.clientId, t.filterStatsCache = [], t.originStatsCache = [], t.lastTimeGetStats = null, t.pc_config = {\n        iceServers: [{\n          urls: [\"stun:webcs.agora.io:3478\", \"stun:stun.l.google.com:19302\"]\n        }],\n        bundlePolicy: \"max-bundle\"\n      }, t.con = {\n        optional: [{\n          DtlsSrtpKeyAgreement: !0\n        }]\n      }, e.iceServers instanceof Array ? t.pc_config.iceServers = e.iceServers : (e.stunServerUrl && (e.stunServerUrl instanceof Array ? e.stunServerUrl.map(function (e) {\n        \"string\" == typeof e && \"\" !== e && t.pc_config.iceServers.push({\n          url: e\n        });\n      }) : \"string\" == typeof e.stunServerUrl && \"\" !== e.stunServerUrl && t.pc_config.iceServers.push({\n        url: e.stunServerUrl\n      })), e.turnServer && (e.turnServer instanceof Array ? e.turnServer.map(function (e) {\n        \"string\" == typeof e.url && \"\" !== e.url && t.pc_config.iceServers.push({\n          username: e.username,\n          credential: e.credential,\n          url: e.url\n        });\n      }) : \"auto\" !== e.turnServer.mode && \"manual\" !== e.turnServer.mode || (e.turnServer.udpport && t.pc_config.iceServers.push({\n        username: e.turnServer.username,\n        credential: e.turnServer.credential,\n        credentialType: \"password\",\n        urls: [\"turn:\" + e.turnServer.url + \":\" + e.turnServer.udpport + \"?transport=udp\"]\n      }), \"string\" == typeof e.turnServer.tcpport && \"\" !== e.turnServer.tcpport && t.pc_config.iceServers.push({\n        username: e.turnServer.username,\n        credential: e.turnServer.credential,\n        credentialType: \"password\",\n        urls: [\"turn:\" + e.turnServer.url + \":\" + e.turnServer.tcpport + \"?transport=tcp\"]\n      }), !0 === e.turnServer.forceturn && (t.pc_config.iceTransportPolicy = \"relay\")))), void 0 === e.audio && (e.audio = !0), void 0 === e.video && (e.video = !0), t.mediaConstraints = {\n        mandatory: {\n          OfferToReceiveVideo: e.video,\n          OfferToReceiveAudio: e.audio\n        }\n      }, t.roapSessionId = 103;\n\n      try {\n        t.pc_config.sdpSemantics = \"plan-b\", t.peerConnection = new n(t.pc_config, t.con);\n      } catch (e) {\n        delete t.pc_config.sdpSemantics, t.peerConnection = new n(t.pc_config, t.con);\n      }\n\n      r.default.debug(\"[\" + t.clientId + ']safari Created RTCPeerConnnection with config \"' + JSON.stringify(t.pc_config) + '\".'), t.iceCandidateTimer = setTimeout(function () {\n        t.iceCandidateTimer = null, r.default.debug(\"[\".concat(t.clientId, \"]Candidates collected: \").concat(t.iceCandidateCount)), t.moreIceComing && (t.moreIceComing = !1, t.markActionNeeded());\n      }, Object(a.getParameter)(\"CANDIDATE_TIMEOUT\")), t.peerConnection.onicecandidate = function (e) {\n        var n, i, a, o;\n        i = (n = t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\\ssrflx.+\\r\\n/), a = n.match(/a=candidate:.+typ\\shost.+\\r\\n/), o = n.match(/a=candidate:.+typ\\srelay.+\\r\\n/), 0 === t.iceCandidateCount && (t.timeout = setTimeout(function () {\n          t.moreIceComing && (t.moreIceComing = !1, t.markActionNeeded());\n        }, 1e3)), null === i && null === a && null === o || void 0 !== t.ice || !t.iceCandidateTimer || (r.default.debug(\"[\" + t.clientId + \"]srflx candidate : \" + i + \" relay candidate: \" + o + \" host candidate : \" + a), clearTimeout(t.iceCandidateTimer), t.iceCandidateTimer = null, t.ice = 0, t.moreIceComing = !1, t.markActionNeeded()), t.iceCandidateCount = t.iceCandidateCount + 1;\n      };\n\n      var i = function (t) {\n        return e.screen && (t = t.replace(\"a=x-google-flag:conference\\r\\n\", \"\")), t;\n      },\n          o = function (n) {\n        var i, a;\n        return (i = n.match(/m=video.*\\r\\n/)) && e.minVideoBW && e.maxVideoBW && (a = i[0] + \"b=AS:\" + e.maxVideoBW + \"\\r\\n\", n = n.replace(i[0], a), r.default.debug(\"[\" + t.clientId + \"]Set Video Bitrate - min:\" + e.minVideoBW + \" max:\" + e.maxVideoBW)), (i = n.match(/m=audio.*\\r\\n/)) && e.maxAudioBW && (a = i[0] + \"b=AS:\" + e.maxAudioBW + \"\\r\\n\", n = n.replace(i[0], a)), n;\n      };\n\n      t.processSignalingMessage = function (e) {\n        var n,\n            a = JSON.parse(e);\n        t.incomingMessage = a, \"new\" === t.state ? \"OFFER\" === a.messageType ? (n = {\n          sdp: a.sdp,\n          type: \"offer\"\n        }, t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)), t.state = \"offer-received\", t.markActionNeeded()) : t.error(\"Illegal message for this state: \" + a.messageType + \" in state \" + t.state) : \"offer-sent\" === t.state ? \"ANSWER\" === a.messageType ? ((n = {\n          sdp: a.sdp,\n          type: \"answer\"\n        }).sdp = i(n.sdp), n.sdp = o(n.sdp), n.sdp = n.sdp.replace(/a=x-google-flag:conference\\r\\n/g, \"\"), t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)), t.state = \"established\") : \"pr-answer\" === a.messageType ? (n = {\n          sdp: a.sdp,\n          type: \"pr-answer\"\n        }, t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))) : \"offer\" === a.messageType ? t.error(\"Not written yet\") : t.error(\"Illegal message for this state: \" + a.messageType + \" in state \" + t.state) : \"established\" === t.state && (\"OFFER\" === a.messageType ? (n = {\n          sdp: a.sdp,\n          type: \"offer\"\n        }, t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)), t.state = \"offer-received\", t.markActionNeeded()) : \"ANSWER\" === a.messageType ? ((n = {\n          sdp: a.sdp,\n          type: \"answer\"\n        }).sdp = i(n.sdp), n.sdp = o(n.sdp), t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))) : t.error(\"Illegal message for this state: \" + a.messageType + \" in state \" + t.state));\n      };\n\n      var s = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        googCodecName: \"opus\",\n        aecDivergentFilterFraction: \"0\",\n        audioInputLevel: \"0\",\n        bytesSent: \"0\",\n        packetsSent: \"0\",\n        googEchoCancellationReturnLoss: \"0\",\n        googEchoCancellationReturnLossEnhancement: \"0\"\n      },\n          c = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        googCodecName: \"h264\" === e.codec ? \"H264\" : \"VP8\",\n        bytesSent: \"0\",\n        packetsLost: \"0\",\n        packetsSent: \"0\",\n        googAdaptationChanges: \"0\",\n        googAvgEncodeMs: \"0\",\n        googEncodeUsagePercent: \"0\",\n        googFirsReceived: \"0\",\n        googFrameHeightSent: \"0\",\n        googFrameHeightInput: \"0\",\n        googFrameRateInput: \"0\",\n        googFrameRateSent: \"0\",\n        googFrameWidthSent: \"0\",\n        googFrameWidthInput: \"0\",\n        googNacksReceived: \"0\",\n        googPlisReceived: \"0\",\n        googRtt: \"0\",\n        googFramesEncoded: \"0\"\n      },\n          d = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        audioOutputLevel: \"0\",\n        bytesReceived: \"0\",\n        packetsLost: \"0\",\n        packetsReceived: \"0\",\n        googAccelerateRate: \"0\",\n        googCurrentDelayMs: \"0\",\n        googDecodingCNG: \"0\",\n        googDecodingCTN: \"0\",\n        googDecodingCTSG: \"0\",\n        googDecodingNormal: \"0\",\n        googDecodingPLC: \"0\",\n        googDecodingPLCCNG: \"0\",\n        googExpandRate: \"0\",\n        googJitterBufferMs: \"0\",\n        googJitterReceived: \"0\",\n        googPreemptiveExpandRate: \"0\",\n        googPreferredJitterBufferMs: \"0\",\n        googSecondaryDecodedRate: \"0\",\n        googSpeechExpandRate: \"0\"\n      },\n          u = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        googTargetDelayMs: \"0\",\n        packetsLost: \"0\",\n        googDecodeMs: \"0\",\n        googMaxDecodeMs: \"0\",\n        googRenderDelayMs: \"0\",\n        googFrameWidthReceived: \"0\",\n        googFrameHeightReceived: \"0\",\n        googFrameRateReceived: \"0\",\n        googFrameRateDecoded: \"0\",\n        googFrameRateOutput: \"0\",\n        googFramesDecoded: \"0\",\n        googFrameReceived: \"0\",\n        googJitterBufferMs: \"0\",\n        googCurrentDelayMs: \"0\",\n        googMinPlayoutDelayMs: \"0\",\n        googNacksSent: \"0\",\n        googPlisSent: \"0\",\n        googFirsSent: \"0\",\n        bytesReceived: \"0\",\n        packetsReceived: \"0\"\n      },\n          l = {\n        id: \"bweforvideo\",\n        type: \"VideoBwe\",\n        googAvailableSendBandwidth: \"0\",\n        googAvailableReceiveBandwidth: \"0\",\n        googActualEncBitrate: \"0\",\n        googRetransmitBitrate: \"0\",\n        googTargetEncBitrate: \"0\",\n        googBucketDelay: \"0\",\n        googTransmitBitrate: \"0\"\n      },\n          p = 0,\n          f = 0,\n          m = 0;\n      return t.getVideoRelatedStats = function (n) {\n        t.peerConnection.getStats().then(function (i) {\n          var a = {\n            peerId: t.uid,\n            mediaType: \"video\",\n            isVideoMute: t.isVideoMute\n          };\n          i.forEach(function (i) {\n            if (t.isSubscriber) {\n              if (\"track\" === i.type && (~i.id.indexOf(\"video\") || ~i.trackIdentifier.indexOf(\"v\"))) {\n                if (!t.lastReport) return void (t.lastReport = i);\n                a.frameRateReceived = i.framesReceived - t.lastReport.framesReceived + \"\", a.frameRateDecoded = i.framesDecoded - t.lastReport.framesDecoded + \"\", t.lastReport = i;\n              }\n\n              \"inbound-rtp\" === i.type && ~i.id.indexOf(\"Video\") && (a.bytesReceived = i.bytesReceived + \"\", a.packetsReceived = i.packetsReceived + \"\", a.packetsLost = i.packetsLost + \"\");\n            } else if (\"outbound-rtp\" === i.type && ~i.id.indexOf(\"Video\")) {\n              if (!t.lastReport) return void (t.lastReport = i);\n              n && n({\n                mediaType: \"video\",\n                isVideoMute: t.isVideoMute,\n                frameRateInput: e.maxFrameRate + \"\",\n                frameRateSent: i.framesEncoded - t.lastReport.framesEncoded + \"\"\n              }), t.lastReport = i;\n            }\n          }), n && n(a);\n        });\n      }, t.getAudioRelatedStats = function (e) {\n        t.peerConnection.getStats().then(function (n) {\n          n.forEach(function (n) {\n            t.isSubscriber && \"inbound-rtp\" === n.type && ~n.id.indexOf(\"Audio\") && e && e({\n              peerId: t.uid,\n              mediaType: \"audio\",\n              isAudioMute: t.isAudioMute,\n              frameDropped: n.packetsLost + \"\",\n              frameReceived: n.packetsReceived + \"\",\n              googJitterReceived: n.jitter + \"\",\n              bytesReceived: n.bytesReceived + \"\",\n              packetsReceived: n.packetsReceived + \"\",\n              packetsLost: n.packetsLost + \"\"\n            });\n          });\n        });\n      }, t.getStatsRate = function (e) {\n        t.getStats(function (t) {\n          t.forEach(function (e) {\n            \"outbound-rtp\" === e.type && \"video\" === e.mediaType && e.googFramesEncoded && (e.googFrameRateSent = ((e.googFramesEncoded - p) / 3).toString(), p = e.googFramesEncoded), \"inbound-rtp\" === e.type && -1 != e.id.indexOf(\"55543\") && (e.googFrameRateReceived && (e.googFrameRateReceived = ((e.googFrameReceived - m) / 3).toString(), m = e.googFrameReceived), e.googFrameRateDecoded && (e.googFrameRateDecoded = ((e.googFramesDecoded - f) / 3).toString(), f = e.googFramesDecoded));\n          }), e(t);\n        });\n      }, t.getStats = function (e, n) {\n        n = (n = n || 500) > 500 ? 500 : n, t.lastTimeGetStats && Date.now() - t.lastTimeGetStats < n ? e && e(t.filterStatsCache, t.originStatsCache) : this._getStats(function (n, i) {\n          t.filterStatsCache = n, t.originStatsCache = i, t.lastTimeGetStats = Date.now(), e && e(n, i);\n        });\n      }, t._getStats = function (e) {\n        var n = [];\n        t.peerConnection.getStats().then(function (i) {\n          i.forEach(function (e) {\n            n.push(e), \"outbound-rtp\" === e.type && \"audio\" === e.mediaType && (s.id = e.id, s.type = e.type, s.mediaType = e.mediaType, s.bytesSent = e.bytesSent ? e.bytesSent + \"\" : \"0\", s.packetsSent = e.packetsSent ? e.packetsSent + \"\" : \"0\"), \"outbound-rtp\" === e.type && \"video\" === e.mediaType && (c.id = e.id, c.type = e.type, c.mediaType = e.mediaType, c.bytesSent = e.bytesSent ? e.bytesSent + \"\" : \"0\", c.packetsSent = e.packetsSent ? e.packetsSent + \"\" : \"0\", c.googPlisReceived = e.pliCount ? e.pliCount + \"\" : \"0\", c.googNacksReceived = e.nackCount ? e.nackCount + \"\" : \"0\", c.googFirsReceived = e.firCount ? e.firCount + \"\" : \"0\", c.googFramesEncoded = e.framesEncoded ? e.framesEncoded + \"\" : \"0\"), \"inbound-rtp\" === e.type && -1 != e.id.indexOf(\"44444\") && (d.id = e.id, d.type = e.type, d.mediaType = \"audio\", d.packetsReceived = e.packetsReceived ? e.packetsReceived + \"\" : \"0\", d.bytesReceived = e.bytesReceived ? e.bytesReceived + \"\" : \"0\", d.packetsLost = e.packetsLost ? e.packetsLost + \"\" : \"0\", d.packetsReceived = e.packetsReceived ? e.packetsReceived + \"\" : \"0\", d.googJitterReceived = e.jitter ? e.jitter + \"\" : \"0\"), \"inbound-rtp\" === e.type && -1 != e.id.indexOf(\"55543\") && (u.id = e.id, u.type = e.type, u.mediaType = \"video\", u.packetsReceived = e.packetsReceived ? e.packetsReceived + \"\" : \"0\", u.bytesReceived = e.bytesReceived ? e.bytesReceived + \"\" : \"0\", u.packetsLost = e.packetsLost ? e.packetsLost + \"\" : \"0\", u.googJitterBufferMs = e.jitter ? e.jitter + \"\" : \"0\", u.googNacksSent = e.nackCount ? e.nackCount + \"\" : \"0\", u.googPlisSent = e.pliCount ? e.pliCount + \"\" : \"0\", u.googFirsSent = e.firCount ? e.firCount + \"\" : \"0\"), \"track\" !== e.type || -1 == e.id.indexOf(\"55543\") && !~e.trackIdentifier.indexOf(\"v\") && null != e.audioLevel || (u.googFrameWidthReceived = e.frameWidth ? e.frameWidth + \"\" : \"0\", u.googFrameHeightReceived = e.frameHeight ? e.frameHeight + \"\" : \"0\", u.googFrameReceived = e.framesReceived ? e.framesReceived + \"\" : \"0\", u.googFramesDecoded = e.framesDecoded ? e.framesDecoded + \"\" : \"0\"), \"track\" !== e.type || -1 == e.id.indexOf(\"44444\") && !~e.trackIdentifier.indexOf(\"a\") && void 0 === e.audioLevel || (d.audioOutputLevel = e.audioLevel + \"\", s.audioInputLevel = e.audioLevel + \"\"), \"candidate-pair\" === e.type && (0 == e.availableIncomingBitrate ? l.googAvailableSendBandwidth = e.availableOutgoingBitrate + \"\" : l.googAvailableReceiveBandwidth = e.availableIncomingBitrate + \"\");\n          });\n          var a = [l, s, c, d, u];\n          a.push({\n            id: \"time\",\n            startTime: t.connectedTime,\n            timestamp: new Date()\n          }), e(a, n);\n        }).catch(function (e) {\n          console.error(e);\n        });\n      }, t.addTrack = function (e, n) {\n        t.peerConnection.addTrack(e, n);\n      }, t.removeTrack = function (e, n) {\n        var i = t.peerConnection.getSenders().find(function (t) {\n          return t.track == e;\n        });\n        i.replaceTrack(null), t.peerConnection.removeTrack(i);\n      }, t.addStream = function (e) {\n        window.navigator.userAgent.indexOf(\"Safari\") > -1 && -1 === navigator.userAgent.indexOf(\"Chrome\") ? e.getTracks().forEach(function (n) {\n          return t.peerConnection.addTrack(n, e);\n        }) : t.peerConnection.addStream(e), t.markActionNeeded();\n      }, t.removeStream = function () {\n        t.markActionNeeded();\n      }, t.close = function () {\n        t.state = \"closed\", t.peerConnection.close();\n      }, t.markActionNeeded = function () {\n        t.actionNeeded = !0, t.doLater(function () {\n          t.onstablestate();\n        });\n      }, t.doLater = function (e) {\n        window.setTimeout(e, 1);\n      }, t.onstablestate = function () {\n        var n;\n\n        if (t.actionNeeded) {\n          if (\"new\" === t.state || \"established\" === t.state) e.isSubscriber && (t.peerConnection.addTransceiver(\"audio\", {\n            direction: \"recvonly\"\n          }), t.peerConnection.addTransceiver(\"video\", {\n            direction: \"recvonly\"\n          })), t.peerConnection.createOffer(t.mediaConstraints).then(function (n) {\n            if (n.sdp = o(n.sdp), e.isSubscriber || (n.sdp = n.sdp.replace(/a=extmap:4 urn:3gpp:video-orientation\\r\\n/g, \"\")), n.sdp !== t.prevOffer) return t.peerConnection.setLocalDescription(n), t.state = \"preparing-offer\", void t.markActionNeeded();\n            r.default.debug(\"[\" + t.clientId + \"]Not sending a new offer\");\n          }).catch(function (e) {\n            r.default.debug(\"[\" + t.clientId + \"]peer connection create offer failed \", e);\n          });else if (\"preparing-offer\" === t.state) {\n            if (t.moreIceComing) return;\n            t.prevOffer = t.peerConnection.localDescription.sdp, t.offerCandidates = t.prevOffer.match(/a=candidate.+\\r\\n/g) || [], t.offerCandidates.length || (r.default.warning(\"[\".concat(t.clientId, \"]No Ice Candidate generated\")), Object(a.getParameter)(\"SHIM_CANDIDATE\") ? (r.default.debug(\"Shimming fake candidate\"), t.prevOffer += \"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\\r\\n\") : r.default.error(\"[\".concat(t.clientId, \"]None Ice Candidate not allowed\"))), t.prevOffer = t.prevOffer.replace(/a=candidate:.+typ\\shost.+\\r\\n/g, \"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\\r\\n\"), t.sendMessage(\"OFFER\", t.prevOffer), t.state = \"offer-sent\";\n          } else if (\"offer-received\" === t.state) t.peerConnection.createAnswer(function (e) {\n            if (t.peerConnection.setLocalDescription(e), t.state = \"offer-received-preparing-answer\", t.iceStarted) t.markActionNeeded();else {\n              var n = new Date();\n              r.default.debug(\"[\" + t.clientId + \"]\" + n.getTime() + \": Starting ICE in responder\"), t.iceStarted = !0;\n            }\n          }, function (e) {\n            r.default.debug(\"[\" + t.clientId + \"]peer connection create answer failed \", e);\n          }, t.mediaConstraints);else if (\"offer-received-preparing-answer\" === t.state) {\n            if (t.moreIceComing) return;\n            n = t.peerConnection.localDescription.sdp, t.sendMessage(\"ANSWER\", n), t.state = \"established\";\n          } else t.error(\"Dazed and confused in state \" + t.state + \", stopping here\");\n          t.actionNeeded = !1;\n        }\n      }, t.sendMessage = function (e, n) {\n        var i = {};\n        i.messageType = e, i.sdp = n, \"OFFER\" === e ? (i.offererSessionId = t.sessionId, i.answererSessionId = t.otherSessionId, i.seq = t.sequenceNumber += 1, i.tiebreaker = Math.floor(429496723 * Math.random() + 1)) : (i.offererSessionId = t.incomingMessage.offererSessionId, i.answererSessionId = t.sessionId, i.seq = t.incomingMessage.seq), t.onsignalingmessage(JSON.stringify(i));\n      }, t._getSender = function (e) {\n        if (t.peerConnection && t.peerConnection.getSenders) {\n          var n = t.peerConnection.getSenders().find(function (t) {\n            return t.track.kind == e;\n          });\n          if (n) return n;\n        }\n\n        return null;\n      }, t.hasSender = function (e) {\n        return !!t._getSender(e);\n      }, t.replaceTrack = function (e, n, i) {\n        var a = t._getSender(e.kind);\n\n        if (!a) return i(\"NO_SENDER_FOUND\");\n\n        try {\n          a.replaceTrack(e);\n        } catch (e) {\n          return i && i(e);\n        }\n\n        setTimeout(function () {\n          return n && n();\n        }, 50);\n      }, t.error = function (e) {\n        throw \"Error in RoapOnJsep: \" + e;\n      }, t.sessionId = t.roapSessionId += 1, t.sequenceNumber = 0, t.actionNeeded = !1, t.iceStarted = !1, t.moreIceComing = !0, t.iceCandidateCount = 0, t.onsignalingmessage = e.callback, t.peerConnection.ontrack = function (e) {\n        console.log(\"!!! ontrack, \", e.track.kind, e.track), t.onaddstream && t.onaddstream(e, \"ontrack\");\n      }, t.peerConnection.onremovestream = function (e) {\n        t.onremovestream && t.onremovestream(e);\n      }, t.peerConnection.oniceconnectionstatechange = function (e) {\n        \"connected\" === e.currentTarget.iceConnectionState && (t.connectedTime = new Date()), t.oniceconnectionstatechange && t.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n      }, t.renegotiate = function () {\n        void 0 !== t.prevOffer && t.peerConnection.createOffer().then(function (e) {\n          return e.sdp = e.sdp.replace(/a=recvonly\\r\\n/g, \"a=inactive\\r\\n\"), e.sdp = i(e.sdp), e.sdp = o(e.sdp), t.peerConnection.setLocalDescription(e);\n        }).then(function () {\n          t.onnegotiationneeded && t.onnegotiationneeded(t.peerConnection.localDescription.sdp);\n        }).catch(function (e) {\n          console.log(\"createOffer error: \", e);\n        });\n      }, t.peerConnection.onnegotiationneeded = t.renegotiate, t.onaddstream = null, t.onremovestream = null, t.state = \"new\", t.markActionNeeded(), t;\n    },\n        B = function (e) {\n      var t = {},\n          n = (mozRTCPeerConnection, mozRTCSessionDescription),\n          i = !1;\n      t.uid = e.uid, t.isVideoMute = e.isVideoMute, t.isAudioMute = e.isAudioMute, t.isSubscriber = e.isSubscriber, t.clientId = e.clientId, t.filterStatsCache = [], t.originStatsCache = [], t.lastTimeGetStats = null, t.pc_config = {\n        iceServers: []\n      }, e.iceServers instanceof Array ? e.iceServers.map(function (e) {\n        0 === e.url.indexOf(\"stun:\") && t.pc_config.iceServers.push({\n          url: e.url\n        });\n      }) : (e.stunServerUrl && (e.stunServerUrl instanceof Array ? e.stunServerUrl.map(function (e) {\n        \"string\" == typeof e && \"\" !== e && t.pc_config.iceServers.push({\n          url: e\n        });\n      }) : \"string\" == typeof e.stunServerUrl && \"\" !== e.stunServerUrl && t.pc_config.iceServers.push({\n        url: e.stunServerUrl\n      })), e.turnServer && \"string\" == typeof e.turnServer.url && \"\" !== e.turnServer.url && (e.turnServer.udpport && t.pc_config.iceServers.push({\n        username: e.turnServer.username,\n        credential: e.turnServer.credential,\n        credentialType: \"password\",\n        urls: \"turn:\" + e.turnServer.url + \":\" + e.turnServer.udpport + \"?transport=udp\"\n      }), \"string\" == typeof e.turnServer.tcpport && \"\" !== e.turnServer.tcpport && t.pc_config.iceServers.push({\n        username: e.turnServer.username,\n        credential: e.turnServer.credential,\n        credentialType: \"password\",\n        urls: \"turn:\" + e.turnServer.url + \":\" + e.turnServer.tcpport + \"?transport=tcp\"\n      }), !0 === e.turnServer.forceturn && (t.pc_config.iceTransportPolicy = \"relay\"))), void 0 === e.audio && (e.audio = !0), void 0 === e.video && (e.video = !0), t.mediaConstraints = {\n        offerToReceiveAudio: e.audio,\n        offerToReceiveVideo: e.video,\n        mozDontOfferDataChannel: !0\n      }, t.roapSessionId = 103, t.peerConnection = new h.RTCPeerConnection(t.pc_config), r.default.debug(\"[\" + t.clientId + ']safari Created RTCPeerConnnection with config \"' + JSON.stringify(t.pc_config) + '\".'), t.iceCandidateTimer = setTimeout(function () {\n        t.iceCandidateTimer = null, r.default.debug(\"[\".concat(t.clientId, \"]Candidates collected: \").concat(t.iceCandidateCount)), t.moreIceComing && (t.moreIceComing = !1, t.markActionNeeded());\n      }, Object(a.getParameter)(\"CANDIDATE_TIMEOUT\")), t.peerConnection.onicecandidate = function (e) {\n        var n, i, a, o;\n        i = (n = t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\\ssrflx.+\\r\\n/), a = n.match(/a=candidate:.+typ\\shost.+\\r\\n/), o = n.match(/a=candidate:.+typ\\srelay.+\\r\\n/), null === i && null === a && null === o || void 0 !== t.ice || !t.iceCandidateTimer || (r.default.debug(\"[\" + t.clientId + \"]srflx candidate : \" + i + \" relay candidate: \" + o + \" host candidate : \" + a), clearTimeout(t.iceCandidateTimer), t.iceCandidateTimer = null, t.ice = 0, t.moreIceComing = !1, t.markActionNeeded()), t.iceCandidateCount = t.iceCandidateCount + 1;\n      }, t.checkMLineReverseInSDP = function (e) {\n        return !(!~e.indexOf(\"m=audio\") || !~e.indexOf(\"m=video\")) && e.indexOf(\"m=audio\") > e.indexOf(\"m=video\");\n      }, t.reverseMLineInSDP = function (e) {\n        var t = e.split(\"m=audio\"),\n            n = t[1].split(\"m=video\"),\n            i = \"m=video\" + n[1],\n            a = \"m=audio\" + n[0];\n        return e = t[0] + i + a;\n      }, t.processSignalingMessage = function (e) {\n        var i,\n            a = JSON.parse(e);\n        t.incomingMessage = a, \"new\" === t.state ? \"OFFER\" === a.messageType ? (a.sdp = l(a.sdp), i = {\n          sdp: a.sdp,\n          type: \"offer\"\n        }, t.peerConnection.setRemoteDescription(new n(i), function () {\n          r.default.debug(\"[\" + t.clientId + \"]setRemoteDescription succeeded\");\n        }, function (e) {\n          r.default.info(\"[\" + t.clientId + \"]setRemoteDescription failed: \" + e.name);\n        }), t.state = \"offer-received\", t.markActionNeeded()) : t.error(\"Illegal message for this state: \" + a.messageType + \" in state \" + t.state) : \"offer-sent\" === t.state ? \"ANSWER\" === a.messageType ? (a.sdp = l(a.sdp), a.sdp = a.sdp.replace(/ generation 0/g, \"\"), a.sdp = a.sdp.replace(/ udp /g, \" UDP \"), -1 !== a.sdp.indexOf(\"a=group:BUNDLE\") ? (a.sdp = a.sdp.replace(/a=group:BUNDLE audio video/, \"a=group:BUNDLE sdparta_0 sdparta_1\"), a.sdp = a.sdp.replace(/a=mid:audio/, \"a=mid:sdparta_0\"), a.sdp = a.sdp.replace(/a=mid:video/, \"a=mid:sdparta_1\")) : (a.sdp = a.sdp.replace(/a=mid:audio/, \"a=mid:sdparta_0\"), a.sdp = a.sdp.replace(/a=mid:video/, \"a=mid:sdparta_0\")), i = {\n          sdp: a.sdp,\n          type: \"answer\"\n        }, t.peerConnection.setRemoteDescription(new n(i), function () {\n          r.default.debug(\"[\" + t.clientId + \"]setRemoteDescription succeeded\");\n        }, function (e) {\n          r.default.info(\"[\" + t.clientId + \"]setRemoteDescription failed: \" + e);\n        }), t.state = \"established\") : \"pr-answer\" === a.messageType ? (i = {\n          sdp: a.sdp,\n          type: \"pr-answer\"\n        }, t.peerConnection.setRemoteDescription(new n(i), function () {\n          r.default.debug(\"[\" + t.clientId + \"]setRemoteDescription succeeded\");\n        }, function (e) {\n          r.default.info(\"[\" + t.clientId + \"]setRemoteDescription failed: \" + e.name);\n        })) : \"offer\" === a.messageType ? t.error(\"Not written yet\") : t.error(\"Illegal message for this state: \" + a.messageType + \" in state \" + t.state) : \"established\" === t.state && (\"OFFER\" === a.messageType ? (i = {\n          sdp: a.sdp,\n          type: \"offer\"\n        }, t.peerConnection.setRemoteDescription(new n(i), function () {\n          r.default.debug(\"[\" + t.clientId + \"]setRemoteDescription succeeded\");\n        }, function (e) {\n          r.default.info(\"[\" + t.clientId + \"]setRemoteDescription failed: \" + e.name);\n        }), t.state = \"offer-received\", t.markActionNeeded()) : t.error(\"Illegal message for this state: \" + a.messageType + \" in state \" + t.state));\n      };\n      var o = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"opus\",\n        googCodecName: \"opus\",\n        aecDivergentFilterFraction: \"0\",\n        audioInputLevel: \"0\",\n        bytesSent: \"0\",\n        packetsSent: \"0\",\n        googEchoCancellationReturnLoss: \"0\",\n        googEchoCancellationReturnLossEnhancement: \"0\"\n      },\n          s = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        googCodecName: \"h264\" === e.codec ? \"H264\" : \"VP8\",\n        bytesSent: \"0\",\n        packetsLost: \"0\",\n        packetsSent: \"0\",\n        googAdaptationChanges: \"0\",\n        googAvgEncodeMs: \"0\",\n        googEncodeUsagePercent: \"0\",\n        googFirsReceived: \"0\",\n        googFrameHeightSent: \"0\",\n        googFrameHeightInput: \"0\",\n        googFrameRateInput: \"0\",\n        googFrameRateSent: \"0\",\n        googFrameWidthSent: \"0\",\n        googFrameWidthInput: \"0\",\n        googNacksReceived: \"0\",\n        googPlisReceived: \"0\",\n        googRtt: \"0\"\n      },\n          c = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        audioOutputLevel: \"0\",\n        bytesReceived: \"0\",\n        packetsLost: \"0\",\n        packetsReceived: \"0\",\n        googAccelerateRate: \"0\",\n        googCurrentDelayMs: \"0\",\n        googDecodingCNG: \"0\",\n        googDecodingCTN: \"0\",\n        googDecodingCTSG: \"0\",\n        googDecodingNormal: \"0\",\n        googDecodingPLC: \"0\",\n        googDecodingPLCCNG: \"0\",\n        googExpandRate: \"0\",\n        googJitterBufferMs: \"0\",\n        googJitterReceived: \"0\",\n        googPreemptiveExpandRate: \"0\",\n        googPreferredJitterBufferMs: \"0\",\n        googSecondaryDecodedRate: \"0\",\n        googSpeechExpandRate: \"0\"\n      },\n          d = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        googTargetDelayMs: \"0\",\n        packetsLost: \"0\",\n        googDecodeMs: \"0\",\n        googMaxDecodeMs: \"0\",\n        googRenderDelayMs: \"0\",\n        googFrameWidthReceived: \"0\",\n        googFrameHeightReceived: \"0\",\n        googFrameRateReceived: \"0\",\n        googFrameRateDecoded: \"0\",\n        googFrameRateOutput: \"0\",\n        googJitterBufferMs: \"0\",\n        googCurrentDelayMs: \"0\",\n        googMinPlayoutDelayMs: \"0\",\n        googNacksSent: \"0\",\n        googPlisSent: \"0\",\n        googFirsSent: \"0\",\n        bytesReceived: \"0\",\n        packetsReceived: \"0\",\n        googFramesDecoded: \"0\"\n      },\n          u = 0;\n      t.getVideoRelatedStats = function (e) {\n        t.peerConnection.getStats().then(function (n) {\n          var i = !0,\n              a = !1,\n              r = void 0;\n\n          try {\n            for (var o, s = n.values()[Symbol.iterator](); !(i = (o = s.next()).done); i = !0) {\n              var c = o.value;\n\n              if (t.isSubscriber) {\n                if ((\"inbound-rtp\" === c.type || \"inboundrtp\" === c.type) && \"video\" === c.mediaType) {\n                  if (!t.lastReport) return void (t.lastReport = c);\n                  e && e({\n                    browser: \"firefox\",\n                    mediaType: \"video\",\n                    peerId: t.uid,\n                    isVideoMute: t.isVideoMute,\n                    frameRateReceived: c.framerateMean + \"\",\n                    frameRateDecoded: c.framesDecoded - t.lastReport.framesDecoded + \"\",\n                    bytesReceived: c.bytesReceived + \"\",\n                    packetsReceived: c.packetsReceived + \"\",\n                    packetsLost: c.packetsLost + \"\"\n                  }), t.lastReport = c;\n                }\n              } else if ((\"outbound-rtp\" === c.type || \"outboundrtp\" === c.type) && \"video\" === c.mediaType) {\n                if (!t.lastReport) return void (t.lastReport = c);\n                e && e({\n                  mediaType: \"video\",\n                  isVideoMute: t.isVideoMute,\n                  frameRateInput: c.framerateMean + \"\",\n                  frameRateSent: c.framesEncoded - t.lastReport.framesEncoded + \"\"\n                }), t.lastReport = c;\n              }\n            }\n          } catch (e) {\n            a = !0, r = e;\n          } finally {\n            try {\n              i || null == s.return || s.return();\n            } finally {\n              if (a) throw r;\n            }\n          }\n        });\n      }, t.getAudioRelatedStats = function (e) {\n        t.peerConnection.getStats().then(function (n) {\n          var i = !0,\n              a = !1,\n              r = void 0;\n\n          try {\n            for (var o, s = n.values()[Symbol.iterator](); !(i = (o = s.next()).done); i = !0) {\n              var c = o.value;\n              t.isSubscriber && (\"inbound-rtp\" !== c.type && \"inboundrtp\" !== c.type || \"audio\" !== c.mediaType || e && e({\n                browser: \"firefox\",\n                mediaType: \"audio\",\n                peerId: t.uid,\n                isAudioMute: t.isAudioMute,\n                frameDropped: c.packetsLost + \"\",\n                frameReceived: c.packetsReceived + \"\",\n                googJitterReceived: c.jitter + \"\",\n                bytesReceived: c.bytesReceived + \"\",\n                packetsReceived: c.packetsReceived + \"\",\n                packetsLost: c.packetsLost + \"\"\n              }));\n            }\n          } catch (e) {\n            a = !0, r = e;\n          } finally {\n            try {\n              i || null == s.return || s.return();\n            } finally {\n              if (a) throw r;\n            }\n          }\n        });\n      }, t.getStatsRate = function (e) {\n        t.getStats(function (t) {\n          t.forEach(function (e) {\n            \"inbound-rtp\" !== e.type && \"inboundrtp\" !== e.type || \"video\" !== e.mediaType || e.googFrameRateDecoded && (e.googFrameRateDecoded = ((e.googFramesDecoded - u) / 3).toString(), u = e.googFramesDecoded);\n          }), e(t);\n        });\n      }, t.getStats = function (e, n) {\n        n = (n = n || 500) > 500 ? 500 : n, t.lastTimeGetStats && Date.now() - t.lastTimeGetStats < n ? e && e(t.filterStatsCache, t.originStatsCache) : this._getStats(function (n, i) {\n          t.filterStatsCache = n, t.originStatsCache = i, t.lastTimeGetStats = Date.now(), e && e(n, i);\n        });\n      }, t._getStats = function (e) {\n        t.peerConnection.getStats().then(function (n) {\n          var i = [],\n              a = !0,\n              r = !1,\n              u = void 0;\n\n          try {\n            for (var l, p = n.values()[Symbol.iterator](); !(a = (l = p.next()).done); a = !0) {\n              var f = l.value;\n              i.push(f), \"outbound-rtp\" !== f.type && \"outboundrtp\" !== f.type || \"video\" !== f.mediaType || -1 !== f.id.indexOf(\"rtcp\") || (s.id = f.id, s.type = f.type, s.mediaType = f.mediaType, s.bytesSent = f.bytesSent ? f.bytesSent + \"\" : \"0\", s.packetsSent = f.packetsSent ? f.packetsSent + \"\" : \"0\", s.googPlisReceived = f.pliCount ? f.pliCount + \"\" : \"0\", s.googNacksReceived = f.nackCount ? f.nackCount + \"\" : \"0\", s.googFirsReceived = f.firCount ? f.firCount + \"\" : \"0\", s.googFrameRateSent = f.framerateMean ? f.framerateMean + \"\" : \"0\"), \"outbound-rtp\" !== f.type && \"outboundrtp\" !== f.type || \"audio\" !== f.mediaType || -1 !== f.id.indexOf(\"rtcp\") || (o.id = f.id, o.type = f.type, o.mediaType = f.mediaType, o.bytesSent = f.bytesSent ? f.bytesSent + \"\" : \"0\", o.packetsSent = f.packetsSent ? f.packetsSent + \"\" : \"0\"), \"inbound-rtp\" !== f.type && \"inboundrtp\" !== f.type || \"audio\" !== f.mediaType || f.isRemote || -1 !== f.id.indexOf(\"rtcp\") || (c.id = f.id, c.type = f.type, c.mediaType = f.mediaType, c.bytesReceived = f.bytesReceived ? f.bytesReceived + \"\" : \"0\", c.packetsLost = f.packetsLost ? f.packetsLost + \"\" : \"0\", c.packetsReceived = f.packetsReceived ? f.packetsReceived + \"\" : \"0\", c.googJitterReceived = f.jitter ? f.jitter + \"\" : \"0\"), \"inbound-rtp\" !== f.type && \"inboundrtp\" !== f.type || \"video\" !== f.mediaType || f.isRemote || -1 !== f.id.indexOf(\"rtcp\") || (d.id = f.id, d.type = f.type, d.mediaType = f.mediaType, d.bytesReceived = f.bytesReceived ? f.bytesReceived + \"\" : \"0\", d.googFrameRateReceived = f.framerateMean ? f.framerateMean + \"\" : \"0\", d.googFramesDecoded = f.framesDecoded ? f.framesDecoded + \"\" : \"0\", d.packetsLost = f.packetsLost ? f.packetsLost + \"\" : \"0\", d.packetsReceived = f.packetsReceived ? f.packetsReceived + \"\" : \"0\", d.googJitterBufferMs = f.jitter ? f.jitter + \"\" : \"0\", d.googNacksSent = f.nackCount ? f.nackCount + \"\" : \"0\", d.googPlisSent = f.pliCount ? f.pliCount + \"\" : \"0\", d.googFirsSent = f.firCount ? f.firCount + \"\" : \"0\"), -1 !== f.id.indexOf(\"outbound_rtcp_video\") && (s.packetsLost = f.packetsLost ? f.packetsLost + \"\" : \"0\");\n            }\n          } catch (e) {\n            r = !0, u = e;\n          } finally {\n            try {\n              a || null == p.return || p.return();\n            } finally {\n              if (r) throw u;\n            }\n          }\n\n          var m = [s, o, c, d];\n          m.push({\n            id: \"time\",\n            startTime: t.connectedTime,\n            timestamp: new Date()\n          }), e(m, i);\n        }, function (e) {\n          r.default.error(\"[\" + t.clientId + \"]\" + e);\n        });\n      }, t.addStream = function (e) {\n        i = !0, t.peerConnection.addStream(e), t.markActionNeeded();\n      }, t.removeStream = function () {\n        t.markActionNeeded();\n      }, t.close = function () {\n        t.state = \"closed\", t.peerConnection.close();\n      }, t.markActionNeeded = function () {\n        t.actionNeeded = !0, t.doLater(function () {\n          t.onstablestate();\n        });\n      }, t.doLater = function (e) {\n        window.setTimeout(e, 1);\n      }, t.onstablestate = function () {\n        if (t.actionNeeded) {\n          if (\"new\" === t.state || \"established\" === t.state) i && (t.mediaConstraints = void 0), t.peerConnection.createOffer(function (e) {\n            if (e.sdp = l(e.sdp), e.sdp = e.sdp.replace(/a=extmap:1 http:\\/\\/www.webrtc.org\\/experiments\\/rtp-hdrext\\/abs-send-time/, \"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\"), e.sdp !== t.prevOffer) return t.peerConnection.setLocalDescription(e), t.state = \"preparing-offer\", void t.markActionNeeded();\n            r.default.debug(\"[\" + t.clientId + \"]Not sending a new offer\");\n          }, function (e) {\n            r.default.debug(\"[\" + t.clientId + \"]Ups! create offer failed \", e);\n          }, t.mediaConstraints);else if (\"preparing-offer\" === t.state) {\n            if (t.moreIceComing) return;\n            t.prevOffer = t.peerConnection.localDescription.sdp, t.offerCandidates = t.prevOffer.match(/a=candidate.+\\r\\n/g) || [], t.offerCandidates.length || (r.default.warning(\"[\".concat(t.clientId, \"]No Ice Candidate generated\")), Object(a.getParameter)(\"SHIM_CANDIDATE\") ? (r.default.debug(\"Shimming fake candidate\"), t.prevOffer += \"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\\r\\n\") : r.default.error(\"[\".concat(t.clientId, \"]None Ice Candidate not allowed\"))), t.prevOffer = t.prevOffer.replace(/a=candidate:.+typ\\shost.+\\r\\n/g, \"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\\r\\n\"), t.sendMessage(\"OFFER\", t.prevOffer), t.state = \"offer-sent\";\n          } else if (\"offer-received\" === t.state) t.peerConnection.createAnswer(function (e) {\n            if (t.peerConnection.setLocalDescription(e), t.state = \"offer-received-preparing-answer\", t.iceStarted) t.markActionNeeded();else {\n              var n = new Date();\n              r.default.debug(\"[\" + t.clientId + \"]\" + n.getTime() + \": Starting ICE in responder\"), t.iceStarted = !0;\n            }\n          }, function () {\n            r.default.debug(\"[\" + t.clientId + \"]Ups! Something went wrong\");\n          });else if (\"offer-received-preparing-answer\" === t.state) {\n            if (t.moreIceComing) return;\n            var e = t.peerConnection.localDescription.sdp;\n            t.sendMessage(\"ANSWER\", e), t.state = \"established\";\n          } else t.error(\"Dazed and confused in state \" + t.state + \", stopping here\");\n          t.actionNeeded = !1;\n        }\n      }, t.sendMessage = function (e, n) {\n        var i = {};\n        i.messageType = e, i.sdp = n, \"OFFER\" === e ? (i.offererSessionId = t.sessionId, i.answererSessionId = t.otherSessionId, i.seq = t.sequenceNumber += 1, i.tiebreaker = Math.floor(429496723 * Math.random() + 1)) : (i.offererSessionId = t.incomingMessage.offererSessionId, i.answererSessionId = t.sessionId, i.seq = t.incomingMessage.seq), t.onsignalingmessage(JSON.stringify(i));\n      }, t._getSender = function (e) {\n        if (t.peerConnection && t.peerConnection.getSenders) {\n          var n = t.peerConnection.getSenders().find(function (t) {\n            return t.track.kind == e;\n          });\n          if (n) return n;\n        }\n\n        return null;\n      }, t.hasSender = function (e) {\n        return !!t._getSender(e);\n      }, t.replaceTrack = function (e, n, i) {\n        var a = t._getSender(e.kind);\n\n        if (!a) return i(\"NO_SENDER_FOUND\");\n\n        try {\n          a.replaceTrack(e);\n        } catch (e) {\n          return i && i(e);\n        }\n\n        setTimeout(function () {\n          return n && n();\n        }, 50);\n      }, t.error = function (e) {\n        throw \"Error in RoapOnJsep: \" + e;\n      }, t.sessionId = t.roapSessionId += 1, t.sequenceNumber = 0, t.actionNeeded = !1, t.iceStarted = !1, t.moreIceComing = !0, t.iceCandidateCount = 0, t.onsignalingmessage = e.callback, t.peerConnection.ontrack = function (e) {\n        t.onaddstream && t.onaddstream(e, \"ontrack\");\n      }, t.peerConnection.onremovestream = function (e) {\n        t.onremovestream && t.onremovestream(e);\n      }, t.peerConnection.oniceconnectionstatechange = function (e) {\n        \"connected\" === e.currentTarget.iceConnectionState && (t.connectedTime = new Date()), t.oniceconnectionstatechange && t.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n      };\n\n      var l = function (t) {\n        var n;\n\n        if (e.video && e.maxVideoBW && (null == (n = t.match(/m=video.*\\r\\n/)) && (n = t.match(/m=video.*\\n/)), n && n.length > 0)) {\n          var i = n[0] + \"b=TIAS:\" + 1e3 * e.maxVideoBW + \"\\r\\n\";\n          t = t.replace(n[0], i);\n        }\n\n        return e.audio && e.maxAudioBW && (null == (n = t.match(/m=audio.*\\r\\n/)) && (n = t.match(/m=audio.*\\n/)), n && n.length > 0) && (i = n[0] + \"b=TIAS:\" + 1e3 * e.maxAudioBW + \"\\r\\n\", t = t.replace(n[0], i)), t;\n      };\n\n      return t.onaddstream = null, t.onremovestream = null, t.state = \"new\", t.markActionNeeded(), t;\n    },\n        W = n(14),\n        H = n.n(W),\n        G = null,\n        q = function () {\n      try {\n        G = window.require(\"electron\");\n      } catch (e) {}\n\n      return G;\n    },\n        J = function (e) {\n      var t = o.b.reportApiInvoke(null, {\n        callback: e,\n        name: \"getScreenSources\",\n        options: arguments,\n        tag: \"tracer\"\n      }),\n          n = q();\n      if (!n) return t && t(\"electron is null\");\n      n.desktopCapturer.getSources({\n        types: [\"window\", \"screen\"]\n      }, function (e, n) {\n        if (e) return t && t(e);\n        t && t(null, n);\n      });\n    },\n        Y = function (e, t, n) {\n      var i = t.width;\n      t = {\n        audio: !1,\n        video: {\n          mandatory: {\n            chromeMediaSource: \"desktop\",\n            chromeMediaSourceId: e,\n            maxHeight: t.height,\n            maxWidth: i,\n            maxFrameRate: t.frameRate && t.frameRate.max,\n            minFrameRate: t.frameRate && t.frameRate.min\n          }\n        }\n      };\n      navigator.webkitGetUserMedia(t, function (e) {\n        n && n(null, e);\n      }, function (e) {\n        n && n(e);\n      });\n    },\n        z = function () {\n      return !!q();\n    },\n        K = J,\n        X = Y,\n        Q = function (e, t) {\n      J(function (n, i) {\n        if (n) return t && t(n);\n        !function (e, t) {\n          var n = document.createElement(\"div\");\n          n.innerText = \"share screen\", n.setAttribute(\"style\", \"text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;\");\n          var i = document.createElement(\"div\");\n          i.setAttribute(\"style\", \"width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;\");\n          var a = document.createElement(\"div\");\n          a.innerText = \"Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.\", a.setAttribute(\"style\", \"height: 12%;\");\n          var r = document.createElement(\"div\");\n          r.setAttribute(\"style\", \"width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;\");\n          var o = document.createElement(\"div\");\n          o.setAttribute(\"style\", \"text-align: right; padding: 16px 0;\");\n          var s = document.createElement(\"button\");\n          s.innerHTML = \"cancel\", s.setAttribute(\"style\", \"width: 85px;\"), s.onclick = function () {\n            document.body.removeChild(c), t && t(\"NotAllowedError\");\n          }, o.appendChild(s), i.appendChild(a), i.appendChild(r), i.appendChild(o);\n          var c = document.createElement(\"div\");\n          c.setAttribute(\"style\", \"position: absolute; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);\"), c.appendChild(n), c.appendChild(i), document.body.appendChild(c), e.map(function (e) {\n            if (e.id) {\n              var n = document.createElement(\"div\");\n              n.setAttribute(\"style\", \"width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;\"), n.innerHTML = '<div style=\"height: 120px; display: table-cell; vertical-align: middle;\"><img style=\"width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);\" src=' + e.thumbnail.toDataURL() + ' /></div><span style=\"\\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\">' + e.name + \"</span>\", n.onclick = function () {\n                document.body.removeChild(c), t && t(null, e.id);\n              }, r.appendChild(n);\n            }\n          });\n        }(i, function (n, i) {\n          if (n) return t && t(n);\n          Y(i, e, t);\n        });\n      });\n    },\n        $ = 103,\n        Z = function (e) {\n      var t = {};\n      if (t.clientId = e.clientId, e.session_id = $ += 1, \"undefined\" == typeof window || !window.navigator) throw r.default.error(\"[\" + t.streamId + \"][\" + t.clientId + \"]Publish/subscribe video/audio streams not supported yet\"), new Error(\"NON_BROWSER_ENV_DETECTED\");\n      return null !== window.navigator.userAgent.match(\"Firefox\") ? (t.browser = \"mozilla\", t = B(e)) : \"iOS\" === f.getBrowserOS() || f.isSafari() ? (r.default.debug(\"[\" + t.streamId + \"][\" + t.clientId + \"]Safari\"), (t = j(e)).browser = \"safari\") : ~window.navigator.userAgent.indexOf(\"Edge\") ? t = new H.a(e) : (t = F(e)).browser = \"chrome-stable\", t;\n    },\n        ee = function (e, t, n) {\n      var i = {};\n      i.config = e, i.streamId = e.streamId, delete e.streamId, navigator.getMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n\n      var a = 0,\n          o = 1,\n          s = !1,\n          c = null,\n          d = function (e) {\n        if (a++, c) {\n          if (c === e) r.default.debug(\"Using Video Source/ Audio Source\");else {\n            var n = c.getVideoTracks()[0],\n                i = c.getAudioTracks()[0],\n                d = e.getVideoTracks()[0],\n                u = e.getAudioTracks()[0];\n            d && (n && c.removeTrack(n), c.addTrack(d)), u && (i && c.removeTrack(i), c.addTrack(u));\n          }\n        } else c = e;\n        a !== o || s || (s = !0, setTimeout(function () {\n          t(c);\n        }, 0));\n      },\n          u = function (e) {\n        r.default.error(\"Failed to GetUserMedia\", e.name, e.code, e.message, e), a++, s || (s = !0, setTimeout(function () {\n          n && n(e);\n        }, 0));\n      },\n          l = function () {\n        var t = {\n          video: e.video,\n          audio: e.audio\n        };\n        if (r.default.debug(\"GetUserMedia\", JSON.stringify(t)), navigator.mediaDevices && navigator.mediaDevices.getUserMedia) navigator.mediaDevices.getUserMedia(t).then(d).catch(u);else if (\"undefined\" != typeof navigator && navigator.getMedia) navigator.getMedia(e, d, u);else {\n          var a = {\n            name: \"MEDIA_NOT_SUPPORT\",\n            message: \"Video/audio streams not supported yet\"\n          };\n          r.default.error(\"[\" + i.streamId + \"]\" + a.message), n && n(a);\n        }\n      };\n\n      if ((e.videoSource || e.audioSource) && (c = new MediaStream(), e.videoSource && c.addTrack(e.videoSource), e.audioSource && c.addTrack(e.audioSource)), e.video || e.audio || e.screen) {\n        if (e.screen) {\n          if (z()) return e.screen.sourceId ? X(e.screen.sourceId, e.screen, function (e, t) {\n            e ? u(e) : d(t);\n          }) : Q(e.screen, function (e, t) {\n            e ? u(e) : d(t);\n          });\n\n          if (f.isFireFox()) {\n            r.default.debug(\"[\" + i.streamId + \"]Screen access requested\");\n            if (!~[\"screen\", \"window\", \"application\"].indexOf(e.screen.mediaSource)) return n && n({\n              code: \"Invalid mediaSource, mediaSource should be one of [screen, window, application]\"\n            });\n            navigator.getMedia({\n              video: e.screen\n            }, function (t) {\n              e.audio && (o++, l()), d(t);\n            }, u);\n          } else if (f.isChrome() && e.screen.extensionId) {\n            if (window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./)[1] < 34) return void n({\n              code: \"This browser does not support screen sharing\"\n            });\n            r.default.debug(\"[\" + i.streamId + \"]Screen access on chrome stable, looking for extension\");\n\n            try {\n              chrome.runtime.sendMessage(e.screen.extensionId, {\n                getStream: !0\n              }, function (t) {\n                if (void 0 === t) {\n                  r.default.error(\"[\" + i.streamId + \"]No response from Chrome Plugin. Plugin not installed properly\");\n                  u({\n                    name: \"PluginNotInstalledProperly\",\n                    message: \"No response from Chrome Plugin. Plugin not installed properly.\"\n                  });\n                } else e.screen.mandatory.chromeMediaSourceId = t.streamId, navigator.getMedia({\n                  video: e.screen\n                }, function (t) {\n                  e.audio && (o++, l()), d(t);\n                }, u);\n              });\n            } catch (e) {\n              r.default.debug(\"[\" + i.streamId + \"]AgoraRTC screensharing plugin is not accessible\");\n              return void n({\n                code: \"no_plugin_present\"\n              });\n            }\n          } else {\n            if (window.navigator.mediaDevices.getDisplayMedia) {\n              var p = {};\n              return \"number\" == typeof e.screen.width && \"number\" == typeof e.screen.height ? p.video = {\n                width: {\n                  ideal: e.screen.width\n                },\n                height: {\n                  ideal: e.screen.height\n                }\n              } : p.video = {\n                width: e.screen.width,\n                height: e.screen.height\n              }, e.screen.frameRate && e.screen.frameRate.min ? p.video.frameRate = {\n                ideal: e.screen.frameRate.max,\n                max: e.screen.frameRate.max\n              } : p.video.frameRate = e.screen.frameRate, r.default.debug(\"use getDisplayMedia, constraints:\", p), window.navigator.mediaDevices.getDisplayMedia(p).then(function (t) {\n                e.audio && (o++, l()), d(t);\n              }).catch(u);\n            }\n\n            r.default.error(\"[\" + i.streamId + \"]This browser does not support screenSharing\"), n({\n              code: \"This browser does not support screen sharing\"\n            });\n          }\n        } else l();\n      } else d(c);\n    },\n        te = n(8),\n        ne = function (e, t, n) {\n      if ([\"End2EndDelay\", \"TransportDelay\", \"PacketLossRate\", \"RecvLevel\", \"RecvBitrate\", \"CodecType\", \"MuteState\", \"TotalFreezeTime\", \"TotalPlayDuration\", \"RecordingLevel\", \"SendLevel\", \"SamplingRate\", \"SendBitrate\", \"CodecType\", \"MuteState\", \"End2EndDelay\", \"TransportDelay\", \"PacketLossRate\", \"RecvBitrate\", \"RecvResolutionWidth\", \"RecvResolutionHeight\", \"RenderResolutionHeight\", \"RenderResolutionWidth\", \"RenderFrameRate\", \"TotalFreezeTime\", \"TotalPlayDuration\", \"TargetSendBitrate\", \"SendFrameRate\", \"SendFrameRate\", \"SendBitrate\", \"SendResolutionWidth\", \"SendResolutionHeight\", \"CaptureResolutionHeight\", \"CaptureResolutionWidth\", \"EncodeDelay\", \"MuteState\", \"TotalFreezeTime\", \"TotalDuration\", \"CaptureFrameRate\", \"RTT\", \"OutgoingAvailableBandwidth\", \"Duration\", \"UserCount\", \"SendBytes\", \"RecvBytes\", \"SendBitrate\", \"RecvBitrate\", \"accessDelay\", \"audioSendBytes\", \"audioSendPackets\", \"videoSendBytes\", \"videoSendPackets\", \"videoSendPacketsLost\", \"videoSendFrameRate\", \"audioSendPacketsLost\", \"videoSendResolutionWidth\", \"videoSendResolutionHeight\", \"accessDelay\", \"audioReceiveBytes\", \"audioReceivePackets\", \"audioReceivePacketsLost\", \"videoReceiveBytes\", \"videoReceivePackets\", \"videoReceivePacketsLost\", \"videoReceiveFrameRate\", \"videoReceiveDecodeFrameRate\", \"videoReceiveResolutionWidth\", \"videoReceiveResolutionHeight\", \"endToEndDelay\", \"videoReceiveDelay\", \"audioReceiveDelay\", \"FirstFrameTime\", \"VideoFreezeRate\", \"AudioFreezeRate\", \"RenderResolutionWidth\", \"RenderResolutionHeight\"].indexOf(t) > -1 && (\"string\" == typeof n || isFinite(n))) return e[t] = \"\" + n;\n    },\n        ie = new function () {\n      var e = s();\n      return e.devicesHistory = {}, e.states = {\n        UNINIT: \"UNINIT\",\n        INITING: \"INITING\",\n        INITED: \"INITED\"\n      }, e.state = e.states.UNINIT, e.deviceStates = {\n        ACTIVE: \"ACTIVE\",\n        INACTIVE: \"INACTIVE\"\n      }, e.deviceReloadTimer = null, e._init = function (t, n) {\n        e.state = e.states.INITING, e.devicesHistory = {}, e._reloadDevicesInfo(function () {\n          e.state = e.states.INITED, e.dispatchEvent({\n            type: \"inited\"\n          }), t && t();\n        }, function (t) {\n          r.default.warning(\"Device Detection functionality cannot start properly.\"), e.state = e.states.UNINIT, n && n(t);\n        });\n      }, e._enumerateDevices = function (e, t) {\n        if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) return r.default.warning(\"enumerateDevices() not supported.\"), t && t(\"enumerateDevices() not supported\");\n        navigator.mediaDevices.enumerateDevices().then(function (t) {\n          e && setTimeout(function () {\n            e(t);\n          }, 0);\n        }).catch(function (e) {\n          t && t(e);\n        });\n      }, e._reloadDevicesInfo = function (t, n) {\n        var i = [];\n\n        e._enumerateDevices(function (n) {\n          var a = Date.now();\n\n          for (var o in n.forEach(function (t) {\n            var n = e.devicesHistory[t.deviceId];\n\n            if ((n ? n.state : e.deviceStates.INACTIVE) != e.deviceStates.ACTIVE) {\n              var r = n || {\n                initAt: a\n              };\n              r.device = t, r.state = e.deviceStates.ACTIVE, i.push(r), e.devicesHistory[t.deviceId] = r;\n            }\n\n            e.devicesHistory[t.deviceId].lastReloadAt = a;\n          }), e.devicesHistory) {\n            var s = e.devicesHistory[o];\n            s && s.state == e.deviceStates.ACTIVE && s.lastReloadAt !== a && (s.state = e.deviceStates.INACTIVE, i.push(s)), s.lastReloadAt = a;\n          }\n\n          e.state == e.states.INITED && i.forEach(function (t) {\n            var n = S()({}, t);\n\n            switch (t.device.kind) {\n              case \"audioinput\":\n                n.type = \"recordingDeviceChanged\";\n                break;\n\n              case \"audiooutput\":\n                n.type = \"playoutDeviceChanged\";\n                break;\n\n              case \"videoinput\":\n                n.type = \"cameraChanged\";\n                break;\n\n              default:\n                r.default.warning(\"Unknown device change\", n), n.type = \"unknownDeviceChanged\";\n            }\n\n            e.dispatchEvent(n);\n          }), t && t();\n        }, n);\n      }, e.getDeviceById = function (t, n, i) {\n        e.getDevices(function (e) {\n          for (var a = 0; a < e.length; a++) {\n            var r = e[a];\n            if (r && r.deviceId === t) return n && n(r);\n          }\n\n          return i && i();\n        });\n      }, e.searchDeviceNameById = function (t) {\n        var n = e.devicesHistory[t];\n        return n ? n.device.label || n.device.deviceId : null;\n      }, e.getDevices = function (t, n) {\n        e._enumerateDevices(t, function (e) {\n          n && n(e.name + \": \" + e.message);\n        });\n      }, e.getVideoCameraIdByLabel = function (t, n, i) {\n        e.getCameras(function (e) {\n          var a = !0,\n              r = !1,\n              o = void 0;\n\n          try {\n            for (var s, c = e[Symbol.iterator](); !(a = (s = c.next()).done); a = !0) {\n              var d = s.value;\n              if (d.label === t) return n && n(d.deviceId);\n            }\n          } catch (e) {\n            r = !0, o = e;\n          } finally {\n            try {\n              a || null == c.return || c.return();\n            } finally {\n              if (r) throw o;\n            }\n          }\n\n          return i && i(x.NOT_FIND_DEVICE_BY_LABEL);\n        }, i);\n      }, e.getRecordingDevices = function (t, n) {\n        return e._enumerateDevices(function (e) {\n          var n = e.filter(function (e) {\n            return \"audioinput\" == e.kind;\n          });\n          t && t(n);\n        }, function (e) {\n          n && n(e);\n        });\n      }, e.getPlayoutDevices = function (t, n) {\n        return e._enumerateDevices(function (e) {\n          var n = e.filter(function (e) {\n            return \"audiooutput\" == e.kind;\n          });\n          t && t(n);\n        }, function (e) {\n          n && n(e);\n        });\n      }, e.getCameras = function (t, n) {\n        return e._enumerateDevices(function (e) {\n          var n = e.filter(function (e) {\n            return \"videoinput\" == e.kind;\n          });\n          t && t(n);\n        }, function (e) {\n          n && n(e);\n        });\n      }, e._init(function () {\n        navigator.mediaDevices && navigator.mediaDevices.addEventListener && navigator.mediaDevices.addEventListener(\"devicechange\", function () {\n          e._reloadDevicesInfo();\n        }), e.deviceReloadTimer = setInterval(e._reloadDevicesInfo, 5e3);\n      }), e;\n    }(),\n        ae = n(6),\n        re = n.n(ae),\n        oe = function (e, t, n) {\n      for (var i = 0; i < n.length; i++) if (e === n[i]) return !0;\n\n      throw new Error(\"\".concat(t, \" can only be set as \").concat(JSON.stringify(n)));\n    },\n        se = function (e, t) {\n      if (!e) throw new Error(\"Invalid param: \".concat(t || \"param\", \" cannot be empty\"));\n      if (\"object\" !== re()(e)) throw new Error(\"\".concat(t || \"This paramter\", \" is of the object type\"));\n      return !0;\n    },\n        ce = function (e, t, n, i, a) {\n      if (_e(n) && (n = 1), i = i || 255, _e(a) && (a = !0), _e(e)) throw new Error(\"\".concat(t || \"param\", \" cannot be empty\"));\n      if (!le(e, n, i, a)) throw new Error(\"Invalid \".concat(t || \"string param\", \": Length of the string: [\").concat(n, \",\").concat(i, \"].\").concat(a ? \" ASCII characters only.\" : \"\"));\n    },\n        de = function (e, t, n, i) {\n      if (_e(n) && (n = 1), i = i || 1e4, _e(e)) throw new Error(\"\".concat(t || \"param\", \" cannot be empty\"));\n      if (!pe(e, n, i)) throw new Error(\"Invalid \".concat(t || \"number param\", \": The value range is [\").concat(n, \",\").concat(i, \"]. integer only\"));\n    },\n        ue = function (e, t) {\n      if (_e(e)) throw new Error(\"\".concat(t || \"param\", \" cannot be empty\"));\n      if (!fe(e)) throw new Error(\"Invalid \".concat(t || \"boolean param\", \": The value is of the boolean type.\"));\n    },\n        le = function (e, t, n, i) {\n      return t || (t = 0), n || (n = Number.MAX_SAFE_INTEGER), _e(i) && (i = !0), Ie(e) && (!i || ge(e)) && e.length >= t && e.length <= n;\n    },\n        pe = function (e, t, n) {\n      return ve(e) && e >= t && e <= n;\n    },\n        fe = function (e) {\n      return \"boolean\" == typeof e;\n    },\n        me = function (e) {\n      return le(e, 1, 2047);\n    },\n        ge = function (e) {\n      if (\"string\" == typeof e) {\n        for (var t = 0; t < e.length; t++) {\n          var n = e.charCodeAt(t);\n          if (n < 0 || n > 255) return !1;\n        }\n\n        return !0;\n      }\n    },\n        ve = function (e) {\n      return \"number\" == typeof e && e % 1 == 0;\n    },\n        Se = function (e) {\n      return \"number\" == typeof e;\n    },\n        Ie = function (e) {\n      return \"string\" == typeof e;\n    },\n        he = function (e) {\n      return e instanceof Array;\n    },\n        _e = function (e) {\n      return null == e;\n    },\n        ye = n(13);\n\n    var Ee = function (e) {\n      ce(e, \"profileName\"), -1 === (e = e.toLowerCase()).indexOf(\"_\") && (e += \"_1\"), oe(e, \"profileName\", Object.keys(a.SUPPORT_RESOLUTION_LIST));\n      var t = a.SUPPORT_RESOLUTION_LIST[e];\n      t || (e = Object(a.getParameter)(\"DEFAULT_PROFILE\"), t = a.SUPPORT_RESOLUTION_LIST[e]);\n      var n = {\n        profileName: e,\n        video: {\n          width: t[0],\n          height: t[1]\n        },\n        attributes: {\n          resolution: \"\".concat(t[0], \"x\").concat(t[1]),\n          minFrameRate: t[2],\n          maxFrameRate: t[3],\n          minVideoBW: t[4],\n          maxVideoBW: t[5]\n        }\n      };\n      return t[2] && t[3] && (n.video.frameRate = {\n        ideal: t[2],\n        max: t[3]\n      }), t[6] && t[7] && (n.screen = {\n        width: t[0],\n        height: t[1],\n        frameRate: {\n          min: t[6],\n          max: t[7]\n        }\n      }), n;\n    },\n        be = function (e) {\n      return Object.keys(a.SUPPORT_RESOLUTION_LIST).filter(function (t) {\n        var n = a.SUPPORT_RESOLUTION_LIST[t],\n            i = [\"width\", \"height\", \"frameRate\"];\n\n        for (var r in i) {\n          var o = i[r];\n\n          if (e[o] && n[r]) {\n            if (\"number\" == typeof e[o].max && e[o].max < n[r]) return !1;\n            if (\"number\" == typeof e[o].min && e[o].min > n[r]) return !1;\n          }\n        }\n\n        return !0;\n      }).reverse();\n    },\n        Te = function (e) {\n      var t = a.AUDIO_PROFILE_SETTINGS[e] || a.AUDIO_PROFILE_SETTINGS.default;\n      return {\n        highQuality: t[0],\n        stereo: t[1],\n        speech: t[2],\n        lowQuality: t[3]\n      };\n    };\n\n    var Re = function (e) {\n      var t = s();\n      if (t.params = S()({}, e), t.stream = e.stream, t.url = e.url, t.onClose = void 0, t.local = !1, t.videoSource = e.videoSource, t.audioSource = e.audioSource, e.video = !(!e.videoSource && !e.video), t.video = e.video, e.audio = !(!e.audioSource && !e.audio), t.audio = e.audio, t.screen = !!e.screen, t.screenAttributes = {\n        width: 1920,\n        height: 1080,\n        maxFr: 5,\n        minFr: 1\n      }, t.videoSize = e.videoSize, t.player = void 0, t.audioLevelHelper = null, e.attributes = e.attributes || {}, t.attributes = e.attributes, t.microphoneId = e.microphoneId, t.cameraId = e.cameraId, t.facingMode = e.facingMode, t.inSwitchDevice = !1, t.userMuteVideo = !1, t.userMuteAudio = !1, t.peerMuteVideo = !1, t.peerMuteAudio = !1, t.lowStream = null, t.videoWidth = 0, t.videoHeight = 0, t.streamId = e.streamID, t.userId = null, t.mirror = !1 !== e.mirror, t.DTX = e.audioProcessing && e.audioProcessing.DTX, t.audioProcessing = e.audioProcessing, t.highQuality = !1, t.stereo = !1, t.speech = !1, t.screen || delete t.screen, !(void 0 === t.videoSize || t.videoSize instanceof Array && 4 === t.videoSize.length)) throw Error(\"Invalid Video Size\");\n\n      function n() {\n        var e = {};\n        t.getVideoTrack() === this ? (r.default.debug(\"Video Track Ended\"), e.type = \"videoTrackEnded\", e.track = this) : t.getAudioTrack() === this ? (r.default.debug(\"Audio Track Ended\"), e.type = \"audioTrackEnded\", e.track = this) : r.default.debug(\"Detached Track ended\", this.kind, this.label, this), e.type && t.dispatchEvent(e);\n      }\n\n      return t.videoSize = [640, 480, 640, 480], void 0 !== e.local && !0 !== e.local || (t.local = !0), t.initialized = !t.local, t._streamInitID = null, function (e) {\n        e.audioMixing = {\n          audioContextInited: !1,\n          defaultVolume: 100,\n          inEarMonitoring: \"FILE\",\n          sounds: {},\n          states: {\n            IDLE: \"IDLE\",\n            STARTING: \"STARTING\",\n            BUSY: \"BUSY\",\n            PAUSED: \"PAUSED\"\n          },\n          inEarMonitoringModes: {\n            NONE: \"NONE\",\n            FILE: \"FILE\",\n            MICROPHONE: \"MOCROPHONE\",\n            ALL: \"ALL\"\n          },\n          ctx: null,\n          mediaStreamSource: null,\n          mediaStreamDest: null,\n          buffer: {}\n        }, e._initSoundIfNotExists = function (t, n) {\n          e.audioMixing.sounds[t] || (e.audioMixing.sounds[t] = {\n            soundId: t,\n            state: \"IDLE\",\n            muted: e.userMuteAudio,\n            filePath: n,\n            volume: e.audioMixing.defaultVolume,\n            startAt: null,\n            startOffset: null,\n            pauseAt: null,\n            pauseOffset: null,\n            resumeAt: null,\n            resumeOffset: null,\n            stopAt: null,\n            options: null,\n            source: null\n          });\n        }, e._initSoundIfNotExists(-1), e.loadAudioBuffer = function (t, n, i) {\n          var a = o.b.reportApiInvoke(e.sid, {\n            callback: i,\n            name: \"Stream.loadAudioBuffer\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n          ce(n, \"url\", 1, 1024, !1), ce(t, \"id\", 1, 1024, !1);\n\n          var s = function (t) {\n            r.default.error(\"[\".concat(e.streamId, \"] loadAudioBuffer Failed: \") + t), a(x.LOAD_AUDIO_FAILED);\n          },\n              c = new XMLHttpRequest();\n\n          c.open(\"GET\", n, !0), c.responseType = \"arraybuffer\", c.onload = function () {\n            if (c.status > 400) s(\"\".concat(c.status, \" \").concat(c.statusText));else {\n              var n = c.response;\n              e.audioMixing.audioContextInited || e._initAudioContext(), e.audioMixing.ctx.decodeAudioData(n, function (n) {\n                e.audioMixing.buffer[t] = n, a(null);\n              }, function (t) {\n                r.default.error(\"[\".concat(e.streamId, \"] decodeAudioData Failed: \"), t), a(t);\n              });\n            }\n          }, c.onerror = function () {\n            return s(\"load error\");\n          }, c.ontimeout = function () {\n            return s(\"timeout\");\n          }, c.send();\n        }, e.createAudioBufferSource = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.createAudioBufferSource\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n\n          if (e.audioMixing.buffer[t.id]) {\n            var i = e.audioMixing.buffer[t.id],\n                a = e.audioMixing.ctx.createBufferSource();\n            a.buffer = i;\n            var s = e.audioMixing.ctx.createGain();\n            if (a.connect(s), s.connect(e.audioMixing.mediaStreamDest), a.gainNode = s, t.loop) a.loop = !0, a.start(0, t.playTime / 1e3);else if (t.cycle > 1) {\n              if (Object(f.isChrome)()) {\n                a.loop = !0;\n                var c = t.cycle * i.duration * 1e3 - (t.playTime || 0);\n                a.start(0, t.playTime / 1e3, c / 1e3);\n              } else r.default.warning(\"[\".concat(e.streamId, \"] Cycle Param is ignored by current browser\")), a.start(0, t.playTime / 1e3);\n            } else a.start(0, t.playTime / 1e3);\n            var d = e.audioMixing.sounds[t.soundId];\n            return d.source = a, e._flushAudioMixingMuteStatus(), a.addEventListener(\"ended\", function () {\n              a === d.source && e.dispatchEvent({\n                type: \"audioSourceEnded\",\n                soundId: t.soundId,\n                source: a,\n                sound: d\n              });\n            }), n(), a;\n          }\n\n          return r.default.error(\"[\".concat(e.streamId, \"] \"), \"AUDIOBUFFER_NOT_FOUND\", t.id), n(!1), !1;\n        }, e.on(\"audioSourceEnded\", function (t) {\n          var n = t.source,\n              i = t.sound;\n          i && i.state === e.audioMixing.states.BUSY && !i.pauseAt && (i.state = e.audioMixing.states.IDLE, i.startAt = null, i.startOffset = null, i.resumeAt = null, i.resumeOffset = null, n.gainNode && n.gainNode.disconnect && n.gainNode.disconnect(), n.buffer = null, e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest));\n        }), e.clearAudioBufferSource = function () {\n          e.audioBufferSource.forEach(function (e) {\n            e.stop();\n          });\n        }, e._isSoundExists = function (t) {\n          return !!e.audioMixing.sounds[t.soundId] || (r.default.error(\"SoundId not exists. #\".concat(t.soundId)), !1);\n        }, e._initAudioContext = function () {\n          if (e.audioMixing.audioContextInited) throw new Error(\"Failed to init audio context. Already inited\");\n          if (!e.stream) throw new Error(\"Failed to init audio context. Local Stream not initialized\");\n          e.audioMixing.ctx = Object(ye.a)(), e.audioMixing.mediaStreamSource = e.audioMixing.ctx.createMediaStreamSource(e.stream), e.audioMixing.mediaStreamDest = e.audioMixing.ctx.createMediaStreamDestination(), e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest);\n          var t = e.stream.getVideoTracks()[0];\n\n          if (t && e.audioMixing.mediaStreamDest.stream.addTrack(t), e._isAudioMuted() ? (e._unmuteAudio(), e.stream = e.audioMixing.mediaStreamDest.stream, e._muteAudio()) : e.stream = e.audioMixing.mediaStreamDest.stream, e.audioLevelHelper = null, e.pc && e.pc.peerConnection && e.pc.peerConnection) {\n            var n = (e.pc.peerConnection && e.pc.peerConnection.getSenders()).find(function (e) {\n              return e && e.track && \"audio\" == e.track.kind;\n            }),\n                i = e.audioMixing.mediaStreamDest.stream.getAudioTracks()[0];\n            n && n.replaceTrack && i && n.replaceTrack(i);\n          }\n\n          e.audioMixing.audioContextInited = !0;\n        }, e._cleanupAudioMixing = function () {\n          if (e.audioMixing.audioContextInited) {\n            for (var t in e.audioMixing.sounds) {\n              var n = e.audioMixing.sounds[t];\n              n.state !== e.audioMixing.states.BUSY && n.state !== e.audioMixing.states.PAUSED || e._stopOneEffect({\n                soundId: t\n              });\n            }\n\n            e.audioLevelHelper = null, e.audioMixing.audioContextInited = !1;\n          }\n        }, e._reloadInEarMonitoringMode = function (t) {\n          if (t) {\n            if (!e.audioMixing.inEarMonitoringModes[t]) return r.default.error(\"[\".concat(e.streamId, \"] Invalid InEarMonitoringMode \").concat(t));\n            e.audioMixing.inEarMonitoring = t;\n          }\n\n          switch (e.audioMixing.audioContextInited || e._initAudioContext(), e.audioMixing.inEarMonitoring) {\n            case e.audioMixing.inEarMonitoringModes.FILE:\n              e.audioMixing.mediaStreamSource.connectedToDestination && (e.audioMixing.mediaStreamSource.disconnect(e.audioMixing.ctx.destination), e.audioMixing.mediaStreamSource.connectedToDestination = !1);\n\n            case e.audioMixing.inEarMonitoringModes.ALL:\n              for (var n in e.audioMixing.sounds) {\n                var i = e.audioMixing.sounds[n];\n                i && i.source && !i.source.connectedToDestination && (i.source.gainNode.connect(e.audioMixing.ctx.destination), i.source.connectedToDestination = !0);\n              }\n\n          }\n\n          switch (e.audioMixing.inEarMonitoring) {\n            case e.audioMixing.inEarMonitoringModes.MICROPHONE:\n              e.audioMixing.source.forEach(function (t) {\n                t.connectedToDestination && (t.gainNode.disconnect(e.audioMixing.ctx.destination), t.connectedToDestination = !1);\n              });\n\n            case e.audioMixing.inEarMonitoringModes.ALL:\n              e.audioMixing.mediaStreamSource.connectedToDestination || (e.audioMixing.mediaStreamSource.connect(e.audioMixing.ctx.destination), e.audioMixing.mediaStreamSource.connectedToDestination = !0);\n          }\n        }, e._startAudioMixingBufferSource = function (t) {\n          e.audioMixing.audioContextInited || e._initAudioContext();\n          var n = {\n            soundId: t.soundId,\n            id: t.filePath,\n            loop: t.loop,\n            cycle: t.cycle,\n            playTime: t.playTime || 0\n          },\n              i = t.replace,\n              a = e.createAudioBufferSource(n);\n          return a.sound = e.audioMixing.sounds[t.soundId], a ? (a.addEventListener(\"ended\", e._audioMixingFinishedListener, {\n            once: !0\n          }), e._reloadInEarMonitoringMode(), i && e.audioMixing.mediaStreamSource.disconnect(e.audioMixing.mediaStreamDest), a) : null;\n        }, e._stopAudioMixingBufferSource = function (t) {\n          var n = e.audioMixing.sounds[t.soundId].source;\n          return n ? (n.removeEventListener(\"ended\", e._audioMixingFinishedListener), e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest), n.stop(), n.gainNode && n.gainNode.disconnect && n.gainNode.disconnect(), n.buffer = null, n) : null;\n        }, e._flushAudioMixingMuteStatus = function (t) {\n          for (var n in e.audioMixing.sounds) {\n            var i = e.audioMixing.sounds[n];\n            i && (void 0 !== t && (i.muted = !!t), i.source && (i.muted ? i.source.gainNode.gain.value = 0 : i.source.gainNode.gain.value = i.volume / 100));\n          }\n        }, e._handleAudioMixingInvalidStateError = function (t, n, i) {\n          var a = e.audioMixing.sounds[n.soundId],\n              o = -1 === n.soundId ? \"INVALID_AUDIO_MIXING_STATE\" : \"INVALID_PLAY_EFFECT_STATE\";\n          r.default.error(\"[\".concat(e.streamId, \"] Cannot \").concat(t, \": \").concat(o, \", state is \").concat(a.state)), i && i(o);\n        }, e._handleAudioMixingNoSourceError = function (t, n, i) {\n          e.audioMixing.sounds[n.soundId].state = e.audioMixing.states.IDLE;\n          var a = -1 === n.soundId ? \"NO_AUDIO_MIXING_SOURCE\" : \"NO_EFFECT_SOURCE\";\n          r.default.error(\"[\".concat(e.streamId, \"] Cannot \").concat(t, \": \").concat(a)), i && i(a);\n        }, e._getOneEffectStates = function (t) {\n          var n = e.audioMixing.sounds[t.soundId];\n          return function () {\n            return n ? {\n              state: n.state,\n              startAt: n.startAt,\n              resumeAt: n.resumeAt,\n              pauseOffset: n.pauseOffset,\n              pauseAt: n.pauseAt,\n              resumeOffset: n.resumeOffset,\n              stopAt: n.stopAt,\n              duration: e._getOneEffectDuration(t),\n              position: e._getOneEffectCurrentPosition(t)\n            } : {};\n          };\n        }, e._audioMixingFinishedListener = function () {\n          var t = this.sound;\n          t.state === e.audioMixing.states.IDLE && e.audioMixing.buffer[t.options.filePath] && !t.options.cacheResource && (r.default.debug(\"Recycled buffer \".concat(t.options.filePath)), delete e.audioMixing.buffer[t.options.filePath]), -1 === t.soundId && e.dispatchEvent({\n            type: \"audioMixingFinished\"\n          });\n        }, e._playOneEffect = function (t, n) {\n          se(t, \"options\");\n          var i = t.soundId,\n              a = (t.filePath, t.cacheResource);\n\n          if (t.cycle, t.loop, t.playTime, t.replace, Object(f.isSafari)() && Object(f.getBrowserVersion)() < 12) {\n            var o = \"BROWSER_NOT_SUPPORT\";\n            return r.default.error(\"[\".concat(e.streamId, \"] Cannot _playOneEffect: \"), o), n(o);\n          }\n\n          e.audioMixing.audioContextInited || e._initAudioContext(), e._initSoundIfNotExists(i);\n          var s = e.audioMixing.sounds[i];\n\n          if (s.state === e.audioMixing.states.IDLE) {\n            if (void 0 !== t.cycle && !t.cycle > 0) return o = \"Invalid Parmeter cycle: \" + t.cycle, r.default.error(\"[\".concat(e.streamId, \"] \").concat(i), o), n(o);\n\n            if (_e(a) && (t.cacheResource = !0), s.state = e.audioMixing.states.STARTING, s.options = t, e.audioMixing.buffer[t.filePath]) {\n              var c = e._startAudioMixingBufferSource(t);\n\n              if (c) return s.source = c, s.startAt = Date.now(), s.resumeAt = null, s.pauseOffset = null, s.pauseAt = null, s.resumeOffset = null, s.stopAt = null, s.startOffset = t.playTime || 0, s.state = e.audioMixing.states.BUSY, e._flushAudioMixingMuteStatus(), n(null);\n              s.state = e.audioMixing.states.IDLE;\n              var d = \"CREATE_BUFFERSOURCE_FAILED\";\n              if (n) return n(d);\n              r.default.error(\"[\".concat(e.streamId, \"] \"), d);\n            } else e.loadAudioBuffer(t.filePath, t.filePath, function (i) {\n              if (i) s.state = e.audioMixing.states.IDLE, n ? n(i) : r.default.error(\"[\".concat(e.streamId, \"] \"), i);else {\n                var a = e._startAudioMixingBufferSource(t);\n\n                if (a) return s.source = a, s.startAt = Date.now(), s.resumeAt = null, s.pauseOffset = null, s.pauseAt = null, s.resumeOffset = null, s.stopAt = null, s.startOffset = t.playTime || 0, s.state = e.audioMixing.states.BUSY, e._flushAudioMixingMuteStatus(), n(null);\n                if (s.state = e.audioMixing.states.IDLE, i = \"CREATE_BUFFERSOURCE_FAILED\", n) return n(i);\n                r.default.error(\"[\".concat(e.streamId, \"] \"), i);\n              }\n            });\n          } else e._handleAudioMixingInvalidStateError(\"_playEffect\", t, n);\n        }, e._stopOneEffect = function (t, n) {\n          var i = e.audioMixing.sounds[t.soundId];\n          return e._isSoundExists(t) ? i.state === e.audioMixing.states.BUSY || i.state === e.audioMixing.states.PAUSED ? (e._stopAudioMixingBufferSource(t), i.stopAt = Date.now(), i.state = e.audioMixing.states.IDLE, e.audioMixing.buffer[i.options.filePath] && !i.options.cacheResource && (r.default.debug(\"Recycled buffer \".concat(i.options.filePath)), delete e.audioMixing.buffer[i.options.filePath]), void (n && n(null))) : void e._handleAudioMixingInvalidStateError(\"_stopOneEffect\", t, n) : n(\"SOUND_NOT_EXISTS\");\n        }, e._pauseOneEffect = function (t, n) {\n          var i = e.audioMixing.sounds[t.soundId];\n          if (i.state === e.audioMixing.states.BUSY) return e._stopAudioMixingBufferSource(t) ? (i.pauseAt = Date.now(), i.state = e.audioMixing.states.PAUSED, i.resumeAt ? i.pauseOffset = i.pauseAt - i.resumeAt + i.resumeOffset : i.pauseOffset = i.pauseAt - i.startAt + i.startOffset, n && n(null)) : void e._handleAudioMixingNoSourceError(\"_pauseOneEffect\", t, n);\n\n          e._handleAudioMixingInvalidStateError(\"_pauseOneEffect\", t, n);\n        }, e._resumeOneEffect = function (t, n) {\n          var i = e.audioMixing.sounds[t.soundId];\n\n          if (i.state === e.audioMixing.states.PAUSED) {\n            var a = {\n              soundId: t.soundId,\n              filePath: i.options.filePath,\n              cycle: i.options.cycle,\n              loop: i.options.loop,\n              playTime: i.pauseOffset,\n              replace: i.options.replace\n            },\n                o = e._startAudioMixingBufferSource(a);\n\n            if (!o) {\n              var s = \"CREATE_BUFFERSOURCE_FAILED\";\n              return n(s), void r.default.error(\"[\".concat(e.streamId, \"] \"), s);\n            }\n\n            i.source = o, i.resumeAt = Date.now(), i.resumeOffset = i.pauseOffset, i.state = e.audioMixing.states.BUSY, i.pauseAt = null, i.pauseOffset = null, n(null);\n          } else e._handleAudioMixingInvalidStateError(\"_resumeOneEffect\", t, n);\n        }, e._getOneEffectDuration = function (t) {\n          var n = e.audioMixing.sounds[t.soundId];\n          return n.options && n.options.filePath && e.audioMixing.buffer[n.options.filePath] ? 1e3 * e.audioMixing.buffer[n.options.filePath].duration : null;\n        }, e._getOneEffectCurrentPosition = function (t, n) {\n          var i = e.audioMixing.sounds[t.soundId];\n          return i.state === e.audioMixing.states.PAUSED ? i.pauseOffset % e._getOneEffectDuration(t) : i.state === e.audioMixing.states.BUSY ? i.resumeAt ? (Date.now() - i.resumeAt + i.resumeOffset + i.startOffset) % e._getOneEffectDuration(t) : (Date.now() - i.startAt + i.startOffset) % e._getOneEffectDuration(t) : void (n && e._handleAudioMixingInvalidStateError(\"_getOneEffectCurrentPosition\", t));\n        }, e._setOneEffectPosition = function (t, n, i) {\n          var a = e.audioMixing.sounds[t.soundId];\n\n          if (a.state === e.audioMixing.states.BUSY) {\n            if (!e._stopAudioMixingBufferSource(t)) return void e._handleAudioMixingNoSourceError(\"_setOneEffectPosition\", t, i);\n\n            var o = {\n              soundId: t.soundId,\n              filePath: a.options.filePath,\n              loop: a.options.loop,\n              cycle: a.options.cycle,\n              playTime: n\n            },\n                s = e._startAudioMixingBufferSource(o);\n\n            if (!s) {\n              var c = \"CREATE_BUFFERSOURCE_FAILED\";\n              return i && i(c), void r.default.error(\"[\".concat(e.streamId, \"] \"), c);\n            }\n\n            a.source = s, a.startAt = Date.now(), a.startOffset = n, a.resumeAt = null, a.resumeOffset = null, a.pauseOffset = null, a.pauseAt = null;\n          } else {\n            if (a.state !== e.audioMixing.states.PAUSED) return void e._handleAudioMixingInvalidStateError(\"_setOneEffectPosition\", t, i);\n            a.pauseOffset = n;\n          }\n\n          i && i(null);\n        }, e.startAudioMixing = function (t, n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            callback: function (t) {\n              if (t) return n && n(t);\n              e.dispatchEvent({\n                type: \"audioMixingPlayed\"\n              }), n && n(null);\n            },\n            getStates: e._getOneEffectStates({\n              soundId: -1\n            }),\n            name: \"Stream.startAudioMixing\",\n            options: t\n          });\n          se(t, \"options\");\n          var r = t.filePath,\n              s = t.cacheResource,\n              c = t.cycle,\n              d = t.loop,\n              u = t.playTime,\n              l = t.replace;\n          ce(r, \"filePath\", 1, Object(a.getParameter)(\"FILEPATH_LENMAX\"), !1), de(u, \"playTime\", 0, 1e8), !_e(c) && de(c, \"cycle\"), !_e(d) && ue(d, \"loop\"), !_e(l) && ue(l, \"replace\"), !_e(s) && ue(s, \"cacheResource\");\n          var p = S()({\n            soundId: -1\n          }, t);\n\n          e._playOneEffect(p, i);\n        }, e.stopAudioMixing = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            callback: t,\n            getStates: e._getOneEffectStates({\n              soundId: -1\n            }),\n            name: \"Stream.stopAudioMixing\"\n          });\n\n          e._stopOneEffect({\n            soundId: -1\n          }, n);\n        }, e.pauseAudioMixing = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            callback: t,\n            getStates: e._getOneEffectStates({\n              soundId: -1\n            }),\n            name: \"Stream.pauseAudioMixing\"\n          });\n          return e._pauseOneEffect({\n            soundId: -1\n          }, n);\n        }, e.resumeAudioMixing = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            callback: function (n, i) {\n              if (n) return t && t(n);\n              e.dispatchEvent({\n                type: \"audioMixingPlayed\"\n              }), t && t(null);\n            },\n            getStates: e._getOneEffectStates({\n              soundId: -1\n            }),\n            name: \"Stream.resumeAudioMixing\"\n          });\n\n          e._resumeOneEffect({\n            soundId: -1\n          }, n);\n        }, e.adjustAudioMixingVolume = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            getStates: e._getOneEffectStates({\n              soundId: -1\n            }),\n            name: \"Stream.adjustAudioMixingVolume\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n          de(t, \"volume\", 0, 100), e.audioMixing.sounds[-1].volume = t, e._flushAudioMixingMuteStatus(), n();\n        }, e.getAudioMixingDuration = function () {\n          var t = o.b.reportApiInvoke(e.sid, {\n            getStates: e._getOneEffectStates({\n              soundId: -1\n            }),\n            name: \"Stream.getAudioMixingDuration\"\n          }),\n              n = e._getOneEffectDuration({\n            soundId: -1\n          });\n\n          return t(null, n), n;\n        }, e.getAudioMixingCurrentPosition = function () {\n          var t = o.b.reportApiInvoke(e.sid, {\n            getStates: e._getOneEffectStates({\n              soundId: -1\n            }),\n            name: \"Stream.getAudioMixingCurrentPosition\"\n          }),\n              n = e._getOneEffectCurrentPosition({\n            soundId: -1\n          }, !0);\n\n          return t(null, n), n;\n        }, e.setAudioMixingPosition = function (t, n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            callback: n,\n            options: arguments,\n            tag: \"tracer\",\n            getStates: e._getOneEffectStates({\n              soundId: -1\n            }),\n            name: \"Stream.setAudioMixingPosition\"\n          });\n          de(t, \"position\", 0, 1e8), e._setOneEffectPosition({\n            soundId: -1\n          }, t, i);\n        }, e.playEffect = function (t, n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            callback: function (t) {\n              if (t) return n && n(t);\n              e.dispatchEvent({\n                type: \"effectPlayed\"\n              }), n && n(null);\n            },\n            name: \"Stream.playEffect\",\n            options: t\n          });\n          se(t, \"options\");\n          var r = t.soundId,\n              s = t.filePath,\n              c = t.cycle;\n          de(r, \"soundId\", 1, 1e4), ce(s, \"filePath\", 0, Object(a.getParameter)(\"FILEPATH_LENMAX\"), !1), !_e(c) && de(c, \"cycle\"), e._playOneEffect(t, i);\n        }, e.stopEffect = function (t, n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            callback: n,\n            getStates: e._getOneEffectStates({\n              soundId: t\n            }),\n            name: \"Stream.stopEffect\"\n          });\n          de(t, \"soundId\", 1, 1e4), e._stopOneEffect({\n            soundId: t\n          }, i);\n        }, e.stopAllEffects = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            callback: t,\n            name: \"Stream.stopAllEffect\"\n          }),\n              i = !1,\n              a = 0,\n              r = 0,\n              s = function (e) {\n            i || (e ? (n(e), i = !0) : a += 1, a === r && (n(null), i = !0));\n          };\n\n          for (var c in e.audioMixing.sounds) {\n            var d = e.audioMixing.sounds[c];\n            -1 !== d.soundId && (d.state !== e.audioMixing.states.BUSY && d.state !== e.audioMixing.states.PAUSED || (r++, e._stopOneEffect({\n              soundId: c\n            }, s)));\n          }\n\n          r || n(null);\n        }, e.preloadEffect = function (t, n, i) {\n          var r = o.b.reportApiInvoke(e.sid, {\n            callback: i,\n            options: arguments,\n            tag: \"tracer\",\n            name: \"Stream.preloadEffect\"\n          });\n          de(t, \"soundId\", 1, 1e4), ce(n, \"filePath\", 1, Object(a.getParameter)(\"FILEPATH_LENMAX\"), !1), e._initSoundIfNotExists(t, n), e.audioMixing.buffer[n] ? r(null) : e.loadAudioBuffer(n, n, r);\n        }, e.unloadEffect = function (t, n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            callback: n,\n            options: arguments,\n            tag: \"tracer\",\n            name: \"Stream.unloadEffect\"\n          });\n          de(t, \"soundId\", 1, 1e4);\n          var a = e.audioMixing.sounds[t];\n\n          if (!a) {\n            var s = \"SOUND_NOT_EXISTS\";\n            return r.default.error(s, t), void i(s);\n          }\n\n          var c = a.options ? a.options.filePath : a.filePath;\n          if (c) delete e.audioMixing.buffer[c], delete e.audioMixing.sounds[t], i(null);else {\n            var d = \"SOUND_BUFFER_NOT_FOUND\";\n            r.default.error(d, t), i(d);\n          }\n        }, e.pauseEffect = function (t, n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            callback: n,\n            options: arguments,\n            tag: \"tracer\",\n            name: \"Stream.pauseEffect\"\n          });\n          return e._pauseOneEffect({\n            soundId: t\n          }, i);\n        }, e.pauseAllEffects = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            callback: t,\n            name: \"Stream.pauseAllEffects\"\n          }),\n              i = !1,\n              a = 0,\n              r = 0,\n              s = function (e) {\n            i || (e ? (n(e), i = !0) : a += 1, a === r && (n(null), i = !0));\n          };\n\n          for (var c in e.audioMixing.sounds) \"-1\" !== c && e.audioMixing.sounds[c].state === e.audioMixing.states.BUSY && (r++, e._pauseOneEffect({\n            soundId: c\n          }, s));\n\n          r || n(null);\n        }, e.resumeEffect = function (t, n) {\n          de(t, \"soundId\", 1, 1e4);\n          var i = o.b.reportApiInvoke(e.sid, {\n            callback: n,\n            options: arguments,\n            tag: \"tracer\",\n            name: \"Stream.resumeEffect\"\n          });\n          return e._resumeOneEffect({\n            soundId: t\n          }, i);\n        }, e.resumeAllEffects = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            callback: t,\n            name: \"Stream.resumeAllEffects\"\n          }),\n              i = !1,\n              a = 0,\n              r = 0,\n              s = function (e) {\n            i || (e ? (n(e), i = !0) : a += 1, a === r && (n(null), i = !0));\n          };\n\n          for (var c in e.audioMixing.sounds) \"-1\" !== c && e.audioMixing.sounds[c].state === e.audioMixing.states.PAUSED && (r++, e._resumeOneEffect({\n            soundId: c\n          }, s));\n\n          r || n(null);\n        }, e.getEffectsVolume = function () {\n          var t = [];\n\n          for (var n in e.audioMixing.sounds) {\n            var i = e.audioMixing.sounds[n];\n            i && \"-1\" !== n && t.push({\n              soundId: parseInt(n),\n              volume: i.volume\n            });\n          }\n\n          return t;\n        }, e.setEffectsVolume = function (t, n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setEffectsVolume\",\n            options: arguments,\n            tag: \"tracer\",\n            callback: n\n          });\n\n          for (var a in de(t, \"volume\", 0, 100), e.audioMixing.defaultVolume = t, e.audioMixing.sounds) {\n            var r = e.audioMixing.sounds[a];\n            \"-1\" !== a && (r.volume = t);\n          }\n\n          e._flushAudioMixingMuteStatus(), i(null);\n        }, e.setVolumeOfEffect = function (t, n, i) {\n          var a = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setVolumeOfEffect\",\n            options: arguments,\n            tag: \"tracer\",\n            callback: i\n          });\n          de(t, \"soundId\", 0, 1e4), de(n, \"volume\", 0, 100), e._initSoundIfNotExists(t), e.audioMixing.sounds[t].volume = n, e._flushAudioMixingMuteStatus(), a(null);\n        };\n      }(t), function (e, t) {\n        e.videoConstraint = {}, t.cameraId && (e.videoConstraint.deviceId = {\n          exact: t.cameraId\n        }), t.facingMode && (e.videoConstraint.facingMode = t.facingMode), e.videoSize && (e.videoConstraint.width = e.videoSize[0], e.videoConstraint.height = e.videoSize[1]), Object(f.isLegacyChrome)() || (e.videoConstraint.frameRate = {\n          ideal: 30,\n          max: 30\n        }), e.audioConstraint = {}, t.microphoneId && (e.audioConstraint.deviceId = {\n          exact: t.microphoneId\n        }), Object(f.isLegacyChrome)() || e.audioProcessing && (void 0 !== e.audioProcessing.AGC && (Object(f.isFireFox)() ? e.audioConstraint.autoGainControl = e.audioProcessing.AGC : Object(f.isChrome)() && (e.audioConstraint.googAutoGainControl = e.audioProcessing.AGC, e.audioConstraint.googAutoGainControl2 = e.audioProcessing.AGC)), void 0 !== e.audioProcessing.AEC && (e.audioConstraint.echoCancellation = e.audioProcessing.AEC), void 0 !== e.audioProcessing.ANS && (Object(f.isFireFox)() ? e.audioConstraint.noiseSuppression = e.audioProcessing.ANS : Object(f.isChrome)() && (e.audioConstraint.googNoiseSuppression = e.audioProcessing.ANS))), e.screenConstraint = {}, t.sourceId && (e.screenConstraint.sourceId = t.sourceId), t.extensionId && Object(f.isChrome)() ? (e.screenConstraint.extensionId = t.extensionId, e.screenConstraint.mandatory = {\n          chromeMediaSource: \"desktop\",\n          maxWidth: e.screenAttributes.width,\n          maxHeight: e.screenAttributes.height,\n          maxFrameRate: e.screenAttributes.maxFr,\n          minFrameRate: e.screenAttributes.minFr\n        }) : (e.screenConstraint.mediaSource = \"screen\", e.screenConstraint.width = e.screenAttributes.width, e.screenConstraint.height = e.screenAttributes.height, e.screenConstraint.frameRate = {\n          ideal: e.screenAttributes.maxFr,\n          max: e.screenAttributes.maxFr\n        }), t.mediaSource && (e.screenConstraint.mediaSource = t.mediaSource), e.setVideoResolution = function (n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setVideoResolution\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n\n          if (!(n instanceof Array)) {\n            var a = Ee(n += \"\");\n            return a && a.video ? (e.videoConstraint = S()(e.videoConstraint, {\n              width: {\n                ideal: a.video.width\n              },\n              height: {\n                ideal: a.video.height\n              }\n            }), t.attributes.resolution = a.attributes.resolution, (s = e.stream && e.stream.getVideoTracks && e.stream.getVideoTracks()[0]) && s.applyConstraints ? (r.default.debug(\"setVideoResolution applyConstraints\", e.videoConstraint), s.applyConstraints(e.videoConstraint).then(i).catch(i)) : i(), !0) : (i(\"NO_PROFILE_\".concat(n)), !1);\n          }\n\n          var s,\n              c = n[0],\n              d = n[1];\n          e.videoConstraint = S()(e.videoConstraint, {\n            width: {\n              ideal: c\n            },\n            height: {\n              ideal: d\n            }\n          }), t.attributes.resolution = \"\".concat(c, \"x\").concat(d), (s = e.stream && e.stream.getVideoTracks && e.stream.getVideoTracks()[0]) && s.applyConstraints ? (r.default.debug(\"setVideoResolution applyConstraints\", e.videoConstraint), s.applyConstraints(e.videoConstraint).then(i).catch(i)) : i();\n        }, e.setVideoFrameRate = function (n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setVideoFrameRate\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n          if (Object(f.isFireFox)()) return i(\"FIREFOX_NOT_SUPPORTED\"), !1;\n\n          if (\"object\" === re()(n) && n instanceof Array && n.length > 1) {\n            e.videoConstraint = S()(e.videoConstraint, {\n              frameRate: {\n                ideal: n[0],\n                max: n[1]\n              }\n            }), t.attributes.minFrameRate = n[0], t.attributes.maxFrameRate = n[1];\n            var a = e.stream && e.stream.getVideoTracks && e.stream.getVideoTracks()[0];\n            return a && a.applyConstraints ? (r.default.debug(\"setVideoFrameRate applyConstraints\", e.videoConstraint), a.applyConstraints(e.videoConstraint).then(i).catch(i)) : i(), !0;\n          }\n\n          return i(\"INVALID_PARAM_\".concat(JSON.stringify(n))), !1;\n        }, e.setVideoBitRate = function (n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setVideoBitRate\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n          return \"object\" === re()(n) && n instanceof Array && n.length > 1 ? (t.attributes.minVideoBW = n[0], t.attributes.maxVideoBW = n[1], e.connectionSpec && (e.connectionSpec.minVideoBW = n[0], e.connectionSpec.maxVideoBW = n[1]), e.pc && e.pc.renegotiate && e.pc.renegotiate(), i(), !0) : (i(\"INVALID_PARAM_\".concat(JSON.stringify(n))), !1);\n        }, e.setScreenBitRate = function (n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setScreenBitRate\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n          return \"object\" === re()(n) && n instanceof Array && n.length > 1 ? (t.screenAttributes.minVideoBW = n[0], t.screenAttributes.maxVideoBW = n[1], i(), !0) : (i(\"INVALID_PARAM_\".concat(JSON.stringify(n))), !1);\n        }, e.setScreenProfile = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setScreenProfile\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n          oe(t, \"profile\", [\"480p_1\", \"480p_2\", \"720p_1\", \"720p_2\", \"1080p_1\", \"1080p_2\"]);\n          var i = Ee(t);\n          return i && i.screen ? (e.screenConstraint.mandatory ? (e.screenConstraint.mandatory.maxWidth = i.screen.width, e.screenConstraint.mandatory.maxHeight = i.screen.height, i.screen.frameRate && i.screen.frameRate.min && i.screen.frameRate.max && (e.screenConstraint.mandatory.minFrameRate = i.screen.frameRate.min, e.screenConstraint.mandatory.maxFrameRate = i.screen.frameRate.max)) : e.screenConstraint = S()(e.screenConstraint, i.screen), e.screenAttributes.width = i.screen.width, e.screenAttributes.height = i.screen.height, e.screenAttributes.minFr = i.screen.frameRate.min, e.screenAttributes.maxFr = i.screen.frameRate.max, n(), !0) : (n(\"NO_SCREEN_PROFILE_\".concat(JSON.stringify(t))), !1);\n        }, e.setVideoProfileCustom = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setVideoProfileCustom\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n          e.setVideoResolution(t[0]), e.setVideoFrameRate([t[1], t[1]]), e.setVideoBitRate([t[2], t[2]]), n();\n        }, e.setVideoProfileCustomPlus = function (n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setVideoProfileCustom\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n          e.videoConstraint.width = n.width, e.videoConstraint.height = n.height, t.attributes.resolution = \"\".concat(n.width, \"x\").concat(n.height), e.setVideoFrameRate([n.framerate, n.framerate]), e.setVideoBitRate([n.bitrate, n.bitrate]), i();\n        }, e.setVideoProfile = function (n) {\n          var i = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setVideoProfile\",\n            options: arguments,\n            tag: \"tracer\"\n          }),\n              a = Ee(n);\n\n          if (!a) {\n            var s = \"Invalid Profile \".concat(n);\n            throw new Error(s);\n          }\n\n          if (e.profile = n, a && a.video) {\n            e.profile = a.profileName, e.videoConstraint = S()(e.videoConstraint, a.video), e.connectionSpec && a.attributes.maxVideoBW && (e.connectionSpec.minVideoBW = a.attributes.minVideoBW, e.connectionSpec.maxVideoBW = a.attributes.maxVideoBW), Object(f.isEdge)() && (e.videoConstraint.frameRate.max = 60), Object(f.isFireFox)() && (e.videoConstraint.frameRate = {\n              ideal: 30,\n              max: 30\n            }), t.attributes = S()(t.attributes, a.attributes), e.pc && e.pc.renegotiate && e.pc.renegotiate();\n            var c = e.stream && e.stream.getVideoTracks && e.stream.getVideoTracks()[0];\n            return c && c.applyConstraints ? (r.default.debug(\"setVideoProfile applyConstraints\", e.videoConstraint), c.applyConstraints(e.videoConstraint).then(function (t) {\n              i(t), Object(te.g)(e.stream, function (t, n) {\n                e.videoWidth = t, e.videoHeight = n;\n              }, function (t) {\n                r.default.warning(\"[\".concat(e.streamId, \"] vsResHack failed: \"), t);\n              });\n            }).catch(i)) : i(), !0;\n          }\n\n          return i(\"INVALID_VIDEO_PROFILE_\".concat(n)), !1;\n        }, e.setAudioProfile = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setAudioProfile\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n          oe(t, \"profile\", [\"speech_low_quality\", \"speech_standard\", \"music_standard\", \"standard_stereo\", \"high_quality\", \"high_quality_stereo\"]), e.audioProfile = t;\n          var i = Te(t);\n          return e.highQuality = i.highQuality, e.stereo = i.stereo, e.speech = i.speech, e.lowQuality = i.lowQuality, e.stereo && Object(f.isChrome)() && (e.audioConstraint.googAutoGainControl = !1, e.audioConstraint.googAutoGainControl2 = !1, e.audioConstraint.echoCancellation = !1, e.audioConstraint.googNoiseSuppression = !1), n(), !0;\n        }, e.setVideoEncoderConfiguration = function (t) {\n          se(t, \"config\");\n          var n = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.setVideoEncoderConfiguration\",\n            options: t,\n            tag: \"tracer\"\n          });\n          t.resolution && (de(t.resolution.width, \"config.resolution.width\"), de(t.resolution.height, \"config.resolution.height\"), e.setVideoResolution([t.resolution.width, t.resolution.height])), t.frameRate && (de(t.frameRate.min, \"config.frameRate.min\"), de(t.frameRate.max, \"config.frameRate.max\"), e.setVideoFrameRate([t.frameRate.min, t.frameRate.max])), t.bitrate && (de(t.bitrate.min, \"config.bitrate.min\", 1, 1e7), de(t.bitrate.max, \"config.bitrate.max\", 1, 1e7), e.setVideoBitRate([t.bitrate.min, t.bitrate.max])), n();\n        }, e.getSupportedProfile = function (t) {\n          var n = o.b.reportApiInvoke(e.sid, {\n            name: \"Stream.getSupportedProfile\",\n            options: arguments,\n            tag: \"tracer\",\n            callback: t\n          });\n\n          if (!e.local) {\n            var i = \"ONLY_LOCAL_STREAM_SUPPORTED\";\n            return r.default.error(i), n(i);\n          }\n\n          if (!e.stream) return i = \"STREAM_NOT_INIT\", r.default.error(i), n(i);\n          if (!e.stream.getVideoTracks) return i = \"TRACK_NOT_SUPPORT\", r.default.error(i), n(i);\n          var a = e.stream.getVideoTracks()[0];\n          if (!a) return i = \"NO_VIDEO_TRACK_FOUND\", r.default.error(i), n(i);\n          if (!a.getCapabilities) return i = \"GETCAPABILITY_NOT_SUPPORT\", r.default.error(i), n(i);\n          var s = a.getCapabilities();\n          return n(null, be(s));\n        };\n      }(t, e), t.on(\"collectStats\", function (e) {\n        e.promises.push(t._getPCStats(e.interval)), e.promises.push(new Promise(function (e) {\n          var n = {};\n          t.pc && t.pc.isSubscriber ? null !== window.navigator.userAgent.match(\"Firefox\") && (ne(n, \"videoReceiveResolutionHeight\", t.videoHeight), ne(n, \"videoReceiveResolutionWidth\", t.videoWidth)) : t.pc && !t.pc.isSubscriber && ((Object(f.isSafari)() || Object(f.isFireFox)()) && (ne(n, \"videoSendResolutionHeight\", t.videoHeight), ne(n, \"videoSendResolutionWidth\", t.videoWidth)), (Object(f.isSafari)() || Object(f.isFireFox)()) && t.uplinkStats && ne(n, \"videoSendPacketsLost\", t.uplinkStats.uplink_cumulative_lost)), e(n);\n        })), e.promises.push(new Promise(function (e) {\n          var n = {};\n          return t.traffic_stats && t.pc && t.pc.isSubscriber ? (ne(n, \"accessDelay\", t.traffic_stats.access_delay), ne(n, \"endToEndDelay\", t.traffic_stats.e2e_delay), ne(n, \"videoReceiveDelay\", t.traffic_stats.video_delay), ne(n, \"audioReceiveDelay\", t.traffic_stats.audio_delay)) : t.traffic_stats && t.pc && !t.pc.isSubscriber && ne(n, \"accessDelay\", t.traffic_stats.access_delay), e(n);\n        }));\n      }), t.getId = function () {\n        return t.streamId;\n      }, t.getUserId = function () {\n        return t.userId;\n      }, t.checkDualStreamEnabled = function () {\n        if (Object(a.getParameter)(\"DUALSTREAM_OPERATION_CHECK\") && t.isDualStream) {\n          return r.default.error(\"Operation not permitted: \".concat(\"DUAL_STREAM_ENABLED\")), \"DUAL_STREAM_ENABLED\";\n        }\n\n        return !1;\n      }, t.setUserId = function (e) {\n        var n = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.setUserId\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        t.userId && r.default.warning(\"[\".concat(t.streamId, \"] Stream.userId \").concat(t.userId, \" => \").concat(e)), t.userId = e, n();\n      }, t.getAttributes = function () {\n        return e.screen ? t.screenAttributes : e.attributes;\n      }, t.hasAudio = function () {\n        return t.audio;\n      }, t.hasVideo = function () {\n        return t.video;\n      }, t.hasScreen = function () {\n        return t.screen;\n      }, t.isVideoOn = function () {\n        return (t.hasVideo() || t.hasScreen()) && !t.userMuteVideo;\n      }, t.isAudioOn = function () {\n        return t.hasAudio() && !t.userMuteAudio;\n      }, t.init = function (i, a) {\n        var s = o.b.reportApiInvoke(t.sid, {\n          callback: function (e, t) {\n            if (e) return a && a(e);\n            i && i(t);\n          },\n          name: \"Stream.init\",\n          options: arguments,\n          tag: \"tracer\"\n        }),\n            c = (new Date().getTime(), arguments[2]);\n        if (void 0 === c && (c = 2), !0 === t.initialized) return s({\n          type: \"warning\",\n          msg: \"STREAM_ALREADY_INITIALIZED\"\n        });\n        if (!0 !== t.local) return s({\n          type: \"warning\",\n          msg: \"STREAM_NOT_LOCAL\"\n        });\n        var d = Math.random().toString().slice(3);\n        this._streamInitID = d, t.videoSource ? t.videoName = \"videoSource\" : t.video && (t.videoName = ie.searchDeviceNameById(e.cameraId) || \"default\"), t.audioSource ? t.audioName = \"audioSource\" : t.audio && (t.audioName = ie.searchDeviceNameById(e.microphoneId) || \"default\"), t.screen && (t.screenName = e.extensionId || \"default\");\n\n        try {\n          if (e.audio || e.video || e.screen || e.videoSource || e.audioSource) {\n            r.default.debug(\"[\".concat(t.streamId, \"] Requested access to local media\"));\n            var u = {\n              streamId: t.streamId\n            };\n            e.videoSource ? u.videoSource = e.videoSource : e.screen ? u.screen = t.screenConstraint : e.video && (u.video = t.videoConstraint), e.audioSource ? u.audioSource = e.audioSource : e.audio && (u.audio = t.audioConstraint), ee(u, function (i) {\n              if (u.screen && r.default.debug(\"[\".concat(t.streamId, \"] User has granted access to screen sharing\")), (u.video || u.audio) && r.default.debug(\"[\".concat(t.streamId, \"] User has granted access to local media\")), null === t._streamInitID) {\n                i.getTracks().forEach(function (e) {\n                  e.stop();\n                });\n                var a = {\n                  type: \"error\",\n                  msg: \"STREAM_IS_CLOSED\",\n                  info: \"stream is closed and cannot be initialized\"\n                };\n                return r.default.error(t.streamId, a.info), void s(a);\n              }\n\n              if (t._streamInitID !== d) {\n                i.getTracks().forEach(function (e) {\n                  e.stop();\n                });\n                a = {\n                  type: \"error\",\n                  msg: \"ABORT_OTHER_INIT\",\n                  info: \"stream initialization is aborted because of another stream.init\"\n                };\n                return r.default.error(t.streamId, a.info), void s(a);\n              }\n\n              t.dispatchEvent({\n                type: \"accessAllowed\"\n              }), t.stream = i, t.initialized = !0, t.reloadDeviceName(), t.hasVideo() && Object(te.g)(i, function (e, n) {\n                t.videoWidth = e, t.videoHeight = n;\n              }, function (e) {\n                r.default.warning(\"[\".concat(t.streamId, \"] vsResHack failed: \"), e);\n              }), e.screen && t.stream && t.stream.getVideoTracks()[0] && (t.stream.getVideoTracks()[0].onended = function () {\n                t.dispatchEvent({\n                  type: \"stopScreenSharing\"\n                });\n              }), t.stream && t.stream.getTracks && t.stream.getTracks().forEach(function (e) {\n                e && !e.onended && (e.onended = n);\n              }), s();\n            }, function (e) {\n              var n = {\n                type: \"error\",\n                info: null\n              };\n\n              switch (e && (n.msg = e.name || e.code || e, e.message && (n.info = e.message), e.code && (n.info ? n.info += \". \" + e.code : n.info = \" \" + e.code), e.constraint && (n.info ? n.info += \". Constraint: \" + e.constraint : n.info = \"constraint: \" + e.constraint)), n.msg) {\n                case \"Starting video failed\":\n                case \"TrackStartError\":\n                  if (t.videoConstraint && (delete t.videoConstraint.width, delete t.videoConstraint.height), c > 0) return void setTimeout(function () {\n                    t.init(function (e) {\n                      return s(e);\n                    }, s, c - 1);\n                  }, 1);\n                  n.msg = \"MEDIA_OPTION_INVALID\";\n                  break;\n\n                case \"DevicesNotFoundError\":\n                  n.msg = \"DEVICES_NOT_FOUND\";\n                  break;\n\n                case \"NotSupportedError\":\n                  n.msg = \"NOT_SUPPORTED\";\n                  break;\n\n                case \"PermissionDeniedError\":\n                case \"InvalidStateError\":\n                  n.msg = \"PERMISSION_DENIED\", t.dispatchEvent({\n                    type: \"accessDenied\"\n                  });\n                  break;\n\n                case \"PERMISSION_DENIED\":\n                case \"NotAllowedError\":\n                  t.dispatchEvent({\n                    type: \"accessDenied\"\n                  });\n                  break;\n\n                case \"ConstraintNotSatisfiedError\":\n                  n.msg = \"CONSTRAINT_NOT_SATISFIED\";\n                  break;\n\n                default:\n                  n.msg || (n.msg = \"UNDEFINED\");\n              }\n\n              var i = \"Media access \".concat(n.msg).concat(n.info ? \": \" + n.info : \"\");\n              r.default.error(\"[\".concat(t.streamId, \"] \"), i), s(n);\n            });\n          } else s({\n            type: \"warning\",\n            msg: \"STREAM_HAS_NO_MEDIA_ATTRIBUTES\"\n          });\n        } catch (e) {\n          r.default.error(\"[\".concat(t.streamId, \"] Stream init: \"), e), s({\n            type: \"error\",\n            msg: e.message || e\n          });\n        }\n      }, t.reloadDeviceName = function () {\n        if (t.stream) {\n          if (t.stream.getVideoTracks) {\n            var e = t.stream.getVideoTracks()[0];\n            e && e.label && (t.videoName = e.label);\n          }\n\n          if (t.stream.getAudioTracks) {\n            var n = t.stream.getAudioTracks()[0];\n            n && n.label && (t.audioName = n.label);\n          }\n        }\n      }, t.close = function () {\n        var e = o.b.reportApiInvoke(null, {\n          name: \"Stream.close\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n\n        if (r.default.debug(\"[\".concat(t.streamId, \"] Close stream with id\"), t.streamId), void 0 !== t.stream) {\n          var n = t.stream.getTracks();\n\n          for (var i in n) n.hasOwnProperty(i) && n[i].stop();\n\n          t.stream = void 0;\n        }\n\n        Object(f.isSafari)() && t.pc && t.pc.peerConnection && t.pc.peerConnection.removeTrack && t.pc.peerConnection.getSenders && t.pc.peerConnection.getSenders().forEach(function (e) {\n          e && (r.default.debug(\"[\".concat(t.streamId, \"] Remove Track\"), e), t.pc.peerConnection.removeTrack(e));\n        });\n        t.initialized = !1, t._streamInitID = null, t._onAudioMute = void 0, t._onAudioUnmute = void 0, t._onVideoMute = void 0, t._onVideoUnmute = void 0, t.lowStream && t.lowStream.close(), e();\n      }, t.enableAudio = function () {\n        var e,\n            n = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.enableAudio\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        return r.default.deprecate(\"[\".concat(t.streamId, \"] Stream.enableAudio is deprecated and will be removed in the future. Use Stream.unmuteAudio instead\")), t.userMuteAudio || r.default.warning(\"[\".concat(t.streamId, \"] User already enableAudio\")), t.userMuteAudio = !1, n(null, e = !t.peerMuteAudio && t._unmuteAudio()), e;\n      }, t.disableAudio = function () {\n        var e = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.disableAudio\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        r.default.deprecate(\"[\".concat(t.streamId, \"] Stream.disableAudio is deprecated and will be removed in the future. Use Stream.muteAudio instead\")), t.userMuteAudio && r.default.warning(\"[\".concat(t.streamId, \"] User already disableAudio\")), t.userMuteAudio = !0;\n\n        var n = t._muteAudio();\n\n        return e(null, n), n;\n      }, t.enableVideo = function () {\n        var e,\n            n = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.enableVideo\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        return r.default.deprecate(\"[\".concat(t.streamId, \"] Stream.enableVideo is deprecated and will be removed in the future. Use Stream.unmuteVideo instead\")), t.userMuteVideo || r.default.warning(\"[\".concat(t.streamId, \"] User already enableVideo\")), t.userMuteVideo = !1, t.lowStream && (t.lowStream.userMuteVideo = !1), n(null, e = !t.peerMuteVideo && t._unmuteVideo()), e;\n      }, t.disableVideo = function () {\n        var e = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.disableVideo\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        r.default.deprecate(\"[\".concat(t.streamId, \"] Stream.disableVideo is deprecated and will be removed in the future. Use Stream.muteVideo instead\")), t.userMuteVideo && r.default.warning(\"[\".concat(t.streamId, \"] User already disableVideo\")), t.userMuteVideo = !0, t.lowStream && (t.lowStream.userMuteVideo = !0);\n\n        var n = t._muteVideo();\n\n        return e(null, n), n;\n      }, t.unmuteAudio = function () {\n        var e,\n            n = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.unmuteAudio\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        return t.userMuteAudio || r.default.warning(\"[\".concat(t.streamId, \"] User already unmuteAudio\")), t.userMuteAudio = !1, n(null, e = !t.peerMuteAudio && t._unmuteAudio()), e;\n      }, t.muteAudio = function () {\n        var e = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.muteAudio\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        t.userMuteAudio && r.default.warning(\"[\".concat(t.streamId, \"] User already muteAudio\")), t.userMuteAudio = !0;\n\n        var n = t._muteAudio();\n\n        return e(null, n), n;\n      }, t.unmuteVideo = function () {\n        var e,\n            n = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.unmuteVideo\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        return t.userMuteVideo || r.default.warning(\"[\".concat(t.streamId, \"] User already unmuteVideo\")), t.userMuteVideo = !1, t.lowStream && (t.lowStream.userMuteVideo = !1), n(null, e = !t.peerMuteVideo && t._unmuteVideo()), e;\n      }, t.muteVideo = function () {\n        var e = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.muteVideo\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        t.userMuteVideo && r.default.warning(\"[\".concat(t.streamId, \"] User already muteVideo\")), t.userMuteVideo = !0, t.lowStream && (t.lowStream.userMuteVideo = !0);\n\n        var n = t._muteVideo();\n\n        return e(null, n), n;\n      }, t._unmuteAudio = function () {\n        return r.default.debug(\"[\".concat(t.streamId, \"] Unmuted audio stream with id \"), t.streamId), t._flushAudioMixingMuteStatus(!1), !(!t.hasAudio() || !t.initialized || void 0 === t.stream || !0 === t.stream.getAudioTracks()[0].enabled) && (t._onAudioUnmute && t._onAudioUnmute(), t.pc && (t.pc.isAudioMute = !1), t.stream.getAudioTracks()[0].enabled = !0, !0);\n      }, t._isAudioMuted = function () {\n        if (t.stream && t.hasAudio()) {\n          var e = t.stream.getAudioTracks();\n          return e.length > 0 && !e[0].enabled;\n        }\n\n        return !1;\n      }, t._isVideoMuted = function () {\n        if (t.stream && t.hasVideo()) {\n          var e = t.stream.getVideoTracks();\n          return e.length > 0 && !e[0].enabled;\n        }\n\n        return !1;\n      }, t._muteAudio = function () {\n        return r.default.debug(\"[\".concat(t.streamId, \"] Muted audio stream with id \"), t.streamId), t._flushAudioMixingMuteStatus(!0), !!(t.hasAudio() && t.initialized && void 0 !== t.stream && t.stream.getAudioTracks()[0].enabled) && (t._onAudioMute && t._onAudioMute(), t.pc && (t.pc.isAudioMute = !0), t.stream.getAudioTracks()[0].enabled = !1, t.sid && o.b.audioSendingStopped(t.sid, {\n          succ: !0,\n          reason: \"muteAudio\"\n        }), !0);\n      }, t._unmuteVideo = function () {\n        return r.default.debug(\"[\".concat(t.streamId, \"] Unmuted video stream with id\"), t.streamId), !(!t.initialized || void 0 === t.stream || !t.stream.getVideoTracks().length || !0 === t.stream.getVideoTracks()[0].enabled) && (t._onVideoUnmute && t._onVideoUnmute(), t.pc && (t.pc.isVideoMute = !1), t.stream.getVideoTracks()[0].enabled = !0, t.lowStream && t.lowStream._unmuteVideo(), !0);\n      }, t._muteVideo = function () {\n        return r.default.debug(\"[\".concat(t.streamId, \"] Muted video stream with id\"), t.streamId), !!(t.initialized && void 0 !== t.stream && t.stream.getVideoTracks().length && t.stream.getVideoTracks()[0].enabled) && (t._onVideoMute && t._onVideoMute(), t.pc && (t.pc.isVideoMute = !0), t.stream.getVideoTracks()[0].enabled = !1, t.lowStream && t.lowStream._muteVideo(), t.sid && o.b.videoSendingStopped(t.sid, {\n          succ: !0,\n          reason: \"muteVideo\"\n        }), !0);\n      }, t.addTrack = function (i) {\n        var a = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.addTrack\",\n          options: arguments,\n          tag: \"tracer\"\n        }),\n            r = t.checkDualStreamEnabled();\n        if (r) return a(r);\n\n        if (t.pc && t.pc.addTrack(i, t.stream), \"audio\" == i.kind) {\n          t._cleanupAudioMixing();\n\n          var s = new MediaStream();\n          t.userMuteAudio && (i.enabled = !1), s.addTrack(i);\n          var c = t.stream.getVideoTracks()[0];\n          c && (s.addTrack(c), t.audio = !0, e.audio = !0), t.stream = s, t.audioLevelHelper = null, t.player && t.player.video && (t.player.video.srcObject = t.stream);\n        } else t.userMuteVideo && (i.enabled = !1), t.stream.addTrack(i), t.video = !0, e.video = !0;\n\n        i.onended || (i.onended = n), a();\n      }, t.removeTrack = function (n) {\n        var i = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.removeTrack\",\n          options: arguments,\n          tag: \"tracer\"\n        }),\n            a = t.checkDualStreamEnabled();\n        if (a) return i(a);\n        t.pc && t.pc.removeTrack(n, t.stream), t.stream.removeTrack(n), t._cleanupAudioMixing(), \"audio\" === n.kind ? (t.audio = !1, e.audio = !1) : (t.video = !1, e.video = !1), t.audioLevelHelper = null, \"live\" == n.readyState && (n.stop(), r.default.debug(\"[\".concat(t.streamId, \"] Track \").concat(n.kind, \" Stopped\"))), i();\n      }, t.setAudioOutput = function (e, n, i) {\n        var a = o.b.reportApiInvoke(t.sid, {\n          callback: function (e, t) {\n            if (e) return i && i(e);\n            n && n(t);\n          },\n          name: \"Stream.setAudioOutput\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        return le(e, 1, 255) ? (t.audioOutput = e, t.player ? void t.player.setAudioOutput(e, function () {\n          return a();\n        }, a) : a()) : (r.default.error(\"[\".concat(t.streamId, \"] setAudioOutput Invalid Parameter\"), e), a(x.INVALID_PARAMETER));\n      }, t.play = function (e, n, i) {\n        \"function\" == typeof n && (i = n, n = null), r.default.debug(\"[\".concat(t.streamId, \"] play().\"), e, n);\n        var a = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.play\",\n          options: arguments,\n          tag: \"tracer\",\n          callback: i\n        });\n        if (ce(e, \"elementID\"), _e(n) || (_e(n.fit) || oe(n.fit, \"fit\", [\"cover\", \"contain\"]), _e(n.muted) || ue(n.muted, \"muted\")), t.player) r.default.warning(\"[\".concat(t.streamId, \"] Stream.play(): Stream is already playing. Fallback to resume stream\")), t.resume().then(function () {\n          a(null);\n        }).catch(a);else {\n          t.elementID = e, t.playOptions = n, !t.local || t.video || t.screen ? t.player = new V({\n            id: t.getId(),\n            stream: t,\n            elementID: e,\n            options: n\n          }) : t.hasAudio() && (t.player = new V({\n            id: t.getId(),\n            stream: t,\n            elementID: e,\n            options: n\n          }));\n          var s = {\n            audio: null,\n            video: null\n          };\n          t.on(\"player-status-change\", function e(n) {\n            if (s[n.mediaType] = n, s.audio && s.video) if (t.removeEventListener(\"player-status-change\", e), s.video.isErrorState || s.audio.isErrorState) {\n              var i = s.video.isErrorState ? s.video : s.audio;\n              a({\n                isErrorState: !0,\n                status: i.status,\n                reason: i.reason,\n                video: s.video,\n                audio: s.audio\n              });\n            } else \"aborted\" === s.video.status && \"aborted\" === s.audio.status ? a({\n              status: \"aborted\",\n              reason: \"stop\",\n              video: s.video,\n              audio: s.audio\n            }) : a(null);\n          }), t.audioOutput && t.player.setAudioOutput(t.audioOutput), void 0 !== t.audioLevel && t.player.setAudioVolume(t.audioLevel), t._flushAudioMixingMuteStatus(!1);\n        }\n      }, t.stop = function () {\n        var e = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.stop\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        r.default.debug(\"[\".concat(t.streamId, \"] Stop stream player with id \"), t.streamId), t.player ? (t.player.destroy(), delete t.player) : r.default.error(\"[\".concat(t.streamId, \"] Stream.stop(): Stream is not playing\")), t._flushAudioMixingMuteStatus(!0), e();\n      }, t.isPlaying = function () {\n        return !!t.player;\n      }, t.isPaused = function () {\n        return !!t.player && (!!(t.player.video && t.player.video.paused && t.player.mediaElemExists(t.player.video)) || !!(t.player.audio && t.player.audio.paused && t.player.mediaElemExists(t.player.audio)));\n      }, t.resume = function () {\n        var e, n;\n        return t.player ? (t.player.video && t.player.video.play && (e = t.player.video.play()), e = e || Promise.resolve(), t.player.audio && t.player.audio.play && (n = t.player.audio.play()), n = n || Promise.resolve(), Promise.all([e, n])) : Promise.reject(\"NO_PLAYER_FOUND\");\n      }, t.getVideoTrack = function () {\n        var e = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.getVideoTrack\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n\n        if (t.stream && t.stream.getVideoTracks) {\n          var n = t.stream.getVideoTracks()[0];\n          if (n) return r.default.info(\"[\".concat(t.streamId, \"] getVideoTrack\"), n), e(), n;\n        }\n\n        r.default.info(\"[\".concat(t.streamId, \"] getVideoTrack None\")), e(null, \"getVideoTrack None\");\n      }, t.getAudioTrack = function () {\n        var e = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.getAudioTrack\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n\n        if (t.stream && t.stream.getAudioTracks) {\n          var n = t.stream.getAudioTracks()[0];\n          if (n) return r.default.info(\"[\".concat(t.streamId, \"] getAudioTracks\"), n), e(), n;\n        }\n\n        r.default.info(\"[\".concat(t.streamId, \"] getAudioTracks None\")), e(null, \"getAudioTracks None\");\n      }, t._replaceMediaStreamTrack = function (e, n, i) {\n        if (t.stream) {\n          if (\"video\" == e.kind) {\n            if (o = t.stream.getVideoTracks()[0]) return t.userMuteVideo && (e.enabled = !1), t.stream.removeTrack(o), t.stream.addTrack(e), r.default.debug(\"[\".concat(t.streamId, \"] _replaceMediaStreamTrack \").concat(e.kind, \" SUCCESS\")), \"live\" == o.readyState && (o.stop(), r.default.debug(\"[\".concat(t.streamId, \"] Track \").concat(o.kind, \" Stopped\"))), n && n();\n            var a = \"MEDIASTREAM_TRACK_NOT_FOUND\";\n            return r.default.error(\"[\".concat(t.streamId, \"] MEDIASTREAM_TRACK_NOT_FOUND \").concat(e.kind)), i(a);\n          }\n\n          if (\"audio\" == e.kind) {\n            var o;\n\n            if (o = t.stream.getAudioTracks()[0]) {\n              t.userMuteAudio && (e.enabled = !1);\n              var s = new MediaStream();\n              s.addTrack(e);\n              var c = t.stream && t.stream.getVideoTracks()[0];\n              return c && s.addTrack(c), t.stream = s, t.audioLevelHelper = null, t.player && t.player.video && (t.player.video.srcObject = t.stream), r.default.debug(\"[\".concat(t.streamId, \"] _replaceMediaStreamTrack SUCCESS\")), \"live\" == o.readyState && (o.stop(), r.default.debug(\"[\".concat(t.streamId, \"] Track \").concat(o.kind, \" Stopped\"))), n && n();\n            }\n\n            a = \"MEDIASTREAM_TRACK_NOT_FOUND\";\n            return r.default.error(\"[\".concat(t.streamId, \"] MEDIASTREAM_TRACK_NOT_FOUND \").concat(e.kind)), i(a);\n          }\n\n          a = \"INVALID_TRACK_TYPE\";\n          return r.default.error(\"[\".concat(t.streamId, \"] _replaceMediaStreamTrack \").concat(a, \" \").concat(e.kind)), i && i(a);\n        }\n\n        a = \"NO_STREAM_FOUND\";\n        return r.default.error(\"[\".concat(t.streamId, \"] _replaceMediaStreamTrack \").concat(a)), i && i(a);\n      }, t.replaceTrack = function (e, i, a) {\n        var s = o.b.reportApiInvoke(t.sid, {\n          callback: function (e, t) {\n            if (e) return a && a(e);\n            i && i(t);\n          },\n          name: \"Stream.replaceTrack\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        if (!e || !e.kind) return s(\"INVALID_TRACK\");\n        var c = t.checkDualStreamEnabled();\n        return c ? s(c) : (t._cleanupAudioMixing(), e.onended || (e.onended = n), t.pc && t.pc.hasSender && t.pc.hasSender(e.kind) ? void t.pc.replaceTrack(e, function () {\n          return r.default.debug(\"[\".concat(t.streamId, \"] PeerConnection.replaceTrack \").concat(e.kind, \" SUCCESS\")), t._replaceMediaStreamTrack(e, function (e) {\n            return s(null, e);\n          }, s);\n        }, function (n) {\n          return r.default.error(\"[\".concat(t.streamId, \"] PeerConnection.replaceTrack \").concat(e.kind, \" Failed \").concat(n)), s(n);\n        }) : t._replaceMediaStreamTrack(e, function (e) {\n          return s(null, e);\n        }, s));\n      }, t.setAudioVolume = function (e) {\n        var n = o.b.reportApiInvoke(t.sid, {\n          name: \"Stream.setAudioVolume\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        de(e, \"level\", 0, 100), t.audioLevel = e, t.player && t.player.setAudioVolume(e), n();\n      }, t.getStats = function (e, n, i) {\n        var a = {\n          type: \"collectStats\",\n          promises: [],\n          interval: i\n        };\n        t.dispatchEvent(a), Promise.all(a.promises).then(function (n) {\n          for (var i = {}, a = n.length - 1; a >= 0; a--) {\n            var r = n[a];\n            S()(i, r);\n          }\n\n          e && setTimeout(e.bind(t, i), 0);\n        }).catch(function (e) {\n          n && setTimeout(n.bind(t, e), 0);\n        });\n      }, t._getPCStats = function (e) {\n        return new Promise(function (n, i) {\n          if (!t.pc || \"established\" !== t.pc.state || !t.pc.getStats) {\n            return i(\"PEER_CONNECTION_NOT_ESTABLISHED\");\n          }\n\n          t.pc.getStats(function (e) {\n            if (!t.pc || \"established\" !== t.pc.state || !t.pc.getStats) {\n              return i(\"PEER_CONNECTION_STATE_CHANGE\");\n            }\n\n            var a = t.pc.isSubscriber ? function (e) {\n              var t = {};\n              return e.forEach(function (e) {\n                e.id && (-1 === e.id.indexOf(\"recv\") && -1 === e.id.indexOf(\"inbound_rtp\") && -1 === e.id.indexOf(\"inbound-rtp\") && -1 === e.id.indexOf(\"InboundRTP\") || (\"audio\" === e.mediaType ? (ne(t, \"audioReceiveBytes\", e.bytesReceived), ne(t, \"audioReceivePackets\", e.packetsReceived), ne(t, \"audioReceivePacketsLost\", e.packetsLost)) : (ne(t, \"videoReceiveBytes\", e.bytesReceived), ne(t, \"videoReceivePacketsLost\", e.packetsLost), ne(t, \"videoReceivePackets\", e.packetsReceived), ne(t, \"videoReceiveFrameRate\", e.googFrameRateReceived), ne(t, \"videoReceiveDecodeFrameRate\", e.googFrameRateDecoded), ne(t, \"videoReceiveResolutionWidth\", e.googFrameWidthReceived), ne(t, \"videoReceiveResolutionHeight\", e.googFrameHeightReceived))));\n              }), t;\n            }(e) : function (e) {\n              var t = {};\n              return e.forEach(function (e) {\n                e.id && (-1 === e.id.indexOf(\"send\") && -1 === e.id.indexOf(\"outbound_rtp\") && -1 === e.id.indexOf(\"OutboundRTP\") || (\"audio\" === e.mediaType ? (ne(t, \"audioSendBytes\", e.bytesSent), ne(t, \"audioSendPackets\", e.packetsSent), ne(t, \"audioSendPacketsLost\", e.packetsLost)) : (ne(t, \"videoSendBytes\", e.bytesSent), ne(t, \"videoSendPackets\", e.packetsSent), ne(t, \"videoSendPacketsLost\", e.packetsLost), ne(t, \"videoSendFrameRate\", e.googFrameRateSent), ne(t, \"videoSendResolutionWidth\", e.googFrameWidthSent), ne(t, \"videoSendResolutionHeight\", e.googFrameHeightSent))));\n              }), t;\n            }(e);\n            return n(a);\n          }, e);\n        }).then(function (e) {\n          return t.pc.isSubscriber ? (Object(f.isFireFox)() || Object(f.isSafari)()) && (e.videoReceiveResolutionHeight && \"0\" !== e.videoReceiveResolutionHeight || e.videoReceiveResolutionWidth && \"0\" !== e.videoReceiveResolutionWidth || (ne(e, \"videoReceiveResolutionHeight\", t.videoHeight), ne(e, \"videoReceiveResolutionWidth\", t.videoWidth))) : ((Object(f.isSafari)() || Object(f.isFireFox)()) && (e.videoSendResolutionHeight && \"0\" !== e.videoSendResolutionHeight || e.videoSendResolutionWidth && \"0\" !== e.videoSendResolutionWidth || (ne(e, \"videoSendResolutionHeight\", t.videoHeight), ne(e, \"videoSendResolutionWidth\", t.videoWidth))), (Object(f.isSafari)() || Object(f.isFireFox)()) && t.uplinkStats && ne(e, \"videoSendPacketsLost\", t.uplinkStats.uplink_cumulative_lost)), Promise.resolve(e);\n        });\n      }, t.getAudioLevel = function () {\n        if (t.audioLevelHelper) return t.audioLevelHelper.getAudioLevel();\n\n        if (t.stream) {\n          if (0 !== t.stream.getAudioTracks().length) return t.audioLevelHelper = new te.a(t.stream), t.audioLevelHelper.getAudioLevel();\n          r.default.warning(\"[\".concat(t.streamId, \"] can't get audioLevel beacuse no audio trace in stream\"));\n        } else r.default.warning(\"[\".concat(t.streamId, \"] can't get audioLevel beacuse no stream exist\"));\n      }, t.setVideoProfile(\"480P\"), t._switchVideoDevice = function (e, n, i) {\n        if (e === t.cameraId) return n && n();\n        var a = {\n          video: S()({}, t.videoConstraint, {\n            deviceId: {\n              exact: e\n            }\n          }),\n          audio: !1\n        };\n        r.default.debug(\"[\".concat(t.streamId, \"] \").concat(a)), ee(a, function (a) {\n          try {\n            var r = function () {\n              t.isPlaying() && (t.stop(), t.elementID && t.play(t.elementID, t.playOptions)), t.cameraId = e, t.videoConstraint.deviceId = {\n                exact: e\n              }, t.userMuteVideo && (t.stream.getVideoTracks()[0].enabled = !1), n && n();\n            };\n\n            Object(f.isSafari)() ? t.replaceTrack(a.getVideoTracks()[0], r, i) : (t.removeTrack(t.stream.getVideoTracks()[0]), t.addTrack(a.getVideoTracks()[0]), r());\n          } catch (e) {\n            return i && i(e);\n          }\n        }, function (e) {\n          return i && i(e);\n        });\n      }, t._switchAudioDevice = function (e, n, i) {\n        if (e === t.microphoneId) return n && n();\n        var a = {\n          video: !1,\n          audio: S()({}, t.audioConstraint, {\n            deviceId: {\n              exact: e\n            }\n          })\n        };\n        r.default.debug(\"[\".concat(t.streamId, \"] \"), a), ee(a, function (a) {\n          var r = function () {\n            t._cleanupAudioMixing(), t.userMuteAudio && (t.stream.getAudioTracks()[0].enabled = !1), t.isPlaying() && (t.stop(), t.elementID && t.play(t.elementID)), t.microphoneId = e, t.audioConstraint.deviceId = {\n              exact: e\n            }, n && n();\n          };\n\n          try {\n            Object(f.isSafari)() ? t.replaceTrack(a.getAudioTracks()[0], r, i) : (t.removeTrack(t.stream.getAudioTracks()[0]), t.addTrack(a.getAudioTracks()[0]), r());\n          } catch (e) {\n            return i && i(e);\n          }\n        }, function (e) {\n          return i && i(e);\n        });\n      }, t.switchDevice = function (e, n, i, a) {\n        var s = o.b.reportApiInvoke(t.sid, {\n          callback: function (e, t) {\n            if (e) return a && a(e);\n            i && i(t);\n          },\n          name: \"Stream.switchDevice\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        ce(n, \"deviceId\");\n\n        var c = function () {\n          return t.inSwitchDevice = !1, s();\n        },\n            d = function (e) {\n          t.inSwitchDevice = !1, r.default.error(\"[\".concat(t.streamId, \"] \"), e), s(e);\n        };\n\n        if (t.inSwitchDevice) return s(\"Device switch is in process.\");\n        if (t.inSwitchDevice = !0, !t.local) return d(\"Only the local stream can switch the device.\");\n        if (t.screen && \"video\" === e) return d(\"The device cannot be switched during screen-sharing.\");\n        if (t.videoSource || t.audioSource) return d(\"The device cannot be switched when using videoSource or audioSource.\");\n        if (t.lowStream) return d(\"The device cannot be switched when using lowstream.\");\n        var u = !1;\n\n        for (var l in t.audioMixing.sounds) {\n          if (t.audioMixing.sounds[l].state !== t.audioMixing.states.IDLE) {\n            u = !0;\n            break;\n          }\n        }\n\n        if (t.audioMixing.audioContextInited && u) return d(\"The device cannot be switched when using audio Mixing.\");\n        ie.getDeviceById(n, function () {\n          if (\"video\" === e) t._switchVideoDevice(n, c, d);else {\n            if (\"audio\" !== e) return d(\"Invalid type.\");\n\n            t._switchAudioDevice(n, c, d);\n          }\n        }, function () {\n          return d(\"The device does not exist.\");\n        });\n      }, t;\n    },\n        Ae = n(15),\n        Ce = [\"live\", \"rtc\", \"web\", \"interop\", \"h264_interop\", \"web-only\"],\n        Oe = [\"vp8\", \"h264\"],\n        Ne = [\"aes-128-xts\", \"aes-256-xts\", \"aes-128-ecb\"],\n        we = n(16),\n        De = n.n(we),\n        ke = function (e) {\n      e && e.apply(this, [].slice.call(arguments, 1));\n    },\n        Le = n(7),\n        Me = function (e) {\n      var t = s(e);\n      t.needReconnect = !0, t.isTimeout = !1, t.isInit = !0, t.sendbytes = 0, t.recvbytes = 0, t.startTime = Date.now(), t.lastMsgTime = null, t.clientId = e.clientId, t.hostIndex = 0, t.requestID = 0, e.host instanceof Array ? t.host = e.host : t.host = [e.host], t.getSendBytes = function () {\n        return t.sendbytes;\n      }, t.getRecvBytes = function () {\n        return t.recvbytes;\n      }, t.getDuration = function () {\n        return Math.ceil((Date.now() - t.startTime) / 1e3);\n      }, t.getURL = function () {\n        return t.connection.url;\n      }, t.reconnect = function () {\n        t.isInit = !0, t.creatConnection();\n      }, t.connectNext = function () {\n        t.isInit = !0, ++t.hostIndex, r.default.debug(\"[\" + t.clientId + \"] Gateway length:\" + t.host.length + \" current index:\" + t.hostIndex), t.hostIndex >= t.host.length ? t.dispatchEvent(l({\n          type: \"recover\"\n        })) : t.creatConnection();\n      }, t.replaceHost = function (e) {\n        t.host = e || t.host, t.hostIndex = 0, t.creatConnection();\n      }, t.creatConnection = function () {\n        if (t.needReconnect = !0, r.default.debug(\"[\" + t.clientId + \"] start connect:\" + t.host[t.hostIndex]), t.lts = new Date().getTime(), t.connection = new WebSocket(\"wss://\" + t.host[t.hostIndex]), t.connection.binaryType = \"arraybuffer\", t.turnConfig = {}, t.connection.url) {\n          var n = t.connection.url.match(/wss\\:\\/\\/([^:]+):(\\d+)/);\n          if (n) t.turnConfig.url = n[1], Object(a.getParameter)(\"TURN_ENABLE_TCP\") && (t.turnConfig.tcpport = parseInt(n[2]) + 30), Object(a.getParameter)(\"TURN_ENABLE_UDP\") && (t.turnConfig.udpport = parseInt(n[2]) + 30);else {\n            var i = t.host[t.hostIndex].split(\":\");\n            t.turnConfig.url = i[0], Object(a.getParameter)(\"TURN_ENABLE_TCP\") && (t.turnConfig.tcpport = parseInt(i[1]) + 30), Object(a.getParameter)(\"TURN_ENABLE_UDP\") && (t.turnConfig.udpport = parseInt(i[1]) + 30);\n          }\n        }\n\n        t.connection.onopen = function (e) {\n          r.default.debug(\"[\" + t.clientId + \"] websockect opened: \" + t.host[t.hostIndex]), t.needReconnect = !0, t.isTimeout = !1, t.isInit = !1, t.sendbytes = 0, t.recvbytes = 0, t.startTime = Date.now(), Object(Le.d)(), clearTimeout(t.timeoutCheck), t.dispatchEvent(l({\n            type: \"onopen\",\n            event: e,\n            socket: t\n          }));\n        }, t.connection.onmessage = function (e) {\n          if (e.data instanceof ArrayBuffer) t.dispatchEvent({\n            type: \"onBinaryData\",\n            data: e.data\n          });else {\n            t.recvbytes += Object(te.d)(e.data);\n            var n = JSON.parse(e.data);\n            t.lastMsgTime = Date.now(), n.hasOwnProperty(\"_id\") ? t.dispatchEvent(l({\n              type: n._id,\n              msg: n\n            })) : n.hasOwnProperty(\"_type\") && t.dispatchSocketEvent(l({\n              type: n._type,\n              msg: n._message\n            }));\n          }\n        }, t.connection.onclose = function (n) {\n          t.needReconnect ? t.isTimeout || t.isInit ? (r.default.debug(\"[\" + t.clientId + \"] websockect connect timeout\"), o.b.joinGateway(e.sid, {\n            lts: t.lts,\n            succ: !1,\n            ec: \"timeout\",\n            addr: t.connection.url\n          }), t.connectNext()) : t.dispatchEvent(l({\n            type: \"disconnect\",\n            event: n\n          })) : (r.default.debug(\"[\" + t.clientId + \"] websockect closeed\"), ke(e.onFailure, n), clearTimeout(t.timeoutCheck), t.dispatchEvent(l({\n            type: \"close\",\n            event: n\n          })), t.connection.onopen = void 0, t.connection.onclose = void 0, t.connection.onerror = void 0, t.connection.onmessage = void 0, t.connection = void 0);\n        }, t.connection.onerror = function (e) {}, setTimeout(function () {\n          t.connection && t.connection.readyState != WebSocket.OPEN && (t.isTimeout = !0, t.connection.close());\n        }, 5e3);\n      }, t.creatConnection(), t.sendMessage = function (e, n) {\n        if (t.connection && t.connection.readyState == WebSocket.OPEN) {\n          var i = JSON.stringify(e);\n          t.sendbytes += Object(te.d)(i), t.connection.send(i);\n        } else n({\n          error: \"Gateway not connected\"\n        });\n      }, t.disconnect = function () {\n        t.needReconnect = !0, t.connection.close();\n      }, t.close = function () {\n        t.needReconnect = !1, t.connection.onclose = void 0, t.connection.close();\n      }, t.sendSignalCommand = function (e, n) {\n        e._id = \"_request_\" + t.requestID, t.requestID += 1, \"publish_stats\" !== e._type && \"subscribe_stats\" !== e._type && \"publish_stats_low\" !== e._type && t.on(e._id, function (i) {\n          i.msg && n && n(i.msg._result, i.msg.message), delete t.dispatcher.eventListeners[e._id];\n        }), t.sendMessage(e, function (e) {\n          e.reason = \"NOT_CONNECTED\", n && n(e.reason, e);\n        });\n      }, t.requests = [];\n\n      var n = function (e) {\n        var n = t.requests.findIndex(function (t) {\n          return t.id === e.type;\n        });\n        if (n >= 0) var i = t.requests.splice(n, 1)[0];\n        i && t.dispatcher.eventListeners[e.type] ? (delete t.dispatcher.eventListeners[e.type], e.msg && i.callback && i.callback(e.msg._result, e.msg._message)) : r.default.warning(\"Detached Response\", e.type, e.msg);\n      };\n\n      return t.sendRequest = function (e, i) {\n        e = S()({\n          _id: \"_request_\" + t.requestID\n        }, e), t.requestID += 1;\n        var a = {\n          id: e._id,\n          timeoutCounter: 0,\n          stalledAt: Date.now(),\n          message: e,\n          callback: i\n        };\n        t.requests.push(a), t.addEventListener(e._id, n), t.sendMessage(e, function (e) {\n          var n = this,\n              i = t.requests.findIndex(function (e) {\n            return e.id === n.id;\n          });\n          i >= 0 && (n = t.requests.splice(i, 1)[0]), n && t.dispatcher.eventListeners[e.type] ? (delete t.dispatcher.eventListeners[e.type], e.reason = \"NOT_CONNECTED\", n.callback && n.callback(e.reason, e)) : r.default.warning(\"handleSendError\", n);\n        }.bind(a));\n      }, t.checkRequestTimeout = function () {\n        for (var e = Math.ceil(Object(a.getParameter)(\"SIGNAL_REQUEST_TIMEOUT\") / Object(a.getParameter)(\"SIGNAL_REQUEST_WATCH_INTERVAL\")), n = t.requests.length - 1; n >= 0; n--) {\n          var i = t.requests[n];\n          i.timeoutCounter >= e ? (t.requests.splice(n, 1), r.default.error(\"Request Timeout\", i.timeoutCounter, i.message), i.callback && i.callback(\"TIMEOUT\")) : i.timeoutCounter++;\n        }\n      }, clearInterval(t.requestTimer), t.requestTimer = setInterval(t.checkRequestTimeout, Object(a.getParameter)(\"SIGNAL_REQUEST_WATCH_INTERVAL\")), t.sendReport = function (e) {\n        t.sendMessage(e, function () {});\n      }, t;\n    },\n        Pe = function (e, t) {\n      var n = {\n        connect: function () {\n          t.host = e, n.signal = Me(t), n.on = n.signal.on, n.dispatchEvent = n.signal.dispatchEvent, n.signal.on(\"onopen\", function (e) {\n            n.signal.onEvent = function (e) {\n              n.dispatchEvent(l({\n                type: e.event,\n                msg: e\n              }));\n            }, n.dispatchEvent(l({\n              type: \"connect\",\n              msg: e\n            }));\n          }), n.signal.on(\"onError\", function (e) {\n            var t = e.msg;\n            onError(t.code, \"error\");\n          });\n        },\n        getLastMsgTime: function () {\n          return n.signal && n.signal.lastMsgTime;\n        },\n        getSendBytes: function () {\n          return n.signal.getSendBytes();\n        },\n        getRecvBytes: function () {\n          return n.signal.getRecvBytes();\n        },\n        getDuration: function () {\n          return n.signal.getDuration();\n        },\n        disconnect: function () {\n          n.signal.disconnect();\n        },\n        close: function () {\n          n.signal.close();\n        },\n        getURL: function () {\n          return n.signal.getURL();\n        },\n        reconnect: function () {\n          n.signal.reconnect();\n        },\n        connectNext: function () {\n          n.signal.connectNext();\n        },\n        replaceHost: function (e) {\n          n.signal.replaceHost(e);\n        },\n        emitSimpleMessage: function (e, t) {\n          n.signal.sendSignalCommand(e, t);\n        },\n        emitRequest: function (e, t) {\n          n.signal.sendRequest(e, t);\n        },\n        emitReport: function (e) {\n          n.signal.sendReport(e);\n        }\n      };\n      return n.connect(), n;\n    },\n        xe = n(5),\n        Ue = n.n(xe),\n        Ve = n(9),\n        Fe = n.n(Ve),\n        je = function (e, t) {\n      var n = !1,\n          i = 0,\n          s = {\n        command: \"convergeAllocateEdge\",\n        sid: e.sid,\n        appId: e.appId,\n        token: e.token,\n        uid: e.uid,\n        cname: e.cname,\n        ts: Math.floor(Date.now() / 1e3),\n        version: a.VERSION,\n        seq: 0,\n        requestId: 1\n      };\n      Object(a.getParameter)(\"PROXY_CS\").map(function (c) {\n        var d = new Date().getTime();\n        Be(\"https://\" + c + \"/api/v1\", s, function (s, u) {\n          if (s) return r.default.debug(\"[\" + e.clientId + \"] Request proxy server failed: \", s), i++, o.b.requestProxyAppCenter(e.sid, {\n            lts: d,\n            succ: !1,\n            APAddr: c,\n            workerManagerList: null,\n            ec: JSON.stringify(s),\n            response: JSON.stringify({\n              err: s,\n              res: u\n            })\n          }), void (i >= Object(a.getParameter)(\"PROXY_CS\").length && t && t(\"Get proxy server failed: request all failed\"));\n          if (!n) if ((u = JSON.parse(u)).json_body) {\n            var l = JSON.parse(u.json_body);\n\n            if (r.default.debug(\"[\" + e.clientId + \"] App return:\", l.servers), 200 !== l.code) {\n              s = \"Get proxy server failed: response code [\" + l.code + \"], reason [ \" + l.reason + \"]\";\n              r.default.debug(\"[\" + e.clientId + \"] \" + s), o.b.requestProxyAppCenter(e.sid, {\n                lts: d,\n                succ: !1,\n                APAddr: c,\n                workerManagerList: null,\n                ec: s,\n                response: JSON.stringify({\n                  err: s,\n                  res: u\n                })\n              });\n            } else {\n              n = !0;\n              var p = He(l.servers);\n              o.b.requestProxyAppCenter(e.sid, {\n                lts: d,\n                succ: !0,\n                APAddr: c,\n                workerManagerList: JSON.stringify(p),\n                ec: null,\n                response: JSON.stringify({\n                  res: u\n                })\n              }), t && t(null, p);\n            }\n          } else r.default.debug(\"[\" + e.clientId + \"] Get proxy server failed: no json_body\"), o.b.requestProxyAppCenter(e.sid, {\n            lts: d,\n            succ: !1,\n            APAddr: c,\n            workerManagerList: null,\n            ec: \"Get proxy server failed: no json_body\",\n            response: JSON.stringify({\n              res: u\n            })\n          });\n        });\n      });\n    },\n        Be = function (e, t, n) {\n      var i = {\n        service_name: \"webrtc_proxy\",\n        json_body: JSON.stringify(t)\n      };\n      Object(Le.c)(e, i, function (e) {\n        n && n(null, e);\n      }, function (e) {\n        n && n(e);\n      }, {\n        \"X-Packet-Service-Type\": 0,\n        \"X-Packet-URI\": 61\n      });\n    },\n        We = function (e, t, n) {\n      var i = !1,\n          a = 0,\n          s = {\n        command: \"request\",\n        gatewayType: \"http\",\n        appId: e.appId,\n        cname: e.cname,\n        uid: e.uid + \"\",\n        sdkVersion: \"2.3.1\",\n        sid: e.sid,\n        seq: 1,\n        ts: +new Date(),\n        requestId: 3,\n        clientRequest: {\n          appId: e.appId,\n          cname: e.cname,\n          uid: e.uid + \"\",\n          sid: e.sid\n        }\n      };\n      t.map(function (c) {\n        var d = new Date().getTime();\n        !function (e, t, n) {\n          Object(Le.c)(e, t, function (e) {\n            n && n(null, e);\n          }, function (e) {\n            n && n(e);\n          });\n        }(\"https://\" + c + \":4000/v2/machine\", s, function (s, u) {\n          if (s) return r.default.debug(\"[\" + e.clientId + \"] Request worker manager failed: \", s), a++, o.b.requestProxyWorkerManager(e.sid, {\n            lts: d,\n            succ: !1,\n            workerManagerAddr: c,\n            ec: JSON.stringify(s),\n            response: JSON.stringify({\n              res: u\n            })\n          }), void (a >= t.length && n && n(\"requeet worker manager server failed: request failed\"));\n\n          if (!i) {\n            if (!(u = JSON.parse(u)).serverResponse) return n && n(\"requeet worker manager server failed: serverResponse is undefined\");\n            i = !0, o.b.requestProxyWorkerManager(e.sid, {\n              lts: d,\n              succ: !0,\n              workerManagerAddr: c,\n              ec: JSON.stringify(s),\n              response: JSON.stringify({\n                res: u\n              })\n            }), n && n(null, {\n              address: c,\n              serverResponse: u.serverResponse\n            });\n          }\n        });\n      });\n    },\n        He = function (e) {\n      if (!e || [] instanceof Array == !1) return [];\n      var t = [];\n      return e.forEach(function (e) {\n        var n;\n        e.address && e.tcp ? (e.address.match(/^[\\.\\:\\d]+$/) ? n = \"\".concat(e.address.replace(/[^\\d]/g, \"-\"), \".edge.agora.io\") : (r.default.info(\"[\" + joinInfo.clientId + \"] \" + \"Cannot recognized as IP address \".concat(e.address, \". Used As Host instead\")), n = \"\".concat(e.address, \":\").concat(e.tcp)), t.push(n)) : r.default.error(\"[\" + joinInfo.clientId + \"] Invalid address format \", e);\n      }), t;\n    },\n        Ge = function (e, t) {\n      var n = S()({}, e),\n          i = Object(a.getParameter)(\"CDS_AP\"),\n          r = [],\n          o = !1;\n      (i = i.map(function (e) {\n        return n.proxyServer ? \"https://\".concat(n.proxyServer, \"/ap/?url=\").concat(e + \"/api/v1\") : \"https://\".concat(e, \"/api/v1?action=config\");\n      })).map(function (e) {\n        !function (e, t, n) {\n          var i = {\n            flag: 64,\n            cipher_method: 0,\n            timeout: 1e3,\n            features: t\n          };\n          Object(Le.c)(e, i, function (e) {\n            try {\n              var t = JSON.parse(e);\n              n && n(null, t);\n            } catch (e) {\n              n && n(e);\n            }\n\n            n && n(null, e);\n          }, function (e) {\n            n && n(e);\n          }, {\n            \"X-Packet-Service-Type\": 0,\n            \"X-Packet-URI\": 54\n          });\n        }(e, n, function (e, n) {\n          o || (e ? (r.push(e), r.length >= i.length && t && t(\"ALL_REQUEST_FAILED\")) : (o = !0, t && t(null, n)));\n        });\n      });\n    },\n        qe = {},\n        Je = {},\n        Ye = function (e, t, n, i) {\n      var a = new Date().getTime(),\n          s = t,\n          c = \"\";\n      t.multiIP && t.multiIP.gateway_ip && (c = {\n        vocs_ip: [t.multiIP.uni_lbs_ip],\n        vos_ip: [t.multiIP.gateway_ip]\n      });\n      var d = {\n        opid: 133,\n        flag: 4096,\n        ts: +new Date(),\n        key: t.token,\n        cname: t.cname,\n        sid: t.sid,\n        detail: {},\n        uid: t.uid || 0\n      };\n      c && (d.detail[5] = JSON.stringify(c)), Object(Le.c)(e + \"\".concat(-1 === e.indexOf(\"?\") ? \"?\" : \"&\", \"action=wrtc_gateway\"), d, function (c) {\n        try {\n          var d = JSON.parse(c);\n          d.res && (d = d.res);\n          var u = d.code;\n        } catch (e) {\n          var l = \"requestChooseServer failed with unexpected body \" + c;\n          return r.default.error(\"[\" + s.clientId + \"]\", l), i(l);\n        }\n\n        if (u) {\n          var p = _[d.code] || u;\n          return o.b.joinChooseServer(t.sid, {\n            lts: a,\n            succ: !1,\n            csAddr: e,\n            serverList: null,\n            ec: p\n          }), i(\"Get server node failed [\" + p + \"]\", e, p);\n        }\n\n        var f = [],\n            m = [\".agora.io\", \".agoraio.cn\"],\n            g = 0;\n\n        if (e.indexOf(m[1]) > -1 && (g = 1), d.addresses.forEach(function (e) {\n          var t;\n          e.ip && e.port ? (e.ip.match(/^[\\.\\:\\d]+$/) ? t = \"\".concat(e.ip.replace(/[^\\d]/g, \"-\"), \".edge\").concat(m[g++ % m.length], \":\").concat(e.port) : (r.default.info(\"[\" + s.clientId + \"] \" + \"Cannot recognized as IP address \".concat(e.ip, \". Used As Host instead\")), t = \"\".concat(e.ip, \":\").concat(e.port)), f.push(t)) : r.default.error(\"[\" + s.clientId + \"] Invalid address format \", e);\n        }), !f.length) {\n          r.default.error(\"[\" + s.clientId + \"] Empty Address response\", d);\n          p = \"EMPTY_ADDRESS_RESPONSE\";\n          return o.b.joinChooseServer(t.sid, {\n            lts: a,\n            succ: !1,\n            csAddr: e,\n            serverList: null,\n            ec: p\n          }), i(\"Get server node failed [\" + p + \"]\", e, p);\n        }\n\n        var v = {\n          gateway_addr: f,\n          uid: d.uid,\n          cid: d.cid,\n          vid: d.detail && d.detail[8],\n          res: d,\n          uni_lbs_ip: d.detail\n        };\n        return n(v, e);\n      }, function (e, n) {\n        \"timeout\" === e.type ? (o.b.joinChooseServer(t.sid, {\n          lts: a,\n          succ: !1,\n          csAddr: n,\n          serverList: null,\n          ec: \"timeout\"\n        }), i(\"Connect choose server timeout\", n)) : o.b.joinChooseServer(t.sid, {\n          lts: a,\n          succ: !1,\n          csAddr: n,\n          serverList: null,\n          ec: \"server_wrong\"\n        });\n      }, {\n        \"X-Packet-Service-Type\": 0,\n        \"X-Packet-URI\": 69\n      });\n    },\n        ze = function (e, t, n) {\n      var i = !1,\n          s = null,\n          c = 1,\n          d = 1,\n          u = null,\n          l = e.clientId,\n          p = function t(n, d) {\n        if (!i) {\n          var p = !1,\n              m = !1,\n              g = [],\n              v = f.getBrowserInfo() || {};\n          Ge({\n            device: v.name,\n            system: v.os,\n            vendor: e.appId,\n            version: a.VERSION,\n            cname: e.cname,\n            sid: e.sid,\n            session_id: Object(o.a)(),\n            detail: \"\",\n            proxyServer: n\n          }, function (t, n) {\n            m = !0;\n\n            try {\n              var i = Object.keys(n.test_tags)[0],\n                  a = JSON.parse(n.test_tags[i]);\n              u = a[1];\n            } catch (e) {\n              u = null;\n            }\n\n            o.b.reportApiInvoke(e.sid, {\n              name: \"_config-distribute-request\",\n              options: {\n                err: t,\n                res: n\n              }\n            })(), Je[l] !== ot.DISCONNECTED && Je[l] !== ot.DISCONNECTING ? p && d && d(g, u) : r.default.debug(\"[\".concat(e.clientId, \"] Request config success when connection state is \").concat(Je[l]));\n          }), function (e, t, n) {\n            for (var i = new Date().getTime(), s = !1, c = !0, d = function (n, a) {\n              if (s) o.b.joinChooseServer(e.sid, {\n                lts: i,\n                succ: !0,\n                csAddr: a,\n                serverList: n.gateway_addr,\n                cid: n.cid + \"\",\n                uid: n.uid + \"\",\n                ec: null\n              }, !1);else {\n                if (clearTimeout(g), s = !0, r.default.debug(\"[\" + e.clientId + \"] Get gateway address:\", n.gateway_addr), e.proxyServer) {\n                  for (var c = n.gateway_addr, d = 0; d < c.length; d++) {\n                    var u = c[d].split(\":\");\n                    n.gateway_addr[d] = e.proxyServer + \"/ws/?h=\" + u[0] + \"&p=\" + u[1];\n                  }\n\n                  r.default.debug(\"[\" + e.clientId + \"] Get gateway address:\", n.gateway_addr);\n                }\n\n                t(n), o.b.joinChooseServer(e.sid, {\n                  lts: i,\n                  succ: !0,\n                  csAddr: a,\n                  serverList: n.gateway_addr,\n                  cid: n.cid + \"\",\n                  uid: n.uid + \"\",\n                  ec: null\n                }, !0);\n              }\n            }, u = function (t, i, a) {\n              c && (r.default.error(\"[\" + e.clientId + \"]\", t, i, a), a && -1 === b.indexOf(a) && (c = !1, n(a)));\n            }, l = Object(a.getParameter)(\"WEBCS_DOMAIN\"), p = 0; p < l.length; ++p) {\n              var f;\n\n              if (\"string\" == typeof l[p]) {\n                var m = l[p];\n                f = e.proxyServer ? \"https://\".concat(e.proxyServer, \"/ap/?url=\").concat(m + \"/api/v1\") : \"https://\".concat(m, \"/api/v1\"), r.default.debug(\"[\" + e.clientId + \"] \" + \"Connect to choose_server: \".concat(f)), Ye(f, e, d, u);\n              } else r.default.error(\"[\" + e.clientId + \"] Invalid Host\", l[p]);\n            }\n\n            var g = setTimeout(function () {\n              if (!s) for (var t = Object(a.getParameter)(\"WEBCS_DOMAIN_BACKUP_LIST\"), n = 0; n < t.length; ++n) if (\"string\" == typeof t[n]) {\n                var i = t[n];\n                f = e.proxyServer ? \"https://\".concat(e.proxyServer, \"/ap/?url=\").concat(i + \"/api/v1\") : \"https://\".concat(i, \"/api/v1\"), r.default.debug(\"[\" + e.clientId + \"] \" + \"Connect to backup_choose_server: \".concat(f)), Ye(f, e, d, u);\n              } else r.default.error(\"[\" + e.clientId + \"] Invalid Host\", t[n]);\n            }, 1e3);\n            setTimeout(function () {\n              !s && c && n();\n            }, Object(a.getParameter)(\"WEBCS_BACKUP_CONNECT_TIMEOUT\"));\n          }(e, function (t) {\n            i = !0, p = !0, g = t, clearTimeout(s), Je[l] !== ot.DISCONNECTED && Je[l] !== ot.DISCONNECTING ? m && d && d(g, u) : r.default.debug(\"[\".concat(e.clientId, \"] Request gateway list success when connection state is \").concat(Je[l]));\n          }, function (i) {\n            i ? r.default.info(\"[\" + e.clientId + \"] Join failed: \" + i) : Je[l] !== ot.DISCONNECTED && Je[l] !== ot.DISCONNECTING ? (r.default.debug(\"[\" + e.clientId + \"] Request gateway list will be restart in \" + c + \"s\"), s = setTimeout(function () {\n              t(n, d);\n            }, 1e3 * c), qe[l] = s, c = c >= 3600 ? 3600 : 2 * c) : r.default.debug(\"[\".concat(e.clientId, \"] Request gateway list falied when connection state is \").concat(Je[l]));\n          });\n        }\n      };\n\n      e.useProxyServer ? function n() {\n        !function (e, t) {\n          je(e, function (n, i) {\n            if (n) return t && t(n);\n            r.default.debug(\"[\" + e.clientId + \"] getProxyServerList: \", i), We(e, i, t);\n          });\n        }(e, function (i, a) {\n          if (i) return r.default.debug(\"[\" + e.clientId + \"]\", i), r.default.debug(\"[\" + e.clientId + \"] Request proxy will be restart in \" + d + \"s\"), s = setTimeout(function () {\n            n();\n          }, 1e3 * d), qe[l] = s, void (d = d >= 3600 ? 3600 : 2 * d);\n          clearTimeout(s);\n          var c = a.address;\n          e.proxyServer = c, e.turnServer = {\n            mode: \"manual\",\n            url: a.address,\n            tcpport: a.serverResponse.tcpport || \"3433\",\n            udpport: a.serverResponse.udpport || \"3478\",\n            username: a.serverResponse.username || \"test\",\n            credential: a.serverResponse.password || \"111111\",\n            forceturn: !0\n          }, e.turnServer.tcpport += \"\", e.turnServer.udpport += \"\", o.b.setProxyServer(c), r.default.setProxyServer(c), p(c, t);\n        });\n      }() : p(null, t);\n    },\n        Ke = function (e, t, n, i) {\n      var a = Date.now();\n      i = i || t.stringUid;\n      var s = {\n        sid: t.sid,\n        opid: 10,\n        appid: t.appId,\n        string_uid: i\n      };\n      return new Promise(function (c, d) {\n        Object(Le.c)(e + \"\".concat(-1 === e.indexOf(\"?\") ? \"?\" : \"&\", \"action=stringuid\"), s, function (u) {\n          try {\n            var l = JSON.parse(u),\n                p = l.code;\n          } catch (c) {\n            var f = \"requestUserAccount failed with unexpected body \" + u;\n            return r.default.error(\"[\" + t.clientId + \"]\", f), d({\n              retryable: !0,\n              info: f,\n              url: e\n            }), n && n.dispatchEvent({\n              type: \"error\",\n              reason: \"USER_ACCOUNT_BODY_NOT_JSON\"\n            }), void o.b.reqUserAccount(s.sid, {\n              lts: a,\n              success: !1,\n              serverAddress: e,\n              stringUid: i,\n              uid: null,\n              extend: u,\n              errorCode: \"USER_ACCOUNT_BODY_NOT_JSON\"\n            });\n          }\n\n          if (p) {\n            var m = E[l.code % 1e4] || \"REQ_ACCOUNT_ERR_\".concat(p);\n            return n && n.dispatchEvent({\n              type: \"error\",\n              reason: m\n            }), o.b.reqUserAccount(s.sid, {\n              lts: a,\n              success: !1,\n              serverAddress: e,\n              stringUid: i,\n              uid: null,\n              errorCode: m,\n              extend: s\n            }), d({\n              retryable: !1,\n              info: f = \"Get String Uid Failed [\" + m + \"]\",\n              url: e,\n              error: m\n            });\n          }\n\n          var g = l.uid;\n\n          if (!(g > 0 && g < Math.pow(2, 32))) {\n            r.default.error(\"[\" + t.clientId + \"] \" + \"Invalid Uint Uid \".concat(i, \" => \").concat(g), l);\n            m = \"INVALID_UINT_UID_\".concat(g);\n            return n && n.dispatchEvent({\n              type: \"error\",\n              reason: m\n            }), o.b.reqUserAccount(s.sid, {\n              lts: a,\n              success: !1,\n              serverAddress: e,\n              stringUid: i,\n              uid: null,\n              errorCode: m,\n              extend: s\n            }), d({\n              retryable: !0,\n              error: m,\n              info: \"Get String Uid failed [\" + m + \"]\",\n              url: e\n            });\n          }\n\n          c({\n            uid: g,\n            url: e\n          }), o.b.reqUserAccount(s.sid, {\n            lts: a,\n            success: !0,\n            serverAddress: e,\n            stringUid: i,\n            uid: g,\n            errorCode: null,\n            extend: s\n          });\n        }, function (e, t) {\n          if (\"timeout\" === e.type) {\n            var r = \"USER_ACCOUNT_TIMEOUT\";\n            n && n.dispatchEvent({\n              type: \"error\",\n              reason: r\n            }), o.b.reqUserAccount(s.sid, {\n              lts: a,\n              success: !1,\n              serverAddress: t,\n              stringUid: i,\n              uid: null,\n              errorCode: r,\n              extend: s\n            }), d({\n              retryable: !0,\n              info: r,\n              url: t\n            });\n          } else {\n            var c = \"USER_ACCOUNT_SERVER_WRONG_\".concat(e.type);\n            n && n.dispatchEvent({\n              type: \"error\",\n              reason: c\n            }), o.b.reqUserAccount(s.sid, {\n              lts: a,\n              success: !1,\n              serverAddress: t,\n              stringUid: i,\n              uid: null,\n              errorCode: c,\n              extend: s\n            }), d({\n              retryable: !0,\n              info: c,\n              url: t\n            });\n          }\n        }, {\n          \"X-Packet-Service-Type\": 0,\n          \"X-Packet-URI\": 72\n        });\n      });\n    },\n        Xe = function (e, t, n) {\n      Date.now();\n      var o,\n          s = Object(a.getParameter)(\"ACCOUNT_REGISTER\"),\n          c = !1,\n          d = Object(a.getParameter)(\"ACCOUNT_REGISTER_RETRY_TIMEOUT\"),\n          u = null,\n          l = null,\n          p = new Promise(function () {\n        var p = Fe()(Ue.a.mark(function p(f, m) {\n          var g, v, S;\n          return Ue.a.wrap(function (p) {\n            for (;;) switch (p.prev = p.next) {\n              case 0:\n                u = f, l = m, o = 0;\n\n              case 3:\n                if (!(o < Object(a.getParameter)(\"ACCOUNT_REGISTER_RETRY_COUNT_MAX\"))) {\n                  p.next = 33;\n                  break;\n                }\n\n                if (!c) {\n                  p.next = 6;\n                  break;\n                }\n\n                return p.abrupt(\"return\");\n\n              case 6:\n                return g = s[o % s.length], v = e.proxyServer ? \"https://\".concat(e.proxyServer, \"/ap/?url=\").concat(s[i] + \"/api/v1\") : \"https://\".concat(g, \"/api/v1\"), p.prev = 8, p.delegateYield(Ue.a.mark(function i() {\n                  var a;\n                  return Ue.a.wrap(function (i) {\n                    for (;;) switch (i.prev = i.next) {\n                      case 0:\n                        return i.next = 2, Ke(v, e, t, n);\n\n                      case 2:\n                        if (a = i.sent, !c) {\n                          i.next = 5;\n                          break;\n                        }\n\n                        return i.abrupt(\"return\", {\n                          v: void 0\n                        });\n\n                      case 5:\n                        c = !0, setTimeout(function () {\n                          r.default.debug(\"Get UserAccount Successfully\", a), u(a);\n                        }, 0);\n\n                      case 7:\n                      case \"end\":\n                        return i.stop();\n                    }\n                  }, i, this);\n                })(), \"t0\", 10);\n\n              case 10:\n                if (S = p.t0, \"object\" !== re()(S)) {\n                  p.next = 13;\n                  break;\n                }\n\n                return p.abrupt(\"return\", S.v);\n\n              case 13:\n                p.next = 30;\n                break;\n\n              case 15:\n                if (p.prev = 15, p.t1 = p.catch(8), !c) {\n                  p.next = 19;\n                  break;\n                }\n\n                return p.abrupt(\"return\");\n\n              case 19:\n                if (!p.t1.retryable) {\n                  p.next = 27;\n                  break;\n                }\n\n                return (d = Math.ceil(d * Object(a.getParameter)(\"ACCOUNT_REGISTER_RETRY_RATIO\"))) > Object(a.getParameter)(\"ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX\") && (d = Object(a.getParameter)(\"ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX\")), r.default.error(\"\".concat(p.t1.info, \" \").concat(p.t1.url, \" Will Fetch User Account in \").concat(d / 1e3, \" seconds\")), p.next = 25, new Promise(function (e) {\n                  setTimeout(e, d);\n                });\n\n              case 25:\n                p.next = 30;\n                break;\n\n              case 27:\n                r.default.error(\"Get UserAccount Error: \".concat(p.t1.info, \" \").concat(p.t1.url), p.t1.error), c = !0, l(p.t1);\n\n              case 30:\n                o++, p.next = 3;\n                break;\n\n              case 33:\n              case \"end\":\n                return p.stop();\n            }\n          }, p, this, [[8, 15]]);\n        }));\n        return function (e, t) {\n          return p.apply(this, arguments);\n        };\n      }());\n      return p.cancel = function () {\n        c || (c = !0, l({\n          info: \"Request Cancelled\",\n          retryable: !1\n        }));\n      }, p.isFinished = function () {\n        return c;\n      }, p;\n    },\n        Qe = {\n      ERR_NO_VOCS_AVAILABLE: \"tryNext\",\n      ERR_NO_VOS_AVAILABLE: \"tryNext\",\n      ERR_JOIN_CHANNEL_TIMEOUT: \"tryNext\",\n      WARN_REPEAT_JOIN: \"quit\",\n      ERR_JOIN_BY_MULTI_IP: \"recover\",\n      WARN_LOOKUP_CHANNEL_TIMEOUT: \"tryNext\",\n      WARN_OPEN_CHANNEL_TIMEOUT: \"tryNext\",\n      ERR_VOM_SERVICE_UNAVAILABLE: \"tryNext\",\n      ERR_TOO_MANY_USERS: \"tryNext\",\n      ERR_MASTER_VOCS_UNAVAILABLE: \"tryNext\",\n      ERR_INTERNAL_ERROR: \"tryNext\",\n      K_SERVICE_NOT_READY: \"recover\",\n      notification_test_recover: \"recover\",\n      notification_test_tryNext: \"tryNext\",\n      notification_test_retry: \"retry\"\n    },\n        $e = {\n      googActualEncBitrate: \"A_aeb\",\n      googAvailableSendBandwidth: \"A_asb\",\n      googRetransmitBitrate: \"A_rb\",\n      googAvailableReceiveBandwidth: \"A_arb\",\n      googTargetEncBitrate: \"A_teb\",\n      googBucketDelay: \"A_bd\",\n      googTransmitBitrate: \"A_tb\",\n      googCodecName: \"A_cn\",\n      bytesSent: \"bytesSent\",\n      packetsLost: \"packetsLost\",\n      packetsSent: \"packetsSent\",\n      googAdaptationChanges: \"A_ac\",\n      googAvgEncodeMs: \"A_aem\",\n      googEncodeUsagePercent: \"A_eup\",\n      googFirsReceived: \"A_fr\",\n      googFrameHeightInput: \"A_fhi\",\n      googFrameHeightSent: \"A_fhs\",\n      googFrameRateInput: \"A_fri\",\n      googFrameRateSent: \"A_frs\",\n      googFrameWidthInput: \"A_fwi\",\n      googFrameWidthSent: \"A_fws\",\n      googNacksReceived: \"A_nr\",\n      googPlisReceived: \"A_pr\",\n      googRtt: \"A_rtt\",\n      aecDivergentFilterFraction: \"A_adff\",\n      audioInputLevel: \"A_ail\",\n      googEchoCancellationReturnLoss: \"A_ecrl\",\n      googEchoCancellationReturnLossEnhancement: \"A_ecrle\",\n      googResidualEchoLikelihood: \"A_rel\",\n      googResidualEchoLikelihoodRecentMax: \"A_relrm\",\n      googTargetDelayMs: \"A_tdm\",\n      bytesReceived: \"bytesReceived\",\n      packetsReceived: \"packetsReceived\",\n      googDecodeMs: \"A_dm\",\n      googMaxDecodeMs: \"A_mdm\",\n      googRenderDelayMs: \"A_rdm\",\n      googFrameWidthReceived: \"A_fwr\",\n      googFrameHeightReceived: \"A_fhr\",\n      googFrameRateReceived: \"A_frr\",\n      googFrameRateDecoded: \"A_frd\",\n      googFrameRateOutput: \"A_fro\",\n      googJitterBufferMs: \"A_jbm\",\n      googCurrentDelayMs: \"A_cdm\",\n      googMinPlayoutDelayMs: \"A_mpdm\",\n      googNacksSent: \"A_ns\",\n      googPlisSent: \"A_ps\",\n      googFirsSent: \"A_fs\",\n      audioOutputLevel: \"A_aol\",\n      googAccelerateRate: \"A_ar\",\n      googDecodingCNG: \"A_dcng\",\n      googDecodingCTN: \"A_dctn\",\n      googDecodingCTSG: \"A_dctsg\",\n      googDecodingNormal: \"A_dn\",\n      googDecodingPLC: \"A_dplc\",\n      googDecodingPLCCNG: \"A_dplccng\",\n      googExpandRate: \"A_er\",\n      googJitterReceived: \"A_jr\",\n      googPreemptiveExpandRate: \"A_per\",\n      googPreferredJitterBufferMs: \"A_pjbm\",\n      googSecondaryDecodedRate: \"A_sdr\",\n      googSpeechExpandRate: \"A_ser\",\n      uplink_fraction_lost: \"B_ufl\",\n      uplink_cumulative_lost: \"B_ucl\",\n      uplink_available_bandwidth: \"B_uab\",\n      access_delay: \"B_acd\",\n      uplink_network_quality: \"B_unq\",\n      downlink_network_quality: \"B_dnq\",\n      pub_audio_lost_ratio_400ms: \"B_palr4\",\n      pub_video_lost_ratio_400ms: \"B_pvlr4\",\n      e2e_delay: \"B_ed\",\n      audio_delay: \"B_ad\",\n      video_delay: \"B_vd\",\n      stream_type: \"B_st\",\n      e2e_audio_lost_ratio_400ms: \"B_ealr4\",\n      e2e_video_lost_ratio_400ms: \"B_evlr4\",\n      downlink_estimate_bandwidth: \"B_deb\"\n    },\n        Ze = {};\n\n    for (var et in $e) {\n      var tt = $e[et];\n      Ze[tt] && console.error(\"Key Conflict: \".concat(tt, \": \").concat($e[tt], \"| \").concat(et)), Ze[tt] = et;\n    }\n\n    var nt = function (e) {\n      return $e[e] || e;\n    },\n        it = function (e) {\n      return Ze[e] || e;\n    };\n\n    var at = function e(t) {\n      var n = !1,\n          i = function (e) {\n        return {\n          _type: \"control\",\n          _message: e\n        };\n      },\n          c = function (e, t) {\n        var n = {};\n        return Object.keys(t).forEach(function (e) {\n          Object(a.getParameter)(\"STATS_FILTER\")[e] || (n[nt(e)] = t[e]);\n        }), {\n          _type: \"subscribe_related_stats\",\n          _message: {\n            stream_type: \"high\",\n            stream_id: e,\n            stats: n\n          }\n        };\n      },\n          m = function (e) {\n        return {\n          _type: \"publish\",\n          _message: e\n        };\n      },\n          g = function (e, t) {\n        var n = {};\n        return Object.keys(t).forEach(function (e) {\n          Object(a.getParameter)(\"STATS_FILTER\")[e] || (n[nt(e)] = t[e]);\n        }), {\n          _type: \"subscribe_stats\",\n          _message: {\n            stream_id: e,\n            stats: n\n          }\n        };\n      },\n          v = e.DISCONNECTED,\n          I = e.CONNECTING,\n          h = e.CONNECTED,\n          _ = e.DISCONNECTING,\n          E = v,\n          b = s(t);\n\n      Object.defineProperty(b, \"state\", {\n        set: function (t) {\n          var n = E;\n          E = t, function (e, t) {\n            Je[e] = t;\n          }(b.clientId, t), n !== t && b.dispatchEvent({\n            type: \"connection-state-change\",\n            prevState: e.connetionStateMap[n],\n            curState: e.connetionStateMap[t]\n          });\n        },\n        get: function () {\n          return E;\n        }\n      }), b.socket = void 0, b.state = v, b.mode = t.mode, b.role = t.role, b.codec = t.codec, b.config = {}, b.timers = {}, b.timer_counter = {}, b.localStreams = {}, b.remoteStreams = {}, b.remoteMuteState = {}, b.attemps = 1, b.p2p_attemps = 1, b.audioLevel = {}, b.activeSpeaker = void 0, b.reconnectMode = \"retry\", b.rejoinAttempt = 0, b.hasChangeBGPAddress = !1, b.traffic_stats = {}, b.clientId = t.clientId, b.pingpongCounter = 0, b.hasInvokeLeave = !1, b.p2ps = new Map(), b.liveStreams = new Map(), b.injectLiveStreams = new Map(), b.remoteStreamsInChannel = new Set(), function (e) {\n        var t = ke;\n        e.makeRequest = function (n, i, a) {\n          if (void 0 === e.socket) return r.default.error(\"[\".concat(e.clientId, \"] No socket available\")), void t(a, x.INVALID_OPERATION);\n\n          try {\n            e.socket.emitRequest(n, function (e, t) {\n              var n;\n              \"success\" === e ? \"function\" == typeof i && i(t) : \"function\" == typeof a && (n = t && t.error_code && y[t.error_code] ? y[t.error_code] : t && t.error_str ? t.error_str : t && t.error_code ? \"UNKNOW_ERROR_\".concat(t.error_code) : e, a(n, t));\n            });\n          } catch (i) {\n            r.default.error(\"[\".concat(e.clientId, \"] Socket emit message failed \").concat(JSON.stringify(n))), r.default.error(\"[\".concat(e.clientId, \"] \"), i), t(a, x.SOCKET_ERROR);\n          }\n        }, e.makeReport = function (t) {\n          void 0 === e.socket && r.default.error(\"[\".concat(e.clientId, \"] No socket available\"));\n\n          try {\n            e.socket.emitReport(t);\n          } catch (n) {\n            r.default.error(\"[\".concat(e.clientId, \"] Socket emit report failed \").concat(JSON.stringify(t)));\n          }\n        };\n      }(b), b.inChannelInfo = {\n        joinAt: null,\n        duration: 0\n      }, b._sendMessage = function (e, t) {\n        switch (e) {\n          case \"SubscribeStats\":\n            sendMessage(g.apply(void 0, De()(t)));\n        }\n      };\n      var T = ke;\n      b.p2pCounter = Object(te.f)(1e5), b.generateP2PId = function () {\n        return ++b.p2pCounter;\n      }, b.audioVolumeIndication = {\n        enabled: !1,\n        sortedAudioVolumes: [],\n        smooth: 3,\n        interval: 2e3\n      }, b.remoteVideoStreamTypes = {\n        REMOTE_VIDEO_STREAM_HIGH: 0,\n        REMOTE_VIDEO_STREAM_LOW: 1,\n        REMOTE_VIDEO_STREAM_MEDIUM: 2\n      }, b.streamFallbackTypes = {\n        STREAM_FALLBACK_OPTION_DISABLED: 0,\n        STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW: 1,\n        STREAM_FALLBACK_OPTION_AUDIO_ONLY: 2\n      }, b.configPublisher = function (e) {\n        b.config = e;\n      }, b.getGatewayInfo = function (e, t) {\n        b.makeRequest({\n          _type: \"gateway_info\"\n        }, e, t);\n      }, b.setClientRole = function (e, t) {\n        r.default.debug(\"[\".concat(b.clientId, \"] setClientRole to \").concat(e));\n        var n = o.b.reportApiInvoke(b.joinInfo.sid, {\n          name: \"_setClientRole\",\n          callback: t\n        });\n        b.makeRequest({\n          _type: \"set_client_role\",\n          _message: {\n            role: e\n          }\n        }, function () {\n          b.role = e, b.dispatchEvent({\n            type: \"client-role-changed\",\n            role: e\n          }), n && n(null, {\n            role: e\n          });\n        }, function (t, i) {\n          if (i && i.code && (t = P[i.code] || \"UNKNOW_ERROR_\" + i.code), \"ERR_ALREADY_IN_USE\" === t) return n && n(null);\n          r.default.error(\"set Client role error to \" + e + \": \" + t), n && n(t);\n        });\n      }, b.join = function (e, n, i, s) {\n        e.useProxyServer && (b.hasChangeBGPAddress = !0);\n        var c = new Date().getTime(),\n            d = e.uid;\n        if (b.inChannelInfo.joinAt && (b.inChannelInfo.duration += c - b.inChannelInfo.joinAt), b.inChannelInfo.joinAt = c, b.state !== I) return r.default.error(\"[\".concat(b.clientId, \"] GatewayClient.join Failed: state \"), b.state), s && s(x.INVALID_OPERATION), void o.b.joinGateway(e.sid, {\n          lts: c,\n          succ: !1,\n          ec: x.INVALID_OPERATION,\n          addr: null\n        });\n        if (null != d && parseInt(d) !== d) return r.default.error(\"[\".concat(b.clientId, \"] Input uid is invalid\")), b.state = v, s && s(x.INVALID_PARAMETER), void o.b.joinGateway(e.sid, {\n          lts: c,\n          succ: !1,\n          ec: x.INVALID_PARAMETER,\n          addr: null\n        });\n        var u = rt.register(b, {\n          uid: d,\n          cname: e && e.cname\n        });\n        if (u) return b.state = v, s && s(u), void o.b.joinGateway(e.sid, {\n          lts: c,\n          succ: !1,\n          ec: u,\n          addr: null\n        });\n        b.joinInfo = S()({}, e), b.uid = d, b.key = n, b.pingpongCounter = 0, O(e, function (n) {\n          var d, u, p, f;\n          b.state = h, r.default.debug(\"[\".concat(b.clientId, \"] Connected to gateway server\")), clearInterval(b.pingTimer), b.pingTimer = setInterval(function () {\n            var e = Object(a.getParameter)(\"PING_PONG_TIME_OUT\");\n\n            if (++b.pingpongCounter >= e) {\n              var t = Date.now();\n              r.default.warning(\"PINGPONG Timeout. Last Socket Message: \".concat(t - b.socket.getLastMsgTime(), \"ms\")), b.socket && b.socket.getLastMsgTime() && t - b.socket.getLastMsgTime() > Object(a.getParameter)(\"WEBSOCKET_TIMEOUT_MIN\") && (b.pingpongCounter = 0, b.socket.close(), b.socket.dispatchEvent(l({\n                type: \"disconnect\",\n                event: {\n                  msg: \"PING_PONG_TIME_OUT\"\n                }\n              })));\n            }\n\n            var n = Date.now();\n            b.makeRequest({\n              _type: \"ping\"\n            }, function () {\n              b.pingpongCounter = 0;\n              var e = Date.now() - n;\n              setTimeout(function () {\n                Object(a.getParameter)(\"REPORT_STATS\") && b.makeRequest({\n                  _type: \"ping_back\",\n                  _message: {\n                    pingpongElapse: e\n                  }\n                });\n              }, 1e3);\n            }, function (e, t) {\n              \"TIMEOUT\" !== e && (r.default.error(\"Ping Error \".concat(e, \" \").concat(JSON.stringify(t))), t && t.error_code && b.socket && b.socket.signal && b.socket.signal.connection && b.socket.signal.connection.readyState === WebSocket.OPEN && (r.default.info(\"Disconnecting websocket connection\"), b.socket.signal.connection.close()));\n            });\n          }, 3e3), b.makeRequest((d = {\n            role: b.role\n          }, u = d.role, p = S()({}, b.joinInfo.apResponse), f = {\n            session_id: b.joinInfo.sid,\n            app_id: t.appId,\n            channel_key: b.key,\n            channel_name: b.joinInfo.cname,\n            sdk_version: a.VERSION,\n            browser: navigator.userAgent,\n            process_id: Object(o.a)(),\n            mode: b.mode,\n            codec: b.codec,\n            role: u,\n            has_changed_gateway: Object(a.getParameter)(\"FORCE_CHANGED_GATEWAY_FLAG\") || b.hasChangeBGPAddress,\n            ap_response: p,\n            extend: Object(a.getParameter)(\"JOIN_EXTEND\"),\n            details: {}\n          }, b.joinInfo.hasOwnProperty(\"stringUid\") && (f.string_uid = b.joinInfo.stringUid), b.joinInfo.aesmode && b.joinInfo.aespassword && (f.aes_mode = b.joinInfo.aesmode, f.aes_secret = b.joinInfo.aespassword), b.socket && b.socket.signal && b.socket.signal && (p.addresses[b.socket.signal.hostIndex] && (f.ap_response.ticket = p.addresses[b.socket.signal.hostIndex].ticket, delete p.addresses), b.joinInfo.turnServer && \"auto\" === b.joinInfo.turnServer.mode && b.socket.signal.turnConfig && (b.joinInfo.turnServer.url = b.socket.signal.turnConfig.url, b.socket.signal.turnConfig.tcpport && (b.joinInfo.turnServer.tcpport = \"\" + b.socket.signal.turnConfig.tcpport), b.socket.signal.turnConfig.udpport && (b.joinInfo.turnServer.udpport = \"\" + b.socket.signal.turnConfig.udpport)), r.default.debug(\"Turn config\", b.joinInfo.turnServer)), b.dispatchEvent({\n            type: \"join-message-hook\",\n            joinMessage: f\n          }), {\n            _type: \"join\",\n            _message: f\n          }), function (t) {\n            if (o.b.joinGateway(e.sid, {\n              lts: c,\n              succ: !0,\n              ec: null,\n              vid: e.vid,\n              addr: b.socket.getURL()\n            }), b.rejoinAttempt = 0, i && i(t.uid), b.dispatchEvent({\n              type: \"join\"\n            }), b.leaveOnConnected) {\n              r.default.info(\"[\".concat(b.clientId, \"] Calling Leave() once joined\"));\n              var n = b.leaveOnConnected;\n              b.leaveOnConnected = null, b.leave(n.onSuccess, n.onFailure);\n            }\n          }, function (t, n) {\n            if (r.default.error(\"[\".concat(b.clientId, \"] User join failed [\").concat(t, \"]\")), \"ERR_JOIN_BY_MULTI_IP\" === t) return b.dispatchEvent({\n              type: \"onMultiIP\",\n              option: n.option\n            });\n\n            if (Qe[t] && b.rejoinAttempt < 4) {\n              if (b._doWithAction(Qe[t], i, s), b.leaveOnConnected) {\n                r.default.error(\"[\".concat(b.clientId, \"] Calling Leave() once joined: Join Failed\"));\n                var a = b.leaveOnConnected;\n                b.leaveOnConnected = null, a.onFailure(x.JOIN_CHANNEL_FAILED);\n              }\n            } else s && s(t);\n\n            o.b.joinGateway(e.sid, {\n              lts: c,\n              succ: !1,\n              ec: t,\n              addr: b.socket.getURL()\n            });\n          });\n        }, function (t) {\n          r.default.error(\"[\".concat(b.clientId, \"] User join failed [\").concat(t, \"]\")), s && s(t), o.b.joinGateway(e.sid, {\n            lts: c,\n            succ: !1,\n            ec: t,\n            addr: b.socket.getURL()\n          });\n        }), clearInterval(b.timers.trafficStats), b.timers.trafficStats = setInterval(function () {\n          b.makeRequest({\n            _type: \"traffic_stats\"\n          }, function (e) {\n            var t = {};\n\n            for (var n in e) t[it(n)] = e[n];\n\n            if (t.peer_delay && t.peer_delay.length) {\n              var i = [];\n              t.peer_delay.forEach(function (e) {\n                var t = {};\n\n                for (var n in e) t[it(n)] = e[n];\n\n                i.push(t);\n              }), t.peer_delay = i;\n            }\n\n            b.traffic_stats = t;\n            var a = b.joinInfo.stringUid,\n                r = b.localStreams[d] || b.localStreams[a];\n            r && (r.traffic_stats = {\n              access_delay: t.access_delay\n            }), t.peer_delay && t.peer_delay.forEach(function (e) {\n              var n = b.remoteStreams[e.peer_uid];\n              n && (n.traffic_stats = {\n                access_delay: t.access_delay,\n                e2e_delay: e.e2e_delay,\n                audio_delay: e.audio_delay,\n                video_delay: e.video_delay\n              });\n            }), b.dispatchEvent({\n              type: \"after-getTrafficStats\",\n              trafficStats: t\n            });\n          });\n        }, 3e3), this.remoteMuteState = {}, b.resetAudioVolumeIndication();\n      }, b.leave = function (e, t) {\n        switch (b.state) {\n          case v:\n            return r.default.debug(\"[\".concat(b.clientId, \"] Client Already in DISCONNECTED status\")), void T(e);\n\n          case _:\n            return r.default.error(\"[\".concat(b.clientId, \"] Client Already in DISCONNECTING status\")), void T(t, x.INVALID_OPERATION);\n\n          case I:\n            if (b.leaveOnConnected) return r.default.error(\"[\".concat(b.clientId, \"] Client.leave() already called\")), void T(t, x.INVALID_OPERATION);\n            if (1 == b.reconnectingCS) return;\n            return r.default.debug(\"[\".concat(b.clientId, \"] Client connecting. Waiting for Client Fully Connected(And leave)\")), void (b.leaveOnConnected = {\n              onSuccess: e,\n              onFailure: t\n            });\n        }\n\n        var n = rt.unregister(b);\n        if (n) r.default.error(\"[\".concat(b.clientId, \"] \"), n);else {\n          for (var i in b.state = _, clearInterval(b.pingTimer), b.timers) b.timers.hasOwnProperty(i) && clearInterval(b.timers[i]);\n\n          for (var i in b.inChannelInfo.joinAt && (b.inChannelInfo.duration += Date.now() - b.inChannelInfo.joinAt, b.inChannelInfo.joinAt = null), b.makeRequest({\n            _type: \"leave\"\n          }, function (t) {\n            b.socket.close(), b.socket = void 0, r.default.info(\"[\".concat(b.clientId, \"] Leave channel success\")), b.state = v, e && e(t);\n          }, function (e) {\n            r.default.error(\"[\".concat(b.clientId, \"] Leave Channel Failed\"), e), b.state = h, t && t(e);\n          }), b.localStreams) if (b.localStreams.hasOwnProperty(i)) {\n            var a = b.localStreams[i];\n            delete b.localStreams[i], void 0 !== a.pc && (a.pc.close(), a.pc = void 0);\n          }\n\n          D();\n        }\n      }, b.publish = function (e, t, n, s) {\n        var c = new Date().getTime(),\n            d = !1;\n        if (e.publishLTS = c, \"object\" !== re()(e) || null === e) return r.default.error(\"[\".concat(b.clientId, \"] Invalid local stream\")), s && s(x.INVALID_LOCAL_STREAM), void o.b.publish(b.joinInfo.sid, {\n          lts: c,\n          succ: !1,\n          audioName: e.hasAudio() && e.audioName,\n          videoName: e.hasVideo() && e.videoName,\n          screenName: e.hasScreen() && e.screenName,\n          ec: x.INVALID_LOCAL_STREAM\n        });\n        if (!e.stream && void 0 === e.url) return r.default.error(\"[\".concat(b.clientId, \"] Invalid local media stream\")), s && s(x.INVALID_LOCAL_STREAM), void o.b.publish(b.joinInfo.sid, {\n          lts: c,\n          succ: !1,\n          audioName: e.hasAudio() && e.audioName,\n          videoName: e.hasVideo() && e.videoName,\n          screenName: e.hasScreen() && e.screenName,\n          ec: x.INVALID_LOCAL_STREAM\n        });\n        if (b.state !== h) return r.default.error(\"[\".concat(b.clientId, \"] User is not in the session\")), s && s(x.INVALID_OPERATION), void o.b.publish(b.joinInfo.sid, {\n          lts: c,\n          succ: !1,\n          audioName: e.hasAudio() && e.audioName,\n          videoName: e.hasVideo() && e.videoName,\n          screenName: e.hasScreen() && e.screenName,\n          ec: x.INVALID_OPERATION\n        });\n        var l = e.getAttributes() || {};\n\n        if (e.local && void 0 === b.localStreams[e.getId()] && (e.hasAudio() || e.hasVideo() || e.hasScreen())) {\n          var p = b.generateP2PId();\n          if (b.p2ps.set(p, e), e.p2pId = p, void 0 !== e.url) N(m({\n            state: \"url\",\n            audio: e.hasAudio(),\n            video: e.hasVideo(),\n            attributes: e.getAttributes(),\n            mode: b.mode\n          }, e.url), function (t, n) {\n            \"success\" === t ? (e.getUserId() !== n && e.setUserId(n), b.localStreams[n] = e, e.onClose = function () {\n              b.unpublish(e);\n            }) : r.default.error(\"[\".concat(b.clientId, \"] Publish local stream failed\"), t);\n          });else {\n            b.localStreams[e.getId()] = e, e.connectionSpec = {\n              callback: function (l) {\n                r.default.debug(\"[\".concat(b.clientId, \"] SDP exchange in publish : send offer --  \"), JSON.parse(l)), b.makeRequest(m({\n                  state: \"offer\",\n                  stream_type: 1 == t.streamType ? \"low\" : \"high\",\n                  p2p_id: p,\n                  sdp: l,\n                  audio: e.audio,\n                  video: e.screen || e.video,\n                  screen: e.screen,\n                  attributes: e.getAttributes(),\n                  dtx: e.DTX,\n                  hq: e.highQuality,\n                  lq: e.lowQuality,\n                  stereo: e.stereo,\n                  speech: e.speech,\n                  mode: b.mode,\n                  codec: b.codec,\n                  extend: Object(a.getParameter)(\"PUB_EXTEND\")\n                }), function (t) {\n                  e.getUserId() !== t.uid && e.setUserId(t.uid), r.default.info(\"[\".concat(b.clientId, \"] Local stream published with uid\"), t.uid), e.onClose = function () {\n                    b.unpublish(e);\n                  }, e._onAudioUnmute = function () {\n                    b.makeReport(i({\n                      action: \"unmute_local_audio\",\n                      stream_id: e.getId()\n                    }));\n                  }, e._onVideoUnmute = function () {\n                    b.makeReport(i({\n                      action: \"unmute_local_video\",\n                      stream_id: e.getId()\n                    }));\n                  }, e._onAudioMute = function () {\n                    b.makeReport(i({\n                      action: \"mute_local_audio\",\n                      stream_id: e.getId()\n                    }));\n                  }, e._onVideoMute = function () {\n                    b.makeReport(i({\n                      action: \"mute_local_video\",\n                      stream_id: e.getId()\n                    }));\n                  }, e.getId() === e.getUserId() && (e.isAudioOn() || e.hasAudio() && (r.default.debug(\"[\".concat(b.clientId, \"] local stream audio mute\")), e._onAudioMute()), e.isVideoOn() || (e.hasVideo() || e.hasScreen()) && (r.default.debug(\"[\".concat(b.clientId, \"] local stream video mute\")), e._onVideoMute())), e.pc.oniceconnectionstatechange = function (t) {\n                    if (\"failed\" === t) {\n                      if (null != b.timers[e.getId()] && (clearInterval(b.timers[e.getId()]), clearInterval(b.timers[e.getId()] + \"_RelatedStats\")), r.default.error(\"[\".concat(b.clientId, \"] Publisher connection is lost -- streamId: \").concat(e.getId(), \", p2pId: \").concat(p)), b.p2ps.delete(p), r.default.debug(\"[\".concat(b.clientId, \"] publish p2p failed: \"), b.p2ps), !d) return d = !0, o.b.publish(b.joinInfo.sid, {\n                        lts: c,\n                        succ: !1,\n                        audioName: e.hasAudio() && e.audioName,\n                        videoName: e.hasVideo() && e.videoName,\n                        screenName: e.hasScreen() && e.screenName,\n                        ec: x.PEERCONNECTION_FAILED\n                      }), b.dispatchEvent(u({\n                        type: \"pubP2PLost\",\n                        stream: e\n                      })), s && s(x.PEERCONNECTION_FAILED);\n                      b.dispatchEvent(u({\n                        type: \"pubP2PLost\",\n                        stream: e\n                      }));\n                    } else if (\"connected\" === t && (r.default.debug(\"[\".concat(b.clientId, \"] publish p2p connected: \"), b.p2ps), e._isAudioMuted() ? b.makeReport(i({\n                      action: \"mute_local_audio\",\n                      stream_id: e.getId()\n                    })) : b.makeReport(i({\n                      action: \"unmute_local_audio\",\n                      stream_id: e.getId()\n                    })), e._isVideoMuted() ? b.makeReport(i({\n                      action: \"mute_local_video\",\n                      stream_id: e.getId()\n                    })) : b.makeReport(i({\n                      action: \"unmute_local_video\",\n                      stream_id: e.getId()\n                    })), !d)) return d = !0, o.b.publish(b.joinInfo.sid, {\n                      lts: c,\n                      succ: !0,\n                      audioName: e.hasAudio() && e.audioName,\n                      videoName: e.hasVideo() && e.videoName,\n                      screenName: e.hasScreen() && e.screenName,\n                      ec: null\n                    }), n && n();\n                  }, r.default.debug(\"[\".concat(b.clientId, \"] SDP exchange in publish : receive answer --  \"), JSON.parse(t.sdp)), e.pc.processSignalingMessage(t.sdp);\n                }, function (t, n) {\n                  r.default.error(\"Publish Failed: \".concat(t)), o.b.publish(b.joinInfo.sid, {\n                    lts: c,\n                    succ: !0,\n                    audioName: e.hasAudio() && e.audioName,\n                    videoName: e.hasVideo() && e.videoName,\n                    screenName: e.hasScreen() && e.screenName,\n                    ec: t\n                  }), \"TIMEOUT\" != t && (b.processPublishFailure(e), s && s(t));\n                });\n              },\n              audio: e.hasAudio(),\n              video: e.hasVideo(),\n              screen: e.hasScreen(),\n              isSubscriber: !1,\n              stunServerUrl: b.stunServerUrl,\n              turnServer: b.joinInfo.turnServer,\n              maxAudioBW: l.maxAudioBW,\n              minVideoBW: l.minVideoBW,\n              maxVideoBW: l.maxVideoBW,\n              mode: b.mode,\n              codec: b.codec,\n              isVideoMute: e.userMuteVideo || e.peerMuteVideo,\n              isAudioMute: e.userMuteAudio || e.peerMuteAudio,\n              maxFrameRate: e.attributes.maxFrameRate,\n              clientId: b.clientId\n            }, e.pc = Z(e.connectionSpec), e.pc.addStream(e.stream), r.default.debug(\"[\".concat(b.clientId, \"] PeerConnection add stream :\"), e.stream), e.pc.onnegotiationneeded = function (n) {\n              var i = {\n                state: \"negotiation\",\n                stream_type: 1 === t.streamType ? \"low\" : \"high\",\n                p2p_id: p,\n                sdp: n\n              };\n              b.makeRequest(m(i), function (t) {\n                r.default.debug(\"Negotating Stream \".concat(e.getId())), e.pc.processSignalingMessage(t.sdp);\n              }, function (e, t) {\n                r.default.error(\"Negotiation failed \".concat(e), t, i);\n              });\n            }, clearInterval(b.timers[e.getId()]), b.timers[e.getId()] = setInterval(function () {\n              if (Object(a.getParameter)(\"REPORT_STATS\")) {\n                var t = 0;\n                e && e.pc && e.pc.getStats && e.pc.getStatsRate(function (n) {\n                  n.forEach(function (n) {\n                    if (n && n.id && !/_recv$/.test(n.id) && !/^time$/.test(n.id) && e.getUserId()) if (-1 === n.id.indexOf(\"outbound_rtp\") && -1 === n.id.indexOf(\"OutboundRTP\") || \"video\" !== n.mediaType || (n.googFrameWidthSent = e.videoWidth + \"\", n.googFrameHeightSent = e.videoHeight + \"\"), e.getId() == e.getUserId()) {\n                      var i = 200 * t;\n                      t++, setTimeout(function () {\n                        var e = b.socket && b.socket.getLastMsgTime() && Date.now() - b.socket.getLastMsgTime();\n                        e > Object(a.getParameter)(\"REPORT_STATS_TIMEOUT\") ? r.default.debug(\"PublishStats report blocked by REPORT_STATS_TIMEOUT \".concat(e)) : b.makeReport(function (e) {\n                          var t = {};\n                          return Object.keys(e).forEach(function (n) {\n                            Object(a.getParameter)(\"STATS_FILTER\")[n] || (t[nt(n)] = e[n]);\n                          }), {\n                            _type: \"publish_stats\",\n                            _message: {\n                              stream_type: \"high\",\n                              stats: t\n                            }\n                          };\n                        }(n));\n                      }, i);\n                    } else {\n                      i = 200 * t;\n                      t++, setTimeout(function () {\n                        var e = b.socket && b.socket.getLastMsgTime() && Date.now() - b.socket.getLastMsgTime();\n                        e > Object(a.getParameter)(\"REPORT_STATS_TIMEOUT\") ? r.default.debug(\"PublishStatsLow report blocked by REPORT_STATS_TIMEOUT \".concat(e)) : b.makeReport(function (e) {\n                          var t = {};\n                          return Object.keys(e).forEach(function (n) {\n                            Object(a.getParameter)(\"STATS_FILTER\")[n] || (t[nt(n)] = e[n]);\n                          }), {\n                            _type: \"publish_stats\",\n                            _message: {\n                              stream_type: \"low\",\n                              stats: t\n                            }\n                          };\n                        }(n));\n                      }, i);\n                    }\n                  });\n                });\n              }\n            }, 3e3);\n\n            var f = function () {\n              Object(a.getParameter)(\"REPORT_STATS\") && e && e.pc && e.pc.getVideoRelatedStats && e.pc.getVideoRelatedStats(function (t) {\n                var n,\n                    i,\n                    o = b.socket && b.socket.getLastMsgTime() && Date.now() - b.socket.getLastMsgTime();\n                o > Object(a.getParameter)(\"REPORT_STATS_TIMEOUT\") ? r.default.debug(\"PublishRelatedStats report blocked by REPORT_STATS_TIMEOUT \".concat(o)) : e.getId() === e.getUserId() ? b.makeReport((n = t, i = {}, Object.keys(n).forEach(function (e) {\n                  Object(a.getParameter)(\"STATS_FILTER\")[e] || (i[nt(e)] = n[e]);\n                }), {\n                  _type: \"publish_related_stats\",\n                  _message: {\n                    stream_type: \"high\",\n                    stats: i\n                  }\n                })) : b.makeReport(function (e) {\n                  var t = {};\n                  return Object.keys(e).forEach(function (n) {\n                    Object(a.getParameter)(\"STATS_FILTER\")[n] || (t[nt(n)] = e[n]);\n                  }), {\n                    _type: \"publish_related_stats\",\n                    _message: {\n                      stream_type: \"low\",\n                      stats: t\n                    }\n                  };\n                }(t));\n              });\n            };\n\n            f(), clearInterval(b.timers[e.getId() + \"_RelatedStats\"]), b.timers[e.getId() + \"_RelatedStats\"] = setInterval(f, 1e3);\n          }\n        }\n      }, b.unpublish = function (e, t, n, i) {\n        if (\"object\" !== re()(e) || null === e) return r.default.error(\"[\".concat(b.clientId, \"] Invalid local stream\")), void T(i, x.INVALID_LOCAL_STREAM);\n        if (b.state !== h) return r.default.error(\"[\".concat(b.clientId, \"] User not in the session\")), void T(i, x.INVALID_OPERATION);\n        if (null != b.timers[e.getId()] && (clearInterval(b.timers[e.getId()]), clearInterval(b.timers[e.getId() + \"_RelatedStats\"])), void 0 !== b.socket) {\n          if (e.local && void 0 !== b.localStreams[e.getId()]) {\n            delete b.localStreams[e.getId()];\n            var a = {\n              stream_id: e.getUserId(),\n              stream_type: 1 === t.streamType ? \"low\" : \"high\"\n            };\n            b.makeRequest({\n              _type: \"unpublish\",\n              _message: a\n            }), (e.hasAudio() || e.hasVideo() || e.hasScreen()) && void 0 === e.url && void 0 !== e.pc && (e.pc.close(), e.pc = void 0), e.onClose = void 0, e._onAudioMute = void 0, e._onAudioUnute = void 0, e._onVideoMute = void 0, e._onVideoUnmute = void 0, b.p2ps.delete(e.p2pId), b.dispatchEvent({\n              type: \"stream-unpublished\",\n              stream: e,\n              options: t\n            }), n && n();\n          } else r.default.error(\"[\".concat(b.clientId, \"] Invalid local stream\")), T(i, x.INVALID_LOCAL_STREAM);\n        } else r.default.error(\"[\".concat(b.clientId, \"] User not in the session\")), T(i, x.INVALID_OPERATION);\n      }, b.subscribe = function (e, t, n) {\n        var s = new Date().getTime();\n        e.subscribeLTS = s;\n        var l = !1;\n        if (r.default.info(\"[\".concat(b.clientId, \"] Gatewayclient \").concat(b.uid, \" Subscribe \").concat(e.getId(), \": \").concat(JSON.stringify(e.subscribeOptions))), \"object\" !== re()(e) || null === e) return r.default.error(\"[\".concat(b.clientId, \"] Invalid remote stream\")), n && n(x.INVALID_REMOTE_STREAM), void o.b.subscribe(b.joinInfo.sid, {\n          lts: s,\n          succ: !1,\n          video: e.subscribeOptions && e.subscribeOptions.video,\n          audio: e.subscribeOptions && e.subscribeOptions.audio,\n          peerid: e.getId(),\n          ec: x.INVALID_REMOTE_STREAM\n        });\n        if (b.state !== h && (r.default.error(\"[\".concat(b.clientId, \"] User is not in the session\")), !l)) return l = !0, o.b.subscribe(b.joinInfo.sid, {\n          lts: s,\n          succ: !1,\n          video: e.subscribeOptions && e.subscribeOptions.video,\n          audio: e.subscribeOptions && e.subscribeOptions.audio,\n          peerid: e.getId(),\n          ec: x.INVALID_OPERATION\n        }), n && n(x.INVALID_OPERATION);\n        if (!e.local && b.remoteStreams.hasOwnProperty(e.getId())) {\n          if (e.hasAudio() || e.hasVideo() || e.hasScreen()) {\n            var p = b.generateP2PId();\n            b.p2ps.set(p, e), e.p2pId = p, e.pc = Z({\n              callback: function (t) {\n                r.default.debug(\"[\".concat(b.clientId, \"] SDP exchange in subscribe : send offer --  \"), JSON.parse(t));\n                var i = {\n                  stream_id: e.getId(),\n                  audio: !e.subscribeOptions || e.subscribeOptions.audio,\n                  video: !e.subscribeOptions || e.subscribeOptions.video,\n                  mode: b.mode,\n                  codec: b.codec,\n                  p2p_id: p,\n                  sdp: t,\n                  tcc: Object(a.getParameter)(\"SUBSCRIBE_TCC\"),\n                  extend: Object(a.getParameter)(\"SUB_EXTEND\")\n                };\n                b.makeRequest({\n                  _type: \"subscribe\",\n                  _message: i\n                }, function (t) {\n                  r.default.debug(\"[\".concat(b.clientId, \"] SDP exchange in subscribe : receive answer --  \"), JSON.parse(t.sdp)), e.pc.processSignalingMessage(t.sdp);\n                }, function (t, i) {\n                  r.default.error(\"[\".concat(b.clientId, \"] Subscribe remote stream Failed: \").concat(t, \", closing stream \"), e.getId(), i), o.b.subscribe(b.joinInfo.sid, {\n                    lts: s,\n                    succ: !1,\n                    video: e.subscribeOptions && e.subscribeOptions.video,\n                    audio: e.subscribeOptions && e.subscribeOptions.audio,\n                    peerid: e.getId(),\n                    ec: t\n                  }), \"TIMEOUT\" != err && (b.processSubscribeFailure(e), n && n(t));\n                });\n              },\n              nop2p: !0,\n              audio: !0,\n              video: !0,\n              screen: e.hasScreen(),\n              isSubscriber: !0,\n              stunServerUrl: b.stunServerUrl,\n              turnServer: b.joinInfo.turnServer,\n              isVideoMute: e.userMuteVideo,\n              isAudioMute: e.userMuteAudio,\n              uid: e.getId(),\n              clientId: b.clientId\n            }), e.pc.onaddstream = function (t, n) {\n              if (e._onAudioUnmute = function () {\n                b.makeRequest(i({\n                  action: \"unmute_remote_audio\",\n                  stream_id: e.getId()\n                }), function () {}, function () {});\n              }, e._onAudioMute = function () {\n                b.makeRequest(i({\n                  action: \"mute_remote_audio\",\n                  stream_id: e.getId()\n                }), function () {}, function () {});\n              }, e._onVideoUnmute = function () {\n                b.makeRequest(i({\n                  action: \"unmute_remote_video\",\n                  stream_id: e.getId()\n                }), function () {}, function () {});\n              }, e._onVideoMute = function () {\n                b.makeRequest(i({\n                  action: \"mute_remote_video\",\n                  stream_id: e.getId()\n                }), function () {}, function () {});\n              }, \"ontrack\" === n && \"video\" === t.track.kind || \"onaddstream\" === n) {\n                r.default.info(\"[\".concat(b.clientId, \"] Remote stream subscribed with uid \"), e.getId());\n                var a = b.remoteStreams[e.getId()];\n\n                if (b.remoteStreams[e.getId()].stream = \"onaddstream\" === n ? t.stream : t.streams[0], b.remoteStreams[e.getId()].hasVideo()) {\n                  if (Object(f.isFireFox)() || Object(f.isSafari)()) {\n                    var o = b.remoteStreams[e.getId()].stream;\n                    Object(te.g)(o, function (t, n) {\n                      e.videoWidth = t, e.videoHeight = n;\n                    }, function (e) {\n                      return r.default.warning(\"[\".concat(b.clientId, \"] vsResHack failed: \") + e);\n                    });\n                  }\n                } else {\n                  var s = b.remoteStreams[e.getId()];\n                  s.peerMuteVideo = !0, b._adjustPCMuteStatus(s);\n                }\n\n                a && a.isPlaying() && a.elementID && (r.default.debug(\"[\".concat(b.clientId, \"] Reload Player \").concat(a.elementID, \" StreamId \").concat(a.getId())), e.audioOutput = a.audioOutput, a.stop(), e.play(a.elementID, a.playOptions)), delete e.audioLevelHelper;\n                var c = d({\n                  type: \"stream-subscribed\",\n                  stream: b.remoteStreams[e.getId()]\n                });\n                b.dispatchEvent(c);\n              }\n            }, clearInterval(b.timers[e.getId()]), b.timers[e.getId()] = setInterval(function () {\n              if (Object(a.getParameter)(\"REPORT_STATS\")) {\n                var t = 0;\n                e && e.pc && e.pc.getStats && e.pc.getStatsRate(function (n) {\n                  n.forEach(function (n) {\n                    if (n && n.id) {\n                      if (/_send$/.test(n.id) || /^time$/.test(n.id) || /^bweforvideo$/.test(n.id)) return;\n                      -1 === n.id.indexOf(\"inbound_rtp\") && -1 === n.id.indexOf(\"inbound-rtp\") || \"video\" !== n.mediaType || (n.googFrameWidthReceived = e.videoWidth + \"\", n.googFrameHeightReceived = e.videoHeight + \"\");\n                      var i = 200 * t;\n                      t++;\n                      var o = e.getId();\n                      setTimeout(function () {\n                        var e = b.socket && b.socket.getLastMsgTime() && Date.now() - b.socket.getLastMsgTime();\n                        e > Object(a.getParameter)(\"REPORT_STATS_TIMEOUT\") ? r.default.debug(\"SubscribeStats report blocked by REPORT_STATS_TIMEOUT \".concat(e)) : b.makeReport(g(o, n));\n                      }, i);\n                    } else ;\n                  });\n                });\n              }\n            }, 3e3), clearInterval(b.timers[e.getId() + \"_RelatedStats\"]), b.timers[e.getId() + \"_RelatedStats\"] = setInterval(function () {\n              if (Object(a.getParameter)(\"REPORT_STATS\") && e && e.pc) {\n                var t = b.socket && b.socket.getLastMsgTime() && Date.now() - b.socket.getLastMsgTime();\n                if (t > Object(a.getParameter)(\"REPORT_STATS_TIMEOUT\")) return void r.default.debug(\"SubscribeRelatedStats report blocked by REPORT_STATS_TIMEOUT \".concat(t));\n                e.pc.getVideoRelatedStats && e.pc.getVideoRelatedStats(function (t) {\n                  b.makeReport(c(e.getId(), t));\n                }), e.pc.getAudioRelatedStats && e.pc.getAudioRelatedStats(function (t) {\n                  b.makeReport(c(e.getId(), t));\n                });\n              }\n            }, 1e3), b.audioLevel[e.getId()] = 0, clearInterval(b.timers[e.getId() + \"audio\"]), b.timers[e.getId() + \"audio\"] = setInterval(function () {\n              b.hasListeners(\"active-speaker\") && e && e.pc && \"established\" === e.pc.state && e.pc.getStats && e.pc.getStats(function (t) {\n                t.forEach(function (t) {\n                  if (\"audio\" === t.mediaType) {\n                    if (t.audioOutputLevel > 5e3) for (var n in b.audioLevel[e.getId()] < 20 && (b.audioLevel[e.getId()] += 1), b.audioLevel) n !== \"\" + e.getId() && b.audioLevel[n] > 0 && (b.audioLevel[n] -= 1);\n                    var i = Object.keys(b.audioLevel).sort(function (e, t) {\n                      return b.audioLevel[t] - b.audioLevel[e];\n                    });\n\n                    if (b.activeSpeaker !== i[0]) {\n                      var a = u({\n                        type: \"active-speaker\",\n                        uid: i[0]\n                      });\n                      b.dispatchEvent(a), b.activeSpeaker = i[0], r.default.debug(\"[\".concat(b.clientId, \"] Update active speaker: \").concat(b.activeSpeaker));\n                    }\n                  }\n                });\n              }, 50);\n            }, 50), e.pc.oniceconnectionstatechange = function (i) {\n              if (\"failed\" === i) null != b.timers[e.getId()] && (clearInterval(b.timers[e.getId()]), clearInterval(b.timers[e.getId()] + \"audio\")), r.default.error(\"[\".concat(b.clientId, \"] Subscriber connection is lost -- streamId: \").concat(e.getId(), \", p2pId: \").concat(p)), r.default.debug(\"[\".concat(b.clientId, \"] subscribe p2p failed: \"), b.p2ps), l || (l = !0, n && n(x.PEERCONNECTION_FAILED), o.b.subscribe(b.joinInfo.sid, {\n                lts: s,\n                succ: !1,\n                video: e.subscribeOptions && e.subscribeOptions.video,\n                audio: e.subscribeOptions && e.subscribeOptions.audio,\n                peerid: e.getId(),\n                ec: x.PEERCONNECTION_FAILED\n              })), b.remoteStreams[e.getId()] && b.p2ps.has(p) && (b.p2ps.delete(p), b.dispatchEvent(u({\n                type: \"subP2PLost\",\n                stream: e\n              })));else if (\"connected\" === i && (r.default.debug(\"[\".concat(b.clientId, \"] subscribe p2p connected: \"), b.p2ps), !l)) {\n                l = !0, o.b.subscribe(b.joinInfo.sid, {\n                  lts: s,\n                  succ: !0,\n                  video: e.subscribeOptions && e.subscribeOptions.video,\n                  audio: e.subscribeOptions && e.subscribeOptions.audio,\n                  peerid: e.getId(),\n                  ec: null\n                }), b._adjustPCMuteStatus(e);\n                var a = !1,\n                    c = setInterval(function () {\n                  e.pc ? e.pc.getStats(function (t) {\n                    t.forEach(function (t) {\n                      -1 !== t.id.indexOf(\"recv\") && \"audio\" === t.mediaType && parseInt(t.googDecodingNormal) > 0 && (a || (a = !0, b.dispatchEvent({\n                        type: \"first-audio-frame-decode\",\n                        stream: e\n                      }), clearInterval(c), o.b.reportApiInvoke(b.joinInfo.sid, {\n                        name: \"firstAudioDecode\"\n                      })(null, {\n                        elapse: Date.now() - e.subscribeLTS\n                      })));\n                    });\n                  }, 100) : clearInterval(c);\n                }, 100),\n                    d = !1,\n                    f = setInterval(function () {\n                  e.pc ? e.pc.getStats(function (t) {\n                    t.forEach(function (t) {\n                      -1 === t.id.indexOf(\"recv\") && -1 === t.id.indexOf(\"inbound_rtp\") && -1 === t.id.indexOf(\"inbound-rtp\") && -1 === t.id.indexOf(\"InboundRTP\") || \"video\" === t.mediaType && (t.framesDecoded > 0 || t.googFramesDecoded > 0) && (d || (d = !0, b.dispatchEvent({\n                        type: \"first-video-frame-decode\",\n                        stream: e\n                      }), clearInterval(f), e.firstFrameTime = new Date().getTime() - e.subscribeLTS, o.b.firstRemoteFrame(b.joinInfo.sid, {\n                        lts: new Date().getTime(),\n                        peerid: e.getId(),\n                        succ: !0,\n                        width: +t.googFrameWidthReceived,\n                        height: +t.googFrameHeightReceived\n                      })));\n                    });\n                  }, 100) : clearInterval(f);\n                }, 100);\n                return e.sid = b.joinInfo.sid, t && t();\n              }\n            };\n          } else r.default.error(\"[\".concat(b.clientId, \"] Invalid remote stream\")), l || (l = !0, n && n(x.INVALID_REMOTE_STREAM), o.b.subscribe(b.joinInfo.sid, {\n            lts: s,\n            succ: !1,\n            video: e.subscribeOptions && e.subscribeOptions.video,\n            audio: e.subscribeOptions && e.subscribeOptions.audio,\n            peerid: e.getId(),\n            ec: x.INVALID_REMOTE_STREAM\n          }));\n        } else r.default.error(\"[\".concat(b.clientId, \"] No such remote stream\")), l || (l = !0, n && n(x.NO_SUCH_REMOTE_STREAM), o.b.subscribe(b.joinInfo.sid, {\n          lts: s,\n          succ: !1,\n          video: e.subscribeOptions && e.subscribeOptions.video,\n          audio: e.subscribeOptions && e.subscribeOptions.audio,\n          peerid: e.getId(),\n          ec: x.NO_SUCH_REMOTE_STREAM\n        }));\n      }, b.subscribeChange = function (e, t, n) {\n        var i = Date.now();\n        r.default.info(\"[\".concat(b.clientId, \"] Gatewayclient \").concat(b.uid, \" SubscribeChange \").concat(e.getId(), \": \").concat(JSON.stringify(e.subscribeOptions))), b._adjustPCMuteStatus(e);\n        var a = {\n          stream_id: e.getId(),\n          audio: e.subscribeOptions.audio,\n          video: e.subscribeOptions.video\n        };\n        b.makeRequest({\n          _type: \"subscribe_change\",\n          _message: a\n        }, function (n) {\n          var a = d({\n            type: \"stream-subscribe-changed\",\n            stream: b.remoteStreams[e.getId()]\n          });\n          o.b.subscribe(b.joinInfo.sid, {\n            lts: i,\n            succ: !0,\n            video: e.subscribeOptions && e.subscribeOptions.video,\n            audio: e.subscribeOptions && e.subscribeOptions.audio,\n            peerid: e.getId(),\n            ec: null\n          }), b.dispatchEvent(a), t && t();\n        }, function (t, i) {\n          r.default.error(\"[\".concat(b.clientId, \"] Subscribe Change Failed \").concat(e.getId()), t, i), n && n(t, i);\n        });\n      }, b.processPublishFailure = function (e) {\n        e.publishLTS = null, e.p2pId && b.p2ps.get(e.p2pId) === e && b.p2ps.delete(e.p2pId), b.localStreams[e.getUserId()] === e && delete b.localStreams[e.getUserId()], b.localStreams[e.getId()] === e && delete b.localStreams[e.getId()], e.pc && (e.pc.processSignalingMessage = function () {}, e.pc.oniceconnectionstatechange = function () {}, e.pc.close(), delete e.pc), delete e.onClose, delete e._onAudioUnmute, delete e._onVideoUnmute, delete e._onAudioMute, delete e._onVideoMute, delete e._onAudioUnmute;\n      }, b.processSubscribeFailure = function (e) {\n        e.p2pId && b.p2ps.get(e.p2pId) === e && b.p2ps.delete(e.p2pId), b.remoteStreams[e.getId()] === e && delete b.remoteStreams[e.getId()], b.remoteStreams[e.getId()] === e && delete b.remoteStreams[e.getId()], e.pc && (e.pc.onaddstream = function () {}, e.pc.processSignalingMessage = function () {}, e.pc.oniceconnectionstatechange = function () {}, e.pc.close(), delete e.pc), delete e.onClose, delete e._onAudioUnmute, delete e._onVideoUnmute, delete e._onAudioMute, delete e._onVideoMute, delete e._onAudioUnmute;\n      }, b._adjustPCMuteStatus = function (e) {\n        !e.local && e.pc && e.pc.peerConnection.getReceivers && e.pc.peerConnection.getReceivers().forEach(function (t) {\n          if (t && t.track && \"audio\" === t.track.kind) {\n            var n = !e.userMuteAudio && !e.peerMuteAudio;\n            e.subscribeOptions && !e.subscribeOptions.audio && (n = !1), t.track.enabled = !!n;\n          } else if (t && t.track && \"video\" === t.track.kind) {\n            var i = !e.userMuteVideo && !e.peerMuteVideo;\n            e.subscribeOptions && !e.subscribeOptions.video && (i = !1), t.track.enabled = !!i;\n          }\n        });\n      }, b.unsubscribe = function (e, t, n) {\n        if (\"object\" !== re()(e) || null === e) return r.default.error(\"[\".concat(b.clientId, \"] Invalid remote stream\")), void T(n, x.INVALID_REMOTE_STREAM);\n        if (b.state !== h) return r.default.error(\"[\".concat(b.clientId, \"] User is not in the session\")), void T(n, x.INVALID_OPERATION);\n\n        if (null != b.timers[e.getId()] && (clearInterval(b.timers[e.getId()]), clearInterval(b.timers[e.getId()] + \"audio\")), null != b.audioLevel[e.getId()] && delete b.audioLevel[e.getId()], null != b.timer_counter[e.getId()] && delete b.timer_counter[e.getId()], b.remoteStreams.hasOwnProperty(e.getId())) {\n          if (!b.socket) return r.default.error(\"[\".concat(b.clientId, \"] User is not in the session\")), void T(n, x.INVALID_OPERATION);\n          if (e.local) return r.default.error(\"[\".concat(b.clientId, \"] Invalid remote stream\")), void T(n, x.INVALID_REMOTE_STREAM);\n          e.close();\n          var i = {\n            stream_id: e.getId()\n          };\n          b.makeRequest({\n            _type: \"unsubscribe\",\n            _message: i\n          }), void 0 !== e.pc && (e.pc.close(), e.pc = void 0), e.onClose = void 0, e._onAudioMute = void 0, e._onAudioUnute = void 0, e._onVideoMute = void 0, e._onVideoUnmute = void 0, delete e.subscribeOptions, b.p2ps.delete(e.p2pId), r.default.info(\"[\".concat(b.clientId, \"] Unsubscribe stream success\")), t && t();\n        } else T(n, x.NO_SUCH_REMOTE_STREAM);\n      }, b.setRemoteVideoStreamType = function (e, t) {\n        if (r.default.debug(\"[\".concat(b.clientId, \"] Switching remote video stream \").concat(e.getId(), \" to \").concat(t)), \"object\" === re()(e) && null !== e) {\n          if (b.state === h) {\n            if (!e.local) {\n              switch (t) {\n                case b.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:\n                case b.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:\n                case b.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:\n                  break;\n\n                default:\n                  return;\n              }\n\n              var n = {\n                stream_id: e.getId(),\n                stream_type: t\n              };\n              b.makeRequest({\n                _type: \"switch_video_stream\",\n                _message: n\n              }, function () {\n                r.default.debug(\"SwitchVideoStream Success \".concat(n.stream_id, \" \").concat(n.stream_type));\n              }, function (e, t) {\n                r.default.error(\"SwitchVideoStream Error \".concat(e, \" \").concat(n.stream_id, \" \").concat(n.stream_type), t);\n              });\n            }\n          } else r.default.error(\"[\".concat(b.clientId, \"] User is not in the session\"));\n        } else r.default.error(\"[\".concat(b.clientId, \"] Invalid remote stream\"));\n      }, b.renewToken = function (e, t, n) {\n        e ? b.key ? b.state !== h ? (r.default.debug(\"[\".concat(b.clientId, \"] Client is not connected. Trying to rejoin\")), b.key = e, b.rejoin(), t && t()) : (r.default.debug(\"[\".concat(b.clientId, \"] renewToken from \").concat(b.key, \" to \").concat(e)), b.makeRequest({\n          _type: \"renew_token\",\n          _message: {\n            token: e\n          }\n        }, t, n)) : (r.default.error(\"[\".concat(b.clientId, \"] Client is previously joined without token\")), n && n(x.INVALID_PARAMETER)) : (r.default.error(\"[\".concat(b.clientId, \"] Invalid Token \").concat(e)), n && n(x.INVALID_PARAMETER));\n      }, b.setStreamFallbackOption = function (e, t) {\n        if (r.default.debug(\"[\".concat(b.clientId, \"] Set stream fallback option \").concat(e.getId(), \" to \").concat(t)), \"object\" === re()(e) && null !== e) {\n          if (b.state === h) {\n            if (!e.local) {\n              switch (t) {\n                case b.streamFallbackTypes.STREAM_FALLBACK_OPTION_DISABLED:\n                case b.streamFallbackTypes.STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:\n                case b.streamFallbackTypes.STREAM_FALLBACK_OPTION_AUDIO_ONLY:\n                  break;\n\n                default:\n                  return;\n              }\n\n              var n = {\n                stream_id: e.getId(),\n                fallback_type: t\n              };\n              b.makeRequest({\n                _type: \"set_fallback_option\",\n                _message: n\n              }, function () {\n                r.default.debug(\"SetStreamFallbackOption success \".concat(n.stream_id, \" \").concat(t));\n              }, function (e, i) {\n                r.default.error(\"Failed to SetStreamFallbackOption \".concat(n.stream_id, \" \").concat(t, \" \").concat(e), i);\n              });\n            }\n          } else r.default.error(\"[\".concat(b.clientId, \"] User is not in the session\"));\n        } else r.default.error(\"[\".concat(b.clientId, \"] Invalid remote stream\"));\n      }, b.enableAudioVolumeIndicator = function (e, t) {\n        b.audioVolumeIndication.enabled = !0, b.audioVolumeIndication.interval = e, b.audioVolumeIndication.smooth = t, b.resetAudioVolumeIndication();\n      }, b.resetAudioVolumeIndication = function () {\n        if (clearInterval(b.timers.audioVolumeIndication), clearInterval(b.timers.audioVolumeSampling), b.audioVolumeIndication.enabled && b.audioVolumeIndication.interval) {\n          var e = Math.floor(1e3 * b.audioVolumeIndication.smooth / 100);\n          clearInterval(b.timers.audioVolumeSampling), b.timers.audioVolumeSampling = setInterval(function () {\n            b.audioVolumeSampling || (b.audioVolumeSampling = {});\n            var t = {};\n\n            for (var n in b.remoteStreams) {\n              var i = b.remoteStreams[n];\n\n              if (i.stream && i.hasAudio()) {\n                var a = i.getAudioLevel();\n                a > 0 && a < 1 && (a *= 100);\n                var r = b.audioVolumeSampling[n] || [];\n\n                for (r.push(a); r.length > e;) r.shift();\n\n                t[n] = r;\n              }\n            }\n\n            b.audioVolumeSampling = t;\n          }, 100), clearInterval(b.timers.audioVolumeIndication), b.timers.audioVolumeIndication = setInterval(function () {\n            if (b.socket && b.socket.signal && b.socket.signal.connection && b.socket.signal.connection.readyState === WebSocket.OPEN) {\n              var e = [];\n\n              for (var t in b.remoteStreams) if (b.audioVolumeSampling && b.audioVolumeSampling[t]) {\n                var n = b.audioVolumeSampling[t],\n                    i = 0;\n                n.forEach(function (e) {\n                  i += e;\n                });\n                var a = {\n                  uid: t,\n                  level: Math.floor(i / n.length)\n                };\n                a.level && e.push(a);\n              }\n\n              var o = e.sort(function (e, t) {\n                return e.level - t.level;\n              });\n              r.default.debug(\"[\".concat(b.clientId, \"] volume-indicator \"), JSON.stringify(o)), b.audioVolumeIndication.sortedAudioVolumes = o;\n              var s = u({\n                type: \"volume-indicator\",\n                attr: o\n              });\n              b.dispatchEvent(s);\n            }\n          }, b.audioVolumeIndication.interval);\n        }\n      }, b.closeGateway = function () {\n        r.default.debug(\"[\".concat(b.clientId, \"] close gateway\")), b.state = v, b.socket.close(), A();\n      };\n\n      var R = function () {\n        r.default.debug(\"[\".concat(b.clientId, \"] Reconnect gateway\")), b.state = v, b.socket.close(), A(), b.reconnectMode = \"recover\", b.state = I, C();\n      };\n\n      b.recover = R;\n\n      var A = function () {\n        for (var e in b.dispatchEvent({\n          type: \"before-clear-connection\"\n        }), b.timers) b.timers.hasOwnProperty(e) && clearInterval(b.timers[e]);\n\n        for (var e in b.remoteStreams) if (b.remoteStreams.hasOwnProperty(e)) {\n          var t = b.remoteStreams[e],\n              n = u({\n            type: \"stream-removed\",\n            uid: t.getId(),\n            stream: t\n          });\n          b.dispatchEvent(n);\n        }\n\n        b.p2ps.clear(), D(), w(), clearInterval(b.pingTimer);\n      };\n\n      b.rejoin = function () {\n        b.socket && (clearInterval(b.pingTimer), b.socket.close(), b.socket = void 0), b.state = I, C();\n      };\n\n      var C = function (e, t) {\n        b.dispatchEvent(u({\n          type: \"rejoin-start\"\n        })), e = e || function (e) {\n          r.default.info(\"[\".concat(b.clientId, \"] User \").concat(e, \" is re-joined to \").concat(b.joinInfo.cname)), b.dispatchEvent(u({\n            type: \"rejoin\"\n          })), b.liveStreams && b.liveStreams.size && b.liveStreams.forEach(function (e, t) {\n            e && b.setLiveTranscoding(b.transcoding), b.startLiveStreaming(t, e);\n          }), b.injectLiveStreams && b.injectLiveStreams.size && b.injectLiveStreams.forEach(function (e, t) {\n            b.addInjectStreamUrl(t, e);\n          });\n        }, t = t || function (e) {\n          r.default.error(\"[\".concat(b.clientId, \"] Re-join to channel failed \"), e), b.dispatchEvent(d({\n            type: \"error\",\n            reason: e\n          }));\n        }, b.key ? (++b.rejoinAttempt, b.join(b.joinInfo, b.key, e, t)) : r.default.error(\"[\".concat(b.clientId, \"] Connection recover failed [Invalid channel key]\"));\n      },\n          O = function (e, t, i) {\n        if (b.onConnect = t, b.socket) {\n          if (b.dispatchEvent({\n            type: \"reconnect\"\n          }), \"retry\" === b.reconnectMode) r.default.debug(\"[\".concat(b.clientId, \"] Retry current gateway\")), b.socket.reconnect();else if (\"tryNext\" === b.reconnectMode) r.default.debug(\"[\".concat(b.clientId, \"] Try next gateway\")), b.socket.connectNext();else if (\"recover\" === b.reconnectMode) {\n            r.default.debug(\"[\".concat(b.clientId, \"] Recover gateway\")), r.default.debug(\"[\".concat(b.clientId, \"] Try to reconnect choose server and get gateway list again \")), b.reconnectingCS = !0;\n            var s = b.joinInfo && b.joinInfo.sid;\n            ze(b.joinInfo, function (e) {\n              r.default.debug(\"[\".concat(b.clientId, \"] session:  \").concat(s, \" get gateway list success\")), b.joinInfo.apResponse = e.res, b.reconnectingCS ? b.socket.replaceHost(e.gateway_addr) : r.default.debug(\"[\".concat(b.clientId, \"] session:  \").concat(s, \" already leave\"));\n            });\n          }\n        } else c = e.gatewayAddr, b.socket = Pe(c, {\n          sid: b.joinInfo.sid,\n          clientId: b.clientId\n        }), b.socket.on(\"start-connection\", function (e) {\n          b.ticket = e && e.msg && e.msg.ticket;\n        }), b.socket.on(\"on_uplink_stats\", function (e) {\n          var t = {};\n\n          for (var n in e) t[it(n)] = e[n];\n\n          b.OutgoingAvailableBandwidth = t.uplink_available_bandwidth, b.localStreams[b.uid] && (b.localStreams[b.uid].uplinkStats = t);\n        }), b.socket.on(\"connect\", function () {\n          b.dispatchEvent({\n            type: \"connected\"\n          }), b.attemps = 1, b.onConnect();\n        }), b.socket.on(\"recover\", function () {\n          b.state = I, r.default.debug(\"[\".concat(b.clientId, \"] Try to reconnect choose server and get gateway list again \")), b.reconnectingCS = !0, b.leaveOnConnected = null;\n          var e = b.joinInfo && b.joinInfo.sid;\n          ze(b.joinInfo, function (t) {\n            r.default.debug(\"[\".concat(b.clientId, \"] session:  \").concat(e, \" get gateway list success\")), b.reconnectingCS ? b.socket.replaceHost(t.gateway_addr) : r.default.debug(\"[\".concat(b.clientId, \"] session:  \").concat(e, \" already leave\"));\n          });\n        }), b.socket.on(\"disconnect\", function (e) {\n          if (r.default.debug(\"[\".concat(b.clientId, \"] Receive disconnect message\")), b.state !== v) {\n            b.state = v;\n            var t = d({\n              type: \"error\",\n              reason: x.SOCKET_DISCONNECTED\n            });\n\n            if (b.dispatchEvent(t), 0 === b.p2ps.size ? b.reconnectMode = \"tryNext\" : b.reconnectMode = \"retry\", A(), 1 != n) {\n              var i,\n                  o = (i = b.attemps, 1e3 * Math.min(30, Math.pow(2, i) - 1));\n              if (r.default.error(\"[\".concat(b.clientId, \"] Disconnect from server [\").concat(JSON.stringify(e), \"], attempt to recover [#\").concat(b.attemps, \"] after \").concat(o / 1e3, \" seconds\")), b.hasInvokeLeave) return r.default.debug(\"[\".concat(b.clientId, \"] No reconnection becase client.leave has been invoked\")), void (b.hasInvokeLeave = !1);\n              setTimeout(function () {\n                b.attemps++, b.state = I, b.inChannelInfo && Date.now() - b.inChannelInfo.joinAt > Object(a.getParameter)(\"TICKET_RENEW_TIMEOUT\") ? (r.default.debug(\"Recovering to renew ticket\"), R()) : C();\n              }, o);\n            }\n          }\n        }), b.socket.on(\"on_add_audio_stream\", function (e) {\n          if (r.default.info(\"[\".concat(b.clientId, \"] Newly added audio stream with uid \").concat(e.uid)), b.joinInfo.stringUid && \"string\" != typeof e.uid && r.default.error(\"StringUID is Mixed with UintUID\"), b.remoteStreamsInChannel.has(e.uid) || b.remoteStreamsInChannel.add(e.uid), void 0 === b.remoteStreams[e.uid]) {\n            var t = Re({\n              streamID: e.uid,\n              local: !1,\n              audio: e.audio,\n              video: e.video\n            });\n            t.peerMuteVideo = !0, b.remoteStreams[e.uid] = t;\n            var n = d({\n              type: \"stream-added\",\n              stream: t\n            });\n            b.dispatchEvent(n);\n            var i = b.remoteMuteState[e.uid];\n\n            if (i && i.audio) {\n              n = u({\n                type: \"mute-audio\",\n                uid: e.uid\n              });\n              b.dispatchEvent(n);\n            }\n\n            if (i && i.video) {\n              n = u({\n                type: \"mute-video\",\n                uid: e.uid\n              });\n              b.dispatchEvent(n);\n            }\n          }\n        }), b.socket.on(\"on_update_stream\", function (e) {\n          var t = b.remoteStreams[e.uid];\n\n          if (b.joinInfo.stringUid && \"string\" != typeof e.uid && r.default.error(\"StringUID is Mixed with UintUID\"), t) {\n            t.audio = e.audio, t.video = e.video, t.screen = e.screen, t.pc && b._adjustPCMuteStatus(t);\n            var n = d({\n              type: \"stream-updated\",\n              stream: t\n            });\n            b.dispatchEvent(n);\n          } else r.default.debug(\"[\".concat(b.clientId, \"] Ignoring onUpdateStream event before onAddStream for uid \").concat(e.uid));\n        }), b.socket.on(\"on_add_video_stream\", function (e) {\n          if (r.default.info(\"[\".concat(b.clientId, \"] Newly added remote stream with uid \").concat(e.uid, \".\")), b.joinInfo.stringUid && \"string\" != typeof e.uid && r.default.error(\"StringUID is Mixed with UintUID\"), b.remoteStreamsInChannel.has(e.uid) || b.remoteStreamsInChannel.add(e.uid), void 0 === b.remoteStreams[e.uid]) {\n            var t = Re({\n              streamID: e.uid,\n              local: !1,\n              audio: e.audio,\n              video: e.video\n            });\n            b.remoteStreams[e.uid] = t;\n            var n = d({\n              type: \"stream-added\",\n              stream: t\n            });\n            b.dispatchEvent(n);\n            var i = b.remoteMuteState[e.uid];\n\n            if (i && i.audio) {\n              n = u({\n                type: \"mute-audio\",\n                uid: e.uid\n              });\n              b.dispatchEvent(n);\n            }\n\n            if (i && i.video) {\n              n = u({\n                type: \"mute-video\",\n                uid: e.uid\n              });\n              b.dispatchEvent(n);\n            }\n          } else {\n            var a = b.remoteStreams[e.uid];\n\n            if (void 0 !== a.stream) {\n              if ((t = b.remoteStreams[e.uid]).video = !0, t.peerMuteVideo = !1, t.pc && b._adjustPCMuteStatus(t), r.default.info(\"[\".concat(b.clientId, \"] Stream changed: enable video \").concat(e.uid)), t.isPlaying()) {\n                var o = t.player.elementID;\n                t.stop(), t.play(o, t.playOptions);\n              }\n            } else if (a.p2pId) b.remoteStreams[e.uid].video = !0;else {\n              t = Re({\n                streamID: e.uid,\n                local: !1,\n                audio: !0,\n                video: !0\n              });\n              b.remoteStreams[e.uid] = t, r.default.info(\"[\".concat(b.clientId, \"] Stream changed: modify video \").concat(e.uid));\n            }\n          }\n        }), b.socket.on(\"on_remove_stream\", function (e) {\n          b.remoteStreamsInChannel.has(e.uid) && b.remoteStreamsInChannel.delete(e.uid);\n          var t = b.remoteStreams[e.uid];\n\n          if (t) {\n            delete b.remoteStreams[e.uid], delete b.remoteMuteState[e.uid];\n            var n = d({\n              type: \"stream-removed\",\n              stream: t\n            });\n            b.dispatchEvent(n), t.close(), void 0 !== t.pc && (t.pc.close(), t.pc = void 0, b.p2ps.delete(t.p2pId));\n          } else r.default.error(\"ERROR stream \", e.uid, \" not found onRemoveStream \", e);\n        }), b.socket.on(\"on_publish_stream\", function (e) {\n          var t = b.localStreams[e.uid],\n              n = d({\n            type: \"streamPublished\",\n            stream: t\n          });\n          b.dispatchEvent(n);\n        }), b.socket.on(\"mute_audio\", function (e) {\n          r.default.info(\"[\".concat(b.clientId, \"] rcv peer mute audio: \").concat(e.uid)), b.remoteMuteState[e.uid] = b.remoteMuteState[e.uid] || {\n            audio: !1,\n            video: !1\n          }, b.remoteMuteState[e.uid].audio = !0;\n          var t = u({\n            type: \"mute-audio\",\n            uid: e.uid\n          }),\n              n = b.remoteStreams[e.uid];\n          n ? (n.peerMuteAudio = !0, n.pc && b._adjustPCMuteStatus(n), b.dispatchEvent(t)) : r.default.debug(\"Ignoring event \".concat(e.type), e);\n        }), b.socket.on(\"unmute_audio\", function (e) {\n          r.default.info(\"[\".concat(b.clientId, \"] rcv peer unmute audio: \").concat(e.uid)), b.remoteMuteState[e.uid] = b.remoteMuteState[e.uid] || {\n            audio: !1,\n            video: !1\n          }, b.remoteMuteState[e.uid].audio = !1;\n          var t = u({\n            type: \"unmute-audio\",\n            uid: e.uid\n          }),\n              n = b.remoteStreams[e.uid];\n          n ? (n.peerMuteAudio = !1, n.pc && b._adjustPCMuteStatus(n), b.dispatchEvent(t)) : r.default.debug(\"Ignoring event \".concat(e.type), e);\n        }), b.socket.on(\"mute_video\", function (e) {\n          r.default.info(\"[\".concat(b.clientId, \"] rcv peer mute video: \").concat(e.uid)), b.remoteMuteState[e.uid] = b.remoteMuteState[e.uid] || {\n            audio: !1,\n            video: !1\n          }, b.remoteMuteState[e.uid].video = !0;\n          var t = u({\n            type: \"mute-video\",\n            uid: e.uid\n          }),\n              n = b.remoteStreams[e.uid];\n          n ? (n.peerMuteVideo = !0, n.pc && b._adjustPCMuteStatus(n), b.dispatchEvent(t)) : r.default.debug(\"Ignoring event \".concat(e.type), e);\n        }), b.socket.on(\"unmute_video\", function (e) {\n          r.default.info(\"[\".concat(b.clientId, \"] rcv peer unmute video: \").concat(e.uid)), b.remoteMuteState[e.uid] = b.remoteMuteState[e.uid] || {\n            audio: !1,\n            video: !1\n          }, b.remoteMuteState[e.uid].video = !1;\n          var t = u({\n            type: \"unmute-video\",\n            uid: e.uid\n          }),\n              n = b.remoteStreams[e.uid];\n          n ? (n.peerMuteVideo = !1, n.pc && b._adjustPCMuteStatus(n), b.dispatchEvent(t)) : r.default.debug(\"Ignoring event \".concat(e.type), e);\n        }), b.socket.on(\"on_user_banned\", function (e) {\n          r.default.info(\"[\".concat(b.clientId, \"] user banned uid: \").concat(e.uid, \" error: \").concat(e.error_code));\n          var t = u({\n            type: \"client-banned\",\n            uid: e.uid,\n            attr: e.error_code\n          });\n          b.dispatchEvent(t), n = !0;\n        }), b.socket.on(\"on_stream_fallback_update\", function (e) {\n          r.default.info(\"[\".concat(b.clientId, \"] stream fallback peerId: \").concat(e.stream_id, \" type: \").concat(e.stream_type));\n          var t = u({\n            type: \"stream-fallback\",\n            uid: e.stream_id,\n            stream: e.stream_id,\n            attr: e.stream_type\n          });\n          b.dispatchEvent(t);\n        }), b.socket.on(\"stream_recover\", function (e) {\n          r.default.info(\"[\".concat(b.clientId, \"] stream recover uid: \").concat(e.id, \" peerId: \").concat(e.peerid, \" type: \").concat(e.type));\n          var t = u({\n            type: \"stream-recover\",\n            uid: e.id,\n            stream: e.peerid,\n            attr: e.type\n          });\n          b.dispatchEvent(t);\n        }), b.socket.on(\"on_p2p_lost\", function (e) {\n          r.default.debug(\"[\".concat(b.clientId, \"] p2plost: \"), e, \"p2ps:\", b.p2ps);\n          var t,\n              n = \"DTLS failed\";\n          (t = b.localStreams[e.uid] || b.remoteStreams[e.uid]) ? (t.pc && t.pc.offerCandidates && 0 === t.pc.offerCandidates.length && (n = \"NO_CANDIDATES_IN_OFFER\"), \"publish\" === e.event && o.b.publish(b.joinInfo.sid, {\n            lts: t.publishLTS,\n            succ: !1,\n            audioName: t.hasAudio() && t.audioName,\n            videoName: t.hasVideo() && t.videoName,\n            screenName: t.hasScreen() && t.screenName,\n            ec: n\n          }), \"subscribe\" === e.event && o.b.subscribe(b.joinInfo.sid, {\n            lts: t.subscribeLTS,\n            succ: !1,\n            video: t.subscribeOptions && t.subscribeOptions.video,\n            audio: t.subscribeOptions && t.subscribeOptions.audio,\n            peerid: e.uid + \"\",\n            ec: n\n          })) : r.default.warning(\"P2PLost Stream Not found\", e), r.default.debug(\"[\".concat(b.clientId, \"] p2plost:\"), e.p2pid), (t = b.p2ps.get(e.p2pid)) && (b.p2ps.delete(e.p2pid), t.local ? b.dispatchEvent(u({\n            type: \"pubP2PLost\",\n            stream: t,\n            attr: n\n          })) : b.remoteStreams[t.getId()] && b.dispatchEvent(u({\n            type: \"subP2PLost\",\n            stream: t,\n            attr: n\n          })));\n        }), b.socket.on(\"on_token_privilege_will_expire\", function (e) {\n          r.default.debug(\"[\".concat(b.clientId, \"] Received Message onTokenPrivilegeWillExpire\")), b.dispatchEvent(u({\n            type: \"onTokenPrivilegeWillExpire\"\n          }));\n        }), b.socket.on(\"on_token_privilege_did_expire\", function () {\n          r.default.warning(\"[\".concat(b.clientId, \"] Received Message onTokenPrivilegeDidExpire, please get new token and join again\")), b.closeGateway(), b.dispatchEvent(u({\n            type: \"onTokenPrivilegeDidExpire\"\n          }));\n        }), b._doWithAction = function (e, t, n) {\n          \"tryNext\" === e ? function (e, t) {\n            r.default.debug(\"[\".concat(b.clientId, \"] Connect next gateway\")), b.state = v, b.socket.close(), A(), b.reconnectMode = \"tryNext\", C(e, t);\n          }(t, n) : \"retry\" === e ? function (e, t) {\n            r.default.debug(\"[\".concat(b.clientId, \"] Reconnect gateway\")), b.state = v, b.socket.close(), A(), b.reconnectMode = \"retry\", C(e, t);\n          }(t, n) : \"quit\" === e ? (r.default.debug(\"[\".concat(b.clientId, \"] quit gateway\")), b.state = v, b.socket.close(), A()) : \"recover\" === e && R();\n        }, b.socket.on(\"on_notification\", function (e) {\n          if (r.default.debug(\"[\".concat(b.clientId, \"] Receive notification: \"), e), \"ERR_JOIN_BY_MULTI_IP\" === y[e.code]) return b.dispatchEvent({\n            type: \"onMultiIP\",\n            option: e.option\n          });\n          e.detail ? b._doWithAction(Qe[y[e.code]]) : e.action && b._doWithAction(e.action);\n        }), b.socket.on(\"on_user_offline\", function (e) {\n          var t = u({\n            type: \"peer-leave\",\n            uid: e.uid\n          });\n\n          if (b.remoteStreamsInChannel.has(e.uid) && b.remoteStreamsInChannel.delete(e.uid), b.remoteStreams.hasOwnProperty(e.uid) && (t.stream = b.remoteStreams[e.uid]), b.dispatchEvent(t), b.remoteStreams.hasOwnProperty(e.uid)) {\n            r.default.info(\"[\".concat(b.clientId, \"] closing stream on peer leave\"), e.uid);\n            var n = b.remoteStreams[e.uid];\n            n.close(), delete b.remoteStreams[e.uid], void 0 !== n.pc && (n.pc.close(), n.pc = void 0, b.p2ps.delete(n.p2pId));\n          }\n\n          b.timers.hasOwnProperty(e.uid) && (clearInterval(b.timers[e.uid]), clearInterval(b.timers[e.uid] + \"_RelatedStats\"), delete b.timers[e.uid]), null != b.audioLevel[e.uid] && delete b.audioLevel[e.uid], null != b.timer_counter[e.uid] && delete b.timer_counter[e.uid];\n        }), b.socket.on(\"onUplinkStats\", function (e) {}), b.socket.on(\"liveStreamingStarted\", function (e) {\n          var t = p({\n            type: \"liveStreamingStarted\",\n            url: e.url\n          });\n          b.dispatchEvent(t);\n        }), b.socket.on(\"liveStreamingFailed\", function (e) {\n          var t = p({\n            type: \"liveStreamingFailed\",\n            url: e.url\n          });\n          b.dispatchEvent(t);\n        }), b.socket.on(\"liveStreamingStopped\", function (e) {\n          var t = p({\n            type: \"liveStreamingStopped\",\n            url: e.url\n          });\n          b.dispatchEvent(t);\n        }), b.socket.on(\"liveTranscodingUpdated\", function (e) {\n          var t = p({\n            type: \"liveTranscodingUpdated\",\n            reason: e.reason\n          });\n          b.dispatchEvent(t);\n        }), b.socket.on(\"streamInjectedStatus\", function (e) {\n          var t = p({\n            type: \"streamInjectedStatus\",\n            url: e.url,\n            uid: e.uid,\n            status: e.status\n          });\n          b.dispatchEvent(t);\n        }), b.socket.on(\"on_user_online\", function (e) {\n          b.joinInfo.stringUid && \"string\" != typeof e.uid && r.default.error(\"StringUID is Mixed with UintUID\"), b.dispatchEvent({\n            type: \"peer-online\",\n            uid: e.uid\n          });\n        });\n\n        var c;\n      },\n          N = function (e, t) {\n        if (void 0 !== b.socket) try {\n          b.socket.emitSimpleMessage(e, function (e, n) {\n            t && t(e, n);\n          });\n        } catch (e) {\n          r.default.error(\"[\".concat(b.clientId, \"] Error in sendSimpleSdp [\").concat(e, \"]\"));\n        } else r.default.error(\"[\".concat(b.clientId, \"] Error in sendSimpleSdp [socket not ready]\"));\n      },\n          w = function () {\n        for (var e in b.localStreams) if (void 0 !== b.localStreams[e]) {\n          var t = b.localStreams[e];\n          delete b.localStreams[e], void 0 !== t.pc && (t.pc.close(), t.pc = void 0);\n        }\n      },\n          D = function () {\n        for (var e in b.remoteStreamsInChannel.clear(), b.remoteStreams) if (b.remoteStreams.hasOwnProperty(e)) {\n          var t = b.remoteStreams[e];\n          t.isPlaying() && t.stop(), t.close(), delete b.remoteStreams[e], void 0 !== t.pc && (t.pc.close(), t.pc = void 0);\n        }\n      };\n\n      return b;\n    },\n        rt = {\n      _gatewayClients: {},\n      register: function (e, t) {\n        if (!t.uid) {\n          var n = \"NO_UID_PROVIDED\";\n          return r.default.error(\"[\".concat(e.clientId, \"] \"), n, t), n;\n        }\n\n        if (t.cname) {\n          if (this._gatewayClients[t.cname] && this._gatewayClients[t.cname][t.uid] && this._gatewayClients[t.cname][t.uid] !== e) {\n            n = \"UID_CONFLICT\";\n            return r.default.error(\"[\".concat(e.clientId, \"] \"), n, t), n;\n          }\n\n          return r.default.debug(\"[\".concat(e.clientId, \"] register client Channel\"), t.cname, \"Uid\", t.uid), this._gatewayClients[t.cname] || (this._gatewayClients[t.cname] = {}), this._gatewayClients[t.cname][t.uid] = e, null;\n        }\n\n        var n = \"NO_CHANNEL_PROVIDED\";\n        return r.default.error(\"[\".concat(e.clientId, \"] \"), n, t), n;\n      },\n      unregister: function (e) {\n        var t = e && e.uid,\n            n = e.joinInfo && e.joinInfo.cname;\n\n        if (!t || !n) {\n          var i = \"INVALID_GATEWAYCLIENT\";\n          return r.default.error(\"[\".concat(e.clientId, \"] \"), i), i;\n        }\n\n        if (this._gatewayClients[n] && this._gatewayClients[n][t]) {\n          if (this._gatewayClients[n][t] !== e) {\n            i = \"GATEWAYCLIENT_UID_CONFLICT\";\n            return r.default.error(\"[\".concat(e.clientId, \"] \"), i), i;\n          }\n\n          return r.default.debug(\"[\".concat(e.clientId, \"] unregister client \"), e.uid), delete this._gatewayClients[n][t], null;\n        }\n\n        var i = \"GATEWEAY_CLIENT_UNREGISTERED\";\n        r.default.error(\"[\".concat(e.clientId, \"] \"), i);\n      }\n    };\n\n    at.DISCONNECTED = 0, at.CONNECTING = 1, at.CONNECTED = 2, at.DISCONNECTING = 3, at.connetionStateMap = {\n      0: \"DISCONNECTED\",\n      1: \"CONNECTING\",\n      2: \"CONNECTED\",\n      3: \"DISCONNECTING\"\n    };\n\n    var ot = at,\n        st = function (e) {\n      var t;\n\n      switch (e) {\n        case \"120p\":\n        case \"120p_1\":\n          t = [\"120p_1\", \"120p_1\", \"120p_1\"];\n          break;\n\n        case \"120p_3\":\n          t = [\"120p_3\", \"120p_3\", \"120p_3\"];\n          break;\n\n        case \"180p\":\n        case \"180p_1\":\n          t = [\"90p_1\", \"90p_1\", \"180p_1\"];\n          break;\n\n        case \"180p_3\":\n          t = [\"120p_3\", \"120p_3\", \"180p_3\"];\n          break;\n\n        case \"180p_4\":\n          t = [\"120p_1\", \"120p_1\", \"180p_4\"];\n          break;\n\n        case \"240p\":\n        case \"240p_1\":\n          t = [\"120p_1\", \"120p_1\", \"240p_1\"];\n          break;\n\n        case \"240p_3\":\n          t = [\"120p_3\", \"120p_3\", \"240p_3\"];\n          break;\n\n        case \"240p_4\":\n          t = [\"120p_4\", \"120p_4\", \"240p_4\"];\n          break;\n\n        case \"360p\":\n        case \"360p_1\":\n        case \"360p_4\":\n        case \"360p_9\":\n        case \"360p_10\":\n        case \"360p_11\":\n          t = [\"90p_1\", \"90p_1\", \"360p_1\"];\n          break;\n\n        case \"360p_3\":\n        case \"360p_6\":\n          t = [\"120p_3\", \"120p_3\", \"360p_3\"];\n          break;\n\n        case \"360p_7\":\n        case \"360p_8\":\n          t = [\"120p_1\", \"120p_1\", \"360p_7\"];\n          break;\n\n        case \"480p\":\n        case \"480p_1\":\n        case \"480p_2\":\n        case \"480p_4\":\n        case \"480p_10\":\n          t = [\"120p_1\", \"120p_1\", \"480p_1\"];\n          break;\n\n        case \"480p_3\":\n        case \"480p_6\":\n          t = [\"120p_3\", \"120p_3\", \"480p_3\"];\n          break;\n\n        case \"480p_8\":\n        case \"480p_9\":\n          t = [\"120p_4\", \"120p_4\", \"480p_8\"];\n          break;\n\n        case \"720p\":\n        case \"720p_1\":\n        case \"720p_2\":\n        case \"720p_3\":\n          t = [\"90p_1\", \"90p_1\", \"720p_1\"];\n          break;\n\n        case \"720p_5\":\n        case \"720p_6\":\n          t = [\"120p_1\", \"120p_1\", \"720p_5\"];\n          break;\n\n        case \"1080p\":\n        case \"1080p_1\":\n        case \"1080p_2\":\n        case \"1080p_3\":\n        case \"1080p_5\":\n          t = [\"90p_1\", \"90p_1\", \"1080p_1\"];\n          break;\n\n        case \"1440p\":\n        case \"1440p_1\":\n        case \"1440p_2\":\n          t = [\"90p_1\", \"90p_1\", \"1440p_1\"];\n          break;\n\n        case \"4k\":\n        case \"4k_1\":\n        case \"4k_3\":\n          t = [\"90p_1\", \"90p_1\", \"4k_1\"];\n          break;\n\n        default:\n          t = [\"120p_1\", \"120p_1\", \"360p_7\"];\n      }\n\n      return Object(f.isOpera)() ? [e, 15, 50] : Object(f.isFireFox)() ? [t[1], 15, 100] : Object(f.isSafari)() ? [t[2], 15, 50] : [t[0], 15, 50];\n    },\n        ct = {\n      1001: \"FRAMERATE_INPUT_TOO_LOW\",\n      1002: \"FRAMERATE_SENT_TOO_LOW\",\n      1003: \"SEND_VIDEO_BITRATE_TOO_LOW\",\n      1005: \"RECV_VIDEO_DECODE_FAILED\",\n      2001: \"AUDIO_INPUT_LEVEL_TOO_LOW\",\n      2002: \"AUDIO_OUTPUT_LEVEL_TOO_LOW\",\n      2003: \"SEND_AUDIO_BITRATE_TOO_LOW\",\n      2005: \"RECV_AUDIO_DECODE_FAILED\",\n      3001: \"FRAMERATE_INPUT_TOO_LOW_RECOVER\",\n      3002: \"FRAMERATE_SENT_TOO_LOW_RECOVER\",\n      3003: \"SEND_VIDEO_BITRATE_TOO_LOW_RECOVER\",\n      3005: \"RECV_VIDEO_DECODE_FAILED_RECOVER\",\n      4001: \"AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER\",\n      4002: \"AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER\",\n      4003: \"SEND_AUDIO_BITRATE_TOO_LOW_RECOVER\",\n      4005: \"RECV_AUDIO_DECODE_FAILED_RECOVER\"\n    },\n        dt = {\n      FramerateInput: 1001,\n      FramerateSent: 1002,\n      SendVideoBitrate: 1003,\n      VideoDecode: 1005,\n      AudioIntputLevel: 2001,\n      AudioOutputLevel: 2002,\n      SendAudioBitrate: 2003,\n      AudioDecode: 2005\n    },\n        ut = function (e) {\n      var t = {\n        remoteStreamStorage: {},\n        localStreamStorage: {}\n      };\n      return t.gatewayClient = e, t.checkAudioOutputLevel = function (e) {\n        return !(e && parseInt(e.audioRecvBytesDelta) > 0 && parseInt(e.audioDecodingNormalDelta) > 0 && 0 === parseInt(e.audioOutputLevel));\n      }, t.checkAudioIntputLevel = function (e) {\n        return !e || 0 !== parseInt(e.audioInputLevel);\n      }, t.checkFramerateInput = function (e, t) {\n        if (!e || !t.attributes) return !0;\n        var n = parseInt(t.attributes.maxFrameRate),\n            i = parseInt(e.googFrameRateInput);\n        return !n || !i || !(n > 10 && i < 5 || n < 10 && n >= 5 && i <= 1);\n      }, t.checkFramerateSent = function (e) {\n        return !(e && parseInt(e.googFrameRateInput) > 5 && parseInt(e.googFrameRateSent) <= 1);\n      }, t.checkSendVideoBitrate = function (e) {\n        return !e || 0 !== parseInt(e.videoSendBytesDelta);\n      }, t.checkSendAudioBitrate = function (e) {\n        return !e || 0 !== parseInt(e.audioSendBytesDelta);\n      }, t.checkVideoDecode = function (e) {\n        return !e || 0 === parseInt(e.videoRecvBytesDelta) || 0 !== parseInt(e.googFrameRateDecoded);\n      }, t.checkAudioDecode = function (e) {\n        return !e || 0 === parseInt(e.audioRecvBytesDelta) || 0 !== parseInt(e.audioDecodingNormalDelta);\n      }, t.record = function (e, n, i, a, r) {\n        i[e] || (i[e] = {\n          isPrevNormal: !0,\n          record: []\n        });\n        var o = i[e],\n            s = t[\"check\" + e](n, r);\n\n        if (o.record.push(s), o.record.length >= 5) {\n          o.isCurNormal = -1 !== o.record.indexOf(!0);\n          var c = dt[e];\n          o.isPrevNormal && !o.isCurNormal && t.gatewayClient.dispatchEvent({\n            type: \"exception\",\n            code: c,\n            msg: ct[c],\n            uid: a\n          }), !o.isPrevNormal && o.isCurNormal && t.gatewayClient.dispatchEvent({\n            type: \"exception\",\n            code: c + 2e3,\n            msg: ct[c + 2e3],\n            uid: a\n          }), o.isPrevNormal = o.isCurNormal, o.record = [];\n        }\n      }, t.setLocalStats = function (e) {\n        var n = {};\n        Object.keys(e).map(function (i) {\n          var a = e[i],\n              r = t.gatewayClient.localStreams[parseInt(i)],\n              o = t.localStreamStorage[i] || {};\n          r && r.hasVideo() && (t.record(\"SendVideoBitrate\", a.videoStats, o, i), t.record(\"FramerateInput\", a.videoStats, o, i, r), t.record(\"FramerateSent\", a.videoStats, o, i)), r && r.hasAudio() && (t.record(\"AudioIntputLevel\", a.audioStats, o, i), t.record(\"SendAudioBitrate\", a.audioStats, o, i)), n[i] = o;\n        }), t.localStreamStorage = n;\n      }, t.setRemoteStats = function (n) {\n        var i = {};\n        Object.keys(n).map(function (a) {\n          var r = n[a],\n              o = e.remoteStreams[a],\n              s = t.remoteStreamStorage[a] || {};\n          o && o.hasVideo() && o.isPlaying() && t.record(\"VideoDecode\", r.videoStats, s, a), o && o.hasAudio() && o.isPlaying() && (t.record(\"AudioOutputLevel\", r.audioStats, s, a), t.record(\"AudioDecode\", r.audioStats, s, a)), i[a] = s;\n        }), t.remoteStreamStorage = i;\n      }, t;\n    },\n        lt = new function () {\n      var e = s();\n      return e.states = {\n        UNINIT: \"UNINIT\",\n        INITING: \"INITING\",\n        INITED: \"INITED\"\n      }, e.state = e.states.UNINIT, e.type = null, e.lastConnectedAt = null, e.lastDisconnectedAt = null, e.lastTypeChangedAt = null, e.networkChangeTimer = null, e._init = function (t, n) {\n        if (e.state = e.states.INITING, navigator.connection && navigator.connection.addEventListener) {\n          var i = e._getNetworkInfo();\n\n          e.type = i && i.type, e.state = e.states.INITED, t && t();\n        } else e.state = e.states.UNINIT, n && n(\"DO_NOT_SUPPORT\");\n      }, e._getNetworkInfo = function () {\n        return navigator.connection;\n      }, e._reloadNetworkInfo = function () {\n        var t = e._getNetworkInfo(),\n            n = t && t.type || \"UNSUPPORTED\",\n            i = Date.now();\n\n        if (n !== e.type) {\n          e.lastTypeChangedAt = i, \"none\" == n ? e.lastDisconnectedAt = i : \"none\" == e.type && (e.lastConnectedAt = i), e.type = n;\n          var a = {\n            type: \"networkTypeChanged\",\n            networkType: n\n          };\n          e.dispatchEvent(a);\n        }\n      }, e.getStats = function (t, n) {\n        var i = {},\n            a = e._getNetworkInfo();\n\n        a && (i.NetworkType = a.type || \"UNSUPPORTED\"), setTimeout(function () {\n          t(i);\n        }, 0);\n      }, e._init(function () {\n        navigator.connection.addEventListener(\"change\", function () {\n          e._reloadNetworkInfo();\n        }), e.networkChangeTimer = setInterval(function () {\n          e._reloadNetworkInfo();\n        }, 5e3);\n      }, function (e) {}), e;\n    }(),\n        pt = \"DISCONNECTING\",\n        ft = \"DISCONNECTED\",\n        mt = \"CONNECTED\",\n        gt = \"INIT\",\n        vt = [],\n        St = (setInterval(function () {\n      Date.now();\n      vt.forEach(function (e) {\n        for (var t = e.requests.length - 1; t >= 0; t--) {\n          var n = e.requests[t];\n          n.timeoutCnt++, n.timeoutCnt >= 15 && (e.requests.splice(t, 1), n.promises.reject({\n            reason: \"TIMEOUT\",\n            code: 499\n          }));\n        }\n      });\n    }, 1e3), 1),\n        It = 1,\n        ht = function () {\n      var e = Fe()(Ue.a.mark(function e(t) {\n        var n, i, o, s, c, d;\n        return Ue.a.wrap(function (e) {\n          for (;;) switch (e.prev = e.next) {\n            case 0:\n              return n = t.url, i = t.serviceName, o = t.sid, s = t.appId, c = t.cname, d = t.timeout, e.abrupt(\"return\", new Promise(function (e, t) {\n                var u = !1,\n                    l = new XMLHttpRequest();\n                l.open(\"POST\", n, !0), l.setRequestHeader(\"Content-Type\", \"application/json; charset=utf-8\"), l.setRequestHeader(\"X-Packet-Service-Type\", \"0\"), l.setRequestHeader(\"X-Packet-URI\", \"61\"), l.onload = function () {\n                  if (!u) {\n                    var n = null,\n                        i = null;\n\n                    try {\n                      n = JSON.parse(l.responseText);\n                    } catch (e) {\n                      var a = \"Invalid text \".concat(l.responseText);\n                      return r.default.error(a), u = !0, t(a);\n                    }\n\n                    if (n.code) {\n                      var o = \"AP_ERR_\".concat(n.code);\n                      return r.default.error(o, n), u = !0, t(o);\n                    }\n\n                    try {\n                      i = JSON.parse(n.json_body || n.json);\n                    } catch (e) {\n                      var s = \"Invalid json_body \".concat(l.responseText);\n                      return r.default.error(s), u = !0, t(s);\n                    }\n\n                    if (200 !== i.code) {\n                      var c = \"APPCENTER_CODE_\".concat(i.code);\n                      return r.default.error(c, i), u = !0, t(c);\n                    }\n\n                    if (!(i.servers && i.servers.length > 0)) {\n                      return r.default.error(\"APPCENTER_EMPTY_SERVER\", i), u = !0, t(\"APPCENTER_EMPTY_SERVER\");\n                    }\n\n                    return u = !0, e(i);\n                  }\n                }, l.onerror = function (e) {\n                  var i = \"AP_REUEST_\".concat(e.type);\n                  r.default.error(i, n, e), u || (u = !0, t(i));\n                }, l.ontimeout = function (e) {\n                  r.default.error(\"AP_REUEST_TIMEOUT\", n, e), u || (u = !0, t(\"AP_REUEST_TIMEOUT\"));\n                }, d && (l.timeout = d), l.send(JSON.stringify({\n                  service_name: i,\n                  json_body: JSON.stringify({\n                    command: \"allocateEdge\",\n                    sid: o,\n                    appId: s,\n                    ts: Math.floor(Date.now() / 1e3),\n                    seq: St++,\n                    cname: c,\n                    version: a.VERSION,\n                    requestId: It++\n                  })\n                }));\n              }));\n\n            case 2:\n            case \"end\":\n              return e.stop();\n          }\n        }, e, this);\n      }));\n      return function (t) {\n        return e.apply(this, arguments);\n      };\n    }(),\n        _t = function () {\n      var e = Fe()(Ue.a.mark(function e(t) {\n        var n, i, o, s, c, d, u, l, p, f, m;\n        return Ue.a.wrap(function (e) {\n          for (;;) switch (e.prev = e.next) {\n            case 0:\n              n = t.serviceName, i = t.sid, o = t.appId, s = t.cname, c = null, e.t0 = Ue.a.keys(Object(a.getParameter)(\"UAP_AP\"));\n\n            case 3:\n              if ((e.t1 = e.t0()).done) {\n                e.next = 34;\n                break;\n              }\n\n              return d = e.t1.value, u = \"https://\".concat(Object(a.getParameter)(\"UAP_AP\")[d], \"/api/v1?action=uap\"), l = void 0, e.prev = 7, e.next = 10, ht({\n                url: u,\n                appId: o,\n                sid: i,\n                serviceName: n,\n                cname: s,\n                timeout: Object(a.getParameter)(\"HTTP_CONNECT_TIMEOUT\")\n              });\n\n            case 10:\n              l = e.sent, e.next = 18;\n              break;\n\n            case 13:\n              return e.prev = 13, e.t2 = e.catch(7), r.default.error(e.t2), c = e.t2, e.abrupt(\"continue\", 3);\n\n            case 18:\n              p = Ue.a.mark(function e(t) {\n                var i, a, o;\n                return Ue.a.wrap(function (e) {\n                  for (;;) switch (e.prev = e.next) {\n                    case 0:\n                      if (i = l.servers[t], a = \"wss://\".concat(i.address.replace(/\\./g, \"-\"), \".edge.\").concat(t % 2 == 0 ? \"agora.io\" : \"agoraio.cn\", \":\").concat(i.wss, \"?serviceName=\").concat(encodeURIComponent(n)), i.wss) {\n                        e.next = 5;\n                        break;\n                      }\n\n                      return r.default.error(\"Invalid server response\", i), e.abrupt(\"return\", \"continue\");\n\n                    case 5:\n                      return e.prev = 5, e.next = 8, new Promise(function (e, t) {\n                        var n = new WebSocket(a),\n                            i = !1;\n                        n.addEventListener(\"open\", function () {\n                          i || (i = !0, e(n));\n                        }), n.addEventListener(\"error\", function (e) {\n                          i || (i = !0, t(e));\n                        });\n                      });\n\n                    case 8:\n                      return (o = e.sent).workerToken = l.workerToken, e.abrupt(\"return\", {\n                        v: o\n                      });\n\n                    case 13:\n                      e.prev = 13, e.t0 = e.catch(5), r.default.error(e.t0), c = e.t0;\n\n                    case 17:\n                    case \"end\":\n                      return e.stop();\n                  }\n                }, e, this, [[5, 13]]);\n              }), f = 0;\n\n            case 20:\n              if (!(f < l.servers.length)) {\n                e.next = 32;\n                break;\n              }\n\n              return e.delegateYield(p(f), \"t3\", 22);\n\n            case 22:\n              m = e.t3, e.t4 = m, e.next = \"continue\" === e.t4 ? 26 : 27;\n              break;\n\n            case 26:\n              return e.abrupt(\"continue\", 29);\n\n            case 27:\n              if (\"object\" !== re()(m)) {\n                e.next = 29;\n                break;\n              }\n\n              return e.abrupt(\"return\", m.v);\n\n            case 29:\n              f++, e.next = 20;\n              break;\n\n            case 32:\n              e.next = 3;\n              break;\n\n            case 34:\n              throw c;\n\n            case 35:\n            case \"end\":\n              return e.stop();\n          }\n        }, e, this, [[7, 13]]);\n      }));\n      return function (t) {\n        return e.apply(this, arguments);\n      };\n    }(),\n        yt = {},\n        Et = function (e) {\n      return yt[e] ? (yt[e] += 1, yt[e]) : (yt[e] = 1, yt[e]);\n    },\n        bt = {},\n        Tt = function (e) {\n      return bt[e] ? (bt[e] += 1, bt[e]) : (bt[e] = 1, bt[e]);\n    },\n        Rt = function (e) {\n      var t = e.appId,\n          n = e.cname,\n          i = e.uid,\n          o = e.sid,\n          c = s();\n      return c.status = gt, c.pingpongTimer = null, c.connection = null, c.requests = [], c.appId = t, c.cname = n, c.uid = i, c.sid = o, c.connection = null, c.connect = function () {\n        var e = Fe()(Ue.a.mark(function e(t) {\n          var n;\n          return Ue.a.wrap(function (e) {\n            for (;;) switch (e.prev = e.next) {\n              case 0:\n                if (n = t.wsClient, c.status === gt) {\n                  e.next = 4;\n                  break;\n                }\n\n                return r.default.debug(\"Ignored UapConnection.connect: \".concat(c.status)), e.abrupt(\"return\");\n\n              case 4:\n                c.connection = n, c.status = mt, c._flush(), c.startPingpong(), n.addEventListener(\"close\", function (e) {\n                  if (console.log(\"Weboskcet closed\", e), n === c.connection) {\n                    var t = {\n                      type: \"close\",\n                      evt: e\n                    };\n                    c.dispatchEvent(t);\n                  }\n                }), n.addEventListener(\"message\", function (e) {\n                  if (e.data) {\n                    var t = null;\n\n                    try {\n                      t = JSON.parse(e.data);\n                    } catch (e) {\n                      return void r.default.error(\"Invalid data from worker manager\", t);\n                    }\n\n                    if (t.requestId) for (var n = c.requests.length - 1; n >= 0; n--) {\n                      var i = c.requests[n];\n\n                      if (i.reqData.requestId === t.requestId) {\n                        c.requests.splice(n, 1), t.code < 400 && t.code >= 200 ? i.promises.resolve(t) : i.promises.reject(t);\n                        break;\n                      }\n                    } else t.type = \"notification\", c.dispatchEvent(t);\n                  }\n                });\n\n              case 10:\n              case \"end\":\n                return e.stop();\n            }\n          }, e, this);\n        }));\n        return function (t) {\n          return e.apply(this, arguments);\n        };\n      }(), c.disconnect = Fe()(Ue.a.mark(function e() {\n        var t;\n        return Ue.a.wrap(function (e) {\n          for (;;) switch (e.prev = e.next) {\n            case 0:\n              for (t in c.status = pt, clearInterval(c.pingpongTimer), c.pingpongTimer = null, c.requests) c.requests[t].promises.reject(\"DISCONNECTED\");\n\n              return c.requests = [], null, c.connection && (c.connection.close(), c.connection = null), c.status = ft, e.abrupt(\"return\", null);\n\n            case 9:\n            case \"end\":\n              return e.stop();\n          }\n        }, e, this);\n      })), c.request = function () {\n        var e = Fe()(Ue.a.mark(function e(t) {\n          var n, i, o, s;\n          return Ue.a.wrap(function (e) {\n            for (;;) switch (e.prev = e.next) {\n              case 0:\n                if (n = S()({\n                  command: \"request\",\n                  sdkVersion: a.VERSION,\n                  seq: Tt(c.sid),\n                  appId: c.appId,\n                  cname: c.cname,\n                  uid: \"\" + c.uid,\n                  sid: c.sid,\n                  requestId: Et(c.sid),\n                  ts: Math.floor(Date.now() / 1e3)\n                }, t), \"INIT\" !== c.status) {\n                  e.next = 5;\n                  break;\n                }\n\n                return e.abrupt(\"return\", new Promise(function (e, t) {\n                  var i = {\n                    reqData: n,\n                    stalledTs: Date.now(),\n                    timeoutCnt: 0,\n                    promises: {\n                      resolve: e,\n                      reject: t\n                    }\n                  };\n                  c.requests.push(i);\n                }));\n\n              case 5:\n                if (c.connection) {\n                  e.next = 11;\n                  break;\n                }\n\n                throw i = \"NO_WEBSOCKET_CONNECTION\", r.default.error(i), new Error(i);\n\n              case 11:\n                if (c.status !== pt || t.clientRequest && \"DestroyWorker\" === t.clientRequest.command) {\n                  e.next = 17;\n                  break;\n                }\n\n                throw o = \"WEBSOCKET_DISCONNECTING\", r.default.error(o), new Error(o);\n\n              case 17:\n                if (\"DISCONNECTED\" !== c.status) {\n                  e.next = 23;\n                  break;\n                }\n\n                throw s = \"WEBSOCKET_DISCONNECTED\", r.default.error(s), new Error(s);\n\n              case 23:\n                return e.abrupt(\"return\", new Promise(function (e, t) {\n                  var i = {\n                    reqData: n,\n                    stalledTs: Date.now(),\n                    timeoutCnt: 0,\n                    promises: {\n                      resolve: e,\n                      reject: t\n                    }\n                  };\n                  c.requests.push(i), c._flush();\n                }));\n\n              case 24:\n              case \"end\":\n                return e.stop();\n            }\n          }, e, this);\n        }));\n        return function (t) {\n          return e.apply(this, arguments);\n        };\n      }(), c._flush = function () {\n        c.connection && c.status === mt && c.requests.forEach(function (e) {\n          e.sentTs || (e.sentTs = Date.now(), e.reqData.clientRequest && (e.reqData.clientRequest.workerToken = c.connection.workerToken), c.connection.send(JSON.stringify(e.reqData)));\n        });\n      }, c.startPingpong = function () {\n        clearInterval(c.pingpongTimer), c.pingpongTimer = setInterval(Fe()(Ue.a.mark(function e() {\n          return Ue.a.wrap(function (e) {\n            for (;;) switch (e.prev = e.next) {\n              case 0:\n                if (c.status !== mt || !c.connection || 1 !== c.connection.readyState) {\n                  e.next = 9;\n                  break;\n                }\n\n                return e.prev = 1, e.next = 4, c.request({\n                  command: \"ping\"\n                });\n\n              case 4:\n                e.next = 9;\n                break;\n\n              case 6:\n                e.prev = 6, e.t0 = e.catch(1), console.error(\"pingpong\", e.t0);\n\n              case 9:\n              case \"end\":\n                return e.stop();\n            }\n          }, e, this, [[1, 6]]);\n        })), 6e3);\n      }, c._flush(), c.startPingpong(), vt.push(c), c;\n    },\n        At = function (e) {\n      return \"number\" == typeof e && 0 <= e && e <= 4294967295;\n    };\n\n    var Ct = function (e) {\n      var t = e;\n      if (Object(a.getParameter)(\"LIVESTREAMING_ALIGN\")) switch (e) {\n        case 200:\n          t = T;\n          break;\n\n        case 451:\n          t = R;\n          break;\n\n        case 453:\n          t = A;\n          break;\n\n        case 470:\n          t = M;\n          break;\n\n        case 499:\n          t = C;\n          break;\n\n        default:\n          t = O;\n      }\n      return t;\n    },\n        Ot = function (e) {\n      var t = e;\n      if (Object(a.getParameter)(\"LIVESTREAMING_ALIGN\")) switch (e) {\n        case 200:\n          t = N;\n          break;\n\n        case 404:\n        case 452:\n          t = w;\n          break;\n\n        case 453:\n          t = D;\n          break;\n\n        case 499:\n          t = k;\n          break;\n\n        default:\n          t = L;\n      }\n      return t;\n    },\n        Nt = function (e) {\n      var t = {\n        key: void 0,\n        highStream: null,\n        lowStream: null,\n        lowStreamParameter: null,\n        isDualStream: !1,\n        highStreamState: 2,\n        lowStreamState: 2,\n        proxyServer: null\n      };\n      t.turnServer = {\n        mode: \"auto\",\n        username: \"test\",\n        credential: \"111111\",\n        forceturn: Object(a.getParameter)(\"FORCE_TURN\")\n      }, t.useProxyServer = !1, t.mode = e.mode, t.codec = e.codec, t.clientId = Object(te.b)().slice(0, 5), t.uintUid = null;\n      e = S()({}, e);\n      return t.aespassword = null, t.aesmode = \"none\", t.hasPublished = !1, t.getSessionId = function () {\n        return e.sessionId;\n      }, t.getConnectionState = function () {\n        var n = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.getConnectionState\",\n          options: arguments,\n          tag: \"tracer\"\n        }),\n            i = ot.connetionStateMap[t.gatewayClient.state];\n        return n(), i;\n      }, t.setClientRole = function (n, i) {\n        var a = o.b.reportApiInvoke(e.sessionId, {\n          callback: i,\n          name: \"Client.setClientRole\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n\n        if (oe(n, \"setClientRole\", [\"host\", \"audience\"]), \"rtc\" === t.mode) {\n          var s = \"RTC mode can not use setClientRole\";\n          return r.default.warning(\"[\".concat(t.clientId, \"] \").concat(s)), a && a(s);\n        }\n\n        t.gatewayClient && t.gatewayClient.state === ot.CONNECTED ? (\"audience\" === n && (0 === this.highStreamState ? this._unpublish(this.highStream, function () {\n          a && a(null, {\n            role: n\n          });\n        }, function (e) {\n          a && a(e);\n        }) : t.gatewayClient.setClientRole(\"audience\", a)), \"host\" === n && t.gatewayClient.setClientRole(\"host\", a)) : (t.gatewayClient.role = n, a && a(null, {\n          role: n\n        }));\n      }, t.getGatewayInfo = function (e) {\n        if (t.gatewayClient.state !== ot.CONNECTED) {\n          var n = \"Client is not in connected state\";\n          return r.default.error(\"[\".concat(t.clientId, \"] \").concat(n)), void e(n);\n        }\n\n        t.gatewayClient.getGatewayInfo(function (t) {\n          e(null, t);\n        }, e);\n      }, t.renewToken = function (n, i, a) {\n        var s = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, t) {\n            if (e) return r.default.error(\"Failed to renew token \".concat(e), t), a && a(e);\n            i && i(t);\n          },\n          name: \"Client.renewToken\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        if (!me(n)) throw new Error(\"Invalid token: Token is of the string type .Length of the string: [1,255]. ASCII characters only.\");\n        return t.gatewayClient ? t.key ? (t.key = n, void t.gatewayClient.renewToken(n, function (e) {\n          return s(null, e);\n        }, s)) : (r.default.error(\"[\".concat(t.clientId, \"] renewToken should not be called before user join\")), s(x.INVALID_OPERATION)) : (r.default.error(\"[\".concat(t.clientId, \"] renewToken Failed. GatewayClient not Exist\")), s(x.INVALID_OPERATION));\n      }, t.setLowStreamParameter = function (n) {\n        var i = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.setLowStreamParameter\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        se(n, \"param\");\n        var a = n.width,\n            s = n.height,\n            c = n.framerate,\n            d = n.bitrate;\n        _e(a) || de(a, \"width\"), _e(s) || de(s, \"height\"), _e(c) || de(c, \"framerate\"), _e(d) || de(d, \"bitrate\", 1, 1e7), (!a && s || a && !s) && r.default.warning(\"[\".concat(t.clientId, \"] The width and height parameters take effect only when both are set\")), t.lowStreamParameter = n, i();\n      }, t.init = function (n, i, a) {\n        var s = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, t) {\n            if (e) return a && a(e);\n            i && i(t);\n          },\n          name: \"Client.init\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        ce(n), Object(f.isChromeKernel)() && Object(f.getChromeKernelVersion)() <= 48 ? a ? s(x.BAD_ENVIRONMENT) : Object(te.e)() : (r.default.info(\"[\".concat(t.clientId, \"] Initializing AgoraRTC client, appId: \").concat(n, \".\")), e.appId = n, e.sessionId = Object(te.b)(), s());\n      }, t.setTurnServer = function (n) {\n        var i = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.setTurnServer\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        if (t.gatewayClient && t.gatewayClient.state !== ot.DISCONNECTED) throw new Error(\"Set turn server before join channel\");\n        if (t.useProxyServer) throw new Error(\"You have already set the proxy\");\n        se(n, \"turnServer\");\n        var a = n.turnServerURL,\n            s = n.username,\n            c = n.password,\n            d = n.udpport,\n            u = n.forceturn,\n            l = n.tcpport;\n        ce(a, \"turnServerURL\"), ce(s, \"username\"), ce(c, \"password\"), ce(d, \"udpport\"), _e(u) || ue(u, \"forceturn\"), t.turnServer.mode = \"manual\", t.turnServer.url = a, t.turnServer.udpport = d, t.turnServer.username = s, t.turnServer.credential = c, t.turnServer.forceturn = u || !1, _e(l) || (ce(l, \"tcpport\"), t.turnServer.tcpport = l, r.default.info(\"[\".concat(t.clientId, \"] Set turnserver tcpurl. \").concat(t.turnServer.url, \":\").concat(t.turnServer.tcpport))), r.default.info(\"[\".concat(t.clientId, \"] Set turnserver udpurl. \").concat(t.turnServer.url, \":\").concat(t.turnServer.udpport, \",username: \").concat(t.turnServer.uername, \",password: \").concat(t.turnServer.credential)), i();\n      }, t.setProxyServer = function (n) {\n        var i = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.setProxyServer\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        if (t.gatewayClient && t.gatewayClient.state !== ot.DISCONNECTED) throw new Error(\"Set proxy server before join channel\");\n        if (!n) throw new Error(\"Do not set the proxyServer parameter as empty\");\n        if (t.useProxyServer) throw new Error(\"You have already set the proxy\");\n        ce(n, \"proxyServer\"), t.proxyServer = n, o.b.setProxyServer(n), r.default.setProxyServer(n), i();\n      }, t.startProxyServer = function () {\n        var n = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.startProxyServer\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        if (t.gatewayClient && t.gatewayClient.state !== ot.DISCONNECTED) throw new Error(\"Start proxy server before join channel\");\n        if (t.proxyServer || t.turnServer.url) throw new Error(\"You have already set the proxy\");\n        t.useProxyServer = !0, n();\n      }, t.stopProxyServer = function () {\n        var n = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.stopProxyServer\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        if (t.gatewayClient && t.gatewayClient.state !== ot.DISCONNECTED) throw new Error(\"Stop proxy server after leave channel\");\n        o.b.setProxyServer(), r.default.setProxyServer(), t.turnServer = {}, t.proxyServer = null, t.useProxyServer = !1, n();\n      }, t.setEncryptionSecret = function (n) {\n        var i = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.setEncryptionSecret\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        ce(n, \"password\"), t.aespassword = n, i();\n      }, t.setEncryptionMode = function (n) {\n        var i = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.setEncryptionMode\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        if (ce(n, \"encryptionMode\"), -1 === Ne.indexOf(n)) throw new Error('Invalid encryptionMode: encryptionMode should be \"aes-128-xts\" | \"aes-256-xts\" | \"aes-128-ecb\"');\n        t.aesmode = n, i();\n      }, t.configPublisher = function (n) {\n        var i = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.configPublisher\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        se(n, \"config\");\n        var a = n.width,\n            r = n.height,\n            s = n.framerate,\n            c = n.bitrate,\n            d = n.publisherUrl;\n        de(a, \"width\"), de(r, \"height\"), de(s, \"framerate\"), de(c, \"bitrate\", 1, 1e7), d && ce(d, \"publisherUrl\"), t.gatewayClient.configPublisher(n), i();\n      }, t.enableDualStream = function (n, i) {\n        var a = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, t) {\n            if (e) return i && i(e);\n            n && n(t);\n          },\n          name: \"Client.enableDualStream\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        return \"iOS\" === Object(f.getBrowserOS)() ? (o.b.streamSwitch(e.sessionId, {\n          lts: new Date().getTime(),\n          isdual: !0,\n          succ: !1\n        }), a(x.IOS_NOT_SUPPORT)) : Object(f.isWeChatBrowser)() ? (o.b.streamSwitch(e.sessionId, {\n          lts: new Date().getTime(),\n          isdual: !0,\n          succ: !1\n        }), a(x.WECHAT_NOT_SUPPORT)) : (o.b.streamSwitch(e.sessionId, {\n          lts: new Date().getTime(),\n          isdual: !0,\n          succ: !0\n        }), t.isDualStream = !0, t.highStream && (t.highStream.isDualStream = !0), void (0 === t.highStreamState ? t._publishLowStream(function (e) {\n          return a(null, e);\n        }, function (e) {\n          r.default.warning(\"[\".concat(t.clientId, \"]\"), e), a(x.ENABLE_DUALSTREAM_FAILED);\n        }) : 1 === t.highStreamState ? a(x.STILL_ON_PUBLISHING) : a(null)));\n      }, t.disableDualStream = function (n, i) {\n        var a = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, t) {\n            if (e) return i && i(e);\n            n && n(t);\n          },\n          name: \"Client.disableDualStream\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        o.b.streamSwitch(e.sessionId, {\n          lts: new Date().getTime(),\n          isdual: !1,\n          succ: !0\n        }), t.isDualStream = !1, t.highStream && (t.highStream.isDualStream = !1), 0 === t.highStreamState ? t._unpublishLowStream(function () {\n          t.highStream.lowStream = null, a();\n        }, function (e) {\n          r.default.warning(\"[\".concat(t.clientId, \"]\"), e), a(x.DISABLE_DUALSTREAM_FAILED);\n        }) : 1 === t.highStreamState ? a(x.STILL_ON_PUBLISHING) : a();\n      }, t._createLowStream = function (e, n) {\n        if (t.highStream && t.highStream.stream) {\n          var i = S()({}, t.highStream.params);\n\n          if (i.streamID += 1, i.audio = !1, i.video) {\n            var o = t.highStream.stream.getVideoTracks()[0];\n            o ? ie.getVideoCameraIdByLabel(o.label, function (o) {\n              i.cameraId = o;\n              var s = new Re(i);\n\n              if (s.streamId = t.highStream.getId() + 1, t.lowStreamParameter) {\n                var c = S()({}, t.lowStreamParameter);\n\n                if (!c.width || !c.height) {\n                  var d = st(t.highStream.profile),\n                      u = a.SUPPORT_RESOLUTION_LIST[d[0]];\n                  c.width = u[0], c.height = u[1];\n                }\n\n                if (c.framerate = c.framerate || 5, c.bitrate = c.bitrate || 50, Object(f.isSafari)() || Object(f.isOpera)()) {\n                  r.default.debug(\"[\".concat(t.clientId, \"] Shimming lowStreamParameter\"));\n                  u = a.SUPPORT_RESOLUTION_LIST[t.highStream.profile];\n                  c.width = u[0], c.height = u[1];\n                }\n\n                s.setVideoProfileCustomPlus(c);\n              } else s.setVideoProfileCustom(st(t.highStream.profile));\n\n              s.init(function () {\n                t.highStream.lowStream = s, t.highStream.userMuteVideo && s.muteVideo(), e && e(s);\n              }, n);\n            }, n) : n && n(x.HIGH_STREAM_NOT_VIDEO_TRACE);\n          } else n && n(x.HIGH_STREAM_NOT_VIDEO_TRACE);\n        } else n && n(x.HIGH_STREAM_NOT_VIDEO_TRACE);\n      }, t._getLowStream = function (e, n) {\n        t.lowStream ? e(t.lowStream) : t._createLowStream(function (n) {\n          t.lowStream = n, e(t.lowStream);\n        }, n);\n      }, t._publishLowStream = function (e, n) {\n        return 2 !== t.lowStreamState ? n && n(x.LOW_STREAM_ALREADY_PUBLISHED) : t.highStream && t.highStream.hasScreen() ? n && n(x.SHARING_SCREEN_NOT_SUPPORT) : void t._getLowStream(function (i) {\n          t.lowStreamState = 1, t.gatewayClient.publish(i, {\n            streamType: 1\n          }, function () {\n            t.lowStreamState = 0, e && e();\n          }, function (e) {\n            1 === t.lowStreamState && (t.lowStreamState = 2), r.default.debug(\"[\".concat(t.clientId, \"] publish low stream failed\")), n && n(e);\n          });\n        }, n);\n      }, t._unpublishLowStream = function (e, n) {\n        if (0 !== t.lowStreamState) return n && n(x.LOW_STREAM_NOT_YET_PUBLISHED);\n        t.lowStream && (t.gatewayClient.unpublish(t.lowStream, {\n          streamType: 1\n        }, function () {}, function (e) {\n          r.default.debug(\"[\".concat(t.clientId, \"] unpublish low stream failed\")), n && n(e);\n        }), t.lowStream.close(), t.lowStream = null, t.lowStreamState = 2, e && e());\n      }, t.join = function (n, i, a, s, c) {\n        var d,\n            u = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, t) {\n            if (e) return c && c(e);\n            s && s(t);\n          },\n          name: \"Client.join\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        if (n && !me(n)) return r.default.warning(\"[\".concat(t.clientId, \"] Param channelKey should be string\")), u(x.INVALID_PARAMETER);\n        if (!Ie(d = i) || !/^[a-zA-Z0-9 \\!\\#\\$\\%\\&\\(\\)\\+\\-\\:\\;\\<\\=\\.\\>\\?\\@\\[\\]\\^\\_\\{\\}\\|\\~\\,]{1,64}$/.test(d)) return r.default.error(\"Invalid Channel Name \".concat(i)), r.default.warning(\"[\".concat(t.clientId, \"] The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,\")), u(x.INVALID_PARAMETER);\n        if (\"string\" == typeof i && \"\" === i) return r.default.warning(\"[\".concat(t.clientId, \"] Param channel should not be empty\")), u(x.INVALID_PARAMETER);\n        if (a && !Object(te.c)(a) && !le(a, 1, 255)) return r.default.error(\"Invalid UID \".concat(a, \" \").concat(re()(a))), r.default.warning(\"[\".concat(t.clientId, \"] [String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]\")), u(x.INVALID_PARAMETER);\n        if (\"string\" == typeof a && 0 == a.length) return r.default.warning(\"[\".concat(t.clientId, \"] String uid should not be empty\")), u(x.INVALID_PARAMETER);\n        if (\"string\" == typeof a && a.length > 256) return r.default.warning(\"[\".concat(t.clientId, \"] Length of string uid should be less than 255\")), u(x.INVALID_PARAMETER);\n        t.highStream = null, t.lowStream = null, t.lowStreamParameter = null, t.isDualStream = !1, t.highStreamState = 2, t.lowStreamState = 2;\n        var l = {\n          clientId: t.clientId,\n          appId: e.appId,\n          sid: e.sessionId,\n          cname: i,\n          uid: a,\n          turnServer: t.turnServer,\n          proxyServer: t.proxyServer,\n          token: n || e.appId,\n          useProxyServer: t.useProxyServer\n        };\n        if (\"string\" == typeof a && (l.stringUid = a, t.uintUid ? (l.uid = t.uintUid, delete t.uintUid) : l.uid = 0), t.aespassword && \"none\" !== t.aesmode && S()(l, {\n          aespassword: t.aespassword,\n          aesmode: t.aesmode\n        }), o.b.sessionInit(e.sessionId, {\n          lts: new Date().getTime(),\n          cname: i,\n          appid: e.appId,\n          mode: e.mode,\n          succ: !0\n        }), t.onSuccess = function (e) {\n          t.rtcStatsCollector.startNetworkQualityTimer(), t.onSuccess = null, u(null, e);\n        }, t.onFailure = function (e) {\n          return u(e);\n        }, t.channel = i, t.gatewayClient.state !== ot.DISCONNECTED) return r.default.error(\"[\".concat(t.clientId, \"] Client already in connecting/connected state\")), u(x.INVALID_OPERATION), void o.b.joinGateway(e.sessionId, {\n          lts: Date.now(),\n          succ: !1,\n          ec: x.INVALID_OPERATION,\n          addr: null\n        });\n        t.gatewayClient.state = ot.CONNECTING;\n\n        var p = function (a, o) {\n          r.default.info(\"[\".concat(t.clientId, \"] Joining channel: \").concat(i)), t.gatewayClient.dispatchEvent({\n            type: \"config-distribute\",\n            config: o,\n            joinInfo: l\n          }), t.key = n || e.appId, l.cid = a.cid, l.uid || (l.uid = a.uid), l.vid = a.vid, l.clientId = t.clientId, l.apResponse = a.res, a.uni_lbs_ip && a.uni_lbs_ip[1] && (l.uni_lbs_ip = a.uni_lbs_ip[1]), l.gatewayAddr = a.gateway_addr, t.joinInfo = l, t.gatewayClient.join(l, t.key, function (e) {\n            r.default.info(\"[\".concat(t.clientId, \"] Join channel \").concat(i, \" success, join with uid: \").concat(e, \".\")), t.onSuccess = null, t.rtcStatsCollector.startNetworkQualityTimer(), u(null, e);\n          }, function (e) {\n            return u(e);\n          });\n        };\n\n        l.stringUid && !l.uid ? (t.userAccountReq && !t.userAccountReq.isFinished() && t.userAccountReq.cancel(), t.userAccountReq = Xe(l, t.gatewayClient), t.userAccountReq.then(function (e) {\n          r.default.debug(\"getUserAccount Success \".concat(e.url, \" \").concat(l.stringUid, \" => \").concat(e.uid)), l.uid = e.uid, ze(l, p);\n        }).catch(function (e) {\n          r.default.error(\"getUserAccount rejected\", e), u(e);\n        })) : ze(l, p);\n      }, t.renewChannelKey = function (n, i, a) {\n        var s = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, t) {\n            if (e) return a && a(e);\n            i && i(t);\n          },\n          name: \"Client.renewChannelKey\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        ce(n, \"key\", 1, 2047), void 0 === t.key ? (r.default.error(\"[\".concat(t.clientId, \"] renewChannelKey should not be called before user join\")), s(x.INVALID_OPERATION)) : (t.key = n, t.gatewayClient.joinInfo.token = n, t.gatewayClient.key = n, t.gatewayClient.recover(), s());\n      }, t.leave = function (n, i) {\n        t.gatewayClient.hasInvokeLeave = !0;\n        var s = !1,\n            c = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, a) {\n            if (e) return i && i(e);\n            var r;\n            t.gatewayClient.reconnectingCS = !1, clearTimeout((r = t.clientId, qe[r])), t._renewSession(), t.rtcStatsCollector.clearNetworkQualityTimer(), n && n(a);\n          },\n          name: \"Client.leave\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        r.default.info(\"[\".concat(t.clientId, \"] Leaving channel\")), t.userAccountReq && !t.userAccountReq.isFinished() && (t.userAccountReq.cancel(), t.gatewayClient.state === ot.CONNECTING && (t.gatewayClient.state = ot.DISCONNECTED)), t.gatewayClient.leave(function (e) {\n          s = !0, c(null, e);\n        }, c), setTimeout(function () {\n          s || (t.gatewayClient.socket && (t.gatewayClient.socket.close(), t.gatewayClient.socket = null), t.gatewayClient.state = ot.DISCONNECTED, c(null, \"LEAVE_MSG_TIMEOUT\"));\n        }, Object(a.getParameter)(\"LEAVE_MSG_TIMEOUT\"));\n      }, t._renewSession = function () {\n        var n = Object(te.b)();\n        if (r.default.debug(\"renewSession \".concat(e.sessionId, \" => \").concat(n)), e.sessionId = n, t.joinInfo && (t.joinInfo.sid = n), t.gatewayClient && (t.gatewayClient.joinInfo && (t.gatewayClient.joinInfo.sid = n), t.gatewayClient.localStreams)) for (var i in t.gatewayClient.localStreams) {\n          var a = t.gatewayClient.localStreams[i];\n          a && (a.sid = n);\n        }\n      }, t._publish = function (n, i, o) {\n        if (2 !== t.highStreamState) return r.default.warning(\"[\".concat(t.clientId, \"] Can't publish stream when stream already publish \").concat(n.getId())), o && o(x.STREAM_ALREADY_PUBLISHED);\n        if (\"auto\" === t.turnServer.mode && Object(a.getParameter)(\"FORCE_TURN\") && !Object(a.getParameter)(\"TURN_ENABLE_TCP\") && !Object(a.getParameter)(\"TURN_ENABLE_UDP\")) throw new Error(\"force TURN With No TURN Configuration\");\n        r.default.info(\"[\".concat(t.clientId, \"] Publishing stream, uid \").concat(n.getId())), t.highStream = n, t.highStreamState = 1, t.highStream.streamId = t.joinInfo.stringUid || t.joinInfo.uid, t.hasPublished = !1;\n\n        var s = function (n, i, a) {\n          t.gatewayClient.publish(n, {\n            streamType: 0\n          }, function () {\n            n.sid = e.sessionId, t.highStreamState = 0, r.default.info(\"[\".concat(t.clientId, \"] Publish success, uid: \").concat(n.getId())), t.highStream && (t.highStream.isDualStream = t.isDualStream), t.isDualStream ? t._publishLowStream(function () {\n              i && i();\n            }, function (e) {\n              r.default.warning(\"[\".concat(t.clientId, \"] \"), e), i && i();\n            }) : i && i();\n          }, a);\n        };\n\n        \"audience\" === t.gatewayClient.role && \"live\" === t.mode ? t.gatewayClient.setClientRole(\"host\", function (e) {\n          if (e) return o && o(e);\n          s(n, i, o);\n        }) : s(n, i, o);\n      }, t._unpublish = function (e, n, i) {\n        if (0 !== t.highStreamState) return r.default.warning(\"[\".concat(t.clientId, \"] Can't unpublish stream when stream not publish\")), i && i(x.STREAM_NOT_YET_PUBLISHED);\n        r.default.info(\"[\".concat(t.clientId, \"] Unpublish stream, uid \").concat(e.getId()));\n\n        var a = function (e, n, i) {\n          t.isDualStream && t.lowStream && t._unpublishLowStream(null, i), t.gatewayClient.unpublish(e, {\n            streamType: 0\n          }, function () {\n            t.highStreamState = 2, r.default.info(\"[\".concat(t.clientId, \"] Unpublish stream success, uid: \").concat(e.getId())), n && n();\n          }, function (n) {\n            r.default.info(\"[\".concat(t.clientId, \"] Unpublish stream fail, uid: \").concat(e.getId())), i && i(n);\n          });\n        };\n\n        \"host\" === t.gatewayClient.role && \"live\" === t.mode ? t.gatewayClient.setClientRole(\"audience\", function (t) {\n          if (t) return i && i(t);\n          a(e, n, i);\n        }) : a(e, n, i);\n      }, t.publish = function (n, i) {\n        var a = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, n) {\n            if (e) return 1 === t.highStreamState && (t.highStreamState = 2), i && i(e);\n          },\n          name: \"Client.publish\",\n          tag: \"tracer\",\n          options: {\n            stream: \"too long to show\",\n            onFailure: !!i\n          }\n        });\n        2 === t.highStreamState ? t._publish(n, function (e) {\n          return a(null, e);\n        }, function (e) {\n          return a(e);\n        }) : a(x.STREAM_ALREADY_PUBLISHED);\n      }, t.unpublish = function (n, i, a) {\n        var r = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, t) {\n            if (e) return i && i(e);\n            a && a(t);\n          },\n          name: \"Client.unpublish\",\n          tag: \"tracer\",\n          options: {\n            stream: \"too long to show\",\n            onFailure: !!i\n          }\n        });\n        0 === t.highStreamState ? t._unpublish(n, function (e) {\n          return r(null, e);\n        }, function (e) {\n          return r(e);\n        }) : r(x.STREAM_NOT_YET_PUBLISHED);\n      }, t.subscribe = function (n, i, a) {\n        var s = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, t) {\n            if (e) return a && a(e);\n          },\n          name: \"Client.subscribe\",\n          tag: \"tracer\",\n          options: {\n            stream: \"too long to show\",\n            options: i,\n            onFailure: !!a\n          }\n        });\n        \"function\" == typeof i && (a = i, i = null), se(n, \"stream\"), _e(i) || (se(i, \"options\"), _e(i.video) || ue(i.video, \"options.video\"), _e(i.audio) || ue(i.audio, \"options.audio\"));\n        var c = {\n          video: !0,\n          audio: !0\n        };\n\n        if (!_e(i)) {\n          if (Object(f.isSafari)() && (!i.video || !i.audio)) {\n            var d = \"SAFARI_NOT_SUPPORTED_FOR_TRACK_SUBSCRIPTION\";\n            return r.default.error(\"[\".concat(t.clientId, \"] \"), d), void s(d);\n          }\n\n          if (!_e(i.video) && !fe(i.video) || !_e(i.audio) && !fe(i.audio) || !1 === i.audio && !1 === i.video) {\n            d = \"INVALID_PARAMETER \".concat(JSON.stringify(i));\n            return r.default.error(\"[\".concat(t.clientId, \"] \"), d), void s(d);\n          }\n        }\n\n        n.subscribeOptions ? (S()(n.subscribeOptions, c, i), t.gatewayClient.subscribeChange(n, function (e) {\n          return s(null, e);\n        }, s)) : (n.subscribeOptions = S()({}, c, i), t.gatewayClient.subscribe(n, function (e) {\n          return s(null, e);\n        }, s));\n      }, t.unsubscribe = function (n, i) {\n        var a = o.b.reportApiInvoke(e.sessionId, {\n          callback: function (e, t) {\n            if (e) return i && i(e);\n          },\n          name: \"Client.unsubscribe\",\n          tag: \"tracer\",\n          options: {\n            stream: \"too long to show\",\n            onFailure: !!i\n          }\n        });\n        r.default.info(\"[\".concat(t.clientId, \"] Unsubscribe stream, uid: \").concat(n.getId())), t.gatewayClient.unsubscribe(n, function (e) {\n          return a(null, e);\n        }, a);\n      }, t.setRemoteVideoStreamType = function (n, i) {\n        var a = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.setRemoteVideoStreamType\",\n          tag: \"tracer\",\n          options: {\n            stream: \"too long to show\",\n            streamType: i\n          }\n        });\n        oe(i, \"streamType\", [0, 1]), t.gatewayClient.setRemoteVideoStreamType(n, i), a();\n      }, t.setStreamFallbackOption = function (n, i) {\n        var a = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.setStreamFallbackOption\",\n          tag: \"tracer\",\n          options: {\n            stream: \"too long to show\",\n            fallbackType: i\n          }\n        });\n        oe(i, \"fallbackType\", [0, 1, 2]), t.gatewayClient.setStreamFallbackOption(n, i), a();\n      }, t.enableAudioVolumeIndicator = function (n, i) {\n        var a = o.b.reportApiInvoke(e.sessionId, {\n          name: \"Client.enableAudioVolumeIndicator\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        n = n || 2e3, de(i = i || 3, \"smooth\", 1, 100), de(n, \"interval\", 50, 1e5), t.audioVolumeIndication = t.audioVolumeIndication || {\n          enabled: !0\n        }, t.audioVolumeIndication.interval = n, t.audioVolumeIndication.smooth = i, t.audioVolumeIndication = {\n          interval: n,\n          smooth: i\n        }, r.default.info(\"[\".concat(t.clientId, \"] enableAudioVolumeIndicator interval \").concat(n, \" smooth \").concat(i)), t.gatewayClient.enableAudioVolumeIndicator(n, i), a();\n      }, t.getNetworkStats = function (e, n) {\n        return r.default.deprecate(\"[\".concat(t.clientId, \"] client.getNetworkStats is deprecated. Use client.getTransportStats instead.\")), lt.getStats(e, n);\n      }, t.getSystemStats = function (e, t) {\n        return g.getStats(e, t);\n      }, t.getRecordingDevices = function (e, t) {\n        return ie.getRecordingDevices(e, t);\n      }, t.getPlayoutDevices = function (e, t) {\n        return ie.getPlayoutDevices(e, t);\n      }, t.getCameras = function (e, t) {\n        return ie.getCameras(e, t);\n      }, t.getRemoteAudioStats = function (e, n) {\n        return t.rtcStatsCollector.getRemoteAudioStats(e, n);\n      }, t.getLocalAudioStats = function (e, n) {\n        return t.rtcStatsCollector.getLocalAudioStats(e, n);\n      }, t.getRemoteVideoStats = function (e, n) {\n        return t.rtcStatsCollector.getRemoteVideoStats(e, n);\n      }, t.getLocalVideoStats = function (e, n) {\n        return t.rtcStatsCollector.getLocalVideoStats(e, n);\n      }, t._getRemoteVideoQualityStats = function (e, n) {\n        return t.rtcStatsCollector.getRemoteVideoQualityStats(e, n);\n      }, t._getRemoteAudioQualityStats = function (e, n) {\n        return t.rtcStatsCollector.getRemoteAudioQualityStats(e, n);\n      }, t.getTransportStats = function (e, n) {\n        return t.rtcStatsCollector.getTransportStats(function (t) {\n          return lt.getStats(function (n) {\n            var i = S()({}, t, n);\n            e && e(i);\n          }, n);\n        }, n);\n      }, t.getSessionStats = function (e, n) {\n        return t.rtcStatsCollector.getSessionStats(e, n);\n      }, t.onNetworkQuality = function () {\n        return t.rtcStatsCollector.onNetworkQuality(onSuccess, onFailure);\n      }, e.clientId = t.clientId, t.gatewayClient = ot(e), t.listenerLoggerTimer = null, t.listenerLoggerCache = [], t.on = function (e, n) {\n        t.gatewayClient.on(e, n), t.listenerLoggerCache.push(\"\".concat(e).concat(n.name ? \":\" + n.name : \"\")), t.listenerLoggerTimer ? clearTimeout(t.listenerLoggerTimer) : r.default.info(\"[\".concat(t.clientId, \"] Adding event handler on \").concat(e)), t.listenerLoggerTimer = setTimeout(function () {\n          t.listenerLoggerCache.length && (t.listenerLoggerTimer = null, r.default.info(\"[\".concat(t.clientId, \"] Added event handler on \").concat(t.listenerLoggerCache.join(\", \"))), t.listenerLoggerCache = []);\n        }, 0);\n      }, t.off = function (e, n) {\n        r.default.info(\"remove event handler from [\".concat(e, \"]\")), t.gatewayClient.removeEventListener(e, n);\n      }, t.rtcStatsCollector = function (e) {\n        var t = s();\n        return t.gatewayClient = e, t.exceptionMonitor = new ut(e), t.localStats = {}, t.remoteStats = {}, t.session = {\n          sendBytes: 0,\n          recvBytes: 0,\n          WSSendBytes: 0,\n          WSSendBytesDelta: 0,\n          WSRecvBytes: 0,\n          WSRecvBytesDelta: 0,\n          HTTPSendBytes: 0,\n          HTTPSendBytesDelta: 0,\n          HTTPRecvBytes: 0,\n          HTTPRecvBytesDelta: 0\n        }, t.getRemoteAudioStats = function (e) {\n          var n = {};\n\n          for (var i in t.remoteStats) {\n            var a = {},\n                r = t.remoteStats[i];\n            ne(a, \"End2EndDelay\", r.peer_delay && r.peer_delay.audio_delay), ne(a, \"TransportDelay\", r.peer_delay && r.peer_delay.e2e_delay), ne(a, \"PacketLossRate\", r.peer_delay && r.peer_delay.e2e_audio_lost_ratio_400ms), ne(a, \"RecvLevel\", r.audioStats && r.audioStats.audioOutputLevel), ne(a, \"RecvBitrate\", r.audioRecvBitrate), ne(a, \"CodecType\", r.audioStats && r.audioStats.googCodecName), ne(a, \"MuteState\", r.audioDisabled), ne(a, \"TotalFreezeTime\", r.audioStats && r.audioStats.audioTotalFreezeTime), ne(a, \"TotalPlayDuration\", r.audioStats && r.audioStats.audioTotalPlayDuration), n[i] = a;\n          }\n\n          e && e(n);\n        }, t.getLocalAudioStats = function (e) {\n          var n = {};\n\n          for (var i in t.localStats) {\n            var a = {},\n                r = t.localStats[i];\n            ne(a, \"RecordingLevel\", r.audioStats && r.audioStats.audioInputLevel), ne(a, \"SendLevel\", r.audioStats && r.audioStats.totalAudioEnergy), ne(a, \"SamplingRate\", r.audioStats && r.audioStats.totalSamplesDuration), ne(a, \"SendBitrate\", r.audioSendBitrate), ne(a, \"CodecType\", r.audioStats && r.audioStats.googCodecName), ne(a, \"MuteState\", r.audioDisabled);\n            var o = t.gatewayClient.localStreams[i];\n            o && o.isPlaying() && ne(a, \"MuteState\", o.userMuteAudio ? \"1\" : \"0\"), n[i] = a;\n          }\n\n          e && e(n);\n        }, t.getRemoteVideoStats = function (e) {\n          var n = {};\n\n          for (var i in t.remoteStats) {\n            var a = {},\n                r = t.remoteStats[i];\n            ne(a, \"End2EndDelay\", r.peer_delay && r.peer_delay.video_delay), ne(a, \"TransportDelay\", r.peer_delay && r.peer_delay.e2e_delay), ne(a, \"PacketLossRate\", r.peer_delay && r.peer_delay.e2e_video_lost_ratio_400ms), ne(a, \"RecvBitrate\", r.videoRecvBitrate), ne(a, \"RecvResolutionWidth\", r.videoStats && r.videoStats.googFrameWidthReceived), ne(a, \"RecvResolutionHeight\", r.videoStats && r.videoStats.googFrameHeightReceived), ne(a, \"RenderResolutionWidth\", r.videoStats && r.videoStats.renderRemoteWidth), ne(a, \"RenderResolutionHeight\", r.videoStats && r.videoStats.renderRemoteHeight), ne(a, \"RenderFrameRate\", r.videoStats && r.videoStats.googFrameRateOutput), ne(a, \"MuteState\", r.videoDisabled), ne(a, \"TotalFreezeTime\", r.videoStats && r.videoStats.videoTotalFreezeTime), ne(a, \"TotalPlayDuration\", r.videoStats && r.videoStats.videoTotalPlayDuration), n[i] = a;\n          }\n\n          e && e(n);\n        }, t.getLocalVideoStats = function (e) {\n          var n = {};\n\n          for (var i in t.localStats) {\n            var a = {},\n                r = t.localStats[i];\n            ne(a, \"TargetSendBitrate\", r.videoTargetSendBitrate), ne(a, \"SendFrameRate\", r.videoStats && r.videoStats.googFrameRateSent), ne(a, \"SendBitrate\", r.videoSendBitrate), ne(a, \"SendResolutionWidth\", r.videoStats && r.videoStats.googFrameWidthSent), ne(a, \"SendResolutionHeight\", r.videoStats && r.videoStats.googFrameHeightSent), ne(a, \"CaptureResolutionWidth\", r.videoStats && r.videoStats.googFrameWidthInput), ne(a, \"CaptureResolutionHeight\", r.videoStats && r.videoStats.googFrameHeightInput), ne(a, \"EncodeDelay\", r.videoStats && r.videoStats.googAvgEncodeMs), ne(a, \"MuteState\", r.videoDisabled), ne(a, \"TotalFreezeTime\", r.videoStats && r.videoStats.videoTotalFreezeTime), ne(a, \"TotalDuration\", r.videoStats && r.videoStats.videoTotalPlayDuration), ne(a, \"CaptureFrameRate\", r.videoStats && r.videoStats.googFrameRateSent), r.videoStats && !r.videoStats.googFrameWidthInput && ne(a, \"CaptureResolutionWidth\", r.videoStats && r.videoStats.renderLocalWidth), r.videoStats && !r.videoStats.googFrameHeightInput && ne(a, \"CaptureResolutionHeight\", r.videoStats && r.videoStats.renderLocalHeight), n[i] = a, e && e(n);\n          }\n        }, t.getRemoteVideoQualityStats = function (e) {\n          var n = {};\n\n          for (var i in t.remoteStats) {\n            var a = {},\n                r = t.remoteStats[i];\n            ne(a, \"videoReceiveDelay\", r.videoStats && r.videoStats.googCurrentDelayMs), ne(a, \"VideoFreezeRate\", r.videoStats && r.videoStats.videoFreezeRate), ne(a, \"FirstFrameTime\", r.firstFrameTime), n[i] = a;\n          }\n\n          e && e(n);\n        }, t.getRemoteAudioQualityStats = function (e) {\n          var n = {};\n\n          for (var i in t.remoteStats) {\n            var a = {},\n                r = t.remoteStats[i];\n            ne(a, \"audioReceiveDelay\", r.audioStats && r.audioStats.googCurrentDelayMs), ne(a, \"AudioFreezeRate\", r.videoStats && r.videoStats.videoFreezeRate), n[i] = a;\n          }\n\n          e && e(n);\n        }, t.getTransportStats = function (e) {\n          var n = {},\n              i = {},\n              a = t.gatewayClient.traffic_stats,\n              r = a.peer_delay;\n\n          if (ne(n, \"OutgoingAvailableBandwidth\", t.gatewayClient.OutgoingAvailableBandwidth / 1e3), ne(n, \"RTT\", a && a.access_delay), r) {\n            var o = !0,\n                s = !1,\n                c = void 0;\n\n            try {\n              for (var d, u = r[Symbol.iterator](); !(o = (d = u.next()).done); o = !0) {\n                var l = d.value;\n                l.downlink_estimate_bandwidth && (i[l.peer_uid] = l.downlink_estimate_bandwidth / 1e3 + \"\");\n              }\n            } catch (e) {\n              s = !0, c = e;\n            } finally {\n              try {\n                o || null == u.return || u.return();\n              } finally {\n                if (s) throw c;\n              }\n            }\n          }\n\n          n.IncomingAvailableBandwidth = i, e && e(n);\n        }, t.getSessionStats = function (e) {\n          var n = {},\n              i = t.gatewayClient.traffic_stats,\n              a = t.gatewayClient.socket,\n              r = 0,\n              o = 0;\n\n          for (var s in t.remoteStats) (c = t.remoteStats[s]) && c.videoStats && c.videoStats.videoRecvBytesDelta && (o += parseInt(c.videoStats.videoRecvBytesDelta)), c && c.audioStats && c.audioStats.audioRecvBytesDelta && (o += parseInt(c.audioStats.audioRecvBytesDelta));\n\n          for (var s in t.localStats) {\n            var c;\n            (c = t.localStats[s]) && c.videoStats && c.videoStats.videoSendBytesDelta && (r += parseInt(c.videoStats.videoSendBytesDelta)), c && c.audioStats && c.audioStats.audioSendBytesDelta && (r += parseInt(c.audioStats.audioSendBytesDelta));\n          }\n\n          var d = r + t.session.WSSendBytesDelta + t.session.HTTPSendBytesDelta,\n              u = o + t.session.WSRecvBytesDelta + t.session.HTTPRecvBytesDelta,\n              l = t.session.sendBytes + Object(Le.b)(),\n              p = t.session.recvBytes + Object(Le.a)();\n          t.gatewayClient.socket && t.gatewayClient.socket.state === t.gatewayClient.CONNECTED && (l += a.getSendBytes(), p += a.getRecvBytes());\n          var f = 1;\n          i.peer_delay && (f = i.peer_delay.length, f += 1), ne(n, \"Duration\", a.getDuration()), ne(n, \"UserCount\", f), ne(n, \"SendBytes\", l), ne(n, \"RecvBytes\", p), ne(n, \"SendBitrate\", 8 * d / 1e3), ne(n, \"RecvBitrate\", 8 * u / 1e3), e && e(n);\n        }, t.isLocalVideoFreeze = function (e, t) {\n          var n = 0,\n              i = 0;\n          if (!e || !t) return !1;\n          if (Object(f.isChrome)() || Object(f.isOpera)()) n = e.googFrameRateInput, i = e.googFrameRateSent;else if (Object(f.isSafari)()) n = parseInt(e.framerateMean), i = parseInt(e.framesEncoded) - parseInt(t.framesEncoded);else {\n            if (!Object(f.isFireFox)()) return !1;\n            n = parseInt(e.framerateMean), i = parseInt(e.framesEncoded) - parseInt(t.framesEncoded);\n          }\n          return n > 5 && i < 3;\n        }, t.isRemoteVideoFreeze = function (e, t) {\n          var n = 0,\n              i = 0;\n          if (!e || !t) return !1;\n          if (Object(f.isChrome)() || Object(f.isOpera)()) n = e.googFrameRateReceived, i = e.googFrameRateDecoded;else if (Object(f.isSafari)()) n = e.framerateMean, i = parseInt(e.framesDecoded) - parseInt(t.framesDecoded);else {\n            if (!Object(f.isFireFox)()) return !1;\n            n = parseInt(e.framesReceived) - parseInt(t.framesReceived), i = parseInt(e.framesDecoded) - parseInt(t.framesDecoded);\n          }\n          return n > 5 && n < 10 && i < 3 || n > 10 && n < 20 && i < 4 || n > 20 && i < 5;\n        }, t.isAudioFreeze = function (e) {\n          if (Object(f.isChrome)() && e) {\n            if (e.googDecodingPLC && e.googDecodingPLCCNG && e.googDecodingCTN) return (parseInt(e.googDecodingPLC) + parseInt(e.googDecodingPLCCNG)) / parseInt(e.googDecodingCTN) > .2;\n          } else if ((Object(f.isSafari)() || Object(f.isFireFox)()) && e.packetsLost && e.packetsReceived) return parseInt(e.packetsLost) / (parseInt(e.packetsLost) + parseInt(e.packetsReceived)) > .2;\n\n          return !1;\n        }, t.isAudioDecodeFailed = function (e) {\n          return !!((Object(f.isChrome)() || Object(f.isOpera)()) && e && parseInt(e.bytesReceived) > 0 && 0 === parseInt(e.googDecodingNormal));\n        }, t.startNetworkQualityTimer = function () {\n          t.clearNetworkQualityTimer(), t.networkQualityTimer = setInterval(function () {\n            if (t.gatewayClient.state !== ot.CONNECTED) t.gatewayClient.dispatchEvent({\n              type: \"network-quality\",\n              uplinkNetworkQuality: 0,\n              downlinkNetworkQuality: 0\n            });else {\n              var e = t.gatewayClient.traffic_stats;\n              t.gatewayClient.dispatchEvent({\n                type: \"network-quality\",\n                uplinkNetworkQuality: t.networkQualityTrans(e.uplink_network_quality),\n                downlinkNetworkQuality: t.networkQualityTrans(e.downlink_network_quality)\n              });\n            }\n          }, 2e3);\n        }, t.clearNetworkQualityTimer = function () {\n          t.networkQualityTimer && clearInterval(t.networkQualityTimer);\n        }, t.networkQualityTrans = function (e) {\n          return e >= 0 && e < .17 ? 1 : e >= .17 && e < .36 ? 2 : e >= .36 && e < .59 ? 3 : e >= .59 && e <= 1 ? 4 : e > 1 ? 5 : 0;\n        }, t.getStatsTimer = setInterval(function () {\n          var e = t.gatewayClient.traffic_stats,\n              n = Date.now();\n          t.gatewayClient.dispatchEvent({\n            type: \"_testException\"\n          }), Object.keys(t.localStats).length && t.exceptionMonitor.setLocalStats(t.localStats), Object.keys(t.remoteStats).length && t.exceptionMonitor.setRemoteStats(t.remoteStats);\n          var i = {};\n          Object.keys(t.gatewayClient.remoteStreams).forEach(function (a) {\n            var r = t.gatewayClient.remoteStreams[a],\n                o = t.remoteStats[a],\n                s = {\n              id: a,\n              updatedAt: n\n            };\n            i[a] = s, s.firstFrameTime = r.firstFrameTime, o ? (s.audioTotalPlayDuration = o.audioTotalPlayDuration + 1, s.audioTotalFreezeTime = o.audioTotalFreezeTime, s.isAudioFreeze = !1, s.isAudioDecodeFailed = !1, s.videoTotalPlayDuration = o.videoTotalPlayDuration + 1, s.videoTotalFreezeTime = o.videoTotalFreezeTime, s.isVideoFreeze = !1) : (s.audioTotalPlayDuration = 1, s.audioTotalFreezeTime = 0, s.videoTotalPlayDuration = 1, s.videoTotalFreezeTime = 0);\n            var c = e && e.peer_delay && e.peer_delay.find(function (e) {\n              return e.peer_uid == a;\n            });\n            c && (s.peer_delay = c), r && (r.isPlaying() && (s.audioDisabled = r.userMuteAudio || r.peerMuteAudio ? \"1\" : \"0\", s.videoDisabled = r.userMuteVideo || r.peerMuteVideo ? \"1\" : \"0\"), o && o.peer_delay && c && o.peer_delay.stream_type !== c.stream_type && t.gatewayClient.dispatchEvent({\n              type: \"streamTypeChange\",\n              uid: a,\n              streamType: c.stream_type\n            }), r.pc && \"established\" == r.pc.state && r.pc.getStats(function (e) {\n              if (s.pcStats = e, s.audioStats = e.find(function (e) {\n                return \"audio\" == e.mediaType && (e.id.indexOf(\"_recv\") > -1 || e.id.toLowerCase().indexOf(\"inbound\") > -1);\n              }), s.videoStats = e.find(function (e) {\n                return \"video\" == e.mediaType && (e.id.indexOf(\"_recv\") > -1 || e.id.toLowerCase().indexOf(\"inbound\") > -1);\n              }), o && o.audioStats && s.audioStats) {\n                var n = parseInt(s.audioStats.bytesReceived) - parseInt(o.audioStats.bytesReceived),\n                    i = parseInt(s.audioStats.googDecodingNormal) - parseInt(o.audioStats.googDecodingNormal);\n\n                if (s.audioStats.audioRecvBytesDelta = n, s.audioStats.audioDecodingNormalDelta = i, t.session.recvBytes += n, isFinite(n) && s.audioStats.timestamp) {\n                  var a = s.audioStats.timestamp.getTime() - o.audioStats.timestamp.getTime();\n                  s.audioRecvBitrate = Math.floor(8 * n / a);\n                }\n\n                t.isAudioFreeze(s.audioStats) && s.audioTotalPlayDuration > 10 && (s.audioTotalFreezeTime++, s.isAudioFreeze = !0), t.isAudioDecodeFailed(s.audioStats) && s.audioTotalPlayDuration > 10 && (s.isAudioDecodeFailed = !0), s.audioStats.audioTotalFreezeTime = s.audioTotalFreezeTime, s.audioStats.audioTotalPlayDuration = s.audioTotalPlayDuration, s.audioStats.audioFreezeRate = Math.ceil(100 * s.audioTotalFreezeTime / s.audioTotalPlayDuration);\n              }\n\n              if (o && o.videoStats && s.videoStats) {\n                var c = parseInt(s.videoStats.bytesReceived) - parseInt(o.videoStats.bytesReceived);\n                s.videoStats.videoRecvBytesDelta = c, t.session.recvBytes += c, isFinite(c) && s.videoStats.timestamp && (a = s.videoStats.timestamp.getTime() - o.videoStats.timestamp.getTime(), s.videoRecvBitrate = Math.floor(8 * c / a)), t.isRemoteVideoFreeze(s.videoStats, o.videoStats) && (s.videoTotalFreezeTime++, s.isVideoFreeze = !0), s.videoStats.videoTotalFreezeTime = s.videoTotalFreezeTime, s.videoStats.videoTotalPlayDuration = s.videoTotalPlayDuration, s.videoStats.videoFreezeRate = Math.ceil(100 * s.videoTotalFreezeTime / s.videoTotalPlayDuration), r.player && r.player.video && r.player.video.videoWidth && r.player.video.videoHeight ? (s.videoStats.renderRemoteWidth = r.player.video.videoWidth, s.videoStats.renderRemoteHeight = r.player.video.videoHeight) : (s.videoStats.renderRemoteWidth = r.videoWidth || s.videoStats.googFrameWidthReceived, s.videoStats.renderRemoteHeight = r.videoHeight || s.videoStats.googFrameHeightReceived);\n              }\n            }));\n          }), t.remoteStats = i;\n          var a = {};\n\n          if (Object.keys(t.gatewayClient.localStreams).forEach(function (e) {\n            var i = t.gatewayClient.localStreams[e],\n                r = t.localStats[e],\n                o = {\n              id: e,\n              updatedAt: n\n            };\n            a[e] = o, r ? (o.videoTotalPlayDuration = r.videoTotalPlayDuration + 1, o.videoTotalFreezeTime = r.videoTotalFreezeTime, o.isVideoFreeze = !1) : (o.videoTotalPlayDuration = 1, o.videoTotalFreezeTime = 0), i && (i.isPlaying() && (o.audioDisabled = i.userMuteAudio ? \"1\" : \"0\", o.videoDisabled = i.userMuteVideo ? \"1\" : \"0\"), i.video && i.attributes.maxVideoBW ? o.videoTargetSendBitrate = i.attributes.maxVideoBW : i.video && i.screenAttributes && (o.videoTargetSendBitrate = i.screenAttributes.maxVideoBW), i.pc && \"established\" == i.pc.state && i.pc.getStats(function (e) {\n              if (o.pcStats = e.reverse(), o.audioStats = e.find(function (e) {\n                return \"audio\" == e.mediaType && (e.id.indexOf(\"_send\") > -1 || e.id.toLowerCase().indexOf(\"outbound\") > -1);\n              }), o.videoStats = e.find(function (e) {\n                return \"video\" == e.mediaType && (e.id.indexOf(\"_send\") > -1 || e.id.toLowerCase().indexOf(\"outbound\") > -1);\n              }), o.audioStats && r && r.audioStats) {\n                var n = parseInt(o.audioStats.bytesSent) - parseInt(r.audioStats.bytesSent);\n\n                if (o.audioStats.audioSendBytesDelta = n, t.session.sendBytes += n, isFinite(n) && o.audioStats.timestamp) {\n                  var a = o.audioStats.timestamp.getTime() - r.audioStats.timestamp.getTime();\n                  o.audioSendBitrate = Math.floor(8 * n / a);\n                }\n              }\n\n              if (o.videoStats && r && r.videoStats) {\n                var s = parseInt(o.videoStats.bytesSent) - parseInt(r.videoStats.bytesSent);\n                o.videoStats.videoSendBytesDelta = s, t.session.sendBytes += s, isFinite(s) && o.videoStats.timestamp && (a = o.videoStats.timestamp.getTime() - r.videoStats.timestamp.getTime(), o.videoSendBitrate = Math.floor(8 * s / a)), t.isLocalVideoFreeze(o.videoStats, r.videoStats) && (o.videoTotalFreezeTime++, o.isVideoFreeze = !0), o.videoStats.videoTotalFreezeTime = o.videoTotalFreezeTime, o.videoStats.videoTotalPlayDuration = o.videoTotalPlayDuration, o.videoStats.videoFreezeRate = Math.ceil(100 * o.videoTotalFreezeTime / o.videoTotalPlayDuration), o.videoStats.renderLocalWidth = i.videoWidth || o.videoStats.googFrameWidthSent, o.videoStats.renderLocalHeight = i.videoHeight || o.videoStats.googFrameHeightSent;\n              }\n            }));\n          }), t.localStats = a, t.session.HTTPSendBytesDelta = Object(Le.b)() - t.session.HTTPSendBytes, t.session.HTTPSendBytes = Object(Le.b)(), t.session.HTTPRecvBytesDelta = Object(Le.a)() - t.session.HTTPRecvBytes, t.session.HTTPRecvBytes = Object(Le.a)(), t.gatewayClient.socket && t.gatewayClient.socket.state === t.gatewayClient.CONNECTED) {\n            var r = t.gatewayClient.socket;\n            t.session.WSSendBytesDelta = r.getSendBytes() - t.session.WSSendBytes, t.session.WSSendBytes = r.getSendBytes(), t.session.WSRecvBytesDelta = r.getRecvBytes() - t.session.WSRecvBytes, t.session.WSRecvBytes = r.getRecvBytes();\n          }\n        }, 1e3), t.gatewayClient.on(\"join\", function () {\n          t.session = {\n            sendBytes: 0,\n            recvBytes: 0,\n            WSSendBytes: 0,\n            WSSendBytesDelta: 0,\n            WSRecvBytes: 0,\n            WSRecvBytesDelta: 0,\n            HTTPSendBytes: 0,\n            HTTPSendBytesDelta: 0,\n            HTTPRecvBytes: 0,\n            HTTPRecvBytesDelta: 0\n          };\n        }), t;\n      }(t.gatewayClient), t.configDistributManager = function (e) {\n        var t = {};\n        return t.client = e, t.client.gatewayClient && t.client.gatewayClient.on(\"config-distribute\", function (n) {\n          var i = n.joinInfo,\n              s = n.config;\n\n          if (s) {\n            _e(s.uploadLog) || (Object(a.setParameter)(\"UPLOAD_LOG\", s.uploadLog), o.b.reportApiInvoke(i.sid, {\n              name: \"_configDistribute\",\n              options: {\n                feature: \"uploadLog\",\n                value: s.uploadLog\n              }\n            })()), _e(s.dualStream) || (e.isDualStream = s.dualStream, o.b.reportApiInvoke(i.sid, {\n              name: \"_configDistribute\",\n              options: {\n                feature: \"dualStream\",\n                value: s.dualStream\n              }\n            })()), _e(s.streamFallbackOption) || t.client.gatewayClient && t.client.gatewayClient.on(\"stream-subscribed\", function (e) {\n              var n = e.stream;\n              n ? (t.client.gatewayClient.setStreamFallbackOption(n, s.streamFallbackOption), o.b.reportApiInvoke(i.sid, {\n                name: \"_configDistribute\",\n                options: {\n                  feature: \"streamFallbackOption\",\n                  value: s.streamFallbackOption,\n                  streamId: n.getId()\n                }\n              })()) : o.b.reportApiInvoke(i.sid, {\n                name: \"_configDistribute\",\n                options: {\n                  feature: \"streamFallbackOption\",\n                  value: s.streamFallbackOption,\n                  streamId: n.getId(),\n                  err: \"invalid stream\"\n                }\n              })();\n            });\n\n            try {\n              r.default.debug(\"[\".concat(e.clientId, \"] setParameter in distribution: \").concat(JSON.stringify(s))), Object.keys(s).map(function (e) {\n                return Object(a.setParameter)(e, s[e]);\n              });\n            } catch (t) {\n              r.default.debug(\"[\".concat(e.clientId, \"] setParameter in distribution failed: \").concat(JSON.stringify(s)));\n            }\n          }\n        }), t;\n      }(t), function (e, t) {\n        var n = arguments;\n        e.liveStreaming = s(), e.liveStreaming.connections = {\n          inject_streaming: null,\n          mix_streaming: null,\n          raw_streaming: null\n        }, e.liveStreaming.connectionTypes = {\n          inject_streaming: \"pull\",\n          mix_streaming: \"push\",\n          raw_streaming: \"push\"\n        }, e.liveStreaming.pushStates = {}, e.liveStreaming.pullStates = {}, e.gatewayClient.addEventListener(\"join\", function (t) {\n          e.liveStreaming.resumeStates(\"pull\");\n        }), e.gatewayClient.addEventListener(\"stream-unpublished\", function (t) {\n          if (t.options && 0 === t.options.streamType) for (var n in e.liveStreaming.pushStates) {\n            var i = e.liveStreaming.pushStates[n];\n            i.url && e._stopLiveStreaming(i.url, i.transcodingEnabled, !0);\n          }\n        }), e.gatewayClient.addEventListener(\"stream-published\", function (t) {\n          e.liveStreaming.resumeStates(\"push\");\n        }), e.liveStreaming.connect = (m = Fe()(Ue.a.mark(function n(i) {\n          var a, r;\n          return Ue.a.wrap(function (n) {\n            for (;;) switch (n.prev = n.next) {\n              case 0:\n                if (e.joinInfo && e.joinInfo.uid && parseInt(e.joinInfo.vid, 10)) {\n                  n.next = 3;\n                  break;\n                }\n\n                throw new Error(\"CLIENT_NOT_JOINED\");\n\n              case 3:\n                return a = new Rt({\n                  appId: t.appId,\n                  cname: e.channel,\n                  sid: t.sessionId,\n                  uid: e.joinInfo.uid\n                }), e.liveStreaming.connections[i] = a, n.next = 7, _t({\n                  appId: t.appId,\n                  cname: e.channel,\n                  serviceName: i,\n                  sid: t.sessionId\n                });\n\n              case 7:\n                return r = n.sent, n.next = 10, a.connect({\n                  wsClient: r\n                });\n\n              case 10:\n                return a.on(\"notification\", function (t) {\n                  if (t.serviceName = i, e.liveStreaming.dispatchEvent(t), 503 === t.code) ;else switch (t.serviceName) {\n                    case \"inject_streaming\":\n                      var n = {\n                        reason: t && t.reason,\n                        status: Ct(t && t.code),\n                        type: \"streamInjectedStatus\",\n                        uid: t && t.serverStatus && t.serverStatus.inject_uid,\n                        url: t && t.serverStatus && t.serverStatus.url\n                      };\n                      e.gatewayClient.dispatchEvent(n);\n                      break;\n\n                    case \"raw_streaming\":\n                    case \"mix_streaming\":\n                      var a = {\n                        reason: t && t.reason,\n                        status: t && t.code,\n                        type: t && 200 === t.code ? \"liveStreamingStarted\" : \"liveStreamingFailed\",\n                        uid: t && t.serverStatus && t.uid,\n                        url: t && t.serverStatus && t.serverStatus.url\n                      };\n                      e.gatewayClient.dispatchEvent(a);\n                  }\n                }), n.abrupt(\"return\", a);\n\n              case 12:\n              case \"end\":\n                return n.stop();\n            }\n          }, n, this);\n        })), function (e) {\n          return m.apply(this, arguments);\n        }), e.liveStreaming.disconnect = (f = Fe()(Ue.a.mark(function t(n) {\n          var i, a;\n          return Ue.a.wrap(function (t) {\n            for (;;) switch (t.prev = t.next) {\n              case 0:\n                t.t0 = Ue.a.keys(e.liveStreaming.connections);\n\n              case 1:\n                if ((t.t1 = t.t0()).done) {\n                  t.next = 13;\n                  break;\n                }\n\n                if (i = t.t1.value, !e.liveStreaming.connections.hasOwnProperty(i)) {\n                  t.next = 11;\n                  break;\n                }\n\n                if (!(a = e.liveStreaming.connections[i]) || n && n !== i) {\n                  t.next = 11;\n                  break;\n                }\n\n                return r.default.info(\"Disconnecting liveStreaming \".concat(i)), t.next = 9, a.disconnect();\n\n              case 9:\n                t.sent, e.liveStreaming.connections[i] = null;\n\n              case 11:\n                t.next = 1;\n                break;\n\n              case 13:\n              case \"end\":\n                return t.stop();\n            }\n          }, t, this);\n        })), function (e) {\n          return f.apply(this, arguments);\n        }), e.liveStreaming.resumeStates = (p = Fe()(Ue.a.mark(function t(n) {\n          var i, a, o, s, c, d, u, l;\n          return Ue.a.wrap(function (t) {\n            for (;;) switch (t.prev = t.next) {\n              case 0:\n                t.t0 = Ue.a.keys(e.liveStreaming.connections);\n\n              case 1:\n                if ((t.t1 = t.t0()).done) {\n                  t.next = 8;\n                  break;\n                }\n\n                if (i = t.t1.value, !n || e.liveStreaming.connectionTypes[i] === n) {\n                  t.next = 5;\n                  break;\n                }\n\n                return t.abrupt(\"continue\", 1);\n\n              case 5:\n                e.liveStreaming.connections.hasOwnProperty(i) && (a = e.liveStreaming.connections[i]) && (r.default.info(\"LiveStreaming closing connection \".concat(i)), a.disconnect(), e.liveStreaming.connections[i] = null), t.next = 1;\n                break;\n\n              case 8:\n                t.t2 = Ue.a.keys(e.liveStreaming.pushStates);\n\n              case 9:\n                if ((t.t3 = t.t2()).done) {\n                  t.next = 37;\n                  break;\n                }\n\n                if (o = t.t3.value, !n || \"push\" === n) {\n                  t.next = 13;\n                  break;\n                }\n\n                return t.abrupt(\"continue\", 9);\n\n              case 13:\n                if (!e.liveStreaming.pushStates.hasOwnProperty(o)) {\n                  t.next = 35;\n                  break;\n                }\n\n                if (s = e.liveStreaming.pushStates[o], \"audience\" !== e.gatewayClient.role) {\n                  t.next = 19;\n                  break;\n                }\n\n                r.default.warning(\"Cannot resume LiveStreaming in audience mode. \".concat(s.url), s), t.next = 35;\n                break;\n\n              case 19:\n                if (!s) {\n                  t.next = 35;\n                  break;\n                }\n\n                return r.default.debug(\"Resuming LiveStreaming \".concat(s.url), s), t.prev = 21, t.next = 24, e._startLiveStreaming(s.url, s.transcodingEnabled);\n\n              case 24:\n                c = t.sent, r.default.debug(\"Resumed LiveStreaming \".concat(s.url, \": \").concat(c.reason)), t.next = 35;\n                break;\n\n              case 28:\n                if (t.prev = 28, t.t4 = t.catch(21), 454 !== t.t4.code) {\n                  t.next = 34;\n                  break;\n                }\n\n                r.default.debug(\"Resumed LiveStreaming \".concat(s.url, \": \").concat(t.t4.reason)), t.next = 35;\n                break;\n\n              case 34:\n                throw t.t4;\n\n              case 35:\n                t.next = 9;\n                break;\n\n              case 37:\n                t.t5 = Ue.a.keys(e.liveStreaming.pullStates);\n\n              case 38:\n                if ((t.t6 = t.t5()).done) {\n                  t.next = 62;\n                  break;\n                }\n\n                if (d = t.t6.value, !n || \"pull\" === n) {\n                  t.next = 42;\n                  break;\n                }\n\n                return t.abrupt(\"continue\", 38);\n\n              case 42:\n                if (!e.liveStreaming.pullStates.hasOwnProperty(d)) {\n                  t.next = 60;\n                  break;\n                }\n\n                if (u = e.liveStreaming.pullStates[d], \"audience\" !== e.gatewayClient.role) {\n                  t.next = 48;\n                  break;\n                }\n\n                r.default.warning(\"Cannot resume addInjectStreamUrl in audience mode. \".concat(u.url), u), t.next = 60;\n                break;\n\n              case 48:\n                if (!u) {\n                  t.next = 60;\n                  break;\n                }\n\n                return r.default.debug(\"Resuming LiveStreaming pullStream \".concat(u.url), u), t.prev = 50, t.next = 53, e._addInjectStreamUrl(u.url, u.transcodingConfig);\n\n              case 53:\n                l = t.sent, r.default.debug(\"Resumed LiveStreaming pullStream \".concat(u.url, \": \").concat(l.reason)), t.next = 60;\n                break;\n\n              case 57:\n                t.prev = 57, t.t7 = t.catch(50), 451 === t.t7.code && r.default.debug(\"Resumed LiveStreaming pullStream \".concat(u.url, \": \").concat(t.t7.reason));\n\n              case 60:\n                t.next = 38;\n                break;\n\n              case 62:\n              case \"end\":\n                return t.stop();\n            }\n          }, t, this, [[21, 28], [50, 57]]);\n        })), function (e) {\n          return p.apply(this, arguments);\n        }), e.liveStreaming.startOptions = {\n          autoDestroyTime: 30\n        }, e.liveStreaming.transcodingConfig = {\n          audioBitrate: 48,\n          audioChannels: 1,\n          audioSampleRate: 48e3,\n          backgroundColor: 0,\n          height: 360,\n          images: [],\n          lowLatency: !1,\n          metadata: \"\",\n          userConfigExtraInfo: \"\",\n          userConfigs: [],\n          videoBitrate: 400,\n          videoCodecProfile: 100,\n          videoCodecType: 1,\n          videoFramerate: 15,\n          videoGop: 30,\n          width: 640\n        }, e.startLiveStreaming = function (n, i) {\n          _e(i) || ue(i, \"transcodingEnabled\"), ce(n, \"url\");\n          var a = o.b.reportApiInvoke(t.sessionId, {\n            name: \"Client.startLiveStreaming\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n\n          if (e.gatewayClient && \"audience\" === e.gatewayClient.role) {\n            var r = {\n              code: 403,\n              reason: \"AUDIENCE_STREAMING_FORBIDDEN\"\n            };\n            throw a(r), r;\n          }\n\n          var s = e._startLiveStreaming(n, i);\n\n          return s.then(function (e) {\n            a(null, e);\n          }).catch(function (e) {\n            a(e);\n          }), s;\n        }, e._startLiveStreaming = (l = Fe()(Ue.a.mark(function n(i, a) {\n          var o, s, c, d;\n          return Ue.a.wrap(function (n) {\n            for (;;) switch (n.prev = n.next) {\n              case 0:\n                return o = S()({\n                  allocate: !0,\n                  clientRequest: {\n                    command: \"PublishStream\"\n                  },\n                  command: \"request\"\n                }), r.default.debug(\"startLiveStreaming \".concat(i, \", \").concat(a)), S()(o.clientRequest, e.liveStreaming.startOptions, {\n                  ts: Date.now(),\n                  url: i,\n                  vid: parseInt(e.joinInfo.vid, 10)\n                }), s = null, a ? (e.liveStreaming.connections.mix_streaming || e.liveStreaming.connect(\"mix_streaming\"), o.clientRequest.transcodingConfig = JSON.parse(JSON.stringify(e.liveStreaming.transcodingConfig)), s = e.liveStreaming.connections.mix_streaming) : (\"vp8\" === t.codec && r.default.warning(\"VP8 is not supported by raw_streaming. Subscriber side will suffer\"), \"rtc\" === t.mode && r.default.warning(\"RTC mode is not supported by raw_streaming. Subscriber side will suffer\"), e.liveStreaming.connections.raw_streaming || e.liveStreaming.connect(\"raw_streaming\"), s = e.liveStreaming.connections.raw_streaming), c = null, d = {}, n.prev = 7, n.next = 10, s.request(o);\n\n              case 10:\n                c = n.sent, d.type = \"liveStreamingStarted\", d.reason = c && c.reason, d.status = c && c.code, d.url = c && c.serverResponse && c.serverResponse.url, e.gatewayClient.dispatchEvent(d), n.next = 26;\n                break;\n\n              case 18:\n                throw n.prev = 18, n.t0 = n.catch(7), d.type = \"liveStreamingFailed\", d.reason = n.t0 && n.t0.reason, d.status = n.t0 && n.t0.code, d.url = n.t0 && n.t0.serverResponse && n.t0.serverResponse.url, e.gatewayClient.dispatchEvent(d), n.t0;\n\n              case 26:\n                return e.liveStreaming.pushStates[i] = {\n                  transcodingEnabled: a,\n                  url: i\n                }, n.abrupt(\"return\", c);\n\n              case 28:\n              case \"end\":\n                return n.stop();\n            }\n          }, n, this, [[7, 18]]);\n        })), function (e, t) {\n          return l.apply(this, arguments);\n        }), e.setLiveTranscoding = function (n, i) {\n          se(n, \"transcoding\");\n          var a = n,\n              r = a.width,\n              s = a.height,\n              c = a.videoBitrate,\n              d = a.videoFramerate,\n              u = a.lowLatency,\n              l = a.audioSampleRate,\n              p = a.audioBitrate,\n              f = a.audioChannels,\n              m = a.videoGop,\n              g = a.videoCodecProfile,\n              v = a.userCount,\n              S = a.backgroundColor,\n              I = a.transcodingUsers;\n\n          if (I || (I = n.userConfigs), _e(r) || de(r, \"width\"), _e(s) || de(s, \"height\"), _e(c) || de(c, \"videoBitrate\", 1, 1e6), _e(d) || de(d, \"videoFramerate\"), _e(u) || ue(u, \"lowLatency\"), _e(l) || oe(l, \"audioSampleRate\", [32e3, 44100, 48e3]), _e(p) || de(p, \"audioBitrate\", 1, 128), _e(f) || oe(f, \"audioChannels\", [1, 2, 3, 4, 5]), _e(m) || de(m, \"videoGop\"), _e(g) || oe(g, \"videoCodecProfile\", [66, 77, 100]), _e(v) || de(v, \"userCount\", 0, 17), _e(S) || de(S, \"backgroundColor\", 0, 16777215), !_e(I)) {\n            if (!he(I)) throw new Error(\"[transcodingUsers]: transcodingUsers should be Array\");\n            if (I.length > 17) throw new Error(\"The length of transcodingUsers cannot greater than 17\");\n            I.map(function (e, t) {\n              if (!_e(e.uid) && !At(e.uid) && !isValidString(e.uid, 1, 255)) throw new Error(\"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]\");\n              if (_e(e.x) || de(e.x, \"transcodingUser[\".concat(t, \"].x\"), 0, 1e4), _e(e.y) || de(e.y, \"transcodingUser[\".concat(t, \"].y\"), 0, 1e4), _e(e.width) || de(e.width, \"transcodingUser[\".concat(t, \"].width\"), 0, 1e4), _e(e.height) || de(e.height, \"transcodingUser[\".concat(t, \"].height\"), 0, 1e4), _e(e.zOrder) || de(e.zOrder, \"transcodingUser[\".concat(t, \"].zOrder\"), 0, 100), !(_e(e.alpha) || Se(e.alpha) && e.alpha <= 1 && e.alpha >= 0)) throw new Error(\"transcodingUser[${index}].alpha: The value range is [0, 1]\");\n            });\n          }\n\n          var h = o.b.reportApiInvoke(t.sessionId, {\n            name: \"Client.setLiveTranscoding\",\n            options: arguments,\n            tag: \"tracer\"\n          });\n\n          if ((n = JSON.parse(JSON.stringify(n))).transcodingUsers && (n.userConfigs = n.transcodingUsers, delete n.transcodingUsers), e.joinInfo.stringUid && n.userConfigs && n.userConfigs.length) {\n            var _ = [];\n            n.userConfigs.forEach(function (t) {\n              _.push(Xe(e.joinInfo, e.gatewayClient, t.uid).then(function (e) {\n                t.uid = e.uid;\n              }));\n            });\n            var y = Promise.all(_).then(function () {\n              return e._setLiveTranscoding(n, i);\n            });\n            return y.then(function (e) {\n              h(null, e);\n            }).catch(function (e) {\n              h(e);\n            }), y;\n          }\n\n          var E = e._setLiveTranscoding(n, i);\n\n          return E.then(function (e) {\n            h(null, e);\n          }).catch(function (e) {\n            h(e);\n          }), E;\n        }, e._setLiveTranscoding = (u = Fe()(Ue.a.mark(function t(n, i) {\n          var a, r, o;\n          return Ue.a.wrap(function (t) {\n            for (;;) switch (t.prev = t.next) {\n              case 0:\n                if (e.liveStreaming.transcodingConfig = S()(e.liveStreaming.transcodingConfig, n), \"boolean\" != typeof i && (i = !!e.liveStreaming.connections.mix_streaming), a = JSON.parse(JSON.stringify({\n                  allocate: !1,\n                  clientRequest: {\n                    command: \"UpdateTranscoding\",\n                    transcodingConfig: e.liveStreaming.transcodingConfig\n                  },\n                  command: \"request\"\n                })), r = {}, !i) {\n                  t.next = 16;\n                  break;\n                }\n\n                return e.liveStreaming.connections.mix_streaming || e.liveStreaming.connect(\"mix_streaming\"), t.next = 8, e.liveStreaming.connections.mix_streaming.request(a);\n\n              case 8:\n                return o = t.sent, r.type = \"liveTranscodingUpdated\", r.reason = o.reason, r.status = o.code, e.gatewayClient.dispatchEvent(r), t.abrupt(\"return\", o);\n\n              case 16:\n                return t.abrupt(\"return\", {\n                  code: 200,\n                  reason: \"success\"\n                });\n\n              case 17:\n              case \"end\":\n                return t.stop();\n            }\n          }, t, this);\n        })), function (e, t) {\n          return u.apply(this, arguments);\n        }), e.stopLiveStreaming = function (n, i) {\n          ce(n, \"url\");\n\n          var a = o.b.reportApiInvoke(t.sessionId, {\n            name: \"Client.stopLiveStreaming\",\n            options: arguments,\n            tag: \"tracer\"\n          }),\n              r = e._stopLiveStreaming(n, i);\n\n          return r.then(function (e) {\n            a(null, e);\n          }).catch(function (e) {\n            a(e);\n          }), r;\n        }, e._stopLiveStreaming = (d = Fe()(Ue.a.mark(function t(n, i, a) {\n          var r, o, s, c, d, u;\n          return Ue.a.wrap(function (t) {\n            for (;;) switch (t.prev = t.next) {\n              case 0:\n                return r = null, o = e.liveStreaming.pushStates[n], r = o ? o.transcodingEnabled ? \"mix_streaming\" : \"raw_streaming\" : i ? \"mix_streaming\" : \"raw_streaming\", s = {\n                  allocate: !1,\n                  clientRequest: {\n                    command: \"UnpublishStream\",\n                    url: n\n                  },\n                  command: \"request\"\n                }, e.liveStreaming.connections[r] || e.liveStreaming.connect(r), c = null, t.prev = 6, t.next = 9, e.liveStreaming.connections[r].request(s);\n\n              case 9:\n                c = t.sent, (d = {}).type = \"liveStreamingStopped\", d.reason = c && c.reason, d.status = c && c.code, d.url = c && c.serverResponse && c.serverResponse.url, e.gatewayClient.dispatchEvent(d), t.next = 27;\n                break;\n\n              case 18:\n                throw t.prev = 18, t.t0 = t.catch(6), (u = {}).type = \"liveStreamingStopped\", u.reason = t.t0 && t.t0.reason, u.status = t.t0 && t.t0.code, u.url = t.t0 && t.t0.serverResponse && t.t0.serverResponse.url, e.gatewayClient.dispatchEvent(u), t.t0;\n\n              case 27:\n                return a || delete e.liveStreaming.pushStates[n], t.abrupt(\"return\", c);\n\n              case 29:\n              case \"end\":\n                return t.stop();\n            }\n          }, t, this, [[6, 18]]);\n        })), function (e, t, n) {\n          return d.apply(this, arguments);\n        }), e.liveStreaming.injectStreamTranscodingConfig = {\n          autoDestroyTime: 30,\n          audioBitrate: 48,\n          audioChannels: 1,\n          audioSampleRate: 44100,\n          height: 0,\n          videoBitrate: 400,\n          videoFramerate: 15,\n          videoGop: 30,\n          width: 0\n        }, e.addInjectStreamUrl = function (i, a) {\n          ce(i, \"url\", 1, 255), se(a, \"config\"), !_e(a && a.width) && de(a.width, \"config.width\", 0, 1e4), !_e(a && a.height) && de(a.height, \"config.height\", 0, 1e4), !_e(a && a.videoGop) && de(a.videoGop, \"config.videoGop\", 1, 1e4), !_e(a && a.videoFramerate) && de(a.videoFramerate, \"config.videoFramerate\", 1, 1e4), !_e(a && a.videoBitrate) && de(a.videoBitrate, \"config.videoBitrate\", 1, 1e4), !_e(a && a.audioSampleRate) && oe(a.audioSampleRate, \"config.audioSampleRate\", [32e3, 44100, 48e3]), !_e(a && a.audioBitrate) && de(a.audioBitrate, \"config.audioBitrate\", 1, 1e4), !_e(a && a.audioChannels) && de(a.audioChannels, \"config.audioChannels\", 1, 2);\n          var r = o.b.reportApiInvoke(t.sessionId, {\n            name: \"Client.addInjectStreamUrl\",\n            options: n,\n            tag: \"tracer\"\n          });\n\n          if (\"audience\" === e.gatewayClient.role) {\n            var s = {\n              code: 403,\n              reason: \"AUDIENCE_INJECTING_FORBIDDEN\"\n            };\n            throw r(s), s;\n          }\n\n          var c = e._addInjectStreamUrl(i, a);\n\n          return c.then(function (e) {\n            r(null, e);\n          }).catch(function (e) {\n            r(e);\n          }), c;\n        }, e._addInjectStreamUrl = (c = Fe()(Ue.a.mark(function n(i, a) {\n          var r, o, s, c, d;\n          return Ue.a.wrap(function (n) {\n            for (;;) switch (n.prev = n.next) {\n              case 0:\n                return r = S()({}, e.liveStreaming.injectStreamTranscodingConfig, a), o = {\n                  allocate: !0,\n                  clientRequest: {\n                    cname: e.channel,\n                    command: \"InjectStream\",\n                    sid: t.sessionId,\n                    transcodingConfig: r,\n                    ts: Date.now(),\n                    url: i,\n                    vid: parseInt(e.joinInfo.vid, 10)\n                  },\n                  command: \"request\"\n                }, e.liveStreaming.connections.inject_streaming || e.liveStreaming.connect(\"inject_streaming\"), s = null, n.prev = 4, n.next = 7, e.liveStreaming.connections.inject_streaming.request(o);\n\n              case 7:\n                s = n.sent, c = {\n                  reason: s && s.reason,\n                  status: Ct(s && s.code),\n                  type: \"streamInjectedStatus\",\n                  uid: s && s.serverResponse && s.serverResponse.inject_uid,\n                  url: s && s.serverResponse && s.serverResponse.url\n                }, e.gatewayClient.dispatchEvent(c), n.next = 17;\n                break;\n\n              case 12:\n                throw n.prev = 12, n.t0 = n.catch(4), d = {\n                  reason: n.t0 && n.t0.reason,\n                  status: Ct(n.t0 && n.t0.code),\n                  type: \"streamInjectedStatus\",\n                  uid: n.t0 && n.t0.serverResponse && n.t0.serverResponse.inject_uid,\n                  url: n.t0 && n.t0.serverResponse && n.t0.serverResponse.url\n                }, e.gatewayClient.dispatchEvent(d), n.t0;\n\n              case 17:\n                return e.liveStreaming.pullStates[i] = {\n                  transcodingConfig: r,\n                  url: i\n                }, n.abrupt(\"return\", s);\n\n              case 19:\n              case \"end\":\n                return n.stop();\n            }\n          }, n, this, [[4, 12]]);\n        })), function (e, t) {\n          return c.apply(this, arguments);\n        }), e.removeInjectStreamUrl = (a = Fe()(Ue.a.mark(function n(i) {\n          var a,\n              r,\n              s = arguments;\n          return Ue.a.wrap(function (n) {\n            for (;;) switch (n.prev = n.next) {\n              case 0:\n                return ce(i, \"url\", 1, 255), a = o.b.reportApiInvoke(t.sessionId, {\n                  name: \"Client.removeInjectStreamUrl\",\n                  options: s,\n                  tag: \"tracer\"\n                }), (r = e._removeInjectStreamUrl(i)).then(function (e) {\n                  a(null, e);\n                }).catch(function (e) {\n                  a(e);\n                }), n.abrupt(\"return\", r);\n\n              case 5:\n              case \"end\":\n                return n.stop();\n            }\n          }, n, this);\n        })), function (e) {\n          return a.apply(this, arguments);\n        }), e._removeInjectStreamUrl = (i = Fe()(Ue.a.mark(function t(n) {\n          var i, a, r, o;\n          return Ue.a.wrap(function (t) {\n            for (;;) switch (t.prev = t.next) {\n              case 0:\n                return i = {\n                  allocate: !1,\n                  clientRequest: {\n                    command: \"UninjectStream\",\n                    url: n\n                  },\n                  command: \"request\"\n                }, e.liveStreaming.connections.inject_streaming || e.liveStreaming.connect(\"inject_streaming\"), a = null, t.prev = 3, t.next = 6, e.liveStreaming.connections.inject_streaming.request(i);\n\n              case 6:\n                a = t.sent, r = {\n                  reason: a && a.reason,\n                  status: Ot(a && a.code),\n                  type: \"streamInjectedStatus\",\n                  uid: a && a.serverResponse && a.serverResponse.inject_uid,\n                  url: a && a.serverResponse && a.serverResponse.url\n                }, e.gatewayClient.dispatchEvent(r), t.next = 16;\n                break;\n\n              case 11:\n                throw t.prev = 11, t.t0 = t.catch(3), o = {\n                  reason: t.t0 && t.t0.reason,\n                  status: Ot(t.t0 && t.t0.code),\n                  type: \"streamInjectedStatus\",\n                  uid: t.t0 && t.t0.serverResponse && t.t0.serverResponse.inject_uid,\n                  url: t.t0 && t.t0.serverResponse && t.t0.serverResponse.url\n                }, e.gatewayClient.dispatchEvent(o), t.t0;\n\n              case 16:\n                return delete e.liveStreaming.pullStates[n], t.abrupt(\"return\", a);\n\n              case 18:\n              case \"end\":\n                return t.stop();\n            }\n          }, t, this, [[3, 11]]);\n        })), function (e) {\n          return i.apply(this, arguments);\n        });\n        var i;\n        var a;\n        var c;\n        var d;\n        var u;\n        var l;\n        var p;\n        var f;\n        var m;\n      }(t, e), _e(e.turnServer) || t.setTurnServer(e.turnServer), _e(e.proxyServer) || t.setProxyServer(e.proxyServer), \"live\" === t.mode && (t.gatewayClient.role = \"audience\"), \"rtc\" === t.mode && (t.gatewayClient.role = \"host\"), t.gatewayClient.on(\"onMultiIP\", function (e) {\n        t.gatewayClient.closeGateway(), t.gatewayClient.socket = void 0, t.gatewayClient.hasChangeBGPAddress = !0, t.joinInfo.multiIP = e.option, t.gatewayClient.state = ot.CONNECTING;\n\n        var n = function (e) {\n          r.default.info(\"[\".concat(t.clientId, \"] Joining channel: \").concat(t.channel)), t.joinInfo.cid = e.cid, t.joinInfo.uid || (t.joinInfo.uid = e.uid), t.joinInfo.uni_lbs_ip = e.uni_lbs_ip, t.joinInfo.gatewayAddr = e.gateway_addr, t.onSuccess ? t.gatewayClient.join(t.joinInfo, t.key, function (e) {\n            r.default.info(\"[\".concat(t.clientId, \"] Join channel \").concat(t.channel, \" success\"));\n            var n = t.onSuccess;\n            t.onSuccess = null, t.onFailure = null, n(e);\n          }, t.onFailure) : (t.gatewayClient.joinInfo = S()({}, t.joinInfo), t.gatewayClient.rejoin());\n        };\n\n        t.joinInfo.stringUid && !t.joinInfo.uid ? (t.userAccountReq && !t.userAccountReq.isFinished() && t.userAccountReq.cancel(), t.userAccountReq = Xe(joinInfo, t.gatewayClient), t.userAccountReq.then(function (e) {\n          r.default.error(\"getUserAccount Success \".concat(e.url, \" \").concat(joinInfo.stringUid, \" => \").concat(e.uid)), t.joinInfo.uid = e.uid, ze(t.joinInfo, n, t.onFailure);\n        }).catch(function (e) {\n          r.default.error(\"getUserAccount rejected\", e), t.onFailure(e);\n        })) : ze(t.joinInfo, n, t.onFailure);\n      }), t.gatewayClient.on(\"rejoin-start\", function () {\n        t._renewSession(), o.b.sessionInit(e.sessionId, {\n          lts: new Date().getTime(),\n          extend: {\n            rejoin: !0\n          },\n          cname: t.channel,\n          appid: e.appId,\n          mode: e.mode,\n          succ: !0\n        });\n      }), t.gatewayClient.on(\"recover\", function () {\n        t._renewSession(), console.log(\"recover\", e.sessionId), o.b.sessionInit(e.sessionId, {\n          lts: new Date().getTime(),\n          extend: {\n            recover: !0\n          },\n          cname: t.channel,\n          appid: e.appId,\n          mode: e.mode,\n          succ: !0\n        });\n      }), t.gatewayClient.on(\"rejoin\", function () {\n        var e = t.highStreamState;\n\n        if (r.default.debug(\"[\".concat(t.clientId, \"] Client local stream preState: \").concat(e)), t.onSuccess) {\n          var n = t.onSuccess;\n          t.onSuccess = null, t.onFailure = null, n();\n        }\n\n        !t.highStream || 0 !== e && 1 !== e || (r.default.info(\"[\".concat(t.clientId, \"] publish after rejoin\")), t.highStreamState = 2, t.lowStreamState = 2, t.publish(t.highStream, function (e) {\n          e && r.default.info(\"[\".concat(t.clientId, \"] \"), e);\n        }));\n      }), t.gatewayClient.on(\"streamPublished\", function (e) {\n        t.hasPublished || (t.hasPublished = !0, t.gatewayClient.dispatchEvent(d({\n          type: \"stream-published\",\n          stream: e.stream\n        })));\n      }), t.gatewayClient.on(\"pubP2PLost\", function (e) {\n        r.default.debug(\"[\".concat(t.clientId, \"] Start reconnect local peerConnection: \").concat(t.highStream.getId())), t.gatewayClient.dispatchEvent({\n          type: \"stream-reconnect-start\",\n          uid: t.highStream.getId()\n        }), 1 === t.highStreamState && (t.highStreamState = 0, t.lowStreamState = 0), t._unpublish(t.highStream, function () {\n          t._publish(t.highStream, function () {\n            r.default.debug(\"[\".concat(t.clientId, \"] Reconnect local peerConnection success: \").concat(t.highStream.getId())), t.gatewayClient.dispatchEvent({\n              type: \"stream-reconnect-end\",\n              uid: t.highStream.getId(),\n              success: !0,\n              reason: \"\"\n            });\n          }, function (e) {\n            r.default.debug(\"[\".concat(t.clientId, \"] Reconnect local peerConnection failed: \").concat(e)), t.gatewayClient.dispatchEvent({\n              type: \"stream-reconnect-end\",\n              uid: t.highStream.getId(),\n              success: !1,\n              reason: e\n            });\n          });\n        }, function (e) {\n          r.default.debug(\"[\".concat(t.clientId, \"] Reconnect local peerConnection failed: \").concat(e)), t.gatewayClient.dispatchEvent({\n            type: \"stream-reconnect-end\",\n            uid: t.highStream.getId(),\n            success: !1,\n            reason: e\n          });\n        });\n      }), t.gatewayClient.on(\"subP2PLost\", function (e) {\n        r.default.debug(\"[\".concat(t.clientId, \"] Start reconnect remote peerConnection: \").concat(e.stream.getId(), \" \").concat(e.stream.subscribeOptions)), t.gatewayClient.dispatchEvent({\n          type: \"stream-reconnect-start\",\n          uid: e.stream.getId()\n        });\n        var n = e.stream.subscribeOptions;\n        console.log(\"Re-subscribe stream\", n, e.stream), t.gatewayClient.unsubscribe(e.stream, function () {\n          e.stream.subscribeOptions = n, t.gatewayClient.subscribe(e.stream, function () {\n            r.default.debug(\"[\".concat(t.clientId, \"] Reconnect remote peerConnection success: \").concat(e.stream.getId())), t.gatewayClient.dispatchEvent({\n              type: \"stream-reconnect-end\",\n              uid: e.stream.getId(),\n              success: !1,\n              reason: \"\"\n            });\n          }, function (n) {\n            r.default.debug(\"[\".concat(t.clientId, \"] Reconnect remote peerConnection failed: \"), n), t.gatewayClient.dispatchEvent({\n              type: \"stream-reconnect-end\",\n              uid: e.stream.getId(),\n              success: !1,\n              reason: n\n            });\n          });\n        }, function (n) {\n          r.default.debug(\"[\".concat(t.clientId, \"] Reconnect remote peerConnection failed: \"), n), t.gatewayClient.dispatchEvent({\n            type: \"stream-reconnect-end\",\n            uid: e.stream.getId(),\n            success: !1,\n            reason: n\n          });\n        });\n      }), lt.on(\"networkTypeChanged\", function (e) {\n        t.gatewayClient && t.gatewayClient.dispatchEvent(e);\n        var n = S()({}, e, {\n          type: \"network-type-changed\"\n        });\n        t.gatewayClient.dispatchEvent(n);\n      }), ie.on(\"recordingDeviceChanged\", function (e) {\n        t.gatewayClient && t.gatewayClient.dispatchEvent(e);\n        var n = S()({}, e, {\n          type: \"recording-device-changed\"\n        });\n        t.gatewayClient.dispatchEvent(n);\n      }), ie.on(\"playoutDeviceChanged\", function (e) {\n        t.gatewayClient && t.gatewayClient.dispatchEvent(e);\n        var n = S()({}, e, {\n          type: \"playout-device-changed\"\n        });\n        t.gatewayClient.dispatchEvent(n);\n      }), ie.on(\"cameraChanged\", function (e) {\n        t.gatewayClient && t.gatewayClient.dispatchEvent(e);\n        var n = S()({}, e, {\n          type: \"camera-changed\"\n        });\n        t.gatewayClient.dispatchEvent(n);\n      }), t.gatewayClient.on(\"streamTypeChange\", function (n) {\n        var i = S()({}, n, {\n          type: \"stream-type-changed\"\n        });\n        t.gatewayClient.dispatchEvent(i), o.b.reportApiInvoke(e.sessionId, {\n          name: \"streamTypeChange\"\n        })(null, JSON.stringify(n));\n      }), t;\n    },\n        wt = {\n      width: 640,\n      height: 360,\n      videoBitrate: 400,\n      videoFramerate: 15,\n      lowLatency: !1,\n      audioSampleRate: 48e3,\n      audioBitrate: 48,\n      audioChannels: 1,\n      videoGop: 30,\n      videoCodecProfile: 100,\n      userCount: 0,\n      userConfigExtraInfo: {},\n      backgroundColor: 0,\n      transcodingUsers: []\n    },\n        Dt = ie.getDevices,\n        kt = K,\n        Lt = JSON.parse(JSON.stringify(a.SUPPORT_RESOLUTION_LIST));\n\n    t.default = {\n      TranscodingUser: {\n        uid: 0,\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        zOrder: 0,\n        alpha: 1\n      },\n      LiveTranscoding: wt,\n      createClient: function (e) {\n        var t = o.b.reportApiInvoke(null, {\n          name: \"createClient\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        (e = S()({}, e || {})).codec || (e.codec = function (e) {\n          switch (e) {\n            case \"h264_interop\":\n              return \"h264\";\n\n            default:\n              return \"vp8\";\n          }\n        }(e.mode));\n\n        var n = function (e) {\n          return -1 === Ce.indexOf(e.mode) ? x.INVALID_CLIENT_MODE : -1 === Oe.indexOf(e.codec) ? x.INVALID_CLIENT_CODEC : \"h264_interop\" == e.mode && \"h264\" !== e.codec && x.CLIENT_MODE_CODEC_MISMATCH;\n        }(e);\n\n        if (n) throw r.default.error(\"Invalid parameter setting MODE: \".concat(e.mode, \" CODEC: \").concat(e.codec, \" ERROR \").concat(n)), t(n), new Error(n);\n        return r.default.info(\"Creating client, MODE: \".concat(e.mode, \" CODEC: \").concat(e.codec)), function (e) {\n          switch (e.mode) {\n            case \"interop\":\n            case \"h264_interop\":\n              e.mode = \"live\";\n              break;\n\n            case \"web-only\":\n              e.mode = \"rtc\";\n          }\n        }(e), t(null, e), Nt(e);\n      },\n      createStream: function (e) {\n        var t = o.b.reportApiInvoke(null, {\n          name: \"createStream\",\n          options: arguments,\n          tag: \"tracer\"\n        });\n        se(e, \"StreamSpec\");\n        var n = e.streamID,\n            i = e.audio,\n            a = e.video,\n            s = e.screen,\n            c = (e.audioSource, e.videoSource, e.cameraId),\n            d = e.facingMode,\n            u = e.microphoneId,\n            l = e.mirror,\n            p = e.extensionId,\n            f = e.mediaSource,\n            m = e.audioProcessing;\n        if (!_e(n) && !Object(te.c)(n) && !le(n, 1, 255)) throw new Error(\"[String streamID] Length of the string: [1,255]. ASCII characters only. [Number streamID] The value range is Uint32\");\n\n        if (ue(i, \"audio\"), ue(a, \"video\"), _e(s) || ue(s, \"screen\"), _e(c) || ce(c, \"cameraId\", 0, 255, !1), _e(d) || oe(d, \"facingMode\", [\"user\", \"environment\", \"left\", \"right\"]), _e(u) || ce(u, \"microphoneId\", 0, 255, !1), _e(p) || ce(p, \"extensionId\"), _e(f) || oe(f, \"mediaSource\", [\"screen\", \"application\", \"window\"]), _e(l) || ue(l, \"mirror\"), !_e(m)) {\n          var g = m.AGC,\n              v = m.AEC,\n              S = m.ANS;\n          _e(g) || ue(g, \"AGC\"), _e(v) || ue(v, \"AEC\"), _e(S) || ue(S, \"ANS\");\n        }\n\n        r.default.debug(\"Create stream\");\n        var I = Re(e);\n        return t(), I;\n      },\n      Logger: r.default,\n      report: o.b,\n      getDevices: Dt,\n      getScreenSources: kt,\n      getParameter: a.getParameter,\n      setParameter: a.setParameter,\n      checkSystemRequirements: function () {\n        var e = o.b.reportApiInvoke(null, {\n          name: \"checkSystemRequirements\",\n          options: arguments,\n          tag: \"tracer\"\n        }),\n            t = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection,\n            n = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.msGetUserMedia || navigator.mozGetUserMedia || navigator.mediaDevices && navigator.mediaDevices.getUserMedia,\n            i = window.WebSocket,\n            a = !!t && !!n && !!i,\n            s = !1;\n        r.default.debug(f.getBrowserInfo(), \"isAPISupport:\" + a), f.isChrome() && f.getBrowserVersion() >= 58 && \"iOS\" !== f.getBrowserOS() && (s = !0), f.isFireFox() && f.getBrowserVersion() >= 56 && (s = !0), f.isOpera() && f.getBrowserVersion() >= 45 && (s = !0), f.isSafari() && f.getBrowserVersion() >= 11 && (s = !0), f.isEdge() && (s = !0), (f.isWeChatBrowser() || f.isQQBrowser()) && \"iOS\" !== f.getBrowserOS() && (s = !0), f.isSupportedPC() || f.isSupportedMobile() || (s = !1);\n        var c = a && s;\n        return e(null, c), c;\n      },\n      getSupportedCodec: Ae.getSupportedCodec,\n      VERSION: a.VERSION,\n      BUILD: a.BUILD,\n      PROFILE_TABLE: Lt,\n      AUDIO_SAMPLE_RATE_32000: 32e3,\n      AUDIO_SAMPLE_RATE_44100: 44100,\n      AUDIO_SAMPLE_RATE_48000: 48e3,\n      VIDEO_CODEC_PROFILE_BASELINE: 66,\n      VIDEO_CODEC_PROFILE_MAIN: 77,\n      VIDEO_CODEC_PROFILE_HIGH: 100,\n      REMOTE_VIDEO_STREAM_HIGH: 0,\n      REMOTE_VIDEO_STREAM_LOW: 1,\n      REMOTE_VIDEO_STREAM_MEDIUM: 2\n    };\n  }]).default;\n});","map":null,"metadata":{},"sourceType":"script"}